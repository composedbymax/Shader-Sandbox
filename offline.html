<!-- 
 ____  _   _    _    ____   _____  ____  
/ ___|| | | |  /_\  |  _ \ | ____||  _ \ 
\___ \| |_| | / _ \ | | | ||  _|  | |_) |
|____/|_| |_|/_/ \_\|____/ |_____||_| \_\

                  Sandbox

Created By Max Warren
https://max.x10.mx/
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <title>CODEVANILLA - SHADER</title>
  <meta charset="UTF-8">
  <meta name="description" content="A browser-based GLSL editor for writing, previewing, and exporting real-time WebGL shaders with audio-reactive support, video recording, and full HTML export">
  <meta name="keywords" content="GLSL, WebGL, shader editor, live coding, Max, browser shader tool, WebGL editor, visual coding, audio reactive shader">
  <meta name="author" content="github.com/composedbymax">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#252525">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="GLSL Editor">
  <meta name="format-detection" content="telephone=no">
  <meta name="application-name" content="GLSL Editor">
  <meta name="HandheldFriendly" content="true">
  <meta name="apple-touch-fullscreen" content="yes">
  <link rel="icon" sizes="192x192" href="/assets/img/icon-192.png">
  <link rel="icon" sizes="512x512" href="/assets/img/icon-512.png">
  <link rel="apple-touch-icon" href="/assets/img/icon-192.png">
  <link rel="apple-touch-startup-image" href="/assets/img/icon-512.png">
  <meta name="msapplication-TileColor" content="#252525">
  <meta name="msapplication-TileImage" content="/assets/img/icon-192.png">
  <link rel="shortcut icon" href="/favicon.ico">
  <meta name="robots" content="index, nofollow">
  <meta name="referrer" content="no-referrer">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="GLSL Editor Application">
  <meta name="twitter:description" content="Write and preview GLSL shaders in real-time. Audio reactive support, WebGL, and full HTML export.">
  <meta name="twitter:image" content="https://max.wuaze.com/assets/img/glsl.jpeg">
  <meta name="twitter:site" content="@composedbymax">
  <meta property="og:title" content="GLSL Editor Application" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://max.wuaze.com/glsl" />
  <meta property="og:image" content="https://max.wuaze.com/assets/img/glsl.jpeg" />
  <meta property="og:description" content="An interactive GLSL editor for experimenting with shaders directly in your browser." />
  <meta property="og:site_name" content="GLSL Editor by Max Wuaze" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self';script-src 'self' 'unsafe-inline' 'unsafe-eval';worker-src 'self' blob:;style-src 'self' 'unsafe-inline';img-src 'self' data:;connect-src 'self';font-src 'self';object-src 'none';media-src 'self' blob:;">
  <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(self), camera=(), fullscreen=(self), clipboard-read=(self), clipboard-write=(self)">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script>
    (function() {
    var attemptKey = '__pageAttempts';
    var lockoutKey = '__pageLockout';
    var maxAttempts = 5;
    var timeWindow = 30000; // 30 seconds
    var lockoutDuration = 300000; // 5 minutes
    function getAttempts() {
        var stored = sessionStorage.getItem(attemptKey);
        return stored ? JSON.parse(stored) : [];
    }
    function addAttempt() {
        var attempts = getAttempts();
        var now = Date.now();
        attempts = attempts.filter(function(time) {
            return now - time < timeWindow;
        });
        attempts.push(now);
        sessionStorage.setItem(attemptKey, JSON.stringify(attempts));
        return attempts.length;
    }
    function isLockedOut() {
        var lockout = sessionStorage.getItem(lockoutKey);
        if (!lockout) return false;
        var lockoutTime = parseInt(lockout);
        var now = Date.now();
        if (now - lockoutTime > lockoutDuration) {
            sessionStorage.removeItem(lockoutKey);
            sessionStorage.removeItem(attemptKey);
            return false;
        }
        return true;
    }
    function triggerLockout() {
        sessionStorage.setItem(lockoutKey, Date.now().toString());
        showBlackScreen();
    }
    function showBlackScreen() {
        document.documentElement.innerHTML = '';
        var blackScreen = document.createElement('div');
        blackScreen.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2147483647;
            margin: 0;
            padding: 0;
        `;
        document.documentElement.appendChild(blackScreen);
        Object.defineProperty(document, 'body', {
            get: function() { return null; },
            set: function() {}
        });
        return;
    }
    if (isLockedOut()) {
        showBlackScreen();
        return;
    }
    var currentAttempts = addAttempt();
    if (currentAttempts >= maxAttempts) {
        triggerLockout();
        return;
    }
    var css = `
        #__pageCover{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background:rgb(0, 0, 0);z-index: 2147483647;overflow: hidden;transition: opacity 1s ease;}
        #__pageCover.shatter-exit{opacity: 0;}
        #__pageCover .title-container{position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);text-align: center;z-index: 10;transition: opacity 0.4s ease, transform 0.4s ease;}
        #__pageCover .main-title{font-family: 'Courier New', monospace;font-size: clamp(2rem, 8vw, 6rem);font-weight: bold;color: #fff;margin: 0;letter-spacing: 0.1em;}
        #__pageCover .subtitle{font-family: 'Arial', sans-serif;font-size: clamp(1rem, 3vw, 1.5rem);color: rgba(255, 255, 255, 0.8);margin-top: 1rem;letter-spacing: 0.2em;text-transform: uppercase;}
        #__pageCover .grid-container{position: absolute;top: 0;left: 0;width: 100%;height: 100%;display: grid;grid-template-columns: repeat(20, 1fr);grid-template-rows: repeat(15, 1fr);gap: 1px;opacity: 1;}
        #__pageCover .grid-piece{background:rgb(0, 0, 0);border: 1px solid rgba(0, 162, 255, 0.3);position: relative;overflow: hidden;}
        #__pageCover.shatter-exit .title-container{opacity: 0;transform: translate(-50%, -50%) scale(0.8);}
        #__pageCover.shatter-exit .grid-piece{animation: __shatterPiece 1s ease-in forwards;}
        @keyframes __shatterPiece{0%{transform: scale(1) rotate(0deg);opacity: 1;}
        70%{transform: scale(0.8) rotate(var(--rotate)) translateX(var(--tx)) translateY(var(--ty));opacity: 0.3;}
        100%{transform: scale(0) rotate(calc(var(--rotate) * 2)) translateX(calc(var(--tx) * 2)) translateY(calc(var(--ty) * 2));opacity: 0;}}
    `;
    var st = document.createElement('style');
    st.textContent = css;
    document.head.appendChild(st);
    var cover = document.createElement('div');
    cover.id = '__pageCover';
    var titleContainer = document.createElement('div');
    titleContainer.className = 'title-container';
    titleContainer.innerHTML = `
        <h1 class="main-title">Shader Sandbox</h1>
        <div class="subtitle">Created By: Max Warren</div>
    `;
    var gridContainer = document.createElement('div');
    gridContainer.className = 'grid-container';
    for (var i = 0; i < 300; i++) {
        var piece = document.createElement('div');
        piece.className = 'grid-piece';
        var rotate = (Math.random() - 0.5) * 720;
        var tx = (Math.random() - 0.5) * 200;
        var ty = (Math.random() - 0.5) * 200;
        var delay = Math.random() * 0.3;
        piece.style.setProperty('--rotate', rotate + 'deg');
        piece.style.setProperty('--tx', tx + 'px');
        piece.style.setProperty('--ty', ty + 'px');
        piece.style.animationDelay = delay + 's';
        gridContainer.appendChild(piece);
    }
    cover.appendChild(titleContainer);
    cover.appendChild(gridContainer);
    document.documentElement.appendChild(cover);
    window.addEventListener('load', function() {
        setTimeout(function() {
            cover.classList.add('shatter-exit');
            setTimeout(function() {
                cover.remove();
                st.remove();
            }, 1000);
        }, 900);
    });
})();
  </script>
  <style>
    *{--pad: 6px 10px;margin: 0;padding: 0;box-sizing: border-box;font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;}html,
body{width: 100%;height: 100%;overflow: hidden;overscroll-behavior: none;-webkit-overflow-scrolling: none;background: var(--1);color: var(--l);overflow: hidden;font: 16px/1.6 sans-serif;}input[type="range"]{width: 100%;height: 12px;-webkit-appearance: none;appearance: none;background: var(--d);border-radius: 10px;outline: none;transition: 0.6s ease;}input[type="range"]:hover{background: var(--D);}input[type="range"]::-webkit-slider-thumb{-webkit-appearance: none;appearance: none;width: 34px;height: 26px;border-radius: 2px;background: var(--D);border: 0.5px solid var(--a);cursor: pointer;transition: 0.3s ease;}input[type="range"]:focus::-webkit-slider-thumb{background: var(--b);transform: scale(1.1);}input[type="range"]::-moz-range-thumb{width: 34px;height: 26px;border-radius: 2px;background: var(--l);border: 0.5px solid var(--a);cursor: pointer;transition: 0.3s ease;}input[type="range"]:focus::-moz-range-thumb{background: var(--b);transform: scale(1.1);}::-webkit-scrollbar{width:14px;height:12px;}::-webkit-scrollbar-thumb{background-color:var(--4);border-radius:4px;border:3px solid var(--d);min-height:5rem;}::-webkit-scrollbar-thumb:hover{background-color:var(--5);border-radius:4rem;}::-webkit-scrollbar-track{background:var(--3);border-radius:4px;}#app{display: flex;height: 100%;}#editors{width: 40%;background: var(--2);display: flex;flex-direction: column;border-right: 2px solid var(--4);position: relative;z-index:100;}.editor-panel{flex: none;display: flex;flex-direction: column;overflow: hidden;white-space: nowrap;z-index:2;}.panel-header{background: var(--3);color: var(--6);padding: var(--pad);font-size: 0.9em;display: flex;justify-content: space-between;align-items: center;}.panel-header input[type=file]{display: none;}.file-name{margin-left: 8px;color: var(--6);font-size: 0.9em;}.panel-header button{background: var(--4);border: none;padding: 2px 6px;cursor: pointer;}.panel-header button:hover, #divider:hover,#fsBtn:hover{background: var(--5);}#rowDivider{height: 10px;background: var(--4);cursor: row-resize;flex: none;transition:0.5s all;}textarea{flex: 1;background: var(--2);color: var(--6);border: none;padding: 4px;font-size: 0.95em;line-height: 1.4;resize: none;overflow: auto;outline: none;}#divider{width: 12px;background: var(--3);cursor: col-resize;transition:0.5s all;}#preview-panel{flex: 1;position: relative;background: var(--1);display: flex;justify-content: center;align-items: center;}#lint{position: absolute;bottom: 0;z-index: 10000;left: 0;width: 100%;max-height: 30%;background: var(--0);color: var(--r);font-size: 0.9em;overflow: auto;white-space: pre-wrap;}#copyErrorsBtn{position: absolute;top: 5px;right: 40px;background: var(--3);color: var(--7);border: none;padding: 4px 8px;cursor: pointer;z-index: 10001;}#copyErrorsBtn:hover{background: var(--5);}#closeLintBtn{position: absolute;top: 5px;right: 5px;background: var(--r);border: none;color: var(--7);cursor: pointer;padding: 4px 8px;z-index: 10001;}#closeLintBtn:hover{background: var(--0);color:var(--r);}#lintContent{padding: 0 10px 0 10px;}#glcanvas{width: 100%;height: 100%;display: block;}#fsBtn{position: absolute;top: 10px;right: 10px;z-index: 2;background: var(--d);color: var(--6);border: none;padding: var(--pad);font-size: 1em;cursor: pointer;width:2rem;height:2rem;}.lbtn{height:39px;position: absolute;bottom: 10px;right: 10px;background: var(--d);color: var(--l);padding: 12px 10px;border: none;cursor: pointer;z-index:10;}.expbtn:hover{background:var(--5);}.expbtn{position: absolute;bottom: 10px;right: 10px;background: var(--d);color: var(--l);height:39px;border: none;cursor: pointer;z-index:4;width:4.25rem;}.lbtn:hover{background:var(--5);}.savew{display:none;position:absolute;width:100%;height:100%;background:var(--2);color:var(--6);padding:10px;z-index:100;}.toggles{display:flex;margin-bottom:10px;}.togbtn{flex: 1;border: none;padding: 16px 0px;cursor: pointer;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;text-align: center;color:var(--6);}.savesct{display:none;overflow:auto;height:90%;padding:10px;}.closebtn{width: 100%;position: absolute;bottom: 10px;right: 10px;background: var(--5);color: var(--l);border: none;cursor: pointer;padding: 12px;max-width:7.8rem;}.savebtn, .sharebtn{background: var(--5);color: var(--7);border: none;cursor: pointer;padding: var(--pad);text-align: center;margin-bottom: 0.5rem;max-height:4rem;max-width: 6rem;word-break: break-word;overflow-wrap: break-word;white-space: normal;}.savebtn{overflow: hidden;}.savebtn:hover, .sharebtn:hover{background: var(--4);}.upldzone{border:2px dashed var(--4);padding:20px;text-align:center;margin-bottom:10px;cursor:pointer;background:var(--3);color:var(--7);overflow-wrap: break-word;max-height:300px;}.ellips, .upldzone p{white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}.saveinput{width:100%;padding:5px;margin-bottom:10px;background:var(--3);color:var(--7);border:none;}.img{margin:6px 0;max-width:100%;}.ldbtn{padding:6px;background:var(--5);color:var(--7);border:none;cursor:pointer;width:80%;max-width:12.5rem;}.xbtn{float:right;padding:4px;background:var(--5);color:var(--7);border:none;cursor:pointer;}@media (max-width: 767px){#divider{width: 14px;transition:0.5s all;}#rowDivider{height: 12px;transition:0.5s all;}}.none{display:none;}#canvas3D{position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index: 0;}#threeLoadBtn{position: absolute;bottom: 10px;right: 146px;z-index: 2;background: var(--d);color: var(--l);border: none;cursor: pointer;width:4.25rem;height:39px;}#threeLoadBtn:hover{background: var(--5);color: var(--l);}#threedModalBg{display: none;position: fixed;inset: 0;background: rgba(0, 0, 0, 0.5);z-index: 100;justify-content: center;align-items: center;}#threedModalBg.show{display: flex;}#threedModal{background: var(--2);padding: 20px;border-radius: 6px;color: var(--7);min-width: 320px;border: 1px solid var(--4);}#threedModal h2{margin-top: 0;color: var(--6);}#threedDropZone{border: 2px dashed var(--5);background: var(--3);padding: 30px;text-align: center;border-radius: 6px;cursor: pointer;transition: background 0.2s, border-color 0.2s;color: var(--7);user-select: none;}#threedDropZone:hover{background: var(--4);}#threedDropZone.dragover{border-color: var(--rh);background: var(--4);}#threedDropZone p{margin: 0;font-size: 14px;color: var(--6);}#threedModal label{color: var(--6);}#threedInfo{margin-top: 10px;color: var(--6);font-size: 14px;}#threedErr{margin-top: 10px;color: var(--rh);font-size: 14px;display: none;}#threedModal footer{margin-top: 20px;text-align: right;display: flex;gap: 10px;justify-content: flex-end;}#threedClose, #threedRevert{padding: 6px 12px;background: var(--3);color: var(--6);border: 1px solid var(--4);border-radius: 4px;cursor: pointer;}#threedClose:hover, #threedRevert:hover{background: var(--4);color: var(--l);}#threedRevert{background: var(--5);color: var(--l);}#threedRevert:hover{background: var(--6);}.format-info{margin-top: 5px;font-size: 12px;color: var(--5);}.audio-reactive-button{background-color: var(--d);position: absolute;top: 50%;right: 10px;transform: translateY(-50%);padding: 8px;background-color: var(--d);color: var(--6);border: none;border-radius: 0;cursor: pointer;font-size: 12px;display: flex;transition: all .2s ease;z-index: 2;height: 2rem;width: 2rem;}.audio-reactive-button.active{background-color: var(--a);}.audio-reactive-button.active:hover{background-color: var(--ah);}.audio-reactive-button:hover{background-color: var(--5);}.audio-reactive-modal{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background-color: none;display: none;z-index: 10000;}.audio-reactive-modal-wrap{position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);background-color: var(--3);border-radius: 2px;padding: 24px;border: 0.1px solid var(--4);min-width: 250px;max-width: 600px;max-height: 80vh;overflow-y: auto;}.audio-reactive-header{display: flex;align-items: center;justify-content: space-between;margin-bottom: 20px;}.audio-reactive-title{margin: 0;color: var(--7);display: flex;align-items: center;gap: 8px;}.audio-reactive-button-group{display: flex;gap: 8px;}.audio-reactive-info-btn{background: none;border: none;color: var(--7);font-size: 16px;cursor: pointer;padding: 4px;border-radius: 2px;transition: background .2s ease;}.audio-reactive-info-btn:hover{background-color: var(--5);}.audio-reactive-close-btn{background: none;border: none;color: var(--7);font-size: 30px;cursor: pointer;}.audio-reactive-mic-section{margin-bottom: 15px;}.audio-reactive-label{display: block;color: var(--7);margin-bottom: 8px;font-size: 14px;}.audio-reactive-select{width: 100%;padding: 8px;background: var(--3);border: 1px solid var(--4);color: var(--7);border-radius: 2px;font-size: 14px;cursor: pointer;}.audio-reactive-toggle-section{margin-bottom: 20px;padding: 0px;background: var(--d);border-radius: 2px;}.audio-reactive-toggle-btn{width: 100%;padding: 12px;background: var(--3);border: none;color: var(--7);border-radius: 2px;cursor: pointer;transition: all .2s ease;}.audio-reactive-status{margin-top: 8px;font-size: 12px;color: var(--7);text-align: center;}.audio-reactive-slider-group{margin-bottom: 10px;}.audio-reactive-slider-label{display: block;color: white;margin-bottom: 4px;}.audio-reactive-slider-value{margin-left: 8px;}.audio-reactive-slider{width: 100%;}.audio-reactive-levels{margin-top: 20px;padding: 16px;background: var(--d);border-radius: 0px;}.audio-reactive-levels-title{margin: 0 0 12px 0;color: white;font-size: 14px;}.audio-reactive-bars{display: flex;gap: 8px;height: 60px;align-items: end;}.audio-bar{flex: 1;border-radius: 2px;min-height: 2px;transition: height .1s ease;}.audio-bar[data-type="bass"]{background: #ff4444;}.audio-bar[data-type="mid"]{background: #44ff44;}.audio-bar[data-type="treble"]{background: #4444ff;}.audio-bar[data-type="volume"]{background: #ffff44;}.audio-reactive-bar-labels{display: flex;justify-content: space-between;color: var(--7);margin-top: 8px;}.audio-reactive-bar-label{font-size: 12px;}.audio-reactive-info-content{color: var(--7);line-height: 1.6;display: none;}.audio-reactive-info-title{color: white;margin: 0 0 16px 0;}.audio-reactive-info-text{margin: 0 0 16px 0;}.audio-reactive-code-block{background: var(--d);padding: 16px;border-radius: 4px;margin: 16px 0;font-family: monospace;font-size: 13px;}.audio-reactive-code-comment{color: #8be9fd;margin-bottom: 8px;}.audio-reactive-code-type{color: #50fa7b;}.audio-reactive-code-var{color: #f8f8f2;}.audio-reactive-code-inline-comment{color: #6272a4;}.audio-reactive-example-title{color: white;margin: 20px 0 12px 0;}.audio-reactive-notes-title{color: white;margin: 20px 0 12px 0;}.audio-reactive-notes-list{margin: 0;padding-left: 20px;}.audio-reactive-notes-item{margin-bottom: 8px;}.audio-reactive-tip-box{background: #1a4b32;padding: 12px;border-radius: 4px;margin: 16px 0;border-left: 4px solid var(--a);}.audio-reactive-tip-strong{color: var(--a);}.audio-reactive-tip-text{color: var(--7);}.audio-reactive-file-drop{margin-bottom: 20px;padding: 20px;background: var(--d);border: 2px dashed var(--4);text-align: center;cursor: pointer;transition: border-color .2s ease;}.audio-reactive-file-drop.dragover{border-color: var(--7);}.audio-reactive-file-text{color: var(--7);}.audio-reactive-upload-btn{background: var(--5);border-radius: 2px;text-decoration: none;padding: 0.5rem 1rem;border: none;color: var(--7);cursor: pointer;}.audio-reactive-file-input{display: none;}.audio-reactive-file-audio{width: 100%;display: none;margin-top: 10px;}.audio-reactive-clear-btn{display: none;margin-top: 10px;padding: 6px 12px;background: var(--d);border: none;color: var(--7);cursor: pointer;}.audio-code-span{color:#ff79c6;}.banner{position: fixed;top: 0;left: 0;right: 0;background: var(--2);color: var(--7);padding: 12px 16px;display: flex;justify-content: space-between;align-items: center;z-index: 9999;font-family: sans-serif;font-size: 16px;transition: transform 0.3s ease, opacity 0.3s ease;}.banner-link{color: var(--a);margin-left: 4px;text-decoration: underline;}.banner-auth-button{margin-left: 4px;background: var(--3);color: var(--7);padding: 0.3rem 0.6rem;border: none;cursor: pointer;font-size: 1rem;}.banner-close{background: none;border: none;color: var(--7);font-size: 20px;cursor: pointer;margin-left: 20px;}.banner-no-transition{transition: none !important;}.camera-btn{position: absolute;top: 42px;right: 42px;background: var(--d);color: var(--6);border: none;width: 2rem;height: 2rem;cursor: pointer;font-size: 14px;z-index: 2;transition: background 0.2s;}.camera-btn:hover{background: var(--5);}.camera-btn.active{background: var(--r);}.camera-modal{display: none;position: fixed;top: 0;left: 0;width: 100%;height: 100%;z-index: 100;justify-content: center;align-items: center;}.camera-modal.show{display: flex;}.camera-content{background: var(--4);padding: 20px;border-radius: 8px;max-width: 600px;width: 90%;max-height: 90%;overflow-y: auto;position: relative;}.camera-header{display: flex;justify-content: space-between;align-items: center;margin-bottom: 20px;color: var(--l);}.camera-close{background: none;border: none;color: var(--l);font-size: 24px;cursor: pointer;padding: 0;width: 30px;height: 30px;display: flex;align-items: center;justify-content: center;}.camera-close:hover{color: var(--l);}.camera-preview{width: 100%;max-width: 400px;height: 300px;background: var(--2);border: 2px solid var(--5);border-radius: 4px;margin: 0 auto 20px;display: block;object-fit: cover;}.camera-controls{display: flex;flex-direction: column;gap: 10px;align-items: center;}.camera-device-select{width: 100%;max-width: 300px;padding: 8px 12px;background: var(--4);color: var(--l);border: 1px solid var(--5);border-radius: 4px;margin-bottom: 15px;}.camera-buttons{display: flex;gap: 10px;flex-wrap: wrap;justify-content: center;}.camera-control-btn{background: var(--a);color: var(--l);border: none;padding: 10px 20px;border-radius: 4px;cursor: pointer;font-size: 14px;min-width: 100px;}.camera-control-btn:hover{background: var(--ah);}.camera-control-btn:disabled{background: var(--3);cursor: not-allowed;}.camera-control-btn.stop{background: var(--r);}.camera-control-btn.stop:hover{background: var(--rh);}.camera-status{color: var(--l);text-align: center;margin-top: 10px;font-size: 14px;}.camera-error{color: var(--r);text-align: center;margin-top: 10px;font-size: 14px;}.camera-info{background: var(--2);padding: 15px;border-radius: 4px;margin-top: 20px;color: var(--7);font-size: 13px;line-height: 1.4;}.camera-info h4{margin: 0 0 10px 0;color: var(--l);}.camera-info code{background: var(--4);padding: 2px 4px;border-radius: 2px;color: var(--a);}.camera-auto-inject{margin-top: 10px;}.camera-auto-inject label{display: flex;align-items: center;gap: 8px;color: var(--l);cursor: pointer;}.camera-auto-inject input[type="checkbox"]{margin: 0;}.glsl-color-picker-overlay{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: transparent;z-index: 10000;display: none;pointer-events: none;}.glsl-color-picker{position: absolute;background: var(--2);border-radius: 8px;padding: 20px;color: var(--7);min-width: 300px;max-width: 350px;pointer-events: auto;border: 1px solid var(--4);}.glsl-color-picker h3{margin: 0 0 15px 0;color: var(--7);font-size: 16px;}.glsl-color-preview{width: 100%;height: 60px;border-radius: 4px;margin-bottom: 15px;border: 2px solid var(--4);}.glsl-color-inputs{display: grid;grid-template-columns: 1fr 1fr 1fr;gap: 10px;margin-bottom: 15px;}.glsl-input-group{display: flex;flex-direction: column;}.glsl-input-group label{font-size: 12px;color: var(--5);margin-bottom: 5px;}.glsl-input-group input{background: var(--3);border: 1px solid var(--4);border-radius: 4px;color: var(--7);padding: 8px;font-family: inherit;}.glsl-input-group input:focus{outline: none;border-color: var(--r);}.glsl-color-sliders{margin-bottom: 15px;}.glsl-slider-group{display: flex;align-items: center;margin-bottom: 8px;gap: 10px;}.glsl-slider-group label{width: 20px;font-size: 12px;color: var(--5);}.glsl-slider-group input[type="range"]{flex: 1;background: var(--3);}.glsl-slider-group span{width: 50px;font-size: 12px;color: var(--7);text-align: right;}.glsl-color-buttons{display: flex;gap: 10px;justify-content: flex-end;}.glsl-btn{padding: 8px 16px;border: none;border-radius: 4px;cursor: pointer;font-family: inherit;font-size: 14px;}.glsl-btn-cancel{background: var(--5);color: var(--7);}.glsl-btn-apply{background: var(--r);color: var(--7);}.glsl-btn:hover{opacity: 0.8;}.glsl-color-highlight{background-color: var(--ah) !important;border-radius: 2px;}.glsl-tab{position: absolute;width: 24px;height: 24px;background: var(--1);border: 1px solid var(--4);border-radius: 4px;display: flex;justify-content: center;align-items: center;cursor: pointer;z-index: 10001;transition: opacity 0.2s ease;}.glsl-tab:hover{opacity: 0.8;}.glsl-tab svg{width: 16px;height: 16px;fill: var(--7);}#flowchartWindow{position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 90vw;max-width: 1000px;height: 80vh;border-radius: 4px;z-index: 999999;display: none;flex-direction: column;}#flowchartWindow.show{display: flex;}.flowchart-header{background: var(--4);padding: 15px 20px;border-bottom: 1px solid var(--6);display: flex;justify-content: space-between;align-items: center;border-radius: 4px 4px 0 0;}.flowchart-header h3{margin: 0;color: var(--7);font-size: 18px;}.flowchart-controls{display: flex;gap: 10px;align-items: center;}.flowchart-controls button{padding: 8px 15px;background: var(--a);color: var(--0);border: none;border-radius: 2px;cursor: pointer;font-size: 14px;}.flowchart-controls button:hover{background: var(--ah);}.flowchart-controls .flowchartclose-btn{background: var(--r);margin-left: 10px;}.flowchart-controls .flowchartclose-btn:hover{background: var(--rh);}.export-dropdown{position: relative;display: inline-block;}.export-dropdown-content{display: none;position: absolute;right: 0;background-color: var(--4);min-width: 120px;box-shadow: 0px 8px 16px rgba(0,0,0,0.2);z-index: 1;border-radius: 4px;overflow: hidden;}.export-dropdown-content button{display: block;width: 100%;text-align: left;padding: 8px 12px;border: none;background: var(--4);color: var(--7);cursor: pointer;font-size: 14px;}.export-dropdown-content button:hover{background: var(--5);}.export-dropdown.show .export-dropdown-content{display: block;}.flowchart-content{flex: 1;overflow: auto;display: flex;flex-direction: column;min-height: 0;}#flowchartSVG{flex: 1;width: 100%;background: var(--3);overflow: auto;min-height: 300px;}.flowchart-node{fill: var(--2);stroke: var(--3);stroke-width: 2px;filter: drop-shadow(2px 2px 4px var(--0));cursor: pointer;}.flowchart-node:hover{stroke-width: 3px;filter: drop-shadow(3px 3px 6px var(--1));}.flowchart-node.vertex{stroke: var(--a);}.flowchart-node.fragment{stroke: var(--m);}.flowchart-node.common{stroke: var(--b);}.flowchart-label{font-size: 11px;text-anchor: middle;dominant-baseline: middle;fill: var(--7);font-weight: 500;pointer-events: none;}.flowchart-line-number{font-size: 9px;text-anchor: middle;fill: var(--5);font-family: monospace;pointer-events: none;}.flowchart-arrow{stroke: var(--5);stroke-width: 2px;fill: none;marker-end: url(#flowchart-arrow-marker);}.flowchart-overlay{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: var(--0);z-index: 99999;display: none;}.flowchart-overlay.show{display: block;}.flowchart-tooltip{position: absolute;background: var(--4);color: var(--7);padding: 8px 12px;border-radius: 4px;font-size: 12px;font-family: monospace;white-space: pre-wrap;max-width: 300px;z-index: 9999999;pointer-events: none;opacity: 0;transition: opacity 0.2s;}.flowchart-tooltip.show{opacity: 1;}.glsl-formatter-modal-overlay{position: fixed;top: 0;right: 0;bottom: 0;z-index: 10000;display: flex;opacity: 0;transition: opacity 0.3s ease;}.glsl-formatter-modal-overlay.show{opacity: 1;}.glsl-formatter-modal{background: var(--2);padding: 30px;width:50vw;transform: scale(0.8) translateY(20px);transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);}.glsl-formatter-modal-overlay.show .glsl-formatter-modal{transform: scale(1) translateY(0);}.glsl-formatter-modal-header{text-align: center;margin-bottom: 25px;position: relative;}.glsl-formatter-modal-title{font-size: 1.8rem;font-weight: 700;color:var(--a);margin: 0;}.glsl-formatter-modal-close{position: absolute;top: -16px;right: -16px;background: var(--r);border: none;width: 2rem;height: 2rem;cursor: pointer;font-size: 1.5rem;display: flex;align-items: center;justify-content: center;transition: all 0.2s ease;color:var(--0);}.glsl-formatter-modal-close:hover{background: var(--rh);}.glsl-formatter-switches{display: grid;gap: 20px;margin-bottom: 25px;}.glsl-formatter-switch-group{display: flex;align-items: center;gap: 15px;padding: 15px;background: var(--4);border-radius: 12px;transition: all 0.2s ease;}.glsl-formatter-switch-group:hover{background: var(--5);}.glsl-formatter-switch{position: relative;display: flex;align-items: center;cursor: pointer;gap: 15px;}.glsl-formatter-switch input{opacity: 0;width: 0;height: 0;}.glsl-formatter-slider{position: relative;width: 50px;height: 26px;background: var(--1);border-radius: 26px;transition: all 0.3s ease;}.glsl-formatter-slider:before{position: absolute;content: "";height: 20px;width: 20px;left: 3px;top: 3px;background: var(--6);border-radius: 50%;transition: all 0.3s ease;}.glsl-formatter-switch input:checked + .glsl-formatter-slider:before{transform: translateX(24px);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.format{background: var(--a);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.remove-lines{background: var(--ah);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.remove-comments{background: var(--rh);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.minify{background: var(--b);}.glsl-formatter-switch input:disabled + .glsl-formatter-slider{opacity: 0.5;cursor: not-allowed;}.glsl-formatter-switch-label{color: var(--7);font-size: 15px;user-select: none;flex: 1;}.glsl-formatter-switch input:disabled ~ .glsl-formatter-switch-label{opacity: 0.5;color: var(--5);}.glsl-formatter-actions{display: flex;gap: 12px;justify-content: center;}.glsl-formatter-btn{padding: 12px 24px;border: none;border-radius: 12px;font-weight: 600;cursor: pointer;transition: all 0.2s ease;font-size: 14px;}.glsl-formatter-btn-primary{background: var(--a);color: var(--0);}.glsl-formatter-btn-primary:hover{background: var(--ah);}.glsl-formatter-btn-secondary{background: var(--r);color: var(--0);}.glsl-formatter-btn-secondary:hover{background: var(--rh);}.webgpu-toggle{position: absolute;bottom: 10px;right: 214px;cursor: pointer;font-size: 12px;border: none;height:39px;width: 4.25rem;font-style: inherit;color: var(--l);}.webgpu-toggle.webgl-mode{background-color: var(--d);}.webgpu-toggle.webgl-mode:hover{background-color: var(--5);}.webgpu-toggle.webgpu-mode{background-color: var(--r);}.webgpu-toggle.webgpu-mode:hover{background-color: var(--rh);}.editor-panel .panel-header span{font-weight: bold;}#webgpu-canvas{display: block;width: 100%;height: 100%;}#preview-panel .instruction-btn{position: absolute;left: 10px;top: 50%;transform: translateY(-50%);z-index: 10;background: var(--d);color: var(--6);border: none;font-size: 1em;cursor: pointer;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;z-index:1;}#preview-panel .instruction-btn:hover{background: var(--5);}#preview-panel .instruction-overlay{position: absolute;top: 0;left: 0;right: 0;bottom: 0;background-color: var(--0);display: flex;flex-direction: column;align-items: center;justify-content: flex-start;z-index: 9999;color: var(--7);font-size: 1rem;padding: 20px;box-sizing: border-box;overflow-y: auto;overflow-x: hidden;}#preview-panel .instruction-modal{margin-top: 4rem;width: 100%;max-width: 800px;min-width: 0;line-height: 1.5em;box-sizing: border-box;word-wrap: break-word;overflow-wrap: break-word;}#preview-panel .instruction-modal h2{color: var(--6);margin-bottom: 1rem;word-wrap: break-word;}#preview-panel .instruction-modal ul{text-align: left;padding-left: 1.2em;list-style-type: disc;margin: 0;word-wrap: break-word;}#preview-panel .instruction-modal li{margin-bottom: 0.8em;}#preview-panel .instruction-modal code{word-break: break-all;background: var(--3);padding: 2px 4px;border-radius: 3px;}#preview-panel .instruction-close-btn{position: fixed;top: 10px;right: 10px;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;cursor: pointer;border: none;background-color: var(--3);color: var(--r);font-size: 1.2rem;z-index: 10000;}#preview-panel .instruction-close-btn:hover{background-color: var(--4);}#jsToggleBtn{z-index:2;position: absolute;bottom: 49px;right: 10px;width: 40px;height: 40px;background: var(--d);color: var(--l);border: none;cursor: pointer;z-index: 1000;transition: all 0.6s ease;}#jsToggleBtn:hover{background: var(--5);}#jsToggleBtn.active{background: var(--a);}#jsCanvas{width: 100%;height: 100%;display: block;background: #000000;position: absolute;top: 0;left: 0;}.preview-panel-relative{position: relative;}.shortcut-modal{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: var(--0);display: none;justify-content: center;align-items: center;z-index: 10000;padding: 20px;box-sizing: border-box;}.shortcut-modal.show{display: flex;}.shortcut{background: var(--1);border-radius: 12px;padding: 30px;height: 90vh;max-width: 95vw;width: 100%;color: var(--7);box-shadow: 0 20px 40px var(--0);border: 1px solid var(--3);display: flex;flex-direction: column;position: relative;}.shortcut-header{flex-shrink: 0;margin-bottom: 20px;}.shortcut-title{font-size: 28px;margin-bottom: 0;color: var(--a);font-weight: 600;text-align: center;}.shortcut-content{display: flex;flex-direction: column;flex: 1;min-height: 0;}.commands-list-container{flex: 1;overflow-y: auto;overflow-x: hidden;margin-bottom: 20px;padding-right: 8px;scroll-behavior: smooth;direction: ltr;}.commands-list-container::-webkit-scrollbar{width: 10px;}.commands-list{display: grid;grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));gap: 15px;padding-bottom: 10px;}.command-item{display: flex;justify-content: space-between;align-items: center;padding: 12px 16px;background: var(--2);border-radius: 8px;border: 2px solid transparent;transition: all 0.3s ease;cursor: pointer;}.command-item:hover{border-color: var(--a);background: var(--3);}.command-item.active{border-color: var(--a);background: var(--d);}.command-desc{font-size: 14px;color: var(--6);}.command-keys{font-family: monospace;font-size: 13px;color: var(--a);font-weight: bold;}.keyboard-container{flex-shrink: 0;display: flex;justify-content: center;overflow: hidden;padding: 10px 0;width: 100%;box-sizing: border-box;}.keyboard{display: grid;gap: 4px;padding: 20px;background: var(--2);border-radius: 12px;border: 1px solid var(--4);min-width: fit-content;transform-origin: center;transition: transform 0.2s ease;}.keyboard-row{display: grid;gap: 4px;justify-content: center;}.key{background: var(--4);border: 1px solid var(--5);border-radius: 4px;color: var(--6);font-size: 11px;font-weight: 500;display: flex;align-items: center;justify-content: center;text-align: center;transition: all 0.2s ease;cursor: pointer;position: relative;min-height: 32px;padding: 2px;white-space: nowrap;}.key:hover{background: var(--5);border-color: var(--6);}.key.highlight{background: var(--a);border-color: var(--ah);color: var(--1);box-shadow: 0 0 10px var(--ah);transform: translateY(-1px);}.key.modifier{background: var(--3);}.key.modifier.highlight{background: var(--r);border-color: var(--rh);color: var(--1);}.close-btn{position: absolute;top: 15px;right: 20px;background: none;border: none;color: var(--5);font-size: 24px;cursor: pointer;transition: color 0.2s;z-index: 1;}.close-btn:hover{color: var(--7);}#preview-panel .shortcut-trigger-btn{position: fixed;top: 10px;left: 50%;transform: translateX(-50%);background: var(--a);border: none;border-radius: 2px;color: var(--l);padding: 8px 12px;cursor: pointer;font-size: 14px;font-weight: 500;transition: background 0.2s;z-index: 10001;}#preview-panel .shortcut-trigger-btn:hover{background: var(--ah);}.arrow-stack{display: flex;flex-direction: column;gap: 2px;height: 32px;box-sizing: border-box;}.key.half-height{min-height: calc(50% - 1px) !important;height: calc(50% - 1px) !important;max-height: calc(50% - 1px);font-size: 9px;flex: none;}@media (max-width: 800px){.shortcut{padding: 20px;height: 92vh;}.shortcut-title{font-size: 24px;}.commands-list{grid-template-columns: 1fr;}.key{min-height: 28px;font-size: 10px;}}@media (max-width: 600px){.shortcut{padding: 15px;height: 95vh;}.shortcut-title{font-size: 22px;margin-bottom: 15px;}.shortcut-header{margin-bottom: 15px;}.commands-list-container{margin-bottom: 15px;}}@media (max-width: 480px){.shortcut-modal{padding: 10px;}.shortcut{padding: 15px;height: 96vh;}.shortcut-title{font-size: 20px;}.commands-list-container{padding-right: 4px;}}#mediaUploadBtn{z-index: 2;cursor: pointer;position: absolute;top: 42px;right: 10px;background: var(--d);color: var(--6);border: none;width: 2rem;height: 2rem;padding: 0.25rem;display: flex;align-items: center;justify-content: center;}#mediaUploadBtn svg{width: 1.25rem;height: 1.25rem;}#mediaUploadBtn:hover{background: var(--5);}#baseImportBtn{background: var(--a);color: var(--l);border: none;border-radius: 4px;padding: 10px 20px;margin: 10px;cursor: pointer;font-size: 14px;}#baseImportBtn:hover{background: var(--ah);}#mediaCloseBtn{position: absolute;top: 10px;right: 15px;background: var(--r);color: var(--l);border: none;border-radius: 50%;width: 30px;height: 30px;font-size: 18px;cursor: pointer;display: flex;align-items: center;justify-content: center;}#mediaCloseBtn:hover{background: var(--rh);}#mediaModal{position: fixed;top: 0;left: 0;right: 0;bottom: 0;display: none;align-items: center;justify-content: center;z-index: 99999;max-width: 60vw;margin: auto;}#mediaModal .modal-content{background: var(--4);padding: 20px;border-radius: 8px;max-width: 90vw;max-height: 90vh;overflow: auto;text-align: center;position: relative;width: 100%;box-sizing: border-box;}#mediaModal img{max-width: 100%;max-height: 40vh;display: block;margin: 10px auto;}#mediaModal video{max-width: 100%;max-height: 30vh;display: block;margin: 10px auto;background: var(--0);}#mediaDropButton{padding: 40px 60px;border: 2px dashed var(--6);background: var(--3);border-radius: 8px;cursor: pointer;font-size: 16px;color: var(--6);margin: 20px 0;transition: all 0.3s ease;}#mediaDropButton:hover{background: var(--5);border-color: var(--a);color: var(--7);}#mediaDropButton.dragover{background: var(--5);border-color: var(--a);color: var(--7);}#mediaDragOverlay{position: absolute;top: 0;left: 0;width: 100%;height: 100%;background: var(--d);backdrop-filter: blur(5px);z-index: 2000;display: none;align-items: center;justify-content: center;flex-direction: column;color: var(--l);font-size: 24px;text-align: center;}#mediaDragOverlay .filename{margin-top: 10px;font-size: 18px;opacity: 0.8;}.modal-toggle{display: flex;background: var(--3);border-radius: 6px;margin: 10px 0;overflow: hidden;}.modal-toggle button{background: none;border: none;padding: 10px 20px;cursor: pointer;color: var(--6);transition: all 0.3s ease;flex: 1;}.modal-toggle button.active{background: var(--a);color: var(--l);}.modal-toggle button:hover:not(.active){background: var(--5);}.modal-view{display: none;}.modal-view.active{display: block;}.video-controls{display: flex;align-items: center;justify-content: center;gap: 10px;margin: 15px 0;padding: 15px;background: var(--3);border-radius: 8px;}.video-controls button{background: var(--a);color: var(--l);border: none;border-radius: 4px;padding: 8px 16px;cursor: pointer;font-size: 14px;}.video-controls button:hover{background: var(--ah);}.video-controls button:disabled{background: var(--5);cursor: not-allowed;}.video-controls .time-info{color: var(--6);font-size: 14px;margin: 0 10px;}.video-progress{width: 100%;height: 6px;background: var(--5);border-radius: 3px;margin: 10px 0;cursor: pointer;overflow: hidden;}.video-progress-bar{height: 100%;background: var(--a);border-radius: 3px;transition: width 0.1s ease;}.effects-grid{display: grid;grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));gap: 15px;margin: 20px 0;}.effect-card{background: var(--3);border: 2px solid var(--5);border-radius: 8px;padding: 15px;cursor: pointer;transition: all 0.3s ease;text-align: left;}.effect-card:hover{border-color: var(--a);background: var(--5);}.effect-card.active{border-color: var(--a);background: var(--ah);}.effect-card h4{margin: 0 0 8px 0;color: var(--7);font-size: 14px;}.effect-card p{margin: 0;color: var(--6);font-size: 12px;}.effect-controls{margin-top: 20px;padding-top: 20px;border-top: 1px solid var(--5);}.effect-control{display: flex;align-items: center;gap: 10px;margin: 10px 0;}.effect-control label{color: var(--6);font-size: 14px;min-width: 80px;}.effect-control input[type="range"]{flex: 1;height: 20px;}.effect-control input[type="number"]{width: 60px;padding: 4px;border: 1px solid var(--5);background: var(--3);color: var(--6);border-radius: 4px;}.active-effects{margin-top: 20px;padding-top: 20px;border-top: 1px solid var(--5);}.active-effect{display: flex;align-items: center;justify-content: space-between;background: var(--3);padding: 8px 12px;border-radius: 4px;margin: 5px 0;}.active-effect span{color: var(--6);font-size: 14px;}.active-effect button{background: var(--r);color: var(--l);border: none;border-radius: 4px;padding: 4px 8px;cursor: pointer;font-size: 12px;}.active-effect button:hover{background: var(--rh);}.apply-effects-btn{background: var(--a);color: var(--l);border: none;border-radius: 4px;padding: 12px 24px;margin: 20px 0;cursor: pointer;font-size: 16px;width: 100%;}.apply-effects-btn:hover{background: var(--ah);}.apply-effects-btn:disabled{background: var(--5);cursor: not-allowed;}.loadmediawarn{font-size: 12px;color: var(--6);opacity: 0.8;}.tutorial-overlay{position: fixed;top: 0;left: 0;width: 100%;height: 100%;z-index: 999998;pointer-events: none;}.tutorial-overlay-clickable{pointer-events: auto;}.tutorial-controls{position: fixed;top: 20px;left: 50%;transform: translateX(-50%);z-index: 1000000;pointer-events: auto;}.tutorial-skip-btn{background: linear-gradient(135deg, var(--a) 0%, var(--ah) 100%);color: var(--l);border: none;padding: 12px 32px;border-radius: 8px;font-size: 16px;font-weight: 600;cursor: pointer;box-shadow: 0 4px 15px var(--5);transition: all 0.3s ease;}.tutorial-skip-btn:hover{transform: translateY(-2px);box-shadow: 0 6px 20px var(--ah);}.tutorial-navigation{position: fixed;bottom: 40px;left: 50%;transform: translateX(-50%);z-index: 1000000;display: flex;gap: 20px;align-items: center;pointer-events: auto;}.tutorial-nav-btn{background: var(--7);border: 2px solid var(--a);color: var(--a);width: 50px;height: 50px;border-radius: 50%;font-size: 24px;cursor: pointer;display: flex;align-items: center;justify-content: center;transition: all 0.3s ease;box-shadow: 0 4px 15px var(--4);}.tutorial-nav-btn:hover:not(:disabled){background: var(--a);color: var(--l);transform: scale(1.1);}.tutorial-nav-btn:disabled{opacity: 0.3;cursor: not-allowed;}.tutorial-step-indicator{background: var(--7);padding: 10px 20px;border-radius: 20px;font-weight: 600;color: var(--a);box-shadow: 0 4px 15px var(--4);}.tutorial-highlight{position: absolute;pointer-events: none;z-index: 999999;border-radius: 8px;box-shadow:
    0 0 0 4px var(--ah),
    0 0 30px 8px var(--ah),
    0 0 60px 15px var(--a);animation: tutorial-pulse 2s ease-in-out infinite;}@keyframes tutorial-pulse{0%, 100%{box-shadow:
    0 0 0 4px var(--ah),
    0 0 30px 8px var(--ah),
    0 0 60px 15px var(--a);}50%{box-shadow:
    0 0 0 4px var(--a),
    0 0 40px 12px var(--ah),
    0 0 80px 20px var(--a);}}.tutorial-textbox{position: absolute;background: var(--7);border-radius: 12px;padding: 20px 24px;max-width: 300px;box-shadow: 0 10px 40px var(--0);z-index: 1000000;pointer-events: auto;}.tutorial-textbox::before{content: '';position: absolute;width: 0;height: 0;border-style: solid;}.tutorial-textbox.pos-bottom::before{bottom: 100%;left: 50%;transform: translateX(-50%);border-width: 0 10px 10px 10px;border-color: transparent transparent var(--7) transparent;}.tutorial-textbox.pos-top::before{top: 100%;left: 50%;transform: translateX(-50%);border-width: 10px 10px 0 10px;border-color: var(--7) transparent transparent transparent;}.tutorial-textbox.pos-right::before{right: 100%;top: 50%;transform: translateY(-50%);border-width: 10px 10px 10px 0;border-color: transparent var(--7) transparent transparent;}.tutorial-textbox.pos-left::before{left: 100%;top: 50%;transform: translateY(-50%);border-width: 10px 0 10px 10px;border-color: transparent transparent transparent var(--7);}.tutorial-textbox-content{font-size: 16px;line-height: 1.5;color: var(--b);}#uploadHTMLBtn{position: absolute;bottom: 10px;right: 78px;background: var(--d);color: var(--l);border: none;cursor: pointer;height:39px;z-index:2;width:4.25rem;}#uploadHTMLBtn:hover{background: var(--5);}#uploadHTMLInput{display: none;}.glsl-performance-monitor-container{position: absolute;z-index: 1;}.glsl-performance-monitor-toggle{width: 2rem;height: 2rem;border: none;background-color: var(--d);cursor: pointer;padding: 7px;display: flex;justify-content: center;align-items: center;}.glsl-performance-monitor-toggle:hover{background-color: var(--5);}.glsl-performance-monitor-panel{padding: 12px;background-color: var(--d);color: var(--7);font-family: monospace;font-size: 12px;width: 60%;}.glsl-performance-monitor-header{display: flex;justify-content: space-between;align-items: center;margin-bottom: 10px;}.glsl-performance-monitor-title{font-weight: bold;color: var(--7);}.glsl-performance-monitor-display{margin-bottom: 6px;}.glsl-performance-monitor-value{color: var(--ah);}.glsl-performance-monitor-details{padding-left: 10px;color: var(--6);}.glsl-performance-monitor-highlight{color: var(--7);}.glsl-performance-monitor-container.top-left{top: 10px;left: 10px;}.glsl-performance-monitor-container.top-right{top: 10px;right: 10px;}.glsl-performance-monitor-container.bottom-left{bottom: 10px;left: 10px;}.glsl-performance-monitor-container.bottom-right{bottom: 10px;right: 10px;}.audio-notification{display: flex;align-items: center;justify-content: center;position: fixed;top: 10px;right: 44px;background: var(--1);color: var(--a);border: 1px solid var(--a);border-radius: 0px;font-size: 16px;font-weight: bold;z-index: 10000;box-shadow: 0 4px 12px var(--0);animation: countdownPulse 0.8s ease-out;min-width: 2rem;min-height: 2rem;text-align: center;}@keyframes countdownPulse{0%{transform: scale(0.9);opacity: 0;}50%{transform: scale(1.05);opacity: 1;}100%{transform: scale(1);opacity: 1;}}.audio-wrapper{display: flex;flex-direction: column;gap: 8px;padding: 0.5em 0;border-radius: 10px;color: var(--7);min-width: 400px;}.audio-time-container{display: flex;align-items: center;justify-content: center;gap: 5px;font-size: 12px;color: var(--6);min-width: 80px;}.audio-controls-row{display: flex;align-items: center;gap: 10px;position: relative;}.audio-play-pause{background: var(--a);color: var(--1);border: none;border-radius: 5px;cursor: pointer;width: 3rem;height: 2rem;font-size: 14px;flex-shrink: 0;}.audio-seek-bar{flex: 1;appearance: none;height: 2rem;border-radius: 2px;background: var(--4);outline: none;}.audio-volume-container{position: relative;flex-shrink: 0;height: 2rem;display: flex;align-items: center;}.audio-volume-button{background: none;border: none;cursor: pointer;font-size: 14px;color: var(--7);padding: 0;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;}.audio-volume-panel{position: absolute;bottom: 100%;left: 50%;transform: translateX(-50%);background: var(--1);border: 1px solid var(--4);border-radius: 8px;padding: 10px 8px;margin-bottom: 5px;box-shadow: 0 4px 12px var(--0);opacity: 0;visibility: hidden;transition: opacity 0.2s, visibility 0.2s;z-index: 1000;display: flex;flex-direction: column;align-items: center;gap: 8px;}.audio-volume-panel.visible{opacity: 1;visibility: visible;}.audio-volume-display{font-size: 11px;color: var(--7);font-weight: bold;min-width: 30px;text-align: center;}.audio-slider-track{width: 4px;height: 80px;background: var(--4);border-radius: 2px;position: relative;cursor: pointer;}.audio-slider-fill{width: 100%;background: var(--a);border-radius: 2px;position: absolute;bottom: 0;transition: height 0.1s ease;}.audio-slider-handle{width: 12px;height: 12px;background: var(--a);border-radius: 50%;position: absolute;left: 50%;transform: translateX(-50%);cursor: pointer;border: 2px solid var(--1);box-shadow: 0 2px 4px var(--0);}.audio-countdown-toggle{border: none;border-radius: 5px;cursor: pointer;width: 2rem;height: 2rem;font-size: 12px;flex-shrink: 0;transition: background 0.2s;display: flex;align-items: center;justify-content: center;}.audio-countdown-toggle.enabled{background: var(--a);color: var(--1);}.audio-countdown-toggle.disabled{background: var(--4);color: var(--7);}#recSettings{display: none;position: absolute;bottom: 42px;left: 10px;background: var(--d);color: var(--l);padding: 10px;z-index: 100;font-size: 0.9rem;min-width: 240px;max-height:80%;overflow-y: auto;}#recSettings label{display: block;margin-bottom: 6px;}#recSettings input{margin-left: 4px;}#recSettings .preset{margin-right: 4px;margin-top: 4px;}#recSettings button{padding: 4px 8px;margin: 2px;cursor: pointer;border:0px;border-radius:6px;}#recSettings .active{background:var(--a);color: white;}#recBtn{width:2rem;height:2rem;position: absolute;bottom: 10px;left: 10px;background: var(--d);color: var(--l);border: none;padding: 8px;cursor: pointer;z-index: 1;font-size: 1rem;display: flex;align-items: center;justify-content: center;}#recBtn:hover{background:var(--5);}#recBtn svg{width: 14px;height: 14px;}#recBtn svg circle{fill: var(--r);}#recordingIndicator{display: none;position: absolute;top: 10px;right: 10px;background:var(--rh);color: var(--1);padding: 5px 10px;border-radius: 4px;z-index: 100;animation: pulse 1.5s infinite;}@keyframes pulse{0%{opacity: 1;}50%{opacity: 0.6;}100%{opacity: 1;}}input, select{padding: 1rem;border-radius: 5px;border: 0px;width: 100%;background: var(--d);color: var(--l);}.checkbox-container{position: relative;display: inline-flex;align-items: center;cursor: pointer;margin-left: 8px;}.checkbox-container input[type="checkbox"]{opacity: 0;position: absolute;width: 18px;height: 18px;margin: 0;padding: 0;cursor: pointer;}.custom-checkbox{width: 18px;height: 18px;border: 2px solid var(--l);border-radius: 3px;background: var(--d);position: relative;display: flex;align-items: center;justify-content: center;transition: all 0.2s ease;}.checkbox-container input[type="checkbox"]:checked + .custom-checkbox{background: var(--a);border-color: var(--a);}.custom-checkbox::after{content: '';position: absolute;width: 5px;height: 9px;border: solid white;border-width: 0 2px 2px 0;transform: rotate(45deg) scale(0);transition: transform 0.15s ease-in-out;top: 1px;}.checkbox-container input[type="checkbox"]:checked + .custom-checkbox::after{transform: rotate(45deg) scale(1);}.checkbox-container:hover .custom-checkbox{border-color: var(--a);}#videoPreview{display: none;margin-top: 10px;padding: 10px;background: var(--1);border-radius: 5px;}#videoPreview video{width: 100%;max-height: 200px;border-radius: 5px;background: var(--1);}#videoPreview .controls{margin-top: 10px;display: flex;gap: 5px;flex-wrap: wrap;}#videoPreview .controls button{padding: 6px 12px;border: none;border-radius: 5px;cursor: pointer;font-size: 12px;flex: 1;min-width: 70px;}#videoPreview .download-btn{background: var(--m);color: var(--1);}#videoPreview .download-btn:hover{background: var(--6);color: var(--7);}#videoPreview .delete-btn{background: var(--r);color: var(--7);}#videoPreview .delete-btn:hover{background: var(--rh);color: var(--1);}#videoPreview .info{color: var(--l);font-size: 11px;margin-top: 8px;line-height: 1.3;}.status-block{background: var(--d);padding: 6px;border-radius: 6px;margin: 5px 0px;font-size: 11px;color: var(--7);}.status-block .canvas-mode,
.status-block .audio-status{background: none;padding: 2px 0;margin: 0;border-radius: 0;color: inherit;}.custom-context-menu{background:var(--d);border:0.3px solid var(--l);border-radius:4px;user-select:none;position:absolute;z-index:99999;min-width:150px;display:none;}.custom-context-menu-item{padding:8px 12px;color:var(--7);cursor:pointer;font-size:12px;}.custom-context-menu-item:hover{background:var(--D);}.custom-context-menu-item.disabled{color:var(--3);cursor:not-allowed;}.custom-context-menu-item.disabled:hover{background:transparent;}.custom-context-menu-separator{height:2px;background:var(--4);margin:5px 0;}.line-info{padding:8px 12px;color:var(--6);font-size:12px;border-bottom:1px solid var(--4);text-align:center;}.inline-control{padding:8px 12px;background:var(--D);}.inline-control label{display:block;color:var(--7);margin-bottom:4px;font-size:11px;}.inline-control input{width:100%;padding:4px;border-radius:3px;border:1px solid var(--5);background:var(--d);color:var(--7);font-size:11px;}.inline-control input[type="range"]{margin:4px 0;}.inline-buttons{display:flex;gap:4px;margin-top:6px;}.inline-buttons button{padding:4px 8px;border-radius:3px;border:none;cursor:pointer;font-size:11px;flex:1;}.btn-cancel{background:var(--3);color:var(--7);}.btn-confirm{background:var(--a);color:var(--1);}.slider-value{color:var(--6);font-size:10px;text-align:center;margin-top:2px;}#toastContainer{position: fixed;bottom: 20px;left: 50%;transform: translateX(-50%);z-index: 10000;pointer-events: none;}.toast{color: white;padding: 10px 16px;border-radius: 0;box-shadow: 0 4px 12px var(--1);margin-bottom: 10px;font-weight: 500;font-size: 14px;max-width: 400px;text-align: center;opacity: 0;transform: translateY(20px);transition: all 0.3s ease;pointer-events: auto;}.toast.success{background: var(--2);border: 2px solid var(--a);}.toast.error{background: var(--r);border: 2px solid var(--1);}.toast.info{background: var(--a);border: 2px solid var(--1);}.toast.warning{background: var(--r);border: 2px solid var(--1);}.toast.visible{opacity: 1;transform: translateY(0);}.toast.hiding{opacity: 0;transform: translateY(-20px);}.shader-card{border: 1px solid var(--4);padding: 4px;margin-bottom: 8px;}.shader-card-header{display: flex;align-items: center;gap: 4px;}.shader-title{display: inline-block;max-width: 160px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}.shader-author{font-size: 0.85em;color: var(--5);}.upload-zone.dragover{background: var(--4);}.upload-zone{background: var(--3);}.search-container{position: relative;margin: 10px 0;width: 100%;}.search-input{width: 100%;padding: 8px 12px;padding-right: 35px;border: 1px solid var(--4);border-radius: 2px;font-size: 14px;background-color: var(--2);color: var(--7);box-sizing: border-box;}.search-input:focus{outline: none;border-color: var(--a);}.search-input::placeholder{color: var(--5);}.clear-btn{position: absolute;right: 8px;top: 50%;transform: translateY(-50%);background: none;border: none;font-size: 16px;cursor: pointer;color: var(--6);width: 20px;height: 20px;display: none;align-items: center;justify-content: center;border-radius: 50%;line-height: 1;}.clear-btn:hover{background-color: var(--r);color: var(--0);}.no-results-message{text-align: center;padding: 20px;color: var(--4);font-style: italic;margin: 0;}#pm-toggle-btn{z-index:2;position: absolute;top: 10px;right: 74px;background: var(--d);color: var(--6);border: none;width: 2rem;height: 2rem;cursor: pointer;z-index: 10;display: flex;align-items: center;justify-content: center;}#pm-toggle-btn:hover{background:var(--5);}#pm-toggle-btn svg{width: 60%;height: 60%;}#pm-root{position: fixed;right: 12px;top: 10px;width: 90%;max-width: calc(100% - 24px);height: 420px;background: var(--4);color: var(--7);border-radius: 4px;padding: 12px;box-shadow: 0 12px 36px var(--1);z-index:100;display: flex;flex-direction: column;gap: 8px;}#pm-root .pm-header{display:flex;align-items:center;justify-content:space-between;gap:8px;}#pm-controls{display:flex;gap:8px;align-items:center;}.pm-btn{background:var(--5);color:var(--l);border:1px solid var(--5);padding:6px 8px;border-radius:4px;cursor:pointer;font-size:13px;}.pm-btn:active{transform: translateY(1px);}#pm-body{display:flex;gap:12px;height: calc(100% - 58px);}#pm-steps-area{flex: 1 1 420px;background:var(--4);border-radius: 8px;padding:10px;overflow:auto;display:flex;align-items:center;}.pm-steps-row{display:flex;align-items:flex-start;gap:10px;padding-bottom:6px;}.pm-step{width: 250px;min-width: 200px;background: var(--2);border: 1px solid var(--5);border-radius:8px;padding:8px;display:flex;flex-direction:column;gap:6px;}.pm-step.pm-future{opacity: 0.45;filter: grayscale(20%);pointer-events: none;}.pm-step.pm-active{outline: 2px solid var(--a);opacity: 1;pointer-events: auto;}.pm-step .pm-header{display:flex;gap:6px;align-items:center;justify-content:space-between;}.pm-step label{font-size:12px;color:#aaa;}.pm-step textarea{width:100%;height:88px;background:var(--1);color:#cfe;border:1px solid var(--5);resize:vertical;font-family: monospace;font-size:12px;padding:6px;}.pm-step input.pm-delay{width: 70px;padding:6px;border-radius:6px;border:1px solid var(--6);background:#111;color:var(--l);font-size:13px;}.pm-step .pm-actions{display:flex;gap:6px;justify-content:flex-end;align-items:center;}.pm-arrow{width:40px;height:40px;display:flex;align-items:center;justify-content:center;user-select:none;opacity:0.9;}.pm-small{font-size:12px;padding:5px 8px;}.pm-step .pm-step-title{font-size:13px;color:var(--l);font-weight:600;}.performance-mode-canvas{position: fixed;top: 0;left: 0;width: 100vw;height: 100vh;z-index: 999999;}.performance-mode-preview{position: fixed;top: 0;left: 0;width: 100vw;height: 100vh;z-index: 999998;}.performance-mode-body{overflow: hidden;}.performance-mode-app{overflow: hidden;}.performance-mode-hidden{display: none;}.glsl-editor-wrapper{position: relative;box-sizing: border-box;width: 100%;height: 100%;}.glsl-editor{position: relative;width: 100%;height: 100%;box-sizing: border-box;font-family: inherit;font-size: inherit;line-height: inherit;border: inherit;outline: none;background: transparent;color: var(--6);overflow: auto;white-space: pre-wrap;word-wrap: break-word;caret-color: var(--caret, #ffffff);}.glsl-hidden-textarea{display: none !important;}.token-comment{color: #6A9955;}.token-keyword{color: #569CD6;}.token-type{color: #4EC9B0;}.token-number{color: #B5CEA8;}.token-function{color: #DCDCAA;}.token-builtin{color: #DCDCAA;}.token-variable{color: #9CDCFE;}#theme-manager-btn{z-index:2;position: absolute;top: 10px;right: 42px;z-index: 1;background: var(--d);border: none;width: 2rem;height: 2rem;font-size: 20px;cursor: pointer;transition: all 0.2s ease;display: flex;align-items: center;justify-content: center;padding: 0;pointer-events: auto;}#theme-manager-btn:hover{background-color: var(--5);}#theme-confirm-modal{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: var(--d);z-index: 1010;display: none;justify-content: center;align-items: center;}.theme-confirm-modal-content{background: var(--2);border: 1px solid var(--5);border-radius: 6px;padding: 20px;max-width: 300px;width: 90%;text-align: center;}.theme-confirm-theme-modal-title{margin: 0 0 15px 0;color: var(--6);font-size: 16px;}.theme-confirm-modal-message{margin: 0 0 20px 0;color: var(--6);font-size: 14px;line-height: 1.4;}.theme-confirm-modal-buttons{display: flex;gap: 10px;justify-content: center;}.theme-confirm-cancel-btn{padding: 8px 16px;background: var(--4);color: var(--6);border: 1px solid var(--5);border-radius: 4px;cursor: pointer;font-size: 12px;transition: background-color 0.2s;}.theme-confirm-delete-btn{padding: 8px 16px;background: var(--r);color: white;border: none;border-radius: 4px;cursor: pointer;font-size: 12px;transition: background-color 0.2s;}#theme-modal{position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 300px;max-height: calc(100vh - 40px);background: var(--3);color: var(--1);border-radius: 4px;z-index: 1005;display: none;overflow: hidden;border: 1px solid var(--2);}.theme-modal-header{padding: 20px;border-bottom: 1px solid var(--2);background: var(--2);}.theme-modal-header-content{display: flex;justify-content: space-between;align-items: center;}.theme-modal-title{margin: 0;color: var(--6);font-size: 18px;}.theme-modal-close-btn{background: none;border: none;font-size: 20px;cursor: pointer;color: var(--r);padding: 0;width: 24px;height: 24px;}.theme-select-container{margin-top: 15px;}.theme-select-label{display: block;font-size: 11px;margin-bottom: 4px;color: var(--6);}.theme-select{width: 100%;padding: 8px;background: var(--3);border: 1px solid var(--5);border-radius: 4px;cursor: pointer;font-size: 12px;box-sizing: border-box;color: var(--6);}.theme-toggle-editor-container{margin-top: 12px;}.theme-toggle-editor-btn{width: 100%;padding: 8px;background: var(--b);color: white;border: none;border-radius: 4px;cursor: pointer;font-size: 12px;}.color-editor-controls{padding: 15px;border-bottom: 1px solid var(--5);background: var(--4);}.theme-name-container{margin-bottom: 12px;}.theme-name-label{display: block;font-size: 11px;margin-bottom: 4px;color: var(--6);}.theme-name-input{width: 100%;padding: 6px 8px;border: 1px solid var(--5);border-radius: 4px;font-size: 12px;margin-bottom: 8px;box-sizing: border-box;}.theme-action-buttons{display: flex;gap: 6px;}.save-theme-btn{flex: 1;padding: 6px 8px;background: var(--a);color: white;border: none;border-radius: 4px;cursor: pointer;font-size: 11px;}.delete-theme-btn{padding: 6px 8px;background: var(--r);color: white;border: none;border-radius: 4px;cursor: pointer;font-size: 11px;}.color-inputs-container{max-height: calc(100vh - 300px);overflow-y: auto;padding: 15px;}.reset-section{padding: 15px;border-top: 1px solid var(--5);background: var(--7);}.theme-reset-btn{width: 100%;padding: 8px;background: var(--4);color: white;border: none;border-radius: 4px;cursor: pointer;font-size: 12px;}.theme-color-picker-container{margin-bottom: 12px;padding: 10px;border: 1px solid var(--5);border-radius: 2px;background: var(--4);}.theme-color-picker-header{display: flex;align-items: center;justify-content: space-between;margin-bottom: 8px;}.property-label{font-weight: bold;font-size: 12px;color: var(--1);}.theme-color-preview{width: 30px;height: 20px;border: 1px solid var(--5);border-radius: 3px;}.theme-color-input-label{display: block;font-size: 10px;margin-bottom: 4px;color: var(--1);}.theme-color-input{width: 100%;height: 30px;border: none;border-radius: 4px;cursor: pointer;margin-bottom: 6px;}.alpha-label{display: block;font-size: 10px;margin-bottom: 4px;color: var(--1);}.alpha-slider{width: 100%;height: 15px;}.autosave-overlay{position: fixed;bottom: 20px;right: 20px;z-index: 10000;pointer-events: none;}.autosave-dialog{background-color: var(--2);border: 1px solid var(--4);border-radius: 2px;padding: 16px;max-width: 320px;width: 100%;animation: slideIn 1.5s ease-out;pointer-events: auto;}.autosave-title{margin-bottom: 16px;color: var(--7);font-size: 18px;font-weight: 600;}.autosave-message{margin-bottom: 24px;color: var(--6);line-height: 1.5;}.autosave-button-container{display: flex;gap: 12px;justify-content: flex-end;}.autosave-btn{padding: 8px 16px;border-radius: 2px;cursor: pointer;font-size: 14px;transition: all 0.2s ease;}.autosave-btn-no{border: 1px solid var(--4);background-color: var(--3);color: var(--6);}.autosave-btn-no:hover{background-color: var(--4);color: var(--7);}.autosave-btn-yes{font-weight: 500;border: 1px solid var(--a);background-color: var(--a);color: var(--l);}.autosave-btn-yes:hover{background-color: var(--ah);}@keyframes slideIn{from{opacity: 0;transform: translateY(-20px) scale(0.95);}to{opacity: 1;transform: translateY(0) scale(1);}}#findBtn{position: absolute;top: 74px;right: 42px;z-index: 1;width: 2rem;height: 2rem;background: var(--d);color: var(--6);border: none;font-size: 16px;cursor: pointer;display: flex;align-items: center;justify-content: center;transition: background 0.3s ease;}#findBtn:hover{background: var(--5);}#findModal{display: none;position: fixed;inset: 0;background: rgba(0,0,0,0.7);backdrop-filter: blur(10px);z-index: 10000;overflow-y: auto;}#findModal .modal-content2{position: relative;margin: 2rem auto;width: 90vw;height: 90vh;background: var(--3);border-radius: 8px;padding: 20px;box-shadow: 0 10px 30px var(--0);display: flex;flex-direction: column;overflow-y: auto;box-sizing: border-box;}.modal-header{display: flex;justify-content: space-between;align-items: center;margin-bottom: 1rem;border-bottom: 1px solid var(--6);padding-bottom: 0.5rem;}.modal-header h2{margin: 0;color: var(--7);font-size: 1.5rem;}.modal-header button{width: 1.5rem;height: 1.5rem;display: flex;align-items: center;justify-content: center;background: none;border: none;color: var(--r);font-size: 1.5rem;cursor: pointer;transition: background 0.3s ease, color 0.3s ease;border-radius: 50%;}.modal-header button:hover{background: var(--r);color: var(--0);}#glslSearchInput{width: 100%;padding: 0.75rem;font-size: 1rem;border: 1px solid var(--4);border-radius: 4px;background: var(--3);color: white;margin-bottom: 1rem;transition: border-color 0.3s ease;}#glslSearchInput:focus{border-color: var(--a);outline: none;}#resultsContainer{flex: 1;overflow-y: auto;border: 1px solid var(--4);border-radius: 4px;background: var(--3);padding: 0.5rem;}.initial-message{text-align: center;color: var(--6);padding: 2rem;}.initial-message ul{list-style:none;padding:0;margin:1rem 0 0;}.result-item{background: var(--3);border-left: 4px solid var(--a);border-radius: 4px;padding: 1rem;margin-bottom: 0.75rem;cursor: pointer;transition: background 0.3s ease;}.result-item:hover{background: var(--4);}.result-item h4{margin: 0 0 0.5rem;color: var(--a);font-size: 1.125rem;}.result-item p{margin: 0 0 0.5rem;color: #ccc;font-size: 0.875rem;}.result-item .tags{margin-bottom: 0.5rem;}.result-item .tags span{background: var(--5);color: var(--7);padding: 0.25rem 0.5rem;border-radius: 3px;font-size: 0.75rem;margin-right: 0.5rem;display: inline-block;}.result-item pre{background: var(--2);padding: 0.5rem;border-radius: 3px;font-family: monospace;font-size: 0.75rem;max-height: 150px;overflow: auto;margin: 0 0 0.5rem;}.result-item button{background: var(--a);color: white;border: none;padding: 0.5rem 1rem;border-radius: 3px;cursor: pointer;font-size: 0.875rem;transition: background 0.3s ease;}.result-item button:hover{background: var(--ah);}.glsl-toast{position: fixed;top: 1rem;right: 1rem;background: var(--a);color: white;padding: 0.75rem 1.25rem;border-radius: 4px;box-shadow: 0 2px 10px var(--0);animation: slideIn 0.3s ease;}@keyframes slideIn{from{transform: translateX(100%);opacity: 0;}to{transform: translateX(0);opacity: 1;}}.initial-message .spinner{animation: spin 1s linear infinite;display: inline-block;}@keyframes spin{0%{transform: rotate(0deg);}100%{transform: rotate(360deg);}}.connect-toggle-btn{z-index: 1;cursor: pointer;position: absolute;top: 74px;right: 10px;background: var(--d);color: var(--6);border: none;width: 2rem;height: 2rem;padding: 0.25rem;display: flex;align-items: center;justify-content: center;}.connect-toggle-btn:hover{background: var(--5);}.connect-toggle-btn.active{background: var(--a);color: var(--D);}.connect-container{position: fixed;bottom: 20px;right: 20px;width: 350px;background: var(--2);color: var(--6);font-family: monospace;font-size: 14px;border-radius: 10px;padding: 15px;z-index: 99999;box-shadow: 0 0 15px var(--0);display: none;transform: translateY(20px);opacity: 0;transition: all 0.3s ease;}.connect-container.show{display: block;transform: translateY(0);opacity: 1;}.connect-header{display: flex;justify-content: space-between;align-items: center;margin-bottom: 12px;}.connect-title{font-weight: bold;font-size: 18px;color: var(--a);}.connect-close-btn{background: none;border: none;color: var(--5);cursor: pointer;font-size: 18px;padding: 0;width: 20px;height: 20px;}.connect-button{width: 100%;padding: 10px;margin-bottom: 8px;background: var(--1);color: var(--a);border: none;border-radius: 6px;cursor: pointer;}.connect-disconnect-btn{width: 100%;padding: 10px;margin-bottom: 8px;background: var(--r);color: var(--7);border: none;border-radius: 6px;cursor: pointer;}.connect-disconnect-btn:hover{background: var(--rh);color:var(--1);}.connect-or{text-align: center;margin-bottom: 8px;color: var(--5);}.connect-input{width: 100%;padding: 10px;margin-bottom: 8px;background: var(--0);color: var(--7);border: 1px solid var(--4);border-radius: 6px;font-family: monospace;}.connect-room-info{display: none;margin-bottom: 12px;padding: 10px;background: var(--0);border-radius: 6px;}.connect-room-code{font-size: 24px;font-weight: bold;color: var(--a);text-align: center;letter-spacing: 2px;margin-bottom: 8px;}.connect-waiting{text-align: center;color: var(--ah);}.connect-status{margin-bottom: 12px;font-weight: bold;min-height: 24px;color: var(--ah);}.connect-sync-info{display: none;margin-bottom: 12px;padding: 8px;background: var(--0);border-radius: 6px;font-size: 12px;}.connect-sync-info-title{color: var(--a);font-weight: bold;}.connect-sync-info-desc{color: var(--5);}.connect-connection-controls{display: none;margin-bottom: 12px;}.connect-log{margin-top: 10px;max-height: 140px;overflow-y: auto;background: var(--0);padding: 10px;border-radius: 6px;font-size: 13px;color: var(--6);white-space: pre-wrap;}
  </style>
</head>
<body>
  <div id="app">
    <div id="editors">
      <button class="lbtn ellips" onclick="openShaderWindow()" title="Save shaders and browse public gallery">Save / Browse</button>
      <div id="shaderWindow" class="savew">
        <div class="toggles">
          <button id="tabSaveBtn" onclick="showTab('save')" class="togbtn">Save</button>
          <button id="tabPublicBtn" onclick="showTab('public')" class="togbtn">Public</button>
          <button id="tabLocalBtn" onclick="showTab('local')" class="togbtn">Local</button>
        </div>
        <div id="tabSave" class="savesct">
          <h3>Save</h3>
          <div id="uploadZone" class="upldzone">
            <p>Drag & Drop Image Here<br>or</p>
            <button id="chooseFileBtn" class="savebtn">Choose File</button>
            <input type="file" id="shaderImage" accept="image/*" style="display:none;">
            <div id="fileName" class="ellips"></div>
          </div>
          <input type="text" id="shaderTitle" placeholder="Shader Title" class="saveinput"><br>
          <button class="sharebtn" onclick="saveLink()">Share Link</button>
          <button class="sharebtn" onclick="saveLocally()">Save Locally</button>
          <?php if (isset($_SESSION['user_role']) && ($_SESSION['user_role'] === 'admin' || $_SESSION['user_role'] === 'premium')): ?>
          <button class="sharebtn" onclick="savePublic()">Save Publicly</button>
          <?php endif; ?>
        </div>
        <div id="tabPublic" class="savesct">
          <h3>Public</h3>
          <div id="publicShaderList"></div>
        </div>
        <div id="tabLocal" class="savesct">
          <h3>Local</h3>
          <div id="localShaderList"></div>
        </div>
        <button class="closebtn" onclick="closeShaderWindow()">Close</button>
      </div>
      <div id="vertPanel" class="editor-panel">
        <div class="panel-header">
          <span>Vertex Shader</span>
          <button type="button" id="vertFileBtn" title="Upload a Vertex Shader (.frag,.fs,.txt)">Upload<span class="file-name" id="vertFileName"></span></button>
          <input type="file" id="vertFile" accept=".vert,.vs,.txt" />
        </div>
        <textarea spellcheck="false" id="vertCode">
attribute vec2 a_position;
void main() {
  gl_Position = vec4(a_position, 0., 1.);
}</textarea>
      </div>
      <div id="rowDivider"></div>
      <div id="fragPanel" class="editor-panel">
        <div class="panel-header">
          <span>Fragment Shader</span>
          <button type="button" id="fragFileBtn" title="Upload a Fragment Shader (.frag,.fs,.txt)">Upload<span class="file-name" id="fragFileName"></span></button>
          <input type="file" id="fragFile" accept=".frag,.fs,.txt" />
        </div>
        <textarea spellcheck="false" id="fragCode">
//WebGL editor - Created By: Max Warren
precision mediump float;
uniform vec2 u_resolution;
uniform float u_time;
uniform float u_volume;
uniform float u_treble;
uniform float u_mid;
uniform float u_bass;
uniform vec2 mouse;
vec2 axel = vec2(1.0);
float hash(vec2 p) {
    p = fract(p * vec2(123.34, 456.21));
    p += dot(p, p + 78.23);
    return fract(p.x * p.y);
}
float boxSDF(vec3 p, vec3 b) {
    vec3 d = abs(p) - b;
    return length(max(d, 0.0)) + min(max(d.x, max(d.y, d.z)), 0.0);
}
float sceneSDF(vec3 p) {
    vec2 gridPos = floor(p.xz / 4.0);
    vec2 localPos = mod(p.xz, 4.0) - 2.0;
    float h = hash(gridPos) * 10.0 + u_volume;
    float d = boxSDF(vec3(localPos.x, p.y, localPos.y), vec3(1.0, h, 1.0));
    return d;
}
float raymarch(vec3 ro, vec3 rd, float maxDist) {
    float t = 0.0;
    for(int i = 0; i < 100; i++) {
        vec3 p = ro + rd * t;
        float d = sceneSDF(p);
        if(d < 0.001 || t > maxDist) break;
        t += d * 0.1;
    }
    return t;
}
vec3 getNormal(vec3 p) {
    float e = 0.001;
    return normalize(vec3(
        sceneSDF(p + vec3(e, 0, 0)) - sceneSDF(p - vec3(e, 0, 0)),
        sceneSDF(p + vec3(0, e, 0)) - sceneSDF(p - vec3(0, e, 0)),
        sceneSDF(p + vec3(0, 0, e)) - sceneSDF(p - vec3(0, 0, e))
    ));
}
void main() {
    axel = mouse;
    vec2 uv = (gl_FragCoord.xy / u_resolution) * 2.0 - 1.0 + (axel * 0.1);
    uv.x *= u_resolution.x / u_resolution.y;
    vec3 ro = vec3(0.0, 2.0, u_time * 5.0);
    vec3 lookAt = vec3(0.0, 2.0, ro.z + 5.0);
    vec3 forward = normalize(lookAt - ro);
    vec3 right = normalize(cross(vec3(0.0,1.0,0.0), forward));
    vec3 up = cross(forward, right);
    vec3 rd = normalize(uv.x * right + uv.y * up + 1.5 * forward);
    float t = raymarch(ro, rd, 100.0);
    vec3 col = vec3(0.0);
    if(t < 100.0) {
        vec3 p = ro + rd * t;
        vec3 n = getNormal(p);
        float diff = clamp(dot(n, vec3(0.5, 1.0, 0.5)), u_treble, 1.0);
        float glow = u_bass;
        if(abs(mod(p.y, 2.0) - 1.0) < 0.1) {
            glow = 1.0;
        }
        col = mix(vec3(u_mid, 0.5, 1.0) * diff, vec3(0.8, 0.2, 1.0), glow);
        col = mix(col, vec3(0.0), 1.0 - exp(-0.02 * t * t));
    }
    gl_FragColor = vec4(col, 1.0);
}
</textarea>
      </div>
    </div>
    <div id="divider"></div>
      <div id="preview-panel">
        <canvas id="glcanvas"></canvas>
        <button id="fsBtn"></button>
        <div id="lint">
          <button id="copyErrorsBtn" style="display: none;">Copy All Errors</button>
          <button id="closeLintBtn" style="display: none;"></button>
          <div id="lintContent"></div>
        </div>
      </div>
    </div>
  <script>
    /*
 * Shader Studio
 * @creator Max Warren
 * 2025
 */
(()=>{const e=e=>document.getElementById(e),t=e("shaderWindow"),n=e("shaderImage"),o=e("shaderTitle"),i=e("vertCode"),a=e("fragCode"),r=e("fileName"),s=e("uploadZone"),l=e("chooseFileBtn"),c=e=>e[0].toUpperCase()+e.slice(1);window._localShaderList=[];let d={count:0,firstErrorTime:null,refreshTriggered:!1,reset(){this.count=0,this.firstErrorTime=null,this.refreshTriggered=!1},addError(){if(this.refreshTriggered)return!1;const e=Date.now();return this.firstErrorTime?(e-this.firstErrorTime<=5e3?this.count++:(this.firstErrorTime=e,this.count=1),!1):(this.firstErrorTime=e,this.count=1,this.refreshTriggered=!0,!0)}};function u(){return window.jsCanvasState&&window.jsCanvasState.isJSMode()?"js":window.webgpuState&&window.webgpuState.isWebGPUMode()?"webgpu":"webgl"}function m(e,t="info"){!function(){const e=document.fullscreenElement||document.documentElement;let t=document.getElementById("toastContainer");t?t.parentNode!==e&&(t.remove(),e.appendChild(t)):(t=document.createElement("div"),t.id="toastContainer",e.appendChild(t))}();const n=document.createElement("div");n.className=`toast ${t}`,n.textContent=e,document.getElementById("toastContainer").appendChild(n),requestAnimationFrame((()=>{n.classList.add("visible")})),setTimeout((()=>{n.classList.add("hiding"),n.classList.remove("visible"),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n)}),300)}),5e3)}const h=new class{constructor(){this.dbName="ShaderCache",this.dbVersion=1,this.storeName="publicShaders",this.db=null,this.fallbackKey="shader_public_cache",this.lastFetchKey="shader_last_fetch",this.initDB()}async initDB(){return new Promise(((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>{console.warn("IndexedDB not available, using localStorage"),e(null)},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName)},n.onsuccess=t=>{this.db=t.target.result,e(this.db)}}))}async getCache(){if(this.db)try{const e=this.db.transaction([this.storeName],"readonly"),t=e.objectStore(this.storeName).get("shaderList");return new Promise((e=>{t.onsuccess=()=>e(t.result),t.onerror=()=>e(null)}))}catch(e){console.warn("IndexedDB error, using localStorage")}try{const e=localStorage.getItem(this.fallbackKey);return e?JSON.parse(e):null}catch(e){return null}}async setCache(e){if(this.db)try{const t=this.db.transaction([this.storeName],"readwrite");return t.objectStore(this.storeName).put(e,"shaderList"),void localStorage.setItem(this.lastFetchKey,Date.now().toString())}catch(e){console.warn("IndexedDB error, using localStorage")}try{localStorage.setItem(this.fallbackKey,JSON.stringify(e)),localStorage.setItem(this.lastFetchKey,Date.now().toString())}catch(e){console.warn("Storage failed - data too large for localStorage")}}async clearCache(){if(this.db)try{const e=this.db.transaction([this.storeName],"readwrite");e.objectStore(this.storeName).delete("shaderList")}catch(e){}try{localStorage.removeItem(this.fallbackKey),localStorage.removeItem(this.lastFetchKey)}catch(e){}}shouldRefresh(){const e=localStorage.getItem(this.lastFetchKey);if(!e)return!0;return Date.now()-parseInt(e)>36e5}};let p=!1;const g=()=>t.style.display="none";function v(t){["save","public","local"].forEach((n=>{e(`tab${c(n)}`).style.display=n===t?"block":"none",e(`tab${c(n)}Btn`).style.background=`var(--${n===t?3:4})`})),{public:y,local:E}[t]?.()}function f(e,t){const n=new Image,o=new FileReader;o.onload=e=>{n.src=e.target.result,n.onload=()=>{const e=document.createElement("canvas"),o=200/n.width;e.width=200,e.height=n.height*o;e.getContext("2d").drawImage(n,0,0,e.width,e.height),t(e.toDataURL("image/jpeg",.5))}},o.readAsDataURL(e)}async function y(){const t=e("publicShaderList");t.innerHTML="<div>Loading shaders...</div>";if(!(p||h.shouldRefresh())){const e=await h.getCache();if(e&&e.length>0)return console.log("Loaded"),void b(e)}console.log("Fetch"),fetch("../shader/api/fetch.php?action=list").then((e=>e.json())).then((async e=>{e.error?t.innerHTML=`<div>Error: ${e.error}</div>`:(await h.setCache(e),p=!1,b(e))})).catch((e=>{t.innerHTML=`<div>Error loading shaders: ${e.message}</div>`}))}async function w(){const t=e("publicShaderList");t.innerHTML="<div>Refreshing shaders...</div>",console.log("DB FETCH");try{await h.clearCache();const e=await fetch("../shader/api/fetch.php?action=list"),n=await e.json();if(n.error)return void(t.innerHTML=`<div>Error: ${n.error}</div>`);await h.setCache(n),b(n),m("Shader list refreshed","info"),d.reset()}catch(e){t.innerHTML=`<div>Error loading shaders: ${e.message}</div>`,d.refreshTriggered=!1}}function b(t){const n=e("publicShaderList");n.innerHTML="",t.forEach((e=>n.appendChild(function(e){const t=document.createElement("div");return t.className="shader-card",t.innerHTML=`\n      <div class="shader-card-header">\n        <strong class="shader-title" title="${e.title}">${e.title}</strong>\n        <span class="shader-author">by ${e.user}</span>\n      </div>\n      <img src="${e.preview}" class="img"><br>\n      <button class="ldbtn ellips" data-public-token="${e.token}">Load</button>\n    `,t}(e))))}function E(){const t=e("localShaderList");t.innerHTML="",window._localShaderList=[],Object.entries(localStorage).filter((([e])=>e.startsWith("shader_")&&!e.includes("cache")&&!e.includes("fetch"))).forEach((([e,n])=>{try{const o=JSON.parse(n),i=window._localShaderList.length;window._localShaderList.push(o),t.appendChild(function(e,t,n){const o=document.createElement("div");return o.className="shader-card",o.innerHTML=`\n      <div class="shader-card-header">\n        <strong class="shader-title" title="${e.title}">${e.title}</strong>\n      </div>\n      <img src="${e.preview}" class="img"><br>\n      <button class="ldbtn" data-local-index="${n}">Load</button>\n      <button class="xbtn" onclick='deleteLocal("${t}")'>X</button>\n    `,o}(o,e,i))}catch{}}))}function x(){document.querySelectorAll(".ldbtn").forEach((e=>{e.disabled=!1,e.textContent=e.dataset.originalText||"Load"}))}function C(e){if(e.animationType){!function(e){const t=u();if(t===e)return;switch(e){case"js":if("js"!==t){const e=document.getElementById("jsToggleBtn");e&&e.click()}break;case"webgpu":if("webgpu"!==t){const e=document.getElementById("webgpuToggle");e&&e.click()}break;case"webgl":if("js"===t){const e=document.getElementById("jsToggleBtn");e&&e.click()}else if("webgpu"===t){const e=document.getElementById("webgpuToggle");e&&e.click()}}}(e.animationType);const t="webgl"===e.animationType?500:300;setTimeout((()=>{o.value=e.title,i.value=e.vert,a.value=e.frag,window.rebuildProgram&&window.rebuildProgram(),window.render&&window.render(),g(),x()}),t)}else o.value=e.title,i.value=e.vert,a.value=e.frag,window.rebuildProgram&&window.rebuildProgram(),window.render&&window.render(),g(),x()}l.addEventListener("click",(()=>n.click())),n.addEventListener("change",(()=>{r.textContent=n.files[0]?.name||""})),["dragover","dragleave","drop"].forEach((e=>s.addEventListener(e,(t=>{t.preventDefault(),s.classList.toggle("dragover","dragover"===e),"drop"===e&&t.dataTransfer.files.length&&(n.files=t.dataTransfer.files,r.textContent=t.dataTransfer.files[0].name)})))),document.body.addEventListener("click",(e=>{if(e.target.classList.contains("ldbtn")){const t=e.target.getAttribute("data-public-token"),n=e.target.getAttribute("data-local-index");function o(e){if(e>=0&&e<window._localShaderList.length){const t=window._localShaderList[e];C(t),m(`Loaded "${t.title}"`,"success")}else x()}document.querySelectorAll(".ldbtn").forEach((e=>{e.disabled=!0,e.dataset.originalText=e.textContent,e.textContent="Loading..."})),null!==t?async function(e){function t(e){d.addError()&&(console.log("DB ERROR"),m("Error detected - reloading...","warning"),setTimeout((()=>w()),1e3)),x()}try{const n=await fetch(`../shader/api/fetch.php?action=load&token=${e}`),o=await n.json();if(o.error)return void t(o.error);C(o),m(`Loaded "${o.title}"`,"success"),d.reset()}catch(e){t(e.message)}}(t):null!==n&&o(parseInt(n))}})),window.openShaderWindow=()=>(t.style.display="block",v("save")),window.closeShaderWindow=g,window.deleteLocal=function(e){const t=e.replace("shader_","");confirm(`Delete "${t}"?`)&&(localStorage.removeItem(e),E(),m(`Deleted "${t}"`,"info"))},window.showTab=v,window.saveLocally=function(){const e=o.value.trim(),t=n.files[0];return e?t?void f(t,(t=>{localStorage.setItem(`shader_${e}`,JSON.stringify({title:e,vert:i.value,frag:a.value,preview:t,animationType:u()})),m(`Saved "${e}" locally`,"success")})):m("Please upload a preview image","warning"):m("Please provide a title","warning")},window.savePublic=function(){const e=o.value.trim(),t=n.files[0];return e?t?void f(t,(t=>{fetch("../shader/api/save.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,vert:JSON.stringify(i.value),frag:JSON.stringify(a.value),preview:t,user:"<?php echo htmlspecialchars($_SESSION['user']); ?>",animationType:u()})}).then((e=>e.text())).then((e=>{m(e,e.toLowerCase().includes("error")?"error":"success"),p=!0,v("public")})).catch((e=>{m(`Error saving shader: ${e.message}`,"error")}))})):m("Please upload a preview image","warning"):m("Please provide a title","warning")},window.clearPublicCache=async function(){await h.clearCache(),console.log("cache cleared"),m("Reloaded","info")},window.forceRefreshPublicShaders=w,window.showToast=m})(),function(){let e=!1,t=null,n=null,o=null,i=null,a=null,r=null,s=null,l=null,c=null,d=null,u=null,m=null,h=null,p=null,g=null,v=new Map,f=performance.now(),y=0,w=0,b=0,E=60;const x=()=>{document.getElementById("vertCode"),document.getElementById("fragCode");v.forEach(((e,t)=>{t.removeEventListener("input",e)})),v.clear()},C=e=>{const t=document.getElementById("vertCode"),n=document.getElementById("fragCode"),o=document.getElementById("vertPanel"),i=document.getElementById("fragPanel");if(e){(()=>{const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&null===m&&null===h&&(m=e.value,h=t.value)})();const e=o?.querySelector(".panel-header span"),a=i?.querySelector(".panel-header span");e&&(e.textContent="Vertex Shader (WGSL)"),a&&(a.textContent="Fragment Shader (WGSL)");const r=document.getElementById("vertFile"),s=document.getElementById("fragFile");r&&(r.accept=".wgsl,.txt"),s&&(s.accept=".wgsl,.txt"),t&&(t.value="// WebGPU Vertex Shader (WGSL)\n//  Created by Max Warren\nstruct VertexOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv: vec2<f32>,\n}\n@vertex\nfn vs_main(@location(0) position: vec2<f32>) -> VertexOutput {\n    var output: VertexOutput;\n    output.position = vec4<f32>(position, 0.0, 1.0);\n    output.uv = position * 0.5 + 0.5;\n    return output;\n}"),n&&(n.value="// WebGPU Fragment Shader (WGSL) with Audio Reactivity\nstruct Uniforms {\n    resolution: vec2<f32>,\n    time: f32,\n    delta_time: f32,\n    mouse: vec2<f32>,\n    mouse_click: vec2<f32>,\n    mouse_pressed: f32,\n    frame: f32,\n    fps: f32,\n    aspect: f32,\n    pixel_size: vec2<f32>,\n    // AUDIO UNIFORMS\n    bass: f32,\n    mid: f32,\n    treble: f32,\n    volume: f32,\n    padding: f32,\n}\n@group(0) @binding(0) var<uniform> u: Uniforms;\n@fragment  \nfn fs_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n    let fragCoord = uv * u.resolution;\n    let mouse_influence = length(fragCoord - u.mouse) / max(u.resolution.x, u.resolution.y);\n    let click_influence = length(fragCoord - u.mouse_click) / max(u.resolution.x, u.resolution.y);\n    let r = sin(u.time * 2.0 + fragCoord.x * 0.01 + mouse_influence * 10.0 + u.bass * 5.0) * 0.5 + 0.5;\n    let g = sin(u.time * 1.5 + fragCoord.y * 0.01 + click_influence * 5.0 + u.mid * 3.0) * 0.5 + 0.5;\n    let b = sin(u.time * 3.0 + u.frame * 0.01 + u.treble * 7.0) * 0.5 + 0.5;\n    let press_effect = u.mouse_pressed * 0.3;\n    let fps_effect = u.fps / 60.0 * 0.1;\n    let delta_effect = clamp(u.delta_time * 10.0, 0.0, 0.2);\n    let volume_boost = 1.0 + u.volume * 0.5;\n    let color = vec3<f32>(r + press_effect, g + fps_effect, b + delta_effect) * volume_boost;\n    return vec4<f32>(color, 1.0);\n}")}else{o&&o.querySelector(".panel-header span")&&(o.querySelector(".panel-header span").textContent="Vertex Shader"),i&&i.querySelector(".panel-header span")&&(i.querySelector(".panel-header span").textContent="Fragment Shader");const e=document.getElementById("vertFile"),a=document.getElementById("fragFile");e&&(e.accept=".vert,.vs,.txt"),a&&(a.accept=".frag,.fs,.txt"),t&&null!==m&&(t.value=m),n&&null!==h&&(n.value=h)}},S=async()=>{if(!navigator.gpu)return console.error("WebGPU not supported"),!1;try{const i=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!i)return console.error("No WebGPU adapter found"),!1;if(t=await i.requestDevice({requiredFeatures:[],requiredLimits:{}}),d=document.getElementById("glcanvas"),c=document.createElement("canvas"),c.id="webgpu-canvas",c.style.cssText=d.style.cssText,c.className=d.className,d.style.display="none",d.parentNode.insertBefore(c,d),n=c.getContext("webgpu"),!n)return console.error("Could not get WebGPU context"),!1;const a=navigator.gpu.getPreferredCanvasFormat();return n.configure({device:t,format:a,alphaMode:"premultiplied"}),f=performance.now(),y=0,w=0,b=0,E=60,(()=>{if(!c)return;u&&(u.disconnect(),u=null);const t=()=>{if(!c||!n)return;const t=c.parentElement;if(!t)return;const i=t.getBoundingClientRect(),a=Math.floor(i.width),r=Math.floor(i.height);if((c.width!==a||c.height!==r)&&(c.width=a,c.height=r,e&&o)){const e=performance.now()-(window.startTime||0);L(.001*e)}};window.ResizeObserver?(u=new ResizeObserver((e=>{for(let n of e)t()})),u.observe(c.parentElement)):window.addEventListener("resize",t),t()})(),!0}catch(e){return console.error("WebGPU initialization failed:",e),console.error("Error details:",e.stack),!1}},L=e=>{if(!(o&&n&&t&&c))return;const s=performance.now();b=(s-w)/1e3,w=s,y++,y%10==0&&(E=.9*E+1/b*.1);const l=window.mouse||{x:0,y:0,clickX:0,clickY:0,isPressed:!1},d=(()=>{const e=window.audioReactiveInstance;if(e&&e.analyser&&e.isActive){const t=new Uint8Array(e.analyser.frequencyBinCount);e.analyser.getByteFrequencyData(t);const n=(e,n,o,i=1)=>Math.min(1,t.slice(e,n).reduce(((e,t)=>e+t))/(n-e)/255*o*i);return{bass:n(0,20,e.sensitivity.bass,.4),mid:n(20,60,e.sensitivity.mid),treble:n(60,120,e.sensitivity.treble),volume:n(0,t.length,e.sensitivity.volume)}}return{bass:0,mid:0,treble:0,volume:0}})(),u=new Float32Array(20);let m=0;u[m++]=c.width,u[m++]=c.height,u[m++]=e,u[m++]=b,u[m++]=l.x,u[m++]=l.y,u[m++]=l.clickX||0,u[m++]=l.clickY||0,u[m++]=l.isPressed?1:0,u[m++]=y,u[m++]=E,u[m++]=c.width/c.height,u[m++]=1/c.width,u[m++]=1/c.height,u[m++]=d.bass,u[m++]=d.mid,u[m++]=d.treble,u[m++]=d.volume,u[m++]=0,u[m++]=0,t.queue.writeBuffer(a,0,u);const h=t.createCommandEncoder(),p=h.beginRenderPass({colorAttachments:[{view:n.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});p.setPipeline(o),p.setBindGroup(0,i),p.setVertexBuffer(0,r),p.draw(6),p.end(),t.queue.submit([h.finish()])},k=()=>{if(!e)return;const t=performance.now();L(.001*(t-f)),s=requestAnimationFrame(k)},T=e=>{const t=document.getElementById("lint"),n=document.getElementById("lintContent"),o=document.getElementById("copyErrorsBtn"),i=document.getElementById("closeLintBtn");n&&(n.textContent="WebGPU Error: "+e),o&&(o.style.display="block"),i&&(i.style.display="block"),t&&(t.style.display="block")},I=()=>{const e=document.getElementById("lint"),t=document.getElementById("copyErrorsBtn"),n=document.getElementById("closeLintBtn");e&&(e.style.display="none"),t&&(t.style.display="none"),n&&(n.style.display="none")},B=()=>{const e=document.getElementById("vertCode"),n=document.getElementById("fragCode");if(!e||!n)return;const s=document.getElementById("lint"),l=document.getElementById("copyErrorsBtn"),c=document.getElementById("closeLintBtn");s&&(s.style.display="none"),l&&(l.style.display="none"),c&&(c.style.display="none");((e,n)=>{try{[o,i]=[null,null],[a,r].forEach((e=>{e&&e.destroy?.()})),a=r=null,a=t.createBuffer({size:80,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const s=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);r=t.createBuffer({size:s.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),t.queue.writeBuffer(r,0,s);const l=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),c=t.createPipelineLayout({bindGroupLayouts:[l]});return o=t.createRenderPipeline({layout:c,vertex:{module:t.createShaderModule({code:e}),entryPoint:"vs_main",buffers:[{arrayStride:8,attributes:[{format:"float32x2",offset:0,shaderLocation:0}]}]},fragment:{module:t.createShaderModule({code:n}),entryPoint:"fs_main",targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]},primitive:{topology:"triangle-list"}}),i=t.createBindGroup({layout:l,entries:[{binding:0,resource:{buffer:a}}]}),!0}catch(e){return console.error("WebGPU pipeline creation failed:",e),T(e.message),!1}})(e.value,n.value)},A=()=>{if(!c)return;const e=(e,t=!1,n)=>{const o=((e,t=!1)=>{const n=c.getBoundingClientRect(),o=t?e.touches[0]||e.changedTouches[0]:e;return{x:o.clientX-n.left,y:n.height-(o.clientY-n.top)}})(e,t);let i=window.mouse||{x:0,y:0,clickX:0,clickY:0,isPressed:!1,lastClickTime:0};"move"===n?(i.x=o.x,i.y=o.y):"down"===n?(i.isPressed=!0,i.clickX=o.x,i.clickY=o.y,i.lastClickTime=performance.now()):"up"===n&&(i.isPressed=!1),window.mouse=i,t&&e.preventDefault()};["mousemove","mousedown","mouseup","mouseleave","touchmove","touchstart","touchend"].forEach((e=>{c.removeEventListener(e,(()=>{}))})),c.addEventListener("mousemove",(t=>e(t,!1,"move"))),c.addEventListener("mousedown",(t=>e(t,!1,"down"))),c.addEventListener("mouseup",(t=>e(t,!1,"up"))),c.addEventListener("mouseleave",(()=>{window.mouse&&(window.mouse.isPressed=!1)})),c.addEventListener("touchmove",(t=>e(t,!0,"move")),{passive:!1}),c.addEventListener("touchstart",(t=>e(t,!0,"down")),{passive:!1}),c.addEventListener("touchend",(t=>e(t,!0,"up")),{passive:!1})},M=async()=>{if(!e&&window.jsCanvasState&&window.jsCanvasState.isJSMode()){const e=document.getElementById("jsToggleBtn");return e&&e.click(),void setTimeout((()=>M()),200)}const m=document.getElementById("webgpuToggle"),h=(e,t)=>{m.textContent=e,m.className="lbtn webgpu-toggle "+t},f=()=>{[l,window.animationId,s].forEach((e=>{e&&cancelAnimationFrame(e)})),l=window.animationId=s=null},y=e=>(e&&e.destroy(),null);e?(f(),I(),u&&(u.disconnect(),u=null),r=y(r),a=y(a),t&&(t.destroy(),t=null),[n,o,i]=[null,null,null],c&&d&&(c.remove(),d.style.display="block",c=null),e=!1,h("WebGPU","webgl-mode"),x(),C(!1),p&&(window.rebuildProgram=p),g&&(window.render=g),(()=>{const e=document.getElementById("glcanvas");if(e){if(window.gl=e.getContext("webgl2")||e.getContext("webgl"),!window.gl)return console.error("Failed to get WebGL context"),!1;const t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n=window.gl.createBuffer();return window.gl.bindBuffer(window.gl.ARRAY_BUFFER,n),window.gl.bufferData(window.gl.ARRAY_BUFFER,t,window.gl.STATIC_DRAW),window.gl.enable(window.gl.BLEND),window.gl.blendFunc(window.gl.SRC_ALPHA,window.gl.ONE_MINUS_SRC_ALPHA),window.gl.clearColor(0,0,0,1),window.gl.clear(window.gl.COLOR_BUFFER_BIT),window.buf=n,!0}return!1})()?((()=>{const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&p&&(e.addEventListener("input",p),t.addEventListener("input",p))})(),setTimeout((()=>{window.rebuildProgram&&window.rebuildProgram(),window.render&&window.render()}),150),console.log("WebGL")):console.error("Failed to restore WebGL context")):(!p&&window.rebuildProgram&&(p=window.rebuildProgram),!g&&window.render&&(g=window.render),f(),window.gl&&window.program&&(window.gl.deleteProgram(window.program),window.program=null),window.animationId&&(cancelAnimationFrame(window.animationId),window.animationId=null),I(),await S()?(e=!0,h("GLSL","webgpu-mode"),x(),C(!0),window.rebuildProgram=B,window.render=k,(()=>{const t=document.getElementById("vertCode"),n=document.getElementById("fragCode");if(t&&n){const o=()=>{e&&B()};v.set(t,o),v.set(n,o),t.addEventListener("input",o),n.addEventListener("input",o)}})(),A(),setTimeout((()=>{B(),k()}),100),console.log("WebGPU")):(console.error("Failed to initialize WebGPU"),alert("WebGPU initialization failed. Check the console for details.")))},P=async()=>{if(!navigator.gpu)return void console.log("WebGPU not supported");if(!await navigator.gpu.requestAdapter({powerPreference:"high-performance"}))return void console.log("WebGPU not supported");(()=>{const e=Object.assign(document.createElement("button"),{id:"webgpuToggle",className:"lbtn webgpu-toggle webgl-mode",textContent:"WebGPU",title:"Toggle between WebGL and WebGPU rendering"}),t=document.getElementById("glcanvas");return(t?.parentElement||document.body).appendChild(e),e})().addEventListener("click",M)};window.webgpuState={isWebGPUMode:()=>e,getCanvas:()=>c},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",P):setTimeout(P,500)}(),function(){const e=document.getElementById("glcanvas");if(!e)return;const t=window.gl||e.getContext("webgl2")||e.getContext("webgl"),n=window.uniforms||{};let o=null,i=null,a=null,r=!1,s=null,l=[],c="upload";const d=document.getElementById("preview-panel");function u(e){const t=parseFloat(e);return isNaN(t)?"0.0":t%1==0?t+".0":t.toString()}const m={blur:{name:"Blur",description:"Adds a gaussian blur effect",params:{strength:.5},controls:[{name:"strength",label:"Strength",type:"range",min:0,max:2,step:.1}],shader:"\nvec4 blur(vec4 color, vec2 uv, float strength) {\n  vec4 sum = vec4(0.0);\n  float off = strength * 0.01;\n  for (int i = -2; i <= 2; i++) {\n    for (int j = -2; j <= 2; j++) {\n      sum += texture2D(u_texture, uv + vec2(float(i), float(j)) * off);\n    }\n  }\n  vec4 blurred = sum / 25.0;\n  return mix(color, blurred, strength);\n}\n      "},sepia:{name:"Sepia",description:"Applies a sepia tone effect",params:{intensity:.8},controls:[{name:"intensity",label:"Intensity",type:"range",min:0,max:1,step:.1}],shader:"\nvec4 sepia(vec4 color, float intensity) {\n  float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n  vec3 sep = vec3(gray) * vec3(1.2, 1.0, 0.8);\n  return vec4(mix(color.rgb, sep, intensity), color.a);\n}\n      "},vignette:{name:"Vignette",description:"Adds a dark vignette around the edges",params:{intensity:.5,radius:.8},controls:[{name:"intensity",label:"Intensity",type:"range",min:0,max:1,step:.1},{name:"radius",label:"Radius",type:"range",min:.1,max:1,step:.1}],shader:"\nvec4 vignette(vec4 color, vec2 uv, float intensity, float radius) {\n  float d = distance(uv, vec2(0.5));\n  float vig = smoothstep(radius, radius - 0.1, d);\n  return vec4(color.rgb * mix(1.0, vig, intensity), color.a);\n}\n      "},chromatic:{name:"Chromatic Aberration",description:"Separates color channels for a glitch effect",params:{strength:.01},controls:[{name:"strength",label:"Strength",type:"range",min:0,max:.5,step:.01}],shader:"\nvec4 chromatic(vec4 color, vec2 uv, float strength) {\n  vec2 off = vec2(strength, 0.0);\n  vec3 ca;\n  ca.r = texture2D(u_texture, uv - off).r;\n  ca.g = texture2D(u_texture, uv).g;\n  ca.b = texture2D(u_texture, uv + off).b;\n  return vec4(mix(color.rgb, ca, strength), color.a);\n}\n      "},pixelate:{name:"Pixelate",description:"Creates a pixelated effect",params:{size:64},controls:[{name:"size",label:"Size",type:"range",min:8,max:256,step:8}],shader:"\nvec4 pixelate(vec4 color, vec2 uv, float pixelSize) {\n  vec2 gridUV = floor(uv * pixelSize) / pixelSize;\n  vec4 p = texture2D(u_texture, gridUV);\n  return p;\n}\n      "},contrast:{name:"Contrast",description:"Adjusts image contrast",params:{amount:1.2},controls:[{name:"amount",label:"Amount",type:"range",min:.5,max:2,step:.1}],shader:"\nvec4 contrast(vec4 color, float amount) {\n  vec3 c = ((color.rgb - 0.5) * amount) + 0.5;\n  return vec4(c, color.a);\n}\n      "}};function h(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&(e.value="\nattribute vec2 a_position;\nvarying   vec2 v_uv;\nvoid main() {\n  v_uv       = a_position * 0.5 + 0.5;\n  gl_Position = vec4(a_position, 0.0, 1.0);\n}",t.value=function(){if(0===l.length)return"video"===a?"\nprecision mediump float;\nuniform sampler2D u_video;\nvarying   vec2      v_uv;\nvoid main() {\n  vec4 color = texture2D(u_video, v_uv);\n  gl_FragColor = color;\n}":"\nprecision mediump float;\nuniform sampler2D u_image;\nvarying   vec2      v_uv;\nvoid main() {\n  vec4 color = texture2D(u_image, v_uv);\n  gl_FragColor = color;\n}";let e=`\nprecision mediump float;\nuniform sampler2D ${"video"===a?"u_video":"u_image"};\n`;return e+=`\n#define u_texture ${"video"===a?"u_video":"u_image"}\n`,e+="varying vec2 v_uv;\n",l.forEach((t=>{e+=m[t.type].shader+"\n"})),e+=`\nvoid main() {\n  vec2 uv    = v_uv;\n  vec4 color = texture2D(${"video"===a?"u_video":"u_image"}, uv);\n`,l.forEach((t=>{const n={...m[t.type].params,...t.params};switch(t.type){case"blur":e+=`  color = blur(color, uv, ${u(n.strength)});\n`;break;case"sepia":e+=`  color = sepia(color, ${u(n.intensity)});\n`;break;case"vignette":e+=`  color = vignette(color, uv, ${u(n.intensity)}, ${u(n.radius)});\n`;break;case"chromatic":e+=`  color = chromatic(color, uv, ${u(n.strength)});\n`;break;case"pixelate":e+=`  color = pixelate(color, uv, ${u(n.size)});\n`;break;case"contrast":e+=`  color = contrast(color, ${u(n.amount)});\n`}})),e+="\n  gl_FragColor = color;\n}",e}(),e.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("input",{bubbles:!0})))}function p(){r&&i&&!i.paused&&(!function(){if(!i||!o)return;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i);const e="video"===a?"uVideo":"uImage",r=(n["video"===a?"u_video":"u_image"]||n[e]||{}).loc;null!=r&&(t.useProgram(window.program),t.uniform1i(r,0))}(),g()),r&&(s=requestAnimationFrame(p))}function g(){const e=document.getElementById("videoProgressBar"),t=document.getElementById("videoTimeInfo");if(e&&t&&i&&"video"===a){const n=i.currentTime/i.duration*100;e.style.width=n+"%";const o=Math.floor(i.currentTime/60),a=Math.floor(i.currentTime%60),r=Math.floor(i.duration/60),s=Math.floor(i.duration%60);t.textContent=`${o}:${a.toString().padStart(2,"0")} / ${r}:${s.toString().padStart(2,"0")}`}}const v=document.createElement("button");v.id="mediaUploadBtn",v.innerHTML='\n    <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none"\n        xmlns="http://www.w3.org/2000/svg">\n        <path fill="currentColor" d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 \n        0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 \n        0 2-2ZM5 5h14v8.59l-3.29-3.3a1 1 \n        0 0 0-1.42 0L8 17l-3-3V5Zm0 \n        14v-2.41l3-3 5.29 5.3a1 1 0 0 \n        0 1.42 0L19 15.41V19H5Z"/>\n        <circle cx="8" cy="8" r="1.5" fill="currentColor"/>\n    </svg>\n  ',v.title="Upload Image/Video",document.body.appendChild(v);const f=document.createElement("input");f.type="file",f.accept="image/*,video/*",f.id="mediaFileInput",f.style.display="none",document.body.appendChild(f);const y=document.createElement("div");y.id="mediaModal",y.innerHTML=`\n    <div class="modal-content">\n      <button id="mediaCloseBtn"></button>\n      <h3>Media & Effects Editor</h3>\n      <div class="modal-toggle">\n        <button id="uploadTab" class="active">Upload Media</button>\n        <button id="effectsTab">Add Effects</button>\n      </div>\n      <div id="uploadView" class="modal-view active">\n        <p>Select an image or video to use in your shader.</p>\n        <button id="mediaDropButton">Choose File or Drag and Drop</button>\n        <div id="mediaPreview"></div>\n        <div class="video-controls" id="videoControls" style="display:none;">\n          <button id="playPauseBtn">Play</button>\n          <div class="time-info" id="videoTimeInfo">0:00 / 0:00</div>\n        </div>\n        <div class="video-progress" id="videoProgress" style="display:none;">\n          <div class="video-progress-bar" id="videoProgressBar"></div>\n        </div>\n        <p class="loadmediawarn">Importing base shaders will delete current text area code</p>\n        <button id="baseImportBtn">Import Base Shaders</button>\n      </div>\n      <div id="effectsView" class="modal-view">\n        <div id="effectsContent">\n          <p>Select effects to apply to your ${a||"media"}:</p>\n          <div class="effects-grid" id="effectsGrid"></div>\n          <div class="effect-controls" id="effectControls" style="display:none;">\n            <h4>Effect Parameters</h4>\n            <div id="controlsContainer"></div>\n          </div>\n          <div class="active-effects" id="activeEffectsContainer">\n            <h4>Active Effects</h4>\n            <div id="activeEffectsList"></div>\n            <button class="apply-effects-btn" id="applyEffectsBtn">Apply Effects to Shader</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `,document.body.appendChild(y);const w=document.createElement("div");w.id="mediaDragOverlay",w.innerHTML='\n    <div>Drop media to upload</div>\n    <div class="filename"></div>\n  ',d.appendChild(w);const b=y.querySelector("#mediaDropButton"),E=y.querySelector("#mediaPreview"),x=y.querySelector("#mediaCloseBtn"),C=y.querySelector("#baseImportBtn"),S=y.querySelector("#uploadTab"),L=y.querySelector("#effectsTab"),k=y.querySelector("#uploadView"),T=y.querySelector("#effectsView"),I=y.querySelector("#effectsGrid"),B=y.querySelector("#effectControls"),A=y.querySelector("#controlsContainer"),M=y.querySelector("#activeEffectsList"),P=y.querySelector("#applyEffectsBtn"),R=y.querySelector("#videoControls"),_=y.querySelector("#playPauseBtn"),F=y.querySelector("#videoProgress"),$=w.querySelector(".filename");let D=0,N=null;function U(){const e=T.querySelector("p");e&&(e.textContent=`Select effects to apply to your ${a||"media"}:`)}function q(){M.innerHTML="",l.forEach(((e,t)=>{const n=document.createElement("div");n.className="active-effect",n.innerHTML=`\n        <span>${m[e.type].name}</span>\n        <button onclick="removeEffect(${t})">Remove</button>\n      `,M.appendChild(n)}))}function O(e){const t=e.type.startsWith("video/"),n=e.type.startsWith("image/");if(!n||["image/jpeg","image/png","image/gif","image/webp"].includes(e.type))if(t||n){if(a=t?"video":"image","video"===a){i=document.createElement("video"),i.crossOrigin="anonymous",i.loop=!0,i.muted=!0,i.controls=!1;const t=URL.createObjectURL(e);i.src=t,i.addEventListener("loadeddata",(function(){H(),E.innerHTML="",E.appendChild(i),R.style.display="flex",F.style.display="block",g()})),i.addEventListener("timeupdate",g)}else{const t=new FileReader;t.onload=function(e){i=new Image,i.onload=function(){H(),E.innerHTML="",E.appendChild(i),R.style.display="none",F.style.display="none"},i.src=e.target.result},t.readAsDataURL(e)}U()}else window.showToast(`Unsupported media type: ${e.name}`,"error");else window.showToast(`Unsupported image format: ${e.name}`,"error")}function H(){o&&t.deleteTexture(o),o=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),"video"===a&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i);const e="video"===a?"uVideo":"uImage",r=(n["video"===a?"u_video":"u_image"]||n[e]||{}).loc;null!=r&&(t.useProgram(window.program),t.uniform1i(r,0))}function G(e){const t=d.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}S.addEventListener("click",(()=>{c="upload",S.classList.add("active"),L.classList.remove("active"),k.classList.add("active"),T.classList.remove("active")})),L.addEventListener("click",(()=>{c="effects",L.classList.add("active"),S.classList.remove("active"),T.classList.add("active"),k.classList.remove("active"),U()})),window.removeEffect=function(e){l.splice(e,1),q(),h()},_.addEventListener("click",(()=>{i&&"video"===a&&(i.paused?(i.play(),_.textContent="Pause",r=!0,p()):(i.pause(),_.textContent="Play",r=!1,s&&(cancelAnimationFrame(s),s=null)))})),F.addEventListener("click",(e=>{if(!i||"video"!==a)return;const t=F.getBoundingClientRect(),n=(e.clientX-t.left)/t.width;i.currentTime=n*i.duration})),C.addEventListener("click",(()=>{l=[],q(),h()})),P.addEventListener("click",(()=>{h()})),v.addEventListener("click",(()=>y.style.display="flex")),x.addEventListener("click",(()=>y.style.display="none")),y.addEventListener("click",(e=>{e.target===y&&(y.style.display="none")})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&(y.style.display="none")})),b.addEventListener("click",(()=>f.click())),f.addEventListener("change",(()=>{f.files[0]&&O(f.files[0])})),["dragenter","dragover"].forEach((e=>{b.addEventListener(e,(e=>{e.preventDefault(),b.classList.add("dragover")}))})),["dragleave","drop"].forEach((e=>{b.addEventListener(e,(e=>{e.preventDefault(),b.classList.remove("dragover")}))})),b.addEventListener("drop",(e=>{const t=e.dataTransfer.files[0];if(!t)return;const n=t.type.startsWith("video/"),o=t.type.startsWith("image/");!o||["image/jpeg","image/png","image/gif","image/webp"].includes(t.type)?n||o?O(t):window.showToast(`Unsupported media type: ${t.name}`,"error"):window.showToast(`Unsupported image format: ${t.name}`,"error")})),window.addEventListener("dragenter",(e=>{if(e.preventDefault(),D++,"flex"!==y.style.display&&e.dataTransfer.items&&[...e.dataTransfer.items].some((e=>"file"===e.kind&&(e.type.startsWith("image/")||e.type.startsWith("video/"))))&&G(e)){const t=[...e.dataTransfer.items].find((e=>"file"===e.kind&&(e.type.startsWith("image/")||e.type.startsWith("video/"))));$.textContent=t?.getAsFile()?.name||"Media file",w.style.display="flex"}})),window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("dragleave",(e=>{e.preventDefault(),D=Math.max(D-1,0),G(e)&&0!==D||(w.style.display="none")})),window.addEventListener("drop",(e=>{e.preventDefault(),w.style.display="none",D=0;const t=e.dataTransfer.files[0];t&&(t.type.startsWith("image/")||t.type.startsWith("video/"))&&G(e)&&(O(t),y.style.display="flex")})),I.innerHTML="",Object.keys(m).forEach((e=>{const t=m[e],n=document.createElement("div");n.className="effect-card",n.innerHTML=`\n        <h4>${t.name}</h4>\n        <p>${t.description}</p>\n      `,n.addEventListener("click",(()=>function(e){N=e,I.querySelectorAll(".effect-card").forEach((e=>{e.classList.remove("active")})),event.target.closest(".effect-card").classList.add("active"),function(e){const t=m[e];B.style.display="block",A.innerHTML="",t.controls.forEach(((n,o)=>{const i=document.createElement("div");i.className="effect-control";const a=t.params[n.name],r=`${e}_${n.name}_range_${o}`,s=`${e}_${n.name}_number_${o}`;i.innerHTML=`\n        <label for="${r}">${n.label}:</label>\n        <input type="range" \n              id="${r}"\n              name="${r}"\n              min="${n.min}" \n              max="${n.max}" \n              step="${n.step}" \n              value="${a}"\n              data-param="${n.name}"\n              aria-label="${n.label} range slider">\n        <input type="number" \n              id="${s}"\n              name="${s}"\n              min="${n.min}" \n              max="${n.max}" \n              step="${n.step}" \n              value="${a}"\n              data-param="${n.name}"\n              aria-label="${n.label} numeric input">\n      `;const l=i.querySelector('input[type="range"]'),c=i.querySelector('input[type="number"]');l.addEventListener("input",(e=>{const o=parseFloat(e.target.value);c.value=o,t.params[n.name]=o})),c.addEventListener("input",(e=>{const o=parseFloat(e.target.value);l.value=o,t.params[n.name]=o})),A.appendChild(i)}));const n=document.createElement("button");n.textContent="Add Effect",n.className="apply-effects-btn",n.style.width="auto",n.style.margin="10px 0",n.addEventListener("click",(()=>function(e){const t=m[e],n={type:e,params:{...t.params}};l.push(n),q(),h()}(e))),A.appendChild(n)}(e)}(e))),I.appendChild(n)})),document.addEventListener("fullscreenchange",(()=>{const e=document.fullscreenElement||document.body;[v,y,w].forEach((t=>e.appendChild(t)))})),window.addEventListener("beforeunload",(()=>{i&&"video"===a&&(i.pause(),i.src&&URL.revokeObjectURL(i.src)),s&&cancelAnimationFrame(s),o&&t.deleteTexture(o)}))}(),(()=>{function e(){const e=document.querySelector('button[onclick="saveLink()"]')||document.querySelector(".savebtn2")||document.querySelector("button.savebtn2"),t=e?e.textContent:"Copy Link",n=document.getElementById("vertCode"),o=document.getElementById("fragCode"),i=document.getElementById("shaderTitle"),a={v:n?.value||"",f:o?.value||"",t:i?.value||"Untitled Shader"},r=function(e){const t=new Map,n=Array.from(e).map((e=>e.charCodeAt(0)));let o=[],i=256,a=[];for(let e of n){let n=o.concat(e),r=n.join(",");if(t.has(r)||e<256&&1===n.length)o=n;else{let n=o.length>1?t.get(o.join(",")):o[0];a.push(n),t.set(r,i++),o=[e]}}if(o.length){let e=o.length>1?t.get(o.join(",")):o[0];a.push(e)}const r=new Uint16Array(a),s=new Uint8Array(r.buffer);let l="";for(let e of s)l+=String.fromCharCode(e);return btoa(l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(JSON.stringify(a)),s=`${window.location.origin+window.location.pathname}?s=${r}`;(async function(e){if(navigator.clipboard&&window.isSecureContext)try{return void await navigator.clipboard.writeText(e)}catch{}const t=document.createElement("textarea");t.value=e,Object.assign(t.style,{position:"fixed",opacity:"0",left:"-999999px",top:"-999999px"}),document.body.appendChild(t),t.focus(),t.select();try{if(!document.execCommand("copy"))throw 0}finally{document.body.removeChild(t)}})(s).then((()=>{e&&(e.textContent="Copied!"),setTimeout((()=>{e&&(e.textContent=t)}),2e3)})).catch((()=>{e&&(e.textContent="Copy Failed"),setTimeout((()=>{e&&(e.textContent=t)}),2e3);try{prompt("Copy this link:",s)}catch{}}))}function t(e,t=5e3,n=100){return new Promise((o=>{const i=performance.now();!function a(){try{if(e())return o(!0)}catch{}if(performance.now()-i>=t)return o(!1);setTimeout(a,n)}()}))}async function n(e=3e3){if("function"==typeof window.rebuildProgram)try{return window.rebuildProgram(),!0}catch{}if("function"==typeof compileShader)try{return compileShader(),!0}catch{}if(await t((()=>"function"==typeof window.rebuildProgram||"function"==typeof compileShader),e,120)){if("function"==typeof window.rebuildProgram)try{return window.rebuildProgram(),!0}catch{}if("function"==typeof compileShader)try{return compileShader(),!0}catch{}}return!1}async function o(){const e=new URLSearchParams(window.location.search).get("s");if(!e)return!1;try{const o=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";let n=atob(t),o=Uint8Array.from(n,(e=>e.charCodeAt(0))),i=new Uint16Array(o.buffer),a=new Map;for(let e=0;e<256;e++)a.set(e,String.fromCharCode(e));let r=i[0],s=a.get(r),l=[s],c=s,d=256;for(let e=1;e<i.length;e++){let t;if(r=i[e],a.has(r))t=a.get(r);else{if(r!==d)throw new Error("Invalid compressed code");t=c+c[0]}l.push(t),a.set(d++,c+t[0]),c=t}return l.join("")}(e);if(!o)throw 0;const i=JSON.parse(o),a=document.getElementById("vertCode"),r=document.getElementById("fragCode"),s=document.getElementById("shaderTitle");a&&i.v&&(a.value=i.v),r&&i.f&&(r.value=i.f),s&&i.t&&(s.value=i.t),window.history.replaceState({},document.title,window.location.origin+window.location.pathname);const l=i.v||"",c=i.f||"";if(/@vertex|@fragment|@group|@binding|@location|struct\s+\w+|fn\s+\w+/.test((l||"")+"\n"+(c||""))){if("function"==typeof window.toggleWebGPU)try{const e=window.toggleWebGPU();e?.then&&await e,await t((()=>window.webgpuState?.isWebGPUMode?.()),6e3,120)}catch{}else{if(await function(e,n=5e3){return t((()=>!!document.querySelector(e)),n)}("#webgpuToggle",4e3)){const e=document.getElementById("webgpuToggle"),n=window.webgpuState?.isWebGPUMode?.();if(!n&&e)try{e.click()}catch{}await t((()=>window.webgpuState?.isWebGPUMode?.()),7e3,120),await t((()=>"function"==typeof window.webgpuState?.getCanvas&&window.webgpuState.getCanvas()),4e3,120)}}return await n(3500),!0}return await n(2e3),!0}catch{return!1}}async function i(){try{await o()}catch{}const t=document.querySelector(".savebtn2")||document.querySelector('button[onclick="saveLink()"]');t&&t.addEventListener("click",e)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):setTimeout(i,200),window.saveLink=e})(),(()=>{class e{constructor(){this.dbName="ThemeManagerDB",this.dbVersion=1,this.storeName="themes",this.db=null,this.currentTheme="default",this.isModalOpen=!1,this.showColorEditor=!1,this.defaultColors={"--0":"rgba(0, 0, 0, 0.9)","--1":"#000000","--2":"rgba(28, 28, 28, 0.99)","--3":"rgba(37, 37, 37, 0.8)","--4":"rgba(64, 64, 64, 0.9)","--5":"rgba(113, 113, 113, 0.7)","--6":"rgba(174, 174, 174, 0.9)","--7":"rgba(227, 227, 227, 0.9)","--d":"rgba(15, 17, 23, .885)","--D":"#070a12","--l":"#f8fafc","--a":"#10b981","--ah":"rgba(36, 214, 154, 0.848)","--b":"#1e293b","--m":"#94a3b8","--r":"#b91040","--rh":"rgba(227, 48, 98, 0.79)"},this.presetThemes={CODE:{"--0":"rgba(0, 0, 0, 0.9)","--1":"#000000","--2":"rgba(0, 12, 24, 0.99)","--3":"rgba(16, 25, 44, 0.8)","--4":"rgba(24, 29, 41, 0.63)","--5":"rgba(76, 83, 93, 0.7)","--6":"rgba(174, 174, 174, 0.9)","--7":"rgba(227, 227, 227, 0.9)","--D":"#070a12","--a":"rgba(4, 35, 108, 1)","--ah":"rgba(13, 82, 242, 0.72)","--b":"#1e293b","--d":"rgba(15, 17, 23, .885)","--l":"#f8fafc","--m":"#94a3b8","--r":"#b91040","--rh":"rgba(227, 48, 98, 1)"},DARK:{"--0":"rgba(0, 0, 0, 0.9)","--1":"#000000","--2":"rgba(10, 10, 10, 0.99)","--3":"rgba(33, 33, 33, 0.47)","--4":"rgba(38, 38, 38, 0.9)","--5":"rgba(113, 113, 113, 0.7)","--6":"rgba(50, 226, 205, 0.9)","--7":"rgba(186, 186, 186, 0.9)","--d":"rgba(28, 28, 28, 0.89)","--D":"#070a12","--l":"#f8fafc","--a":"rgba(180, 19, 137, 1)","--ah":"rgba(255, 15, 155, 0.85)","--b":"#1e293b","--m":"#94a3b8","--r":"rgba(199, 0, 0, 1)","--rh":"rgba(255, 20, 20, 0.84)"},LIGHT:{"--0":"rgba(255, 255, 255, 0.9)","--1":"#ffffff","--2":"rgba(245, 245, 245, 0.99)","--3":"rgba(186, 186, 186, 0.76)","--4":"rgba(220, 220, 220, 0.9)","--5":"rgba(223, 223, 223, 0.9)","--6":"rgba(27, 28, 28, 0.9)","--7":"rgba(113, 113, 113, 0.9)","--d":"rgba(255, 255, 255, 0.23)","--D":"rgba(78, 78, 78, 0.3)","--l":"#0f172a","--a":"rgba(180, 19, 137, 1)","--ah":"rgba(255, 15, 155, 0.85)","--b":"#e2e8f0","--m":"#475569","--r":"rgba(199, 0, 0, 1)","--rh":"rgba(255, 20, 20, 0.84)"}},this.init()}async init(){this.applyDefaultColors(),await this.initDB(),this.createButton(),this.createModal(),this.createConfirmModal(),await this.loadSavedTheme()}applyDefaultColors(){const e=document.documentElement;Object.entries(this.defaultColors).forEach((([t,n])=>{e.style.setProperty(t,n)}))}initDB(){return new Promise(((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){t.createObjectStore(this.storeName,{keyPath:"name"}).add({name:"default",colors:this.defaultColors,created:(new Date).toISOString()})}}}))}createButton(){const e=document.createElement("button");e.id="theme-manager-btn",e.title="Theme Manager",e.setAttribute("aria-label","Open Theme Manager"),e.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15"\n          viewBox="0 0 24 24" fill="none" stroke="var(--6)" stroke-width="2"\n          stroke-linecap="round" stroke-linejoin="round"\n          style="pointer-events: none;">\n          <path d="M2 18c0 1.1.9 2 2 2h1l3-3-2-2-3 3v1z"></path>\n          <path d="M20.7 7.3a1 1 0 0 0 0-1.4L18.1 3.3a1 1 0 0 0-1.4 0l-9.3 9.3 2 2 9.3-9.3z"></path>\n        </svg>\n      ',e.onclick=()=>this.toggleModal(),document.addEventListener("fullscreenchange",(()=>{const t=document.getElementById("theme-modal"),n=document.getElementById("theme-confirm-modal");document.fullscreenElement?(document.fullscreenElement.appendChild(e),t&&document.fullscreenElement.appendChild(t),n&&document.fullscreenElement.appendChild(n)):(document.body.appendChild(e),t&&document.body.appendChild(t),n&&document.body.appendChild(n))})),document.body.appendChild(e)}createConfirmModal(){const e=document.createElement("div");e.id="theme-confirm-modal",e.innerHTML='\n        <div class="theme-confirm-modal-content">\n          <h4 class="theme-confirm-theme-modal-title">Delete Theme</h4>\n          <p id="confirm-message" class="theme-confirm-modal-message"></p>\n          <div class="theme-confirm-modal-buttons">\n            <button id="confirm-cancel" class="theme-confirm-cancel-btn">Cancel</button>\n            <button id="confirm-delete" class="theme-confirm-delete-btn">Delete</button>\n          </div>\n        </div>\n      ',document.body.appendChild(e),this.setupConfirmModalEvents()}setupConfirmModalEvents(){const e=document.getElementById("theme-confirm-modal"),t=document.getElementById("confirm-cancel"),n=document.getElementById("confirm-delete"),o=()=>{e.style.display="none",this.confirmCallback=null};t.onclick=o,n.onclick=()=>{this.confirmCallback&&this.confirmCallback(),e.style.display="none",this.confirmCallback=null},e.onclick=t=>{t.target===e&&o()},document.addEventListener("keydown",(t=>{"Escape"===t.key&&"none"!==e.style.display&&o()}))}showCustomConfirm(e,t){const n=document.getElementById("theme-confirm-modal");document.getElementById("confirm-message").textContent=e,this.confirmCallback=t,n.style.display="flex"}createModal(){const e=document.createElement("div");e.id="theme-modal",e.innerHTML='\n        <div class="theme-modal-header">\n          <div class="theme-modal-header-content">\n            <h3 class="theme-modal-title">Theme Manager</h3>\n            <button id="close-modal" class="theme-modal-close-btn" aria-label="Close Theme Manager"></button>\n          </div>\n          <div class="theme-select-container">\n            <label for="theme-select" class="theme-select-label">Select Theme:</label>\n            <select id="theme-select" class="theme-select">\n              <option value="">Choose a theme...</option>\n            </select>\n          </div>\n          <div class="theme-toggle-editor-container">\n            <button id="toggle-editor" class="theme-toggle-editor-btn">\n              Color Editor\n            </button>\n          </div>\n        </div>\n        <div id="color-editor-section" style="display: none;">\n          <div class="color-editor-controls">\n            <div class="theme-name-container">\n              <label for="theme-name" class="theme-name-label">Theme Name:</label>\n              <input type="text" id="theme-name" placeholder="Enter custom theme name" class="theme-name-input">\n              <div class="theme-action-buttons">\n                <button id="save-theme" class="save-theme-btn">Save</button>\n                <button id="delete-theme" class="delete-theme-btn">Delete</button>\n              </div>\n            </div>\n          </div>\n          <div id="color-inputs" class="color-inputs-container">\n          </div>\n          <div class="reset-section">\n            <button id="reset-colors" class="theme-reset-btn">Reset to Default</button>\n          </div>\n        </div>\n      ',document.body.appendChild(e),this.setupModalEvents(),this.createColorInputs()}setupModalEvents(){const e=document.getElementById("theme-modal"),t=document.getElementById("close-modal"),n=document.getElementById("theme-select"),o=document.getElementById("toggle-editor"),i=document.getElementById("save-theme"),a=document.getElementById("delete-theme"),r=document.getElementById("reset-colors");t.onclick=()=>this.closeModal(),n.onchange=()=>this.loadSelectedTheme(n.value),o.onclick=()=>this.toggleColorEditor(),i.onclick=()=>this.saveTheme(),a.onclick=()=>this.deleteTheme(),r.onclick=()=>this.resetToDefault();const s=t=>{this.isModalOpen&&("click"===t.type&&!e.contains(t.target)&&"theme-manager-btn"!==t.target.id||"keydown"===t.type&&"Escape"===t.key)&&this.closeModal()};document.addEventListener("click",s),document.addEventListener("keydown",s)}toggleColorEditor(){const e=document.getElementById("color-editor-section"),t=document.getElementById("toggle-editor");this.showColorEditor=!this.showColorEditor,this.showColorEditor?(e.style.display="block",t.textContent="Hide Color Editor",t.style.background="var(--r)"):(e.style.display="none",t.textContent="Color Editor",t.style.background="var(--b)")}async loadSelectedTheme(e,t=!0){if(e){if(this.presetThemes[e])return this.applyThemeColors(this.presetThemes[e]),this.currentTheme=e,void(t&&this.showToast(`"${e}" preset loaded!`,"success"));try{const n=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),o=await new Promise(((t,o)=>{const i=n.get(e);i.onsuccess=()=>t(i.result),i.onerror=()=>o(i.error)}));o&&(this.applyThemeColors(o.colors),this.currentTheme=e,t&&this.showToast(`"${e}" loaded!`,"success"))}catch(e){t&&this.showToast("Load failed!","error"),console.error("Load theme error:",e)}}}applyThemeColors(e){const t=document.documentElement;Object.entries(e).forEach((([e,n])=>{if(t.style.setProperty(e,n),this.showColorEditor){const t=e.replace("--",""),o=document.getElementById(`preview-${t}`),i=document.getElementById(`color-${t}`),a=document.getElementById(`alpha-${t}`);if(o&&(o.style.background=n),i&&(i.value=this.extractHexFromColor(n)),a){const e=this.colorToRgb(n);a.value=e.a;const t=a.previousElementSibling;t&&(t.textContent=`: ${e.a.toFixed(2)}`)}}}))}async updateThemesList(){const e=document.getElementById("theme-select");if(e)try{e.innerHTML='<option value="">Choose a theme...</option>';const t=document.createElement("option");t.value="default",t.textContent="Default",e.appendChild(t);const n=document.createElement("optgroup");n.label="Presets",Object.keys(this.presetThemes).forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)})),e.appendChild(n);const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),i=await new Promise(((e,t)=>{const n=o.getAll();n.onsuccess=()=>e(n.result||[]),n.onerror=()=>t(n.error)}));if(i.length>0){const t=document.createElement("optgroup");t.label="Custom",i.forEach((e=>{if("default"===e.name)return;const n=document.createElement("option");n.value=e.name,n.textContent=e.name,t.appendChild(n)})),e.appendChild(t)}}catch(e){console.error("Update themes list error:",e)}}async deleteTheme(){const e=document.getElementById("theme-select"),t=e.value;t?this.presetThemes[t]?this.showToast("Cannot delete preset themes!","error"):"default"!==t?this.showCustomConfirm(`Are you sure you want to delete the theme "${t}"? This action cannot be undone.`,(async()=>{try{const n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName);await new Promise(((e,o)=>{const i=n.delete(t);i.onsuccess=()=>e(),i.onerror=()=>o(i.error)})),await this.updateThemesList(),this.showToast(`"${t}" deleted!`,"success"),e.value=""}catch(e){this.showToast("Delete failed!","error"),console.error("Delete theme error:",e)}})):this.showToast("Cannot delete default theme!","error"):this.showToast("Select a theme first!","error")}updateColorRealTime(e,t,n=null){const o=document.documentElement;let i=t;if(null!==n&&t.startsWith("#")){const e=this.colorToRgb(t);i=`rgba(${e.r}, ${e.g}, ${e.b}, ${n})`}o.style.setProperty(e,i)}colorToRgb(e){let t,n,o,i=1;if(e.includes("rgba")||e.includes("rgb")){const a=e.match(/rgba?\(([^)]+)\)/);if(a){const e=a[1].split(",").map((e=>parseFloat(e.trim())));t=e[0],n=e[1],o=e[2],void 0!==e[3]&&(i=e[3])}}else{if(!e.startsWith("#"))return{r:0,g:0,b:0,a:1};{const i=e.slice(1);t=parseInt(i.substr(0,2),16),n=parseInt(i.substr(2,2),16),o=parseInt(i.substr(4,2),16)}}return{r:Math.round(t),g:Math.round(n),b:Math.round(o),a:i}}rgbToHex(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}createCompactColorPicker(e,t,n){const o=document.createElement("div");o.className="theme-color-picker-container";const i=document.createElement("div");i.className="theme-color-picker-header";const a=document.createElement("span");a.textContent=e,a.className="property-label";const r=document.createElement("div");r.id=`preview-${e.replace("--","")}`,r.className="theme-color-preview",r.style.background=t,i.appendChild(a),i.appendChild(r);const s=document.createElement("label");s.setAttribute("for",`color-${e.replace("--","")}`),s.className="theme-color-input-label",s.textContent="Color:";const l=document.createElement("input");l.type="color",l.id=`color-${e.replace("--","")}`,l.value=this.extractHexFromColor(t),l.className="theme-color-input",l.addEventListener("input",(t=>{const i=t.target.value,a=o.querySelector(`#alpha-${e.replace("--","")}`),s=a?parseFloat(a.value):1;if(this.updateColorRealTime(e,i,s),s<1){const e=this.colorToRgb(i);r.style.background=`rgba(${e.r}, ${e.g}, ${e.b}, ${s})`}else r.style.background=i;n(i)})),o.appendChild(i),o.appendChild(s),o.appendChild(l);const c=this.colorToRgb(t);if(t.includes("rgba")||c.a<1){const t=document.createElement("div"),n=document.createElement("label");n.setAttribute("for",`alpha-${e.replace("--","")}`),n.textContent=`: ${c.a.toFixed(2)}`,n.className="alpha-label";const i=document.createElement("input");i.type="range",i.min="0",i.max="1",i.step="0.01",i.value=c.a,i.id=`alpha-${e.replace("--","")}`,i.className="alpha-slider",i.addEventListener("input",(()=>{const t=parseFloat(i.value);n.textContent=`: ${t.toFixed(2)}`;const o=l.value;this.updateColorRealTime(e,o,t);const a=this.colorToRgb(o);r.style.background=`rgba(${a.r}, ${a.g}, ${a.b}, ${t})`})),t.appendChild(n),t.appendChild(i),o.appendChild(t)}return o}extractHexFromColor(e){if(e.startsWith("#"))return e;if(e.includes("rgb")){const t=this.colorToRgb(e);return this.rgbToHex(t.r,t.g,t.b)}return"#000000"}createColorInputs(){const e=document.getElementById("color-inputs");Object.entries(this.defaultColors).forEach((([t,n])=>{const o=this.createCompactColorPicker(t,n,(e=>{}));e.appendChild(o)}))}resetToDefault(){this.applyThemeColors(this.defaultColors),this.showToast("Reset to default!","success")}async saveTheme(){const e=document.getElementById("theme-name"),t=e.value.trim();if(!t)return void this.showToast("Enter theme name!","error");if(this.presetThemes[t])return void this.showToast("Cannot overwrite preset themes!","error");const n={},o=document.documentElement;Object.keys(this.defaultColors).forEach((e=>{const t=getComputedStyle(o).getPropertyValue(e).trim();n[e]=t||this.defaultColors[e]}));try{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName);await new Promise(((e,i)=>{const a=o.put({name:t,colors:n,created:(new Date).toISOString()});a.onsuccess=()=>e(),a.onerror=()=>i(a.error)})),this.currentTheme=t,await this.updateThemesList(),this.showToast(`"${t}" saved!`,"success"),e.value=""}catch(e){this.showToast("Save failed!","error"),console.error("Save theme error:",e)}}async loadSavedTheme(){const e=localStorage.getItem("currentTheme");e&&"default"!==e&&await this.loadSelectedTheme(e,!1)}showToast(e,t="info"){"function"==typeof window.showToast?window.showToast(e,t):console.log(`Toast: ${e} (${t})`)}toggleModal(){this.isModalOpen?this.closeModal():this.openModal()}async openModal(){document.getElementById("theme-modal").style.display="block",this.isModalOpen=!0,await this.updateThemesList()}closeModal(){document.getElementById("theme-modal").style.display="none",this.isModalOpen=!1,this.showColorEditor=!1;const e=document.getElementById("toggle-editor"),t=document.getElementById("color-editor-section");e&&t&&(e.textContent="Color Editor",e.style.background="var(--b)",t.style.display="none"),localStorage.setItem("currentTheme",this.currentTheme)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{window.themeManager=new e})):window.themeManager=new e,"undefined"!=typeof module&&module.exports&&(module.exports=e)})(),window.AudioReactive=class{constructor(){this.isActive=!1,this.audioContext=null,this.analyser=null,this.gl=null,this.program=null,this.sensitivity={bass:1,mid:1,treble:1,volume:1},this.showingInfo=!1,this.micStream=null,this.fileSource=null,this.fileActive=!1,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.init(),window.audioReactiveInstance=this})):(this.init(),window.audioReactiveInstance=this)}init(){if(this.previewPanel=document.getElementById("preview-panel"),!this.previewPanel)return console.warn("No #preview-panel");"static"===getComputedStyle(this.previewPanel).position&&(this.previewPanel.style.position="relative"),this.button(),this.Modal(),navigator.mediaDevices.addEventListener("devicechange",(()=>this.loadAudioDevices())),this.loadAudioDevices()}EL(e,t={},n="",o=""){const i=document.createElement(e);return Object.assign(i,t),n&&(i.className=n),o&&(i.innerHTML=o),i}style(e,t){Object.assign(e.style,t)}button(){this.button=this.EL("button",{innerHTML:this.SVG(),title:"Audio Reactivity"},"audio-reactive-button"),this.button.addEventListener("mouseleave",(()=>{this.button.classList.toggle("active",this.isActive)})),this.button.onclick=()=>this.show(),this.previewPanel.appendChild(this.button)}SVG(){return'\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n        <path d="M12 1c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2s2-.9 2-2V3c0-1.1-.9-2-2-2z"/>\n        <path d="M19 10v1c0 3.87-3.13 7-7 7s-7-3.13-7-7v-1\n                 c0-.55-.45-1-1-1s-1 .45-1 1v1\n                 c0 4.72 3.56 8.61 8 9.19V22\n                 c0 .55.45 1 1 1s1-.45 1-1v-2.81\n                 c4.44-.58 8-4.47 8-9.19v-1\n                 c0-.55-.45-1-1-1s-1 .45-1 1z"/>\n        <circle cx="12" cy="20" r="2" opacity="0.3"/>\n      </svg>\n    '}InfoSVG(){return'\n     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">\n      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1" fill="none"/>\n      <line x1="12" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>\n      <circle cx="12" cy="8" r="1" fill="currentColor"/>\n    </svg>\n    '}Modal(){this.modal=this.EL("div",{},"audio-reactive-modal");const e=this.EL("div",{},"audio-reactive-modal-wrap"),t=this.EL("div",{},"",`<div class="audio-reactive-header">\n        <h3 class="audio-reactive-title">\n          ${this.SVG()} <span id="modal-title">Audio</span>\n        </h3>\n        <div class="audio-reactive-button-group">\n          <button id="info-toggle" class="audio-reactive-info-btn" title="Show Documentation">\n            ${this.InfoSVG()}\n          </button>\n          <button id="close-modal" class="audio-reactive-close-btn"></button>\n        </div>\n      </div>`);e.appendChild(t),this.settingsContent=this.EL("div",{id:"settings-content"}),this.settingsContent.appendChild(this.EL("div",{},"",'<div class="audio-reactive-mic-section">\n        <span class="audio-reactive-label">\n          Microphone Input:\n        </span>\n        <select id="mic-select" class="audio-reactive-select">\n          <option value="">Loading devices...</option>\n        </select>\n      </div>')),this.settingsContent.appendChild(this.EL("div",{},"",'<div class="audio-reactive-toggle-section">\n        <button id="audio-toggle" class="audio-reactive-toggle-btn">\n          Enable Audio Input\n        </button>\n        <div id="audio-status" class="audio-reactive-status">\n          Click to enable microphone access\n        </div>\n      </div>'));const n=["bass","mid","treble","volume"].map((e=>`<div class="audio-reactive-slider-group">\n          <span class="audio-reactive-slider-label">\n            ${e[0].toUpperCase()+e.slice(1)} Sensitivity:\n            <span id="${e}-value" class="audio-reactive-slider-value" style="color:${this.color(e)};">1.0</span>\n          </span>\n          <input id="${e}-slider" class="audio-reactive-slider" type="range" min="0.1" max="3" step="0.1" value="1.0" />\n        </div>`)).join("");this.settingsContent.appendChild(this.EL("div",{},"",`${n}`)),this.settingsContent.appendChild(this.EL("div",{},"",`<div class="audio-reactive-levels">\n        <h4 class="audio-reactive-levels-title">\n          Audio Levels\n        </h4>\n        <div id="audio-bars" class="audio-reactive-bars">\n          ${["bass","mid","treble","volume"].map((e=>`<div class="audio-bar" data-type="${e}"></div>`)).join("")}\n        </div>\n        <div class="audio-reactive-bar-labels">\n          ${["Bass","Mid","Treble","Volume"].map((e=>`<span class="audio-reactive-bar-label">${e}</span>`)).join("")}\n        </div>\n      </div>`)),this.infoContent=this.EL("div",{id:"info-content"},"audio-reactive-info-content"),this.infoContent.appendChild(this.EL("div",{},"",'<div>\n        <h4 class="audio-reactive-info-title">Audio-Reactive Shader Uniforms</h4>\n        <p class="audio-reactive-info-text">\n          This system automatically passes audio data to your shaders as uniform variables. \n          Use these in your fragment shader code:\n        </p>\n        <div class="audio-reactive-code-block">\n          <div class="audio-reactive-code-comment">// Available uniforms:</div>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_bass;</span>    <span class="audio-reactive-code-inline-comment">// Bass frequencies (0.0-1.0)</span><br>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_mid;</span>     <span class="audio-reactive-code-inline-comment">// Mid frequencies (0.0-1.0)</span><br>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_treble;</span> <span class="audio-reactive-code-inline-comment">// High frequencies (0.0-1.0)</span><br>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_volume;</span> <span class="audio-reactive-code-inline-comment">// Overall volume (0.0-1.0)</span>\n        </div>\n        <h5 class="audio-reactive-example-title">Example Usage:</h5>\n        <div class="audio-reactive-code-block">\n          <div class="audio-reactive-code-comment">// Pulse effect with bass</div><br>\n          <span class="audio-reactive-code-var">vec3 color = baseColor * (</span><span class="audio-code-span">1.0</span><span class="audio-reactive-code-var"> + u_bass * </span><span class="audio-code-span">2.0</span><span class="audio-reactive-code-var">);</span><br><br>\n          <div class="audio-reactive-code-comment">// Frequency-based color mixing</div><br>\n          <span class="audio-reactive-code-var">vec3 audioColor = vec3(u_bass, u_mid, u_treble);</span><br><br>\n          <div class="audio-reactive-code-comment">// Time modulation with volume</div><br>\n          <span class="audio-reactive-code-var">float speed = u_time * (</span><span class="audio-code-span">1.0</span><span class="audio-reactive-code-var"> + u_volume * </span><span class="audio-code-span">5.0</span><span class="audio-reactive-code-var">);</span><br><br>\n          <div class="audio-reactive-code-comment">// Scale transformations</div><br>\n          <span class="audio-reactive-code-var">vec2 scaledUV = uv * (</span><span class="audio-code-span">1.0</span><span class="audio-reactive-code-var"> + u_bass * </span><span class="audio-code-span">0.5</span><span class="audio-reactive-code-var">);</span>\n        </div>\n        <h5 class="audio-reactive-notes-title">Notes:</h5>\n        <ul class="audio-reactive-notes-list">\n          <li class="audio-reactive-notes-item">Bass frequencies are dampened to prevent overwhelming effects</li>\n          <li class="audio-reactive-notes-item">Use sensitivity sliders to fine-tune responsiveness</li>\n          <li class="audio-reactive-notes-item">Combine multiple frequencies for complex animations</li>\n          <li class="audio-reactive-notes-item">Values are smoothed over time to reduce jitter</li>\n        </ul>\n        <div class="audio-reactive-tip-box">\n          <strong class="audio-reactive-tip-strong">Pro Tip:</strong> \n          <span class="audio-reactive-tip-text">Try multiplying audio values by larger numbers (2.0-10.0) for more dramatic effects, or use them as offsets in noise functions.</span>\n        </div>\n      </div>'));const o=this.EL("div",{id:"file-drop"},"audio-reactive-file-drop",'\n      <p class="audio-reactive-file-text">\n        Drag & drop an audio file here<br>\n        or <button id="file-upload-btn" class="audio-reactive-upload-btn">Browse files</button>\n      </p>\n      <input id="file-input" class="audio-reactive-file-input" type="file" accept="audio/mpeg, audio/mp3, audio/wav, audio/wave, audio/x-wav, audio/aac, audio/mp4, audio/x-m4a, audio/flac, audio/ogg, audio/opus, .mp3, .wav, .aac, .m4a, .flac, .ogg, .opus"/>\n      <audio id="file-audio" class="audio-reactive-file-audio" controls></audio>\n      <button id="clear-file-btn" class="audio-reactive-clear-btn">Clear File</button>\n    ');this.settingsContent.appendChild(o),e.appendChild(this.settingsContent),e.appendChild(this.infoContent),this.modal.appendChild(e),this.bindEvents()}color(e){return{bass:"#ff4444",mid:"#44ff44",treble:"#4444ff",volume:"#ffff44"}[e]}async loadAudioDevices(e){try{const t=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)),n=this.modal.querySelector("#mic-select"),o=e||n.value;n.innerHTML="",t.forEach(((e,t)=>{const o=document.createElement("option");o.value=e.deviceId,o.text=e.label||`Microphone ${t+1}`,n.appendChild(o)})),o&&[...n.options].some((e=>e.value===o))&&(n.value=o)}catch(e){console.warn("Could not enumerate audio devices:",e)}}bindEvents(){this.modal.querySelector("#close-modal").onclick=()=>this.hide(),this.modal.onclick=e=>{e.target===this.modal&&this.hide()},document.addEventListener("keydown",(e=>{"Escape"===e.key&&"none"!==this.modal.style.display&&this.hide()}),{once:!1});const e=this.modal.querySelector("#info-toggle"),t=this.modal.querySelector("#modal-title");e.onclick=()=>{this.showingInfo=!this.showingInfo,this.showingInfo?(this.settingsContent.style.display="none",this.infoContent.style.display="block",t.textContent="Documentation",e.innerHTML=this.SVG(),e.title="Show Settings"):(this.settingsContent.style.display="block",this.infoContent.style.display="none",t.textContent="Audio",e.innerHTML=this.InfoSVG(),e.title="Show Documentation")},this.modal.querySelector("#mic-select").addEventListener("change",(async()=>{this.isActive&&!this.fileActive&&await this.switchToMicrophone()}));const n=this.modal.querySelector("#audio-toggle");this.modal.querySelector("#audio-status"),n.onclick=async()=>{if(this.fileActive)await this.switchToMicrophone();else if(this.audioContext&&this.micStream)this.isActive=!this.isActive,this.isActive?(this.updateMicrophoneUI(!0,"Microphone active"),this.button.classList.add("active")):(this.cleanupMicrophone(),this.updateMicrophoneUI(!1,"Click to enable microphone access"),this.button.classList.remove("active"));else try{await this.getMic(),this.updateMicrophoneUI(!0,"Microphone active"),this.isActive=!0,this.fileActive=!1,this.button.classList.add("active")}catch{this.updateMicrophoneUI(!1,"Microphone access denied",!0)}},["bass","mid","treble","volume"].forEach((e=>{const t=this.modal.querySelector(`#${e}-slider`),n=this.modal.querySelector(`#${e}-value`);t.oninput=()=>{this.sensitivity[e]=+t.value,n.textContent=t.value}}));const o=this.modal.querySelector("#file-drop"),i=this.modal.querySelector("#file-input"),a=this.modal.querySelector("#file-upload-btn"),r=(this.modal.querySelector("#file-audio"),this.modal.querySelector("#clear-file-btn"));a.onclick=e=>{e.stopPropagation(),i.click()},["dragenter","dragover"].forEach((e=>o.addEventListener(e,(e=>{e.preventDefault(),o.classList.add("dragover")})))),["dragleave","drop"].forEach((e=>o.addEventListener(e,(e=>{e.preventDefault(),o.classList.remove("dragover")})))),o.addEventListener("drop",(e=>{const t=e.dataTransfer.files[0];t&&t.type.startsWith("audio/")&&this.loadFile(t)})),i.onchange=()=>{const e=i.files[0];e&&this.loadFile(e)},r.onclick=()=>this.clearFile()}updateMicrophoneUI(e,t,n=!1){const o=this.modal.querySelector("#audio-toggle"),i=this.modal.querySelector("#audio-status");n?(o.textContent="Access Denied",this.style(o,{backgroundColor:"var(--r)"}),i.style.color="var(--r)"):(o.textContent=e?"Microphone: ON":"Microphone: OFF",this.style(o,{backgroundColor:e?"var(--a)":"var(--1)"}),i.style.color="var(--7)"),i.textContent=t}async switchToMicrophone(){try{this.fileActive&&this.clearFileAudio(),await this.getMic(),this.updateMicrophoneUI(!0,"Microphone active"),this.isActive=!0,this.fileActive=!1,this.button.style.backgroundColor="var(--a)"}catch(e){console.error("Failed to switch to microphone:",e),this.updateMicrophoneUI(!1,"Failed to access microphone",!0)}}clearFileAudio(){const e=this.modal.querySelector("#file-audio"),t=this.modal.querySelector("#clear-file-btn");e&&(e.pause(),e.currentTime=0,e.style.display="none",e.src&&(URL.revokeObjectURL(e.src),e.src="")),t&&(t.style.display="none"),this.fileSource&&(this.fileSource.disconnect(),this.fileSource=null)}async show(){const e=document.fullscreenElement||document.webkitFullscreenElement||document.body;this.modal.parentNode!==e&&e.appendChild(this.modal),this.modal.style.display="block",this.showingInfo=!1,this.settingsContent.style.display="block",this.infoContent.style.display="none",this.modal.querySelector("#modal-title").textContent="Audio",this.modal.querySelector("#info-toggle").innerHTML=this.InfoSVG(),this.modal.querySelector("#info-toggle").title="Show Documentation",this.barAnimation()}hide(){this.modal.style.display="none"}barAnimation(){const e=()=>{if("none"!==this.modal.style.display){if(this.analyser&&this.isActive&&!this.showingInfo){const e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(e);const t={bass:e.slice(0,20).reduce(((e,t)=>e+t))/20*.4,mid:e.slice(20,60).reduce(((e,t)=>e+t))/40,treble:e.slice(60,120).reduce(((e,t)=>e+t))/60,volume:e.reduce(((e,t)=>e+t))/e.length};this.modal.querySelectorAll(".audio-bar").forEach((e=>{const n=e.dataset.type,o=Math.max(2,t[n]/255*60);e.style.height=o+"px"}))}requestAnimationFrame(e)}};requestAnimationFrame(e)}cleanupMicrophone(){this.micStream&&(this.micStream.getTracks().forEach((e=>e.stop())),this.micStream=null)}stopAudio(){this.cleanupMicrophone(),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null,this.analyser=null,this.fileSource=null}async getMic(){this.cleanupMicrophone();const e=this.modal.querySelector("#mic-select").value;try{this.micStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:e?{exact:e}:void 0,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}),this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),"suspended"===this.audioContext.state&&await this.audioContext.resume(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.3,this.audioContext.createMediaStreamSource(this.micStream).connect(this.analyser),await this.loadAudioDevices(e)}catch(e){throw this.cleanupMicrophone(),e}}async loadFile(e){this.clearFileAudio();const t=this.EL("audio",{id:"file-audio",controls:!0,src:URL.createObjectURL(e)},"audio-reactive-file-audio");t.style.display="block",this.modal.querySelector("#clear-file-btn").style.display="block",this.modal.querySelector("#file-drop").appendChild(t);try{this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=new AudioContext),"suspended"===this.audioContext.state&&await this.audioContext.resume(),this.cleanupMicrophone(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.3,this.fileSource=this.audioContext.createMediaElementSource(t),this.fileSource.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.isActive=!0,this.fileActive=!0,this.button.style.backgroundColor="var(--a)",this.updateMicrophoneUI(!1,"Audio file active - Click to switch to microphone"),await t.play()}catch(e){console.error("Failed to load audio file:",e),this.clearFile()}}clearFile(){this.clearFileAudio(),this.fileActive=!1,this.isActive=!1,this.button.style.backgroundColor="var(--d)",this.updateMicrophoneUI(!1,"Click to enable microphone access")}setGLContext(e,t){this.gl=e,this.program=t}update(){if(!(this.analyser&&this.isActive&&this.gl&&this.program))return;const e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(e);const t=(t,n,o,i=1)=>Math.min(1,e.slice(t,n).reduce(((e,t)=>e+t))/(n-t)/255*o*i),n={bass:t(0,20,this.sensitivity.bass,.4),mid:t(20,60,this.sensitivity.mid),treble:t(60,120,this.sensitivity.treble),volume:t(0,e.length,this.sensitivity.volume)};["bass","mid","treble","volume"].forEach((e=>{const t=this.gl.getUniformLocation(this.program,`u_${e}`);t&&this.gl.uniform1f(t,n[e])}))}},function(){const e=new WeakSet;let t=null,n=!1,o=!1,i=null,a=null,r=null;function s(e){if(isNaN(e)||!isFinite(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}function l(e){const t=document.createElement("div");t.textContent=e,t.className="audio-notification";(document.fullscreenElement||document.body).appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),900)}function c(){i&&(clearInterval(i),i=null),o=!1;document.querySelectorAll(".audio-notification").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))}function d(d){if(e.has(d))return;e.add(d),function(){if(t&&t.parentNode){const e=t.querySelector("audio");e&&(e.pause(),e.src="",e.load()),c(),t.parentNode.removeChild(t),t=null}r=null,a=null}(),r=d,a=d.src,d.controls=!1;const u=document.createElement("div");u.className="audio-wrapper",t=u;const m=document.createElement("div");m.className="audio-time-container";const h=document.createElement("div");h.textContent="0:00";const p=document.createElement("div");p.textContent="/";const g=document.createElement("div");g.textContent="0:00",m.appendChild(h),m.appendChild(p),m.appendChild(g);const v=document.createElement("div");v.className="audio-controls-row";const f=document.createElement("button");f.textContent="",f.className="audio-play-pause";const y=document.createElement("input");y.type="range",y.min=0,y.max=100,y.value=0,y.disabled=!0,y.className="audio-seek-bar";const w=document.createElement("div");w.className="audio-volume-container";const b=document.createElement("button");b.className="audio-volume-button";const E=document.createElementNS("http://www.w3.org/2000/svg","svg"),x=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","currentColor"),E.setAttribute("width","20"),E.setAttribute("height","20"),x.setAttribute("d","M3 10v4h4l5 5V5l-5 5H3zm13.5 2c0-.83-.34-1.58-.88-2.12l1.42-1.42A5.985 5.985 0 0120.5 12c0 1.66-.67 3.16-1.76 4.24l-1.42-1.42c.54-.54.88-1.29.88-2.12zm-2.12-7.88l1.42 1.42A8.963 8.963 0 0122 12a8.963 8.963 0 01-4.2 7.46l-1.42-1.42A6.978 6.978 0 0019.5 12c0-2.21-.9-4.21-2.62-5.88z"),E.appendChild(x),b.appendChild(E);const C=document.createElement("div");C.className="audio-volume-panel";const S=document.createElement("div");S.textContent=Math.round(100*d.volume)+"%",S.className="audio-volume-display";const L=document.createElement("div");L.className="audio-slider-track";const k=document.createElement("div");k.className="audio-slider-fill";const T=document.createElement("div");function I(e){const t=100*e;k.style.height=t+"%",T.style.bottom=`calc(${t}% - 6px)`,S.textContent=Math.round(t)+"%",0===e?x.setAttribute("d","M5 9v6h4l5 5V4l-5 5H5z M16 10l4 4m0-4l-4 4"):e<.5?x.setAttribute("d","M5 9v6h4l5 5V4l-5 5H5z M17 12a3 3 0 00-1.2-2.4l.7-.7a4 4 0 010 6.2l-.7-.7A3 3 0 0017 12z"):x.setAttribute("d","M5 9v6h4l5 5V4l-5 5H5z M17 12a3 3 0 00-1.2-2.4l.7-.7a4 4 0 010 6.2l-.7-.7A3 3 0 0017 12z M20 12a5 5 0 00-2-4l.7-.7a6 6 0 010 9.4l-.7-.7a5 5 0 002-4z")}T.className="audio-slider-handle",L.appendChild(k),L.appendChild(T),C.appendChild(S),C.appendChild(L),I(d.volume),w.appendChild(b),w.appendChild(C);let B,A=!1;function M(e){const t=L.getBoundingClientRect(),n=e-t.top;return Math.max(0,Math.min(1,1-n/t.height))}function P(e){if(A){const t=M(e.clientY);d.volume=t,I(t)}}function R(){B=setTimeout((()=>{A||C.classList.remove("visible")}),500)}L.addEventListener("mousedown",(e=>{A=!0;const t=M(e.clientY);d.volume=t,I(t),document.addEventListener("mousemove",P),document.addEventListener("mouseup",(()=>{A=!1,document.removeEventListener("mousemove",P)}))})),b.addEventListener("mouseenter",(function(){clearTimeout(B),C.classList.add("visible")})),w.addEventListener("mouseleave",R),C.addEventListener("mouseenter",(()=>clearTimeout(B))),C.addEventListener("mouseleave",R);let _=d.volume;b.addEventListener("click",(()=>{d.volume>0?(_=d.volume,d.volume=0):d.volume=_||.5,I(d.volume)}));const F=document.createElement("button");F.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n      <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/>\n      <path d="M12.5 7H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>\n    </svg>',F.title="Toggle 10s countdown",F.className="audio-countdown-toggle "+(n?"enabled":"disabled"),v.appendChild(f),v.appendChild(y),v.appendChild(F),v.appendChild(w),d.parentNode.insertBefore(u,d),u.appendChild(m),u.appendChild(v),u.appendChild(d),F.addEventListener("click",(()=>{n=!n,F.className="audio-countdown-toggle "+(n?"enabled":"disabled")})),f.addEventListener("click",(()=>{if(d.src||a)if(d.paused)if(n&&!o){const e=function(e){const t=new(window.AudioContext||window.webkitAudioContext),n=t.sampleRate,o=t.createBuffer(1,e*n,n).length,i=new ArrayBuffer(44+2*o),a=new DataView(i),r=(e,t)=>{for(let n=0;n<t.length;n++)a.setUint8(e+n,t.charCodeAt(n))};r(0,"RIFF"),a.setUint32(4,36+2*o,!0),r(8,"WAVE"),r(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,n,!0),a.setUint32(28,2*n,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),r(36,"data"),a.setUint32(40,2*o,!0);for(let e=0;e<o;e++)a.setInt16(44+2*e,0,!0);return t.close(),new Blob([i],{type:"audio/wav"})}(10),t=URL.createObjectURL(e);d.src=t,d.load(),d.play(),function(e,t){if(o)return;o=!0;let n=10;l(n),i=setInterval((()=>{n--,n>0?l(n):(c(),e===r&&(e.src=t,e.load(),e.play()))}),1e3)}(d,a)}else d.play();else d.pause(),c()})),d.addEventListener("play",(()=>{f.textContent="",y.disabled=!1})),d.addEventListener("pause",(()=>{f.textContent=""})),d.addEventListener("timeupdate",(()=>{isNaN(d.duration)||(y.value=d.currentTime/d.duration*100||0,h.textContent=s(d.currentTime),g.textContent=s(d.duration))})),d.addEventListener("loadedmetadata",(()=>{y.disabled=!1,h.textContent="0:00",g.textContent=s(d.duration)})),y.addEventListener("input",(()=>{isNaN(d.duration)||(d.currentTime=y.value/100*d.duration)})),d.addEventListener("volumechange",(()=>{I(d.volume)}))}new MutationObserver((e=>{for(let t of e)for(let e of t.addedNodes)1===e.nodeType&&"AUDIO"===e.tagName&&"file-audio"===e.id&&d(e)})).observe(document.body,{childList:!0,subtree:!0});const u=document.getElementById("file-audio");u&&d(u)}(),window.addEventListener("tutorial:end",(function(){if(document.querySelector(".banner"))return;if(window.bannerDismissed)return;const e=!0===window.userLoggedIn,t=window.userRole;if(e){if("basic"!==t)return;n("Upgrade to save your work publicly ",function(e,t){const n=document.createElement("a");return n.className="banner-link",n.href=e,n.textContent=t,n}("/upgrade","Upgrade now"))}else n("Want to save your progress? ",function(e){const t=document.createElement("button");return t.className="banner-auth-button",t.setAttribute("data-auth-open",""),t.textContent=e,t.addEventListener("click",(()=>{const e=document.getElementById("authModal");e&&(e.style.display="block")})),t}("Login/Register"));function n(e,t){const n=document.createElement("div");n.className="banner";const o=document.createElement("span");o.textContent=e,o.appendChild(t);const i=document.createElement("button");i.className="banner-close",i.textContent="",i.addEventListener("click",g),n.appendChild(o),n.appendChild(i),document.body.appendChild(n);const a=.3*n.offsetWidth;let r,s=0;function l(e){Math.abs(e.deltaX)<Math.abs(e.deltaY)||(e.preventDefault(),s-=e.deltaX,s<0?s=0:(n.classList.add("banner-no-transition"),n.style.transform=`translateX(${s}px)`,n.style.opacity=""+(1-Math.min(Math.abs(s)/n.offsetWidth,1)),clearTimeout(r),r=setTimeout(c,100)))}function c(){n.classList.remove("banner-no-transition"),Math.abs(s)>a?(n.style.transform=`translateX(${n.offsetWidth}px)`,n.style.opacity="0",setTimeout(g,300)):(n.style.transform="",n.style.opacity="1"),s=0}n.addEventListener("wheel",l,{passive:!1});let d=0,u=0,m=!1;n.addEventListener("touchstart",(e=>{m=!0,d=e.touches[0].clientX,n.classList.add("banner-no-transition")}),{passive:!0}),n.addEventListener("touchmove",(e=>{if(!m)return;u=e.touches[0].clientX;const t=u-d;t<0||(n.style.transform=`translateX(${t}px)`,n.style.opacity=""+(1-Math.abs(t)/n.offsetWidth))}),{passive:!0}),n.addEventListener("touchend",(()=>{const e=u-d;n.classList.remove("banner-no-transition"),e>a?(n.style.transform=`translateX(${n.offsetWidth}px)`,n.style.opacity="0",setTimeout(g,300)):(n.style.transform="",n.style.opacity="1"),m=!1}),{passive:!0});let h=!1,p=0;function g(){n.remove(),n.removeEventListener("wheel",l),window.bannerDismissed=!0}n.addEventListener("mousedown",(e=>{h=!0,p=e.clientX,n.classList.add("banner-no-transition")})),window.addEventListener("mousemove",(e=>{if(!h)return;const t=e.clientX-p;t<0||(n.style.transform=`translateX(${t}px)`,n.style.opacity=""+(1-Math.abs(t)/n.offsetWidth))})),window.addEventListener("mouseup",(e=>{if(!h)return;const t=e.clientX-p;n.classList.remove("banner-no-transition"),t>a?(n.style.transform=`translateX(${n.offsetWidth}px)`,n.style.opacity="0",setTimeout(g,300)):(n.style.transform="",n.style.opacity="1"),h=!1}))}})),document.querySelectorAll("[data-auth-open]").forEach((e=>{e.addEventListener("click",(()=>{document.getElementById("authModal").style.display="block"}))}));class e{constructor(e,t={}){this.canvas=e,this.gl=e.getContext("webgl")||e.getContext("webgl2"),this.options={sampleSize:t.sampleSize||60,showFPS:void 0===t.showFPS||t.showFPS,showMemory:void 0===t.showMemory||t.showMemory,showGPUInfo:void 0===t.showGPUInfo||t.showGPUInfo,showDrawCalls:void 0===t.showDrawCalls||t.showDrawCalls,overlayPosition:t.overlayPosition||"top-right"},this.metrics={fps:{current:0,average:0,min:1/0,max:0,history:[]},drawCalls:0,triangleCount:0,memory:{jsHeapSizeLimit:0,totalJSHeapSize:0,usedJSHeapSize:0},gpuInfo:{vendor:"",renderer:""}},this.lastTimestamp=performance.now(),this.frameCount=0,this.isPanelOpen=!1,this.createUI(),this.options.showGPUInfo&&this.collectGPUInfo(),this.instrumentGLDrawCalls()}createUI(){this.container=document.createElement("div"),this.container.className="glsl-performance-monitor-container",this.updateContainerPosition(),this.toggleButton=document.createElement("button"),this.toggleButton.className="glsl-performance-monitor-toggle",this.toggleButton.title="Performance Monitor",this.toggleButton.innerHTML='\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M3 13H10V3H3V13ZM3 21H10V15H3V21ZM12 21H19V11H12V21ZM12 3V9H19V3H12Z" fill="var(--6)"/>\n        </svg>\n      ',this.overlay=document.createElement("div"),this.overlay.className="glsl-performance-monitor-panel",this.overlay.style.display="none";const e=document.createElement("div");e.className="glsl-performance-monitor-header";const t=document.createElement("div");t.textContent="Performance Monitor",t.className="glsl-performance-monitor-title",e.appendChild(t),this.overlay.appendChild(e),this.options.showFPS&&(this.fpsDisplay=document.createElement("div"),this.fpsDisplay.className="glsl-performance-monitor-display",this.overlay.appendChild(this.fpsDisplay)),this.options.showDrawCalls&&(this.drawCallsDisplay=document.createElement("div"),this.drawCallsDisplay.className="glsl-performance-monitor-display",this.overlay.appendChild(this.drawCallsDisplay)),this.options.showMemory&&(this.memoryDisplay=document.createElement("div"),this.memoryDisplay.className="glsl-performance-monitor-display",this.overlay.appendChild(this.memoryDisplay)),this.options.showGPUInfo&&(this.gpuInfoDisplay=document.createElement("div"),this.overlay.appendChild(this.gpuInfoDisplay)),this.toggleButton.addEventListener("click",(()=>this.togglePanel())),this.container.appendChild(this.toggleButton),this.container.appendChild(this.overlay),this.canvas.parentNode.style.position="relative",this.canvas.parentNode.appendChild(this.container),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isPanelOpen&&this.togglePanel()}))}updateContainerPosition(){this.container.classList.remove("top-left","top-right","bottom-left","bottom-right"),this.container.classList.add(this.options.overlayPosition)}togglePanel(){this.isPanelOpen=!this.isPanelOpen,this.overlay.style.display=this.isPanelOpen?"block":"none";const e=this.isPanelOpen?'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M3 13H10V3H3V13ZM3 21H10V15H3V21ZM12 21H19V11H12V21ZM12 3V9H19V3H12Z" fill="var(--rh)"/>\n          </svg>':'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M3 13H10V3H3V13ZM3 21H10V15H3V21ZM12 21H19V11H12V21ZM12 3V9H19V3H12Z" fill="var(--7)"/>\n          </svg>';this.toggleButton.innerHTML=e,this.isPanelOpen?this.start():this.stop()}start(){this.isRunning=!0,this.frameCount=0,this.lastTimestamp=performance.now(),this.metrics.fps.history=[],this.metrics.fps.min=1/0,this.metrics.fps.max=0,this.metrics.drawCalls=0,this.metrics.triangleCount=0,this.animate()}stop(){this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}animate(){if(!this.isRunning)return;const e=performance.now(),t=e-this.lastTimestamp;t>=1e3&&(this.metrics.fps.current=Math.round(1e3*this.frameCount/t),this.metrics.fps.min=Math.min(this.metrics.fps.min,this.metrics.fps.current),this.metrics.fps.max=Math.max(this.metrics.fps.max,this.metrics.fps.current),this.metrics.fps.history.push(this.metrics.fps.current),this.metrics.fps.history.length>this.options.sampleSize&&this.metrics.fps.history.shift(),this.metrics.fps.average=Math.round(this.metrics.fps.history.reduce(((e,t)=>e+t),0)/this.metrics.fps.history.length),this.options.showMemory&&window.performance&&performance.memory&&(this.metrics.memory={jsHeapSizeLimit:performance.memory.jsHeapSizeLimit,totalJSHeapSize:performance.memory.totalJSHeapSize,usedJSHeapSize:performance.memory.usedJSHeapSize}),this.updateDisplay(),this.frameCount=0,this.lastTimestamp=e,this.metrics.drawCalls=0,this.metrics.triangleCount=0),this.frameCount++,this.animationFrameId=requestAnimationFrame((()=>this.animate()))}updateDisplay(){if(this.overlay&&this.isPanelOpen){if(this.options.showFPS&&this.fpsDisplay&&(this.fpsDisplay.innerHTML=`\n          <div><b>FPS:</b> <span class="glsl-performance-monitor-value">${this.metrics.fps.current}</span></div>\n          <div class="glsl-performance-monitor-details">\n            avg: ${this.metrics.fps.average}, \n            min: ${this.metrics.fps.min}, \n            max: ${this.metrics.fps.max}\n          </div>\n        `),this.options.showDrawCalls&&this.drawCallsDisplay&&(this.drawCallsDisplay.innerHTML=`\n          <div><b>Draw calls:</b> <span class="glsl-performance-monitor-value">${this.metrics.drawCalls}</span></div>\n          <div class="glsl-performance-monitor-details">\n            Triangles: ~<span class="glsl-performance-monitor-highlight">${Math.round(this.metrics.triangleCount)}</span>\n          </div>\n        `),this.options.showMemory&&this.memoryDisplay&&window.performance&&performance.memory){const e=e=>(e/1048576).toFixed(2);this.memoryDisplay.innerHTML=`\n          <div><b>Memory:</b> <span class="glsl-performance-monitor-value">${e(this.metrics.memory.usedJSHeapSize)} MB</span></div>\n          <div class="glsl-performance-monitor-details">\n            Total: ${e(this.metrics.memory.totalJSHeapSize)} MB\n            (Limit: ${e(this.metrics.memory.jsHeapSizeLimit)} MB)\n          </div>\n        `}this.options.showGPUInfo&&this.gpuInfoDisplay&&(this.gpuInfoDisplay.innerHTML=`\n          <div><b>GPU:</b> <span class="glsl-performance-monitor-value">${this.metrics.gpuInfo.vendor}</span></div>\n          <div class="glsl-performance-monitor-details">\n            ${this.metrics.gpuInfo.renderer}\n          </div>\n        `)}}collectGPUInfo(){if(this.gl){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)this.metrics.gpuInfo.vendor=this.gl.getParameter(this.gl.VENDOR)||"Unknown",this.metrics.gpuInfo.renderer=this.gl.getParameter(this.gl.RENDERER)||"Unknown";else{const e=this.gl.getExtension("WEBGL_debug_renderer_info");e?(this.metrics.gpuInfo.vendor=this.gl.getParameter(e.UNMASKED_VENDOR_WEBGL)||"Unknown",this.metrics.gpuInfo.renderer=this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL)||"Unknown"):(this.metrics.gpuInfo.vendor=this.gl.getParameter(this.gl.VENDOR)||"Unknown",this.metrics.gpuInfo.renderer=this.gl.getParameter(this.gl.RENDERER)||"Unknown")}}}instrumentGLDrawCalls(){if(!this.gl||!this.options.showDrawCalls)return;const e=this.gl.drawArrays,t=this.gl.drawElements;this.gl.drawArrays=(t,n,o)=>{if(this.isPanelOpen)switch(this.metrics.drawCalls++,t){case this.gl.TRIANGLES:this.metrics.triangleCount+=o/3;break;case this.gl.TRIANGLE_STRIP:case this.gl.TRIANGLE_FAN:o>=3&&(this.metrics.triangleCount+=o-2)}return e.call(this.gl,t,n,o)},this.gl.drawElements=(e,n,o,i)=>{if(this.isPanelOpen)switch(this.metrics.drawCalls++,e){case this.gl.TRIANGLES:this.metrics.triangleCount+=n/3;break;case this.gl.TRIANGLE_STRIP:case this.gl.TRIANGLE_FAN:n>=3&&(this.metrics.triangleCount+=n-2)}return t.call(this.gl,e,n,o,i)}}getMetrics(){return this.metrics}setPosition(e){this.container&&(this.options.overlayPosition=e,this.updateContainerPosition())}destroy(){this.stop(),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.gl&&this.options.showDrawCalls&&(this._originalDrawArrays&&(this.gl.drawArrays=this._originalDrawArrays),this._originalDrawElements&&(this.gl.drawElements=this._originalDrawElements))}}!function(){const t=e=>document.getElementById(e),n=t("app"),o=t("editors"),i=t("vertPanel"),a=t("fragPanel"),r=t("rowDivider"),s=t("divider"),l=t("preview-panel"),d=t("glcanvas"),u=t("vertCode"),m=t("fragCode"),p=t("vertFile"),g=t("fragFile"),v=t("fsBtn"),f=(t("lint"),new AudioReactive);let y,w=[],b=null,E=!1,x=0,C={x:0,y:0,clickX:0,clickY:0,isPressed:!1,lastClickTime:0};if(y=d.getContext("webgl2"),y||(console.warn("WebGL2 not available, falling back to WebGL1."),y=d.getContext("webgl")),y?console.log(`${y.getParameter(y.VERSION)} context`):alert("WebGL is not supported in your browser."),!y)return void alert("WebGL not supported");let S=null,L=null,k={},T=performance.now(),I={type:null,startPos:0,startSize:0},B=!0;pauseOnBlurEnabled=!0;const A=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),M=y.createBuffer();new e(d,{sampleSize:120,showFPS:!0,showMemory:!0,showGPUInfo:!0,showDrawCalls:!0,overlayPosition:"top-left"});y.bindBuffer(y.ARRAY_BUFFER,M),y.bufferData(y.ARRAY_BUFFER,A,y.STATIC_DRAW),y.enable(y.BLEND),y.blendFunc(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA),y.clearColor(0,0,0,1),y.clear(y.COLOR_BUFFER_BIT);const P=(e,t=!1,n)=>{if(I.type)return;const o=((e,t=!1)=>{const n=d.getBoundingClientRect(),o=t?e.touches[0]||e.changedTouches[0]:e;return{x:o.clientX-n.left,y:n.height-(o.clientY-n.top)}})(e,t);"move"===n?(C.x=o.x,C.y=o.y):"down"===n?(C.isPressed=!0,C.clickX=o.x,C.clickY=o.y,C.lastClickTime=performance.now()):"up"===n&&(C.isPressed=!1),t&&e.preventDefault()};d.addEventListener("mousemove",(e=>P(e,!1,"move"))),d.addEventListener("mousedown",(e=>P(e,!1,"down"))),d.addEventListener("mouseup",(e=>P(e,!1,"up"))),d.addEventListener("mouseleave",(()=>{C.isPressed=!1})),d.addEventListener("touchmove",(e=>P(e,!0,"move")),{passive:!1}),d.addEventListener("touchstart",(e=>P(e,!0,"down")),{passive:!1}),d.addEventListener("touchend",(e=>P(e,!0,"up")),{passive:!1});const R=()=>{const e=document.hidden||!document.hasFocus();pauseOnBlurEnabled&&(e?_():F())},_=()=>{b&&!E&&(cancelAnimationFrame(b),b=null,E=!0,x=performance.now())},F=()=>{E&&(T+=performance.now()-x,E=!1,O())};function $(){if(B){const e=o.clientHeight-r.offsetHeight;i.style.height=a.style.height=e/2+"px"}D()}function D(){const e=l.clientWidth,t=l.clientHeight;d.width===e&&d.height===t||(d.width=e,d.height=t,y.viewport(0,0,e,t))}function N(){B=!B,B?(o.style.display="block",s.style.display="block",v.textContent="",v.title="Hide Editors",n.style.gridTemplateColumns="1fr auto 1fr"):(o.style.display="none",s.style.display="none",v.textContent="",v.title="Show Editors (2 quick clicks for fullscreen)",n.style.gridTemplateColumns="1fr auto 1fr"),setTimeout(D,10)}function U(e,t){const n=y.createShader(t);if(y.shaderSource(n,e),y.compileShader(n),!y.getShaderParameter(n,y.COMPILE_STATUS)){const e=y.getShaderInfoLog(n);return y.deleteShader(n),{shader:null,error:e}}return{shader:n,error:null}}function q(){if(window.jsCanvasState&&window.jsCanvasState.isJSMode())return;D();const e=document.getElementById("lint"),t=document.getElementById("lintContent"),n=document.getElementById("copyErrorsBtn"),o=document.getElementById("closeLintBtn"),i=i=>{t.textContent=i,n.style.display="block",o.style.display="block",e.style.display="block"};t.textContent="",n.style.display="none",o.style.display="none",e.style.display="none",S&&y.deleteProgram(S);const a=[],r=U(u.value,y.VERTEX_SHADER),s=U(m.value,y.FRAGMENT_SHADER);if(r.error&&a.push("Vertex: "+r.error),s.error&&a.push("Fragment: "+s.error),a.length)return void i(a.join("\n"));const l=y.createProgram();if(y.attachShader(l,r.shader),y.attachShader(l,s.shader),y.linkProgram(l),!y.getProgramParameter(l,y.LINK_STATUS))return i("Link: "+y.getProgramInfoLog(l)),void y.deleteProgram(l);S=l,f.setGLContext(y,S),y.useProgram(S);const c=["a_position","position","aPosition","a_pos"];L=-1;for(const e of c)if(L=y.getAttribLocation(S,e),-1!==L)break;if(-1!==L)y.enableVertexAttribArray(L),y.vertexAttribPointer(L,2,y.FLOAT,!1,0,0);else{console.warn("No position attribute found in shader. Available attributes:");const e=y.getProgramParameter(S,y.ACTIVE_ATTRIBUTES);for(let t=0;t<e;t++){const e=y.getActiveAttrib(S,t);console.warn(`  ${e.name} (location: ${y.getAttribLocation(S,e.name)})`)}}k={};const d=y.getProgramParameter(S,y.ACTIVE_UNIFORMS);for(let e=0;e<d;e++){const t=y.getActiveUniform(S,e),n=y.getUniformLocation(S,t.name);k[t.name]={loc:n,type:t.type}}Object.keys(k).forEach((e=>{if(e.startsWith("u_")||e.startsWith("u")&&e[1]==e[1].toUpperCase())return;const t="u_"+e;t in k||(k[t]=k[e]);const n="u"+e[0].toUpperCase()+e.slice(1);n in k||(k[n]=k[e])}))}function O(){if(!S||E)return;D(),y.useProgram(S);const e=.001*(performance.now()-T),t=(e,t)=>{for(const n of e)if(k[n]){t(k[n].loc);break}};t(["u_time","uTime","iTime"],(t=>y.uniform1f(t,e))),t(["u_resolution","uResolution","iResolution"],(e=>y.uniform2f(e,d.width,d.height))),t(["u_mouse","uMouse","iMouse"],(e=>y.uniform2f(e,C.x/d.width,C.y/d.height))),t(["u_mouse_pixel","uMousePixel","iMousePixel"],(e=>y.uniform2f(e,C.x,C.y))),t(["u_mouse_click","uMouseClick","iMouseClick"],(e=>y.uniform2f(e,C.clickX/d.width,C.clickY/d.height))),t(["u_mouse_click_pixel","uMouseClickPixel","iMouseClickPixel"],(e=>y.uniform2f(e,C.clickX,C.clickY))),t(["u_mouse_pressed","uMousePressed","iMousePressed"],(e=>y.uniform1i(e,C.isPressed?1:0))),t(["u_mouse_click_time","uMouseClickTime","iMouseClickTime"],(e=>y.uniform1f(e,.001*(performance.now()-C.lastClickTime)))),k.uColor&&y.uniform3f(k.uColor.loc,1,1,1),f.update(),y.drawArrays(y.TRIANGLES,0,6),b=requestAnimationFrame(O)}document.addEventListener("visibilitychange",R),window.addEventListener("focus",R),window.addEventListener("blur",(()=>pauseOnBlurEnabled&&_())),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"p"===e.key.toLowerCase())return e.preventDefault(),pauseOnBlurEnabled=!pauseOnBlurEnabled,void showToast("Window Focus "+(pauseOnBlurEnabled?"enabled":"disabled"));if(e.ctrlKey&&"f"===e.key.toLowerCase()){e.preventDefault();const t=performance.now();if(w.push(t),w.length>2&&w.shift(),2===w.length&&t-w[0]<600){w=[];const e=n,t=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen,o=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,i=document.fullscreenElement?o:t,a=document.fullscreenElement?document:e;i.call(a)}else N()}})),document.getElementById("copyErrorsBtn").addEventListener("click",(function(){const e=this,t=document.getElementById("lintContent").textContent;navigator.clipboard.writeText(t).then((()=>{const t=e.textContent;e.textContent="Copied!",setTimeout((()=>{e.textContent=t}),1e3)})).catch((e=>{console.error("Failed to copy: ",e)}))})),document.getElementById("closeLintBtn").addEventListener("click",(function(){const e=document.getElementById("lint"),t=document.getElementById("copyErrorsBtn"),n=document.getElementById("closeLintBtn");e.style.display="none",t.style.display="none",n.style.display="none"})),window.addEventListener("load",(()=>{$(),h()})),window.addEventListener("resize",$),["mousedown","touchstart"].forEach((e=>{r.addEventListener(e,(e=>{I.type="row",I.startPos=e.clientY||e.touches[0].clientY,I.startSize=i.getBoundingClientRect().height,e.preventDefault()}),{passive:!1}),s.addEventListener(e,(e=>{I.type="col",I.startPos=e.clientX||e.touches[0].clientX,I.startSize=o.getBoundingClientRect().width,e.preventDefault()}),{passive:!1})})),["mousemove","touchmove"].forEach((e=>{document.addEventListener(e,(t=>{if(!I.type)return;const s=e.includes("touch")?t.touches[0]["row"===I.type?"clientY":"clientX"]:t["row"===I.type?"clientY":"clientX"];if("row"===I.type){const e=s-I.startPos,t=o.clientHeight-r.offsetHeight;let n=Math.max(50,Math.min(t-50,I.startSize+e));i.style.height=n+"px",a.style.height=t-n+"px"}else{const e=Math.max(100,Math.min(n.clientWidth-100,I.startSize+s-I.startPos));o.style.width=e+"px"}D(),t.preventDefault()}))})),["mouseup","touchend","touchcancel"].forEach((e=>{document.addEventListener(e,(()=>I.type=null))})),[u,m].forEach((e=>e.addEventListener("input",q))),p.addEventListener("change",(()=>c(p,u))),g.addEventListener("change",(()=>c(g,m))),v.onclick=e=>{const t=performance.now();if(w.push(t),w.length>2&&w.shift(),2===w.length&&t-w[0]<600){w=[];const e=n,t=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen,o=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,i=document.fullscreenElement?o:t,a=document.fullscreenElement?document:e;i.call(a)}else N()},q(),O(),window.rebuildProgram=q,window.$=e=>document.getElementById(e),window.render=O,window.editorsVisible=!0,window.pauseAnimation=_,window.resumeAnimation=F}();$("app");const t=$("preview-panel"),n=$("vertCode"),o=$("fragCode"),i=$("vertFileBtn"),a=$("fragFileBtn"),r=$("vertFileName"),s=$("fragFileName");function l(e,t){const n=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=`shader.${e}`,i.click(),URL.revokeObjectURL(o)}function c(e,t){if(!e.files.length)return;const n=new FileReader;n.onload=e=>{t.value=e.target.result,rebuildProgram()},n.readAsText(e.files[0])}function d(e,t,n){const o=e.name.slice(e.name.lastIndexOf(".")).toLowerCase();if(![".txt",".vert",".vs",".frag",".fs",".wgsl"].includes(o))return;const i=new FileReader;i.onload=e=>{t.value=e.target.result,rebuildProgram()},i.readAsText(e),n.textContent=e.name}function u(){const e=n?.value||"",t=o?.value||"";if(!e.trim()&&!t.trim())return void alert("No shader code to export!");window.webgpuState&&window.webgpuState.isWebGPUMode()?function(e,t){function n(e){return e.replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$\{/g,"\\${").replace(/\r\n/g,"\\n").replace(/\r/g,"\\n").replace(/\n/g,"\\n")}const o=`<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<title>WebGPU Shader Animation</title>\n<style>\nbody { margin: 0; overflow: hidden; background: #000; }\ncanvas { width: 100vw; height: 100vh; display: block; }\n#error { \n    position: absolute; \n    top: 50%; \n    left: 50%; \n    transform: translate(-50%, -50%); \n    color: white; \n    font-family: Arial, sans-serif; \n    text-align: center; \n}\n</style>\n</head>\n<body>\n<canvas id="webgpu-canvas"></canvas>\n<div id="error" style="display: none;">\n    <h2>WebGPU Not Supported</h2>\n    <p>This animation requires WebGPU support.<br>\n    Please use a modern browser with WebGPU enabled.</p>\n</div>\n<script>\n(async function(){\n    const canvas = document.getElementById('webgpu-canvas');\n    const errorDiv = document.getElementById('error');\n    if (!navigator.gpu) {\n        errorDiv.style.display = 'block';\n        return;\n    }\n    const vertexShader = \`${n(e)}\`;\n    const fragmentShader = \`${n(t)}\`;\n    let device, context, pipeline, bindGroup, uniformBuffer, vertexBuffer;\n    let startTime = performance.now();\n    let frameCount = 0;\n    let lastFrameTime = 0;\n    let deltaTime = 0;\n    let fps = 60;\n    const UNIFORM_BUFFER_SIZE = 80;\n    const mouse = {\n        x: 0,\n        y: 0,\n        clickX: 0,\n        clickY: 0,\n        isPressed: false\n    };\n    try {\n        const adapter = await navigator.gpu.requestAdapter({\n            powerPreference: 'high-performance'\n        });\n        if (!adapter) {\n            throw new Error('No WebGPU adapter found');\n        }\n        device = await adapter.requestDevice();\n        context = canvas.getContext('webgpu');\n        if (!context) {\n            throw new Error('Could not get WebGPU context');\n        }\n        const canvasFormat = navigator.gpu.getPreferredCanvasFormat();\n        context.configure({\n            device: device,\n            format: canvasFormat,\n            alphaMode: 'premultiplied',\n        });\n        uniformBuffer = device.createBuffer({\n            size: UNIFORM_BUFFER_SIZE,\n            usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\n        });\n        const vertices = new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]);\n        vertexBuffer = device.createBuffer({\n            size: vertices.byteLength,\n            usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\n        });\n        device.queue.writeBuffer(vertexBuffer, 0, vertices);\n        const bindGroupLayout = device.createBindGroupLayout({\n            entries: [{\n                binding: 0,\n                visibility: GPUShaderStage.FRAGMENT,\n                buffer: { type: 'uniform' }\n            }]\n        });\n        const pipelineLayout = device.createPipelineLayout({\n            bindGroupLayouts: [bindGroupLayout]\n        });\n        pipeline = device.createRenderPipeline({\n            layout: pipelineLayout,\n            vertex: {\n                module: device.createShaderModule({ code: vertexShader }),\n                entryPoint: 'vs_main',\n                buffers: [{\n                    arrayStride: 8,\n                    attributes: [{\n                        format: 'float32x2',\n                        offset: 0,\n                        shaderLocation: 0\n                    }]\n                }]\n            },\n            fragment: {\n                module: device.createShaderModule({ code: fragmentShader }),\n                entryPoint: 'fs_main',\n                targets: [{ format: canvasFormat }]\n            },\n            primitive: { topology: 'triangle-list' }\n        });\n        bindGroup = device.createBindGroup({\n            layout: bindGroupLayout,\n            entries: [{\n                binding: 0,\n                resource: { buffer: uniformBuffer }\n            }]\n        });\n        const getMousePos = (e, isTouch = false) => {\n            const rect = canvas.getBoundingClientRect();\n            const point = isTouch ? (e.touches[0] || e.changedTouches[0]) : e;\n            return {\n                x: point.clientX - rect.left,\n                y: rect.height - (point.clientY - rect.top),\n            };\n        };\n        const updateMouse = (e, isTouch = false, type) => {\n            const pos = getMousePos(e, isTouch);\n            if (type === 'move') {\n                mouse.x = pos.x;\n                mouse.y = pos.y;\n            } else if (type === 'down') {\n                mouse.isPressed = true;\n                mouse.clickX = pos.x;\n                mouse.clickY = pos.y;\n            } else if (type === 'up') {\n                mouse.isPressed = false;\n            }\n            if (isTouch) e.preventDefault();\n        };\n        canvas.addEventListener('mousemove', e => updateMouse(e, false, 'move'));\n        canvas.addEventListener('mousedown', e => updateMouse(e, false, 'down'));\n        canvas.addEventListener('mouseup', e => updateMouse(e, false, 'up'));\n        canvas.addEventListener('mouseleave', () => { mouse.isPressed = false; });\n        canvas.addEventListener('touchmove', e => updateMouse(e, true, 'move'), { passive: false });\n        canvas.addEventListener('touchstart', e => updateMouse(e, true, 'down'), { passive: false });\n        canvas.addEventListener('touchend', e => updateMouse(e, true, 'up'), { passive: false });\n        const resize = () => {\n            const w = canvas.clientWidth;\n            const h = canvas.clientHeight;\n            if (canvas.width !== w || canvas.height !== h) {\n                canvas.width = w;\n                canvas.height = h;\n            }\n        };\n        window.addEventListener('resize', resize);\n        resize();\n        function render() {\n            const currentTime = performance.now();\n            deltaTime = (currentTime - lastFrameTime) / 1000.0;\n            lastFrameTime = currentTime;\n            frameCount++;\n            if (frameCount % 10 === 0) {\n                fps = fps * 0.9 + (1.0 / deltaTime) * 0.1;\n            }\n            const time = (currentTime - startTime) * 0.001;\n            const uniformData = new Float32Array(20);\n            let offset = 0;\n            uniformData[offset++] = canvas.width;\n            uniformData[offset++] = canvas.height;\n            uniformData[offset++] = time;\n            uniformData[offset++] = deltaTime;\n            uniformData[offset++] = mouse.x;\n            uniformData[offset++] = mouse.y;\n            uniformData[offset++] = mouse.clickX || 0;\n            uniformData[offset++] = mouse.clickY || 0;\n            uniformData[offset++] = mouse.isPressed ? 1.0 : 0.0;\n            uniformData[offset++] = frameCount;\n            uniformData[offset++] = fps;\n            uniformData[offset++] = canvas.width / canvas.height;\n            uniformData[offset++] = 1.0 / canvas.width;\n            uniformData[offset++] = 1.0 / canvas.height;\n            uniformData[offset++] = 0.0;\n            uniformData[offset++] = 0.0;\n            uniformData[offset++] = 0.0;\n            uniformData[offset++] = 0.0;\n            uniformData[offset++] = 0.0;\n            uniformData[offset++] = 0.0;\n            device.queue.writeBuffer(uniformBuffer, 0, uniformData);\n            const commandEncoder = device.createCommandEncoder();\n            const renderPass = commandEncoder.beginRenderPass({\n                colorAttachments: [{\n                    view: context.getCurrentTexture().createView(),\n                    clearValue: { r: 0, g: 0, b: 0, a: 1 },\n                    loadOp: 'clear',\n                    storeOp: 'store',\n                }]\n            });\n            renderPass.setPipeline(pipeline);\n            renderPass.setBindGroup(0, bindGroup);\n            renderPass.setVertexBuffer(0, vertexBuffer);\n            renderPass.draw(6);\n            renderPass.end();\n            device.queue.submit([commandEncoder.finish()]);\n            requestAnimationFrame(render);\n        }\n        render();\n    } catch (error) {\n        console.error('WebGPU initialization failed:', error);\n        errorDiv.style.display = 'block';\n        errorDiv.innerHTML = \`\n            <h2>WebGPU Error</h2>\n            <p>Failed to initialize WebGPU:<br>\${error.message}</p>\n            <p>Please check the console for more details.</p>\n        \`;\n    }\n})();\n<\/script>\n</body>\n</html>`;m(o,"webgpu-shader.html","text/html")}(e,t):function(e,t){function n(e){return e.replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$\{/g,"\\${").replace(/\r\n/g,"\\n").replace(/\r/g,"\\n").replace(/\n/g,"\\n")}const o=`<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<title>WebGL Shader Animation</title>\n<style>\nbody { margin: 0; overflow: hidden; }\ncanvas { width: 100vw; height: 100vh; display: block; }\n</style>\n</head>\n<body>\n<canvas id="glcanvas"></canvas>\n<script>\n(function(){\n    const canvas = document.getElementById('glcanvas');\n    const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');\n    if (!gl) { alert('WebGL not supported'); return; }\n    const isWebGL2 = gl instanceof WebGL2RenderingContext;\n    const vertexShader = \`${n(e)}\`;\n    const fragmentShader = \`${n(t)}\`;\n    function compileShader(src, type) {\n        const s = gl.createShader(type);\n        gl.shaderSource(s, src);\n        gl.compileShader(s);\n        if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {\n            console.error('Shader compilation error:', gl.getShaderInfoLog(s));\n            return null;\n        }\n        return s;\n    }\n    const vs = compileShader(vertexShader, gl.VERTEX_SHADER);\n    const fs = compileShader(fragmentShader, gl.FRAGMENT_SHADER);\n    if (!vs || !fs) {\n        console.error('Failed to compile shaders');\n        return;\n    }\n    const program = gl.createProgram();\n    gl.attachShader(program, vs);\n    gl.attachShader(program, fs);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n        console.error('Program linking error:', gl.getProgramInfoLog(program));\n        return;\n    }\n    const quadVerts = new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]);\n    const buf = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buf);\n    gl.bufferData(gl.ARRAY_BUFFER, quadVerts, gl.STATIC_DRAW);\n    let attribName = 'a_position';\n    const attribRegex = /(attribute|in)\\s+(?:vec\\d+|float|int)\\s+(\\w+)/g;\n    const matches = [...vertexShader.matchAll(attribRegex)];\n    if (matches.length > 0) {\n        attribName = matches[0][2];\n    }\n    const attribLoc = gl.getAttribLocation(program, attribName);\n    if (attribLoc !== -1) {\n        gl.enableVertexAttribArray(attribLoc);\n        gl.vertexAttribPointer(attribLoc, 2, gl.FLOAT, false, 0, 0);\n    } else {\n        console.warn('Could not find attribute:', attribName);\n        const fallbacks = ['a_position', 'position', 'a_vertex', 'vertex'];\n        let found = false;\n        for (const fallback of fallbacks) {\n            const loc = gl.getAttribLocation(program, fallback);\n            if (loc !== -1) {\n                gl.enableVertexAttribArray(loc);\n                gl.vertexAttribPointer(loc, 2, gl.FLOAT, false, 0, 0);\n                found = true;\n                break;\n            }\n        }\n        if (!found) {\n            console.error('No valid vertex attribute found');\n            return;\n        }\n    }\n    const uniforms = {};\n    const numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n    for (let i = 0; i < numUniforms; i++) {\n        const info = gl.getActiveUniform(program, i);\n        uniforms[info.name] = gl.getUniformLocation(program, info.name);\n    }\n    const startTime = performance.now();\n    function resize() {\n        const w = canvas.clientWidth, h = canvas.clientHeight;\n        if (canvas.width !== w || canvas.height !== h) {\n            canvas.width = w;\n            canvas.height = h;\n            gl.viewport(0, 0, w, h);\n        }\n    }\n    const mouse = {\n        x: 0,\n        y: 0,\n        clickX: 0,\n        clickY: 0,\n        lastClickTime: 0,\n        isPressed: false\n    };\n    canvas.addEventListener('mousemove', e => {\n        const rect = canvas.getBoundingClientRect();\n        mouse.x = e.clientX - rect.left;\n        mouse.y = rect.height - (e.clientY - rect.top);\n    });\n    canvas.addEventListener('mousedown', e => {\n        const rect = canvas.getBoundingClientRect();\n        mouse.clickX = e.clientX - rect.left;\n        mouse.clickY = rect.height - (e.clientY - rect.top);\n        mouse.lastClickTime = performance.now() * 0.001;\n        mouse.isPressed = true;\n    });\n    canvas.addEventListener('mouseup', () => {\n        mouse.isPressed = false;\n    });\n    canvas.addEventListener('mouseleave', () => {\n        mouse.isPressed = false;\n    });\n    const mouseUniforms = ['mouse', 'u_mouse', 'uMouse', 'iMouse'];\n    const mouseDownUniforms = ['u_mouseDown', 'uMouseDown'];\n    const mouseClickUniforms = ['u_mouseClick', 'uMouseClick'];\n    const mouseTimeUniforms = ['u_mouseTime', 'uMouseTime'];\n    function render() {\n        resize();\n        gl.useProgram(program);\n        const time = (performance.now() - startTime) * 0.001;\n        const setUniform = (names, fn, ...args) => {\n            for (const name of names) {\n                if (uniforms[name]) {\n                    fn(uniforms[name], ...args);\n                    break;\n                }\n            }\n        };\n        setUniform(['time', 'u_time', 'uTime', 'iTime'], gl.uniform1f.bind(gl), time);\n        setUniform(['resolution', 'u_resolution', 'uResolution', 'iResolution'], gl.uniform2f.bind(gl), canvas.width, canvas.height);\n        setUniform(['uColor', 'u_color', 'color'], gl.uniform3f.bind(gl), 1.0, 1.0, 1.0);\n        setUniform(['mouse', 'u_mouse', 'uMouse', 'iMouse'], gl.uniform2f.bind(gl),mouse.x / canvas.width, mouse.y / canvas.height);\n        setUniform(['u_mouse_pixel', 'uMousePixel'], gl.uniform2f.bind(gl), mouse.x, mouse.y);\n        setUniform(['u_mouse_click', 'uMouseClick'], gl.uniform2f.bind(gl),mouse.clickX / canvas.width, mouse.clickY / canvas.height);\n        setUniform(['u_mouse_click_pixel', 'uMouseClickPixel'], gl.uniform2f.bind(gl),mouse.clickX, mouse.clickY);\n        setUniform(mouseDownUniforms, gl.uniform1i.bind(gl), mouse.isPressed ? 1 : 0);\n        setUniform(mouseTimeUniforms, gl.uniform1f.bind(gl),(performance.now() - mouse.lastClickTime) * 0.001);\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n        requestAnimationFrame(render);\n    }\n    render();\n})();\n<\/script>\n</body>\n</html>`;m(o,"webgl-shader.html","text/html")}(e,t)}function m(e,t,n){try{const o=new Blob([e],{type:n}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download=t,a.click(),URL.revokeObjectURL(i)}catch(e){console.error("Export failed:",e),alert("Failed to export file: "+e.message)}}function h(){const e=document.createElement("button");e.textContent="Export",e.title="Export Vertex Shader",e.onclick=()=>{l(window.webgpuState&&window.webgpuState.isWebGPUMode()?"wgsl":"vert",n.value)},vertPanel.querySelector(".panel-header").appendChild(e);const i=document.createElement("button");i.textContent="Export",i.title="Export Fragment Shader",i.onclick=()=>{l(window.webgpuState&&window.webgpuState.isWebGPUMode()?"wgsl":"frag",o.value)},fragPanel.querySelector(".panel-header").appendChild(i);const a=document.createElement("button");a.textContent="Export",a.title="Export Full HTML",a.style.position="absolute",a.classList.add("expbtn"),a.onclick=u,t.appendChild(a)}i.onclick=()=>vertFile.click(),a.onclick=()=>fragFile.click(),vertFile.addEventListener("change",(()=>{r.textContent=vertFile.files.length?vertFile.files[0].name:"",c(vertFile,n)})),fragFile.addEventListener("change",(()=>{s.textContent=fragFile.files.length?fragFile.files[0].name:"",c(fragFile,o)})),["dragover","dragenter"].forEach((e=>{n.addEventListener(e,(e=>e.preventDefault())),o.addEventListener(e,(e=>e.preventDefault()))})),n.addEventListener("drop",(e=>{e.preventDefault(),e.dataTransfer.files.length&&d(e.dataTransfer.files[0],n,r)})),o.addEventListener("drop",(e=>{e.preventDefault(),e.dataTransfer.files.length&&d(e.dataTransfer.files[0],o,s)})),(()=>{function e(){if(window.jsCanvasState&&window.jsCanvasState.isJSMode())return window.jsCanvasState.getCanvas();const e=document.getElementById("canvas3D");return e&&"none"!==e.style.display?e:window.webgpuState&&window.webgpuState.isWebGPUMode()?window.webgpuState.getCanvas():document.getElementById("glcanvas")}const t=e(),n=document.getElementById("preview-panel");if(!t||!n)return;let o=null;window.webgpuState&&window.webgpuState.isWebGPUMode()||(o=t.getContext("webgl",{preserveDrawingBuffer:!0})||t.getContext("experimental-webgl",{preserveDrawingBuffer:!0}));const i=document.createElement("div");i.id="recordingIndicator",i.textContent=" RECORDING",n.appendChild(i);const a=document.createElement("button");a.id="recBtn",a.title="Record Settings",a.innerHTML='<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45"/></svg>',n.appendChild(a);const r=document.createElement("div");r.id="videoPreview",r.innerHTML='\n    <video id="previewVideo" controls></video>\n    <div class="controls">\n      <button class="download-btn" id="downloadFromPreview">Download</button>\n      <button class="delete-btn" id="deleteVideo">Delete</button>\n    </div>\n    <div class="info" id="videoInfo"></div>\n  ';const s=navigator.userAgent,l=/^((?!chrome|android).)*safari/i.test(s),c=/iPad|iPhone|iPod/.test(s)&&!window.MSStream,d=/firefox/i.test(s),u=document.createElement("div");u.id="recSettings",u.innerHTML=`\n    <label>Width: <input type="number" id="recWidth" value="1920" min="100"/></label>\n    <label>Height: <input type="number" id="recHeight" value="1080" min="100"/></label>\n    <label>FPS: \n      <select id="recFPS">\n        <option value="30">30</option>\n        <option value="60" selected>60</option>\n        <option value="120">120</option>\n      </select>\n    </label>\n    <label>Quality:\n      <input type="range" id="recQuality" min="1000" max="50000" step="1000" value="20000"/>\n      <span id="recQualityVal">20000</span> kbps\n    </label>\n    <label>Codec: \n      <select id="recCodec">\n        ${d?'\n          <option value="h264" disabled>H.264 (Not supported in Firefox)</option>\n          <option value="vp9" disabled>VP9 (Not supported in Firefox)</option>\n          <option value="vp8" selected>VP8 (WebM)</option>\n        ':l||c?'\n          <option value="h264" selected>H.264 (MP4)</option>\n          <option value="vp9" disabled>VP9 (Not supported in Safari)</option>\n          <option value="vp8" disabled>VP8 (Not supported in Safari)</option>\n        ':'\n          <option value="h264" selected>H.264 (MP4)</option>\n          <option value="vp9">VP9 (WebM)</option>\n          <option value="vp8">VP8 (WebM)</option>\n        '}\n      </select>\n    </label>\n    <label style="display: flex; align-items: center;">\n      Include Audio\n      <div class="checkbox-container">\n        <input type="checkbox" id="includeAudio" checked/>\n        <div class="custom-checkbox"></div>\n      </div>\n    </label>\n    <div id="statusBlock" class="status-block">\n      <div id="canvasMode" class="canvas-mode">Canvas: WebGL</div>\n      <div id="audioStatus" class="audio-status">Audio: Not detected</div>\n    </div>\n    <button id="recRotate" title="Rotate dimensions"> Rotate</button>\n    <div id="recPresets">\n      <button class="preset active" data-w="1920" data-h="1080">1080p</button>\n      <button class="preset" data-w="2560" data-h="1440">1440p</button>\n      <button class="preset" data-w="3840" data-h="2160">4K</button>\n      <button class="preset" data-w="1280" data-h="720">720p</button>\n    </div>\n    <button class="start" id="startRec">Start Recording</button>\n    <button class="stop" id="stopRec" disabled>Stop</button>\n    <a id="downloadLink" style="border:0px;border-radius:6px;background:var(--m);display:none;text-decoration:none; color:var(--1);">Download</a>\n    <div id="recStats" style="margin-top: 8px; display: none;"></div>\n  `,n.appendChild(u),u.appendChild(r),document.addEventListener("keydown",(e=>{if("Escape"===e.key){const e=document.getElementById("recSettings");e&&(e.style.display="none")}}));const m=u.querySelector("#recWidth"),h=u.querySelector("#recHeight"),p=u.querySelector("#recFPS"),g=u.querySelector("#recQuality"),v=u.querySelector("#recQualityVal"),f=u.querySelector("#recCodec"),y=u.querySelector("#recRotate"),w=u.querySelector("#includeAudio"),b=u.querySelector("#audioStatus"),E=u.querySelector("#canvasMode"),x=u.querySelectorAll(".preset"),C=u.querySelector("#startRec"),S=u.querySelector("#stopRec"),L=u.querySelector("#downloadLink"),k=u.querySelector("#recStats"),T=r.querySelector("#previewVideo"),I=r.querySelector("#downloadFromPreview"),B=r.querySelector("#deleteVideo"),A=r.querySelector("#videoInfo");let M,P,R,_,F,$=[],D=!1,N=null,U=null,q=null;function O(){if(D){if(window.AudioReactive&&window.audioReactiveInstance){const e=window.audioReactiveInstance;e.isActive?e.fileActive?b.textContent="Audio: File audio active":e.micStream?b.textContent="Audio: Microphone active":b.textContent="Audio: Active but no source":b.textContent="Audio: Inactive"}else b.textContent="Audio: AudioReactive not found";window.jsCanvasState&&window.jsCanvasState.isJSMode()?E.textContent="Canvas: JavaScript 2D":window.webgpuState&&window.webgpuState.isWebGPUMode()?E.textContent="Canvas: WebGPU":E.textContent="Canvas: WebGL"}}function H(){C.disabled=!(+m.value>0&&+h.value>0)}setInterval(O,1e3),g.addEventListener("input",(()=>{v.textContent=g.value})),y.addEventListener("click",(()=>{[m.value,h.value]=[h.value,m.value],H()})),x.forEach((e=>{e.addEventListener("click",(()=>{x.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),m.value=e.dataset.w,h.value=e.dataset.h,H()}))})),[m,h].forEach((e=>{e.addEventListener("input",H)})),H(),a.addEventListener("click",(()=>{D=!D,u.style.display=D?"block":"none",D&&O()})),I.addEventListener("click",(()=>{if(N&&q){const e=document.createElement("a");e.href=U,e.download=`recording_${q.width}x${q.height}_${q.codec}.${q.extension}`,e.click()}})),B.addEventListener("click",(()=>{U&&URL.revokeObjectURL(U),N=null,U=null,q=null,r.style.display="none",T.src="",L.style.display="none",k.style.display="none"}));const G=(e,t)=>{const n={vp8:["video/webm; codecs=vp8","video/webm;codecs=vp8",'video/webm; codecs="vp8"','video/webm;codecs="vp8"'],vp9:["video/webm; codecs=vp9","video/webm;codecs=vp9",'video/webm; codecs="vp9"','video/webm;codecs="vp9"'],h264:["video/mp4; codecs=avc1.42E01E","video/mp4;codecs=avc1.42E01E",'video/mp4; codecs="avc1.42E01E"','video/mp4;codecs="avc1.42E01E"',"video/webm; codecs=h264","video/webm;codecs=h264","video/mp4"]},o=navigator.userAgent,i=/iPad|iPhone|iPod/.test(o)&&!window.MSStream,a=/^((?!chrome|android).)*safari/i.test(o),r=i&&a&&{h264:['video/mp4; codecs="avc1.42E01E"',"video/mp4; codecs=avc1.42E01E","video/mp4"]}[e]||n[e];if(!r)return null;if(i&&a&&t){for(const e of r)if(MediaRecorder.isTypeSupported(e))return e;const e=["mp4a.40.2","aac"];for(const t of e)for(const e of r)if(e.includes("codecs=")){const n=e.replace(/codecs="?([^"]+)"?/,`codecs="$1,${t}"`);if(MediaRecorder.isTypeSupported(n))return n}return null}return(t?[",opus",", opus"]:[""]).flatMap((e=>r.map((t=>t.endsWith('"')?t.replace(/"$/,`${e}"`):t+e)))).find((e=>MediaRecorder.isTypeSupported(e)))||null};C.addEventListener("click",(()=>{L.style.display=k.style.display="none",k.textContent="";const t=+m.value,n=+h.value,o=+p.value,a=e();if(!a)return void alert("Canvas not found. Make sure the visualization is running.");P=Object.assign(document.createElement("canvas"),{width:t,height:n}),R=P.getContext("2d",{alpha:!1});const s=P.captureStream(o);let l=w.checked&&function(){if(window.AudioReactive&&window.audioReactiveInstance){const e=window.audioReactiveInstance;if(e.isActive&&e.audioContext)try{const t=e.audioContext.createMediaStreamDestination();if(e.fileActive&&e.fileSource)return e.fileSource.connect(t),b.textContent="Audio: File audio detected",t.stream;if(e.micStream&&e.analyser)return e.audioContext.createMediaStreamSource(e.micStream).connect(t),b.textContent="Audio: Microphone detected",t.stream}catch(e){console.warn("Error capturing audio stream:",e),b.textContent="Audio: Error capturing audio"}}return b.textContent="Audio: Not detected",null}();const c=navigator.userAgent,d=/iPad|iPhone|iPod/.test(c)&&!window.MSStream,u=/^((?!chrome|android).)*safari/i.test(c);l&&!l.getAudioTracks().length&&(l=null),d&&u&&w.checked&&!l&&(console.warn("Audio not available on iOS Safari, continuing with video-only recording"),b.textContent="Audio: Not available on iOS");const v=l?new MediaStream([...s.getVideoTracks(),...l.getAudioTracks()]):s,y=1e3*g.value,E=f.value;let x=G(E,!!l);if(!x&&d&&u&&(console.log("Trying iOS fallback codecs..."),x=G("h264",!1),x&&(f.value="h264",l&&(console.warn("iOS Safari: Falling back to video-only recording"),v.getAudioTracks().forEach((e=>{v.removeTrack(e),e.stop()})),l=null))),x||(x=["h264","vp9","vp8"].reduce(((e,t)=>e||G(t,!!l)&&(f.value=t,G(t,!!l))),null)),!x&&(l&&(console.log("Trying video-only as final fallback..."),v.getAudioTracks().forEach((e=>{v.removeTrack(e),e.stop()})),x=G(E,!1)||G("h264",!1),x&&alert("Audio recording not supported on this device. Recording video only.")),!x))return alert("No supported codecs found for video recording on this device.");if(x&&x!==G(E,!!l)){const e=v.getAudioTracks().length>0;alert(`Using ${f.value} codec${e?" with audio":" (video only)"}.`)}!function(e,t,n,o,a,s,l){const c={mimeType:t,videoBitsPerSecond:n};e.getAudioTracks().length>0&&(c.audioBitsPerSecond=128e3);try{M=new MediaRecorder(e,c)}catch(e){return void alert(`Recording failed: ${e.message}. Try a different codec or lower quality.`)}function d(){const t=((Date.now()-F)/1e3).toFixed(1),n=e.getAudioTracks().length>0,o=window.webgpuState&&window.webgpuState.isWebGPUMode()?"GPU":"GL";i.textContent=` RECORDING ${t}s ${n?"":""} ${o}`}function u(){R.imageSmoothingEnabled=!0,R.imageSmoothingQuality="high",R.clearRect(0,0,o,a),R.drawImage(l,0,0,o,a),_=requestAnimationFrame(u)}$=[],F=Date.now(),M.ondataavailable=e=>{e.data&&e.data.size>0&&($.push(e.data),d())},M.onstop=()=>{const t="h264"===s?"mp4":"webm",n=new Blob($,{type:"h264"===s?"video/mp4":"video/webm"}),l=(n.size/1048576).toFixed(2),c=((Date.now()-F)/1e3).toFixed(1),d=e.getAudioTracks().length>0,u=window.jsCanvasState&&window.jsCanvasState.isJSMode()?"JavaScript":window.webgpuState&&window.webgpuState.isWebGPUMode()?"WebGPU":"WebGL";U&&URL.revokeObjectURL(U),N=n,U=URL.createObjectURL(n),q={width:o,height:a,codec:s,extension:t,size:l,duration:c,bitrate:g.value,hasAudio:d,canvasType:u},T.src=U,A.innerHTML=`\n        <div><strong>File:</strong> ${l} MB  ${c}s  ${o}${a}</div>\n        <div><strong>Settings:</strong> ${s}  ${g.value} kbps  ${u}</div>\n        <div><strong>Audio:</strong> ${d?"Included":"Video only"}</div>\n      `,r.style.display="block",L.style.display="none",k.style.display="none",i.style.display="none",C.disabled=!1,cancelAnimationFrame(_)},u(),M.start(1e3),i.style.display="block",C.disabled=!0,S.disabled=!1;const m=setInterval((()=>{M&&"recording"===M.state?M.requestData():clearInterval(m)}),2e3)}(v,x,y,t,n,f.value,a)})),S.addEventListener("click",(()=>{M&&"recording"===M.state&&(M.stop(),S.disabled=!0)}))})(),function(){function e(e,t={},n=document.body){const o=document.createElement(e);return Object.entries(t).forEach((([e,t])=>o[e]=t)),n.appendChild(o),o}document.addEventListener("fullscreenchange",(()=>{const e=document.fullscreenElement;e&&!e.contains(t)?(e.appendChild(t),e.appendChild(n)):e||(document.body.appendChild(t),document.body.appendChild(n))}));const t=e("button",{id:"uploadHTMLBtn",textContent:"Upload",title:"Upload HTML, JS, or shader file"}),n=e("input",{id:"uploadHTMLInput",type:"file",accept:".html,.js,.frag,.vert,.vs,.fs"}),o=document.getElementById("vertCode"),i=document.getElementById("fragCode"),a=document.getElementById("vertFileName"),r=document.getElementById("fragFileName");function s(e){const t=["vertexShaderSource","vertexShader","vertex_shader","VERTEX_SHADER","vsSource","vs","vert","vertShader","vertex"],n=["fragmentShaderSource","fragmentShader","fragment_shader","FRAGMENT_SHADER","fsSource","fs","frag","fragShader","fragment"],o=t=>{let n=e.match(new RegExp(`(?:const\\s+|let\\s+|var\\s+)?${t}\\s*=\\s*[\`"']([\\s\\S]*?)[\`"']`));return n||(t.length<=3&&(n=e.match(new RegExp(`(?:const\\s+|let\\s+|var\\s+)?\\w*${t}\\w*\\s*=\\s*[\`"']([\\s\\S]*?)[\`"']`))),n)};let i,a;for(const e of t)if(i=o(e),i)break;for(const e of n)if(a=o(e),a)break;return{vs:i&&i[1],fs:a&&a[1]}}function l(e){return e.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\r/g,"\r").replace(/\\"/g,'"').replace(/\\'/g,"'")}function c(e,t,n){o.value=l(e.trim()),i.value=l(t.trim()),a.textContent=r.textContent=`(${n})`,"function"==typeof rebuildProgram&&rebuildProgram(),"function"==typeof render&&render()}t.addEventListener("click",(()=>{n.value="",n.click()})),n.addEventListener("change",(()=>{const e=n.files[0];if(!e)return;const t=new FileReader;t.onload=t=>{const n=t.target.result,l=e.name.split(".").pop().toLowerCase();"frag"===l||"fs"===l?function(e,t){i.value=e.trim(),r.textContent=`(${t})`,console.log(`Fragment shader loaded from ${t}`),"function"==typeof rebuildProgram&&rebuildProgram();"function"==typeof render&&render()}(n,e.name):"vert"===l||"vs"===l?function(e,t){o.value=e.trim(),a.textContent=`(${t})`,console.log(`Vertex shader loaded from ${t}`),"function"==typeof rebuildProgram&&rebuildProgram();"function"==typeof render&&render()}(n,e.name):"js"===l?function(e,t){const{vs:n,fs:o}=s(e);n&&o?c(n,o,t):console.error(`Invalid JS file ${t}. Expected shader source constants or vars.`)}(n,e.name):function(e,t){const n=(new DOMParser).parseFromString(e,"text/html"),o=n.querySelector('script[type="x-shader/x-vertex"]'),i=n.querySelector('script[type="x-shader/x-fragment"]');if(o&&i)return c(o.textContent,i.textContent,t);for(let e of n.querySelectorAll("script")){const{vs:n,fs:o}=s(e.textContent);if(n&&o)return c(n,o,t)}const{vs:a,fs:r}=s(e);if(a&&r)return c(a,r,t);console.error(`No shaders found in ${t}.`)}(n,e.name)},t.readAsText(e)}))}(),function(){const e=document.getElementById("authModal");window.addEventListener("beforeunload",(function(t){e&&"block"===e.style.display||(t.preventDefault(),t.returnValue="")}))}(),(()=>{let e=null,t=null,n=!1,o=!1,i="";const a=new Set,r={stack:[],index:-1,maxSize:50,push(e){this.stack=this.stack.slice(0,this.index+1),this.stack.push(e),this.stack.length>this.maxSize?this.stack.shift():this.index++},canUndo(){return this.index>=0},canRedo(){return this.index<this.stack.length-1},undo(){if(!this.canUndo())return null;const e=this.stack[this.index];return this.index--,e},redo(){if(!this.canRedo())return null;this.index++;return this.stack[this.index]}},s=(e,t="unknown")=>{if("INPUT"===e.tagName&&"file"===e.type)return;if(!e)return;let n,o,i;if(["INPUT","TEXTAREA"].includes(e.tagName))n=e.value,o=e.selectionStart,i=e.selectionEnd;else{if(!e.isContentEditable)return;{n=e.innerHTML;const t=window.getSelection();if(t.rangeCount>0){const e=t.getRangeAt(0);o=e.startOffset,i=e.endOffset}}}r.push({element:e,value:n,selectionStart:o,selectionEnd:i,operation:t,timestamp:Date.now()})},l=e=>{if(!e||!e.element)return;const{element:t,value:n,selectionStart:o,selectionEnd:i}=e;if("INPUT"!==t.tagName||"file"!==t.type){if(["INPUT","TEXTAREA"].includes(t.tagName)){if(t.value=n,"function"==typeof t.setSelectionRange&&Number.isInteger(o)&&Number.isInteger(i))try{t.setSelectionRange(o,i)}catch(e){console.warn("Restore Error",e)}}else if(t.isContentEditable&&(t.innerHTML=n,Number.isInteger(o)&&Number.isInteger(i)))try{const e=document.createRange(),n=t.firstChild;if(n){const t=Math.min(o,n.textContent.length),a=Math.min(i,n.textContent.length);e.setStart(n,t),e.setEnd(n,a);const r=window.getSelection();r.removeAllRanges(),r.addRange(e)}}catch(e){t.focus()}t.focus(),window.rebuildProgram?.(),window.render?.()}else t.focus()},c=e=>{if("INPUT"===e.tagName&&"file"===e.type)return;if(a.has(e))return;a.add(e);let t=null,n=e.value||e.textContent||"";s(e,"initial");const o=()=>{clearTimeout(t),t=setTimeout((()=>{const t=e.value||e.textContent||"";t!==n&&(s(e,"manual-edit"),n=t)}),2e3)};e.addEventListener("input",o),e.addEventListener("paste",(()=>{setTimeout((()=>o()),10)})),e.addEventListener("keydown",(o=>{"Backspace"!==o.key&&"Delete"!==o.key||(t&&clearTimeout(t),s(e,"delete-operation"),n=e.value||e.textContent||"")}))};document.addEventListener("keydown",(e=>{if(!e.metaKey&&!e.ctrlKey||e.shiftKey||"z"!==e.key){if((e.metaKey||e.ctrlKey)&&e.shiftKey&&"z"===e.key||(e.metaKey||e.ctrlKey)&&"y"===e.key){e.preventDefault();const t=r.redo();t&&l(t)}}else{e.preventDefault();const t=r.undo();t&&l(t)}}));const d=(e,t={},n="")=>{const o=document.createElement(e);return Object.entries(t).forEach((([e,t])=>o.setAttribute(e,t))),n&&(o.innerHTML=n),o},u=d("div",{class:"custom-context-menu"});document.body.append(u);const m=e=>e.style.display="none";m(u);const h=()=>clearTimeout(e),p=(e,t,n=!1)=>{const o=d("div",{class:"custom-context-menu-item"+(n?" disabled":"")});o.textContent=e,n||o.addEventListener("click",(e=>{e.stopPropagation(),m(u),t()})),u.append(o)},g=e=>{const t=d("div",{class:"inline-control"});return t.innerHTML=e,u.append(t),t},v=(e,t)=>{if(!e)return null;let n,o;if(["INPUT","TEXTAREA"].includes(e.tagName))n=e.value,o=e.selectionStart;else{if(!e.isContentEditable)return null;{n=e.textContent;const t=window.getSelection();if(t.rangeCount){const n=t.getRangeAt(0).cloneRange();n.selectNodeContents(e),n.setEnd(t.getRangeAt(0).endContainer,t.getRangeAt(0).endOffset),o=n.toString().length}else o=0}}if(void 0!==t&&(o=t),void 0===o)return null;const i=n.slice(0,o).split("\n"),a=n.split("\n").length;return{currentLine:i.length,totalLines:a,column:i[i.length-1].length+1,cursorPos:o}};document.addEventListener("touchstart",(t=>{e=setTimeout((()=>{const e=t.touches[0],n=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY});t.target.dispatchEvent(n)}),600)}),{passive:!0}),["touchend","touchmove"].forEach((e=>document.addEventListener(e,h,{passive:!0}))),document.addEventListener("contextmenu",(e=>{if(e.preventDefault(),t=e.target,n=["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable,i=window.getSelection().toString(),o=!!i,u.innerHTML="",n){let n;if(["INPUT","TEXTAREA"].includes(t.tagName)){const o=function(e,t){if(!["INPUT","TEXTAREA"].includes(t.tagName))return null;try{if("TEXTAREA"===t.tagName){if(t.focus(),document.caretPositionFromPoint){const n=document.caretPositionFromPoint(e.clientX,e.clientY);if(n&&n.offsetNode===t.firstChild)return n.offset}if(document.caretRangeFromPoint){const n=document.caretRangeFromPoint(e.clientX,e.clientY);if(n&&n.startContainer===t.firstChild)return n.startOffset}}return t.selectionStart}catch{return t.selectionStart}}(e,t);n=null!=o?o:t.selectionStart}const o=v(t,n);if(o){const e=d("div",{class:"line-info"});e.textContent=`Line ${o.currentLine} of ${o.totalLines} (Col: ${o.column})`,u.append(e)}}if(o&&/^-?\d+(\.\d+)?$/.test(i)){const e=`slider-${Date.now()}`,n=`slider-label-${Date.now()}`,o=g(`\n        <label id="${n}" for="${e}">Adjust Value:</label>\n        <input type="range" id="${e}" name="value-slider" class="slider-input" aria-labelledby="${n}">\n        <div class="slider-value"></div>\n        <div class="inline-buttons">\n          <button class="btn-cancel slider-cancel">Cancel</button>\n          <button class="btn-confirm slider-confirm">Done</button>\n        </div>\n      `),a=parseFloat(i),r=o.querySelector(".slider-input"),l=o.querySelector(".slider-value"),c=2*Math.abs(a)||1;let h,p,f;if(r.min=(a-c).toString(),r.max=(a+c).toString(),r.step=(2*c/100).toString(),r.value=a,l.textContent=a.toFixed(3),["INPUT","TEXTAREA"].includes(t.tagName))h=t.value,p=t.selectionStart,f=t.selectionEnd;else{h=t.textContent;const e=v(t);p=e.cursorPos-i.length,f=e.cursorPos}let y=!1;const w=()=>{y||(s(t,"number-adjust"),y=!0);const e=r.value,n=parseFloat(e).toFixed(3);l.textContent=n;const o=h.slice(0,p),i=h.slice(f);if(["INPUT","TEXTAREA"].includes(t.tagName))t.value=o+n+i,t.setSelectionRange(p,p+n.length);else{t.textContent=o+n+i;const e=document.createRange(),a=t.firstChild;e.setStart(a,p+n.length),e.collapse(!0);const r=window.getSelection();r.removeAllRanges(),r.addRange(e)}window.rebuildProgram?.(),window.render?.()};r.addEventListener("input",w),o.querySelector(".slider-confirm").onclick=e=>{e.stopPropagation(),r.removeEventListener("input",w),m(u),t.focus(),window.rebuildProgram?.(),window.render?.()},o.querySelector(".slider-cancel").onclick=e=>{if(e.stopPropagation(),r.removeEventListener("input",w),m(u),["INPUT","TEXTAREA"].includes(t.tagName))t.value=h,t.setSelectionRange(p,f);else{t.textContent=h;const e=document.createRange(),n=t.firstChild;e.setStart(n,f),e.collapse(!0);const o=window.getSelection();o.removeAllRanges(),o.addRange(e)}t.focus()},u.append(d("div",{class:"custom-context-menu-separator"}))}if(o&&n){const e=`find-input-${Date.now()}`,o=`replace-input-${Date.now()}`,a=`find-label-${Date.now()}`,r=`replace-label-${Date.now()}`,l=g(`\n          <label id="${a}" for="${e}">Find Text:</label>\n          <input type="text" id="${e}" name="find-text" class="find-input" readonly value="${i.replace(/"/g,"&quot;")}" aria-labelledby="${a}">\n          <label id="${r}" for="${o}">Replace All:</label>\n          <input type="text" id="${o}" name="replace-text" class="replace-input" placeholder="Replace with..." aria-labelledby="${r}">\n          <div class="inline-buttons">\n            <button class="btn-cancel replace-cancel">Cancel</button>\n            <button class="btn-confirm replace-confirm">Replace</button>\n          </div>\n        `);p("Cut",(()=>{s(t,"cut"),document.execCommand("cut")})),p("Copy",(()=>document.execCommand("copy")));const c=l.querySelector(".replace-input");c.focus(),l.querySelector(".replace-confirm").onclick=e=>{e.stopPropagation(),((e,o)=>{if(n&&t){if(s(t,"replace-all"),["INPUT","TEXTAREA"].includes(t.tagName))t.value=t.value.split(e).join(o);else{const n=t.closest("[contenteditable]");n&&(n.innerHTML=n.innerHTML.split(e).join(o))}window.rebuildProgram?.(),window.render?.()}})(i,c.value),m(u)},l.querySelector(".replace-cancel").onclick=e=>{e.stopPropagation(),m(u)},u.append(d("div",{class:"custom-context-menu-separator"}))}n&&(p("Paste",(async()=>{s(t,"paste");let e="";try{e=await navigator.clipboard.readText()}catch{}if(["INPUT","TEXTAREA"].includes(t.tagName)){const{selectionStart:n,selectionEnd:o,value:i}=t;t.value=i.slice(0,n)+e+i.slice(o);const a=n+e.length;t.setSelectionRange(a,a),t.focus()}else{if(!document.execCommand("insertText",!1,e)){const t=window.getSelection();if(t.rangeCount){const n=t.getRangeAt(0);n.deleteContents(),n.insertNode(document.createTextNode(e)),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}}t.focus()}window.rebuildProgram?.(),window.render?.()})),p("Copy Text Field",(()=>{t.focus(),["INPUT","TEXTAREA"].includes(t.tagName)?t.select():document.execCommand("selectAll"),document.execCommand("copy")})),p("Delete All (Text Field)",(()=>{s(t,"delete-all"),t.focus(),["INPUT","TEXTAREA"].includes(t.tagName)?t.value="":t.textContent="",window.rebuildProgram?.(),window.render?.()}))),p("Copy All",(()=>{const e=document.createRange();e.selectNodeContents(document.body);const t=window.getSelection();t.removeAllRanges(),t.addRange(e),document.execCommand("copy"),t.removeAllRanges()})),u.append(d("div",{class:"custom-context-menu-separator"})),p("Undo",(()=>{const e=r.undo();e&&l(e)}),!r.canUndo()),p("Redo",(()=>{const e=r.redo();e&&l(e)}),!r.canRedo()),u.append(d("div",{class:"custom-context-menu-separator"})),p("Back",(()=>r.back())),p("Reload",(()=>location.reload())),u.style.visibility="hidden",u.style.display="block";const{width:a,height:c}=u.getBoundingClientRect();u.style.display="none",u.style.visibility="";let h=e.clientX,f=e.clientY;h+a>window.innerWidth&&(h=window.innerWidth-a-5),f+c>window.innerHeight&&(f=e.clientY-c,f<5&&(f=5)),u.style.left=`${h}px`,u.style.top=`${f}px`,u.style.display="block"})),document.addEventListener("click",(e=>{u.contains(e.target)||m(u)})),window.addEventListener("scroll",(()=>m(u))),document.addEventListener("keydown",(e=>{"Escape"===e.key&&m(u)})),setTimeout((()=>{(()=>{const e=document.querySelector("#vertCode"),t=document.querySelector("#fragCode");e&&c(e),t&&c(t),document.querySelectorAll("input:not([type=file]), textarea, [contenteditable]").forEach((e=>c(e)))})(),((e,t=document)=>Array.from(t.querySelectorAll(e)))("#vertCode, #fragCode").forEach((e=>{e.addEventListener("mousedown",(t=>2===t.button&&e.focus())),c(e)}))}),1e3);new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{1===e.nodeType&&(e.matches&&e.matches("input, textarea, [contenteditable]")&&c(e),e.querySelectorAll&&e.querySelectorAll("input, textarea, [contenteditable]").forEach((e=>{c(e)})))}))}))})).observe(document.body,{childList:!0,subtree:!0})})(),(()=>{const e=document.getElementById("preview-panel");if(!e)return;const t=document.createElement("button");t.className="instruction-btn",t.title="Instructions",t.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"\n         stroke="var(--6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n         viewBox="0 0 24 24" aria-hidden="true">\n      <circle cx="12" cy="12" r="10" />\n      <line x1="12" y1="16" x2="12" y2="12" />\n      <line x1="12" y1="8" x2="12" y2="8" />\n    </svg>\n  ',"static"===getComputedStyle(e).position&&(e.style.position="relative"),t.addEventListener("click",(function(){const t=document.createElement("div");t.className="instruction-overlay";const n=document.createElement("div");n.className="instruction-modal",n.innerHTML="\n      <h2>GLSL Editor  Guide</h2>\n      <ul>\n        <li><strong>Save/Browse:</strong> Save shaders locally, by share link or publicly (premium), and explore public gallery</li>\n        <li><strong>Editor:</strong> Write or edit <code>.vert</code> and <code>.frag</code> code with live updates</li>\n        <li><strong>GLSL Version:</strong> Use <code>#ifdef GL_ES ... #endif</code> for GLSL 2.0, or <code>#version 300 es</code> for GLSL ES 3.00</li>\n        <li><strong>WebGPU Support:</strong> **Experimental** Use toggle to switch to WebGPU canvas </li>\n        <li><strong>Import/Export:</strong> Drag + drop, or upload <code>.vert</code>, <code>.frag</code>, <code>.vs</code>, <code>.fs</code>, <code>.txt</code>, or <code>.html</code> files</li>\n        <li><strong>Audio Reactive:</strong> Use mic, system audio, or uploaded files for audio-reactive effects via bass, mid, treble and overall volume uniforms</li>\n        <li><strong>Record:</strong> Capture WebM/MP4 of canvas with included audio</li>\n        <li><strong>Performance:</strong> Monitor FPS, memory, draw calls</li>\n        <li><strong>Linting:</strong> Get instant console feedback for mistakes</li>\n        <li><strong>Customize:</strong> Resize or hide panels and theme the UI</li>\n        <li><strong>Color:</strong> Click a <code>vec3</code> color to open picker</li>\n        <li><strong>Format:</strong> Open code formatter to minify or format your code</li>\n        <li><strong>Visualize Code:</strong> Open flowchart window to visualize your code, and export and png, or detailed json/txt package</li>\n        <li><strong>Insert GLSL Snippets:</strong>Press in text area and then open snippet library to add code segments</li>\n        <li><strong>Support:</strong> Contact: <span>compositionsbymax@gmail.com</span></li>\n      </ul>\n    ";const o=document.createElement("button");o.className="shortcut-trigger-btn",o.textContent="Shortcuts",o.addEventListener("click",(()=>{window.KeyboardShortcuts.open()})),n.appendChild(o);const i=document.createElement("button");i.textContent="",i.setAttribute("aria-label","Close instructions"),i.className="instruction-close-btn",document.addEventListener("keydown",(n=>{"Escape"===n.key&&e.removeChild(t)}),{once:!0}),i.addEventListener("click",(()=>{e.removeChild(t)})),t.appendChild(n),t.appendChild(i),e.appendChild(t)})),e.appendChild(t)})();class p{constructor(){this.isInitialized=!1,this.currentTextarea=null,this.currentMatch=null,this.currentStartPos=0,this.currentEndPos=0,this.tabElement=null,this.originalValues={r:0,g:0,b:0},this.tabRemovalTimeout=null,this.clickOutsideHandler=null,this.init()}ColorRegex(){return/\(\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\s*\)/g}init(){this.isInitialized||(this.HTML(),this.bind(),this.attachToTextareas(),this.setupFullscreenHandler(),this.isInitialized=!0)}setupFullscreenHandler(){document.addEventListener("fullscreenchange",(()=>{const e=document.getElementById("glsl-color-picker-overlay"),t=this.tabElement;document.fullscreenElement?(e&&document.fullscreenElement.appendChild(e),t&&document.fullscreenElement.appendChild(t)):(e&&document.body.appendChild(e),t&&document.body.appendChild(t))}))}HTML(){if(document.getElementById("glsl-color-picker-overlay"))return;const e=document.createElement("div");e.className="glsl-color-picker-overlay",e.id="glsl-color-picker-overlay",e.innerHTML='\n            <div class="glsl-color-picker" id="glsl-color-picker">\n                <h3>Edit GLSL Color</h3>\n                <div class="glsl-color-preview" id="glsl-color-preview"></div>\n                <div class="glsl-color-inputs">\n                    <div class="glsl-input-group">\n                        <label for="glsl-red">Red</label>\n                        <input type="number" id="glsl-red" step="0.01" min="0" max="2">\n                    </div>\n                    <div class="glsl-input-group">\n                        <label for="glsl-green">Green</label>\n                        <input type="number" id="glsl-green" step="0.01" min="0" max="2">\n                    </div>\n                    <div class="glsl-input-group">\n                        <label for="glsl-blue">Blue</label>\n                        <input type="number" id="glsl-blue" step="0.01" min="0" max="2">\n                    </div>\n                </div>\n                <div class="glsl-color-sliders">\n                    <div class="glsl-slider-group">\n                        <label for="glsl-red-slider">R</label>\n                        <input type="range" id="glsl-red-slider" min="0" max="2" step="0.01">\n                        <span id="glsl-red-value">0.00</span>\n                    </div>\n                    <div class="glsl-slider-group">\n                        <label for="glsl-green-slider">G</label>\n                        <input type="range" id="glsl-green-slider" min="0" max="2" step="0.01">\n                        <span id="glsl-green-value">0.00</span>\n                    </div>\n                    <div class="glsl-slider-group">\n                        <label for="glsl-blue-slider">B</label>\n                        <input type="range" id="glsl-blue-slider" min="0" max="2" step="0.01">\n                        <span id="glsl-blue-value">0.00</span>\n                    </div>\n                </div>\n                <div class="glsl-color-buttons">\n                    <button class="glsl-btn glsl-btn-cancel" id="glsl-cancel">Cancel</button>\n                    <button class="glsl-btn glsl-btn-apply" id="glsl-apply">Apply</button>\n                </div>\n            </div>\n        ';(document.fullscreenElement||document.body).appendChild(e)}bind(){const e=document.getElementById("glsl-color-picker-overlay"),t=document.getElementById("glsl-red"),n=document.getElementById("glsl-green"),o=document.getElementById("glsl-blue"),i=document.getElementById("glsl-red-slider"),a=document.getElementById("glsl-green-slider"),r=document.getElementById("glsl-blue-slider"),s=document.getElementById("glsl-cancel"),l=document.getElementById("glsl-apply");e.addEventListener("click",(t=>{t.target===e&&this.cancelPicker()}));const c=(e=!1)=>{const s=parseFloat(t.value)||0,l=parseFloat(n.value)||0,c=parseFloat(o.value)||0;i.value=s,a.value=l,r.value=c,document.getElementById("glsl-red-value").textContent=s.toFixed(2),document.getElementById("glsl-green-value").textContent=l.toFixed(2),document.getElementById("glsl-blue-value").textContent=c.toFixed(2),this.updatePreview(s,l,c),e&&(this.updateEditors(s,l,c),this.highlightColor(this.currentTextarea,this.currentStartPos,this.currentEndPos))};[t,n,o].forEach((e=>{e.addEventListener("input",(()=>c(!1)))})),[i,a,r].forEach(((e,i)=>{e.addEventListener("input",(()=>{[t,n,o][i].value=e.value,c(!0)}))})),s.addEventListener("click",(()=>this.cancelPicker())),l.addEventListener("click",(()=>this.applyColor())),document.addEventListener("keydown",(e=>{"block"===document.getElementById("glsl-color-picker-overlay").style.display&&("Escape"===e.key?this.cancelPicker():"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&this.applyColor())}))}updateEditors(e,t,n){if(!this.currentTextarea)return;const o=`(${e.toFixed(1)}, ${t.toFixed(1)}, ${n.toFixed(1)})`,i=this.currentTextarea.value,a=i.substring(0,this.currentStartPos)+o+i.substring(this.currentEndPos);this.currentEndPos=this.currentStartPos+o.length,this.currentTextarea.value=a;const r=new Event("input",{bubbles:!0});this.currentTextarea.dispatchEvent(r)}attachToTextareas(){const e=()=>{document.querySelectorAll("textarea").forEach((e=>{e.dataset.glslColorPickerAttached||(this.attachToTextarea(e),e.dataset.glslColorPickerAttached="true")}))};e();new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0})}attachToTextarea(e){const t=t=>this.handleTextareaClick(t,e);e.addEventListener("click",t),e._glslClickHandler=t}handleTextareaClick(e,t){const n=t.selectionStart,o=t.value,i=this.ColorRegex();let a;for(;null!==(a=i.exec(o));){const o=a.index,i=o+a[0].length;if(n>=o&&n<=i)return void setTimeout((()=>{this.showTab(e.clientX,e.clientY,t,a,o,i)}),10)}this.removeTab()}showTab(e,t,n,o,i,a){this.removeTab();const r=document.createElement("div");r.className="glsl-tab",r.innerHTML='\n        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n            <g transform="scale(0.09)">\n                <path fill="var(--7)" d="M254.141,53.244C224.508,18.909,185.299,0,143.736,0c-35.062,0-68.197,13.458-93.302,37.9 C10.383,76.892-2.822,123.282,14.207,165.178c13.868,34.122,45.625,57.954,77.227,57.954c0.841,0,1.671-0.016,2.508-0.053 c4.705-0.194,9.249-0.586,13.646-0.966c5.309-0.462,10.325-0.895,14.77-0.895c10.54,0,19.645,0,19.645,26.846 c0,28.811,17.538,48.934,42.65,48.936c0.002,0,0.002,0,0.004,0c17.864,0,37.651-10.342,57.215-29.903 c25.882-25.88,43.099-62.198,47.234-99.64C293.762,125.326,281.343,84.763,254.141,53.244z M227.315,252.54 c-15.397,15.398-30.55,23.877-42.66,23.875c-16.288,0-22.064-15.274-22.064-28.352c0-32.357-12.786-47.43-40.232-47.43 c-5.333,0-10.778,0.472-16.545,0.969c-4.169,0.359-8.481,0.733-12.724,0.909c-0.553,0.024-1.102,0.034-1.655,0.034 c-23.07,0-47.529-18.975-58.156-45.118c-13.714-33.738-2.225-71.927,31.519-104.779c21.239-20.676,49.272-32.063,78.939-32.063 c35.485,0,69.159,16.373,94.82,46.107C289.187,125.359,272.6,207.256,227.315,252.54z"/>\n                <path d="M192.654,165.877c0,17.213,13.918,31.217,31.026,31.217c17.107,0,31.025-14.004,31.025-31.217 c0-17.215-13.918-31.219-31.025-31.219C206.572,134.658,192.654,148.662,192.654,165.877z M234.118,165.877 c0,5.861-4.682,10.633-10.438,10.633c-5.756,0-10.438-4.771-10.438-10.633c0-5.863,4.683-10.633,10.438-10.633 C229.436,155.244,234.118,160.014,234.118,165.877z"/>\n                <path d="M226.914,93.489c0-17.215-13.917-31.219-31.025-31.219c-17.107,0-31.025,14.004-31.025,31.219 c0,17.211,13.918,31.218,31.025,31.218C212.997,124.707,226.914,110.7,226.914,93.489z M185.45,93.489 c0-5.865,4.684-10.632,10.439-10.632c5.756,0,10.438,4.767,10.438,10.632c0,5.86-4.683,10.633-10.438,10.633 C190.133,104.122,185.45,99.35,185.45,93.489z"/>\n                <path d="M124.863,39.627c-17.107,0-31.025,14.004-31.025,31.217c0,17.213,13.918,31.217,31.025,31.217s31.025-14.004,31.025-31.217 C155.888,53.631,141.97,39.627,124.863,39.627z M124.863,81.478c-5.756,0-10.438-4.771-10.438-10.634 c0-5.863,4.682-10.633,10.438-10.633c5.756,0,10.438,4.77,10.438,10.633C135.3,76.707,130.619,81.478,124.863,81.478z"/>\n                <path d="M70.821,92.809c-17.107,0-31.026,14.004-31.026,31.217c0,17.214,13.919,31.219,31.026,31.219s31.024-14.005,31.024-31.219 C101.845,106.813,87.928,92.809,70.821,92.809z M70.821,134.658c-5.757,0-10.439-4.77-10.439-10.633 c0-5.861,4.683-10.63,10.439-10.63c5.755,0,10.438,4.769,10.438,10.63C81.259,129.889,76.576,134.658,70.821,134.658z"/>\n            </g>\n            </svg>\n        ',r.style.left=e+5+"px",r.style.top=t+5+"px";r.addEventListener("click",(r=>{this.openPicker(n,o,i,a,e,t),this.removeTab()}));(document.fullscreenElement||document.body).appendChild(r),this.tabElement=r,this.removeClickOutsideHandler(),this.clickOutsideHandler=e=>{const t=e.target;!this.tabElement||this.tabElement.contains(t)||n.contains(t)||(this.removeTab(),this.removeClickOutsideHandler())},setTimeout((()=>{document.addEventListener("click",this.clickOutsideHandler)}),50),this.tabRemovalTimeout=setTimeout((()=>{this.removeTab()}),5e3)}removeTab(){this.tabRemovalTimeout&&(clearTimeout(this.tabRemovalTimeout),this.tabRemovalTimeout=null),this.tabElement&&(this.tabElement.remove(),this.tabElement=null),this.removeClickOutsideHandler()}removeClickOutsideHandler(){this.clickOutsideHandler&&(document.removeEventListener("click",this.clickOutsideHandler),this.clickOutsideHandler=null)}positionPicker(e,t){const n=document.getElementById("glsl-color-picker-overlay"),o=document.getElementById("glsl-color-picker");o.style.visibility="hidden",n.style.display="block";const i=o.getBoundingClientRect(),a=i.width,r=i.height;o.style.visibility="visible";const s=window.innerWidth,l=window.innerHeight,c=20;let d=e,u=t+30;if(d+a+c>s&&(d=s-a-c),d<c&&(d=c),u+r+c>l){const e=t-r-30;u=e>=c?e:Math.max(c,(l-r)/2)}o.style.left=d+"px",o.style.top=u+"px"}openPicker(e,t,n,o,i,a){this.currentTextarea=e,this.currentMatch=t,this.currentStartPos=n,this.currentEndPos=o;const r=parseFloat(t[1]),s=parseFloat(t[2]),l=parseFloat(t[3]);this.originalValues={r:r,g:s,b:l},document.getElementById("glsl-red").value=r,document.getElementById("glsl-green").value=s,document.getElementById("glsl-blue").value=l,document.getElementById("glsl-red-slider").value=r,document.getElementById("glsl-green-slider").value=s,document.getElementById("glsl-blue-slider").value=l,document.getElementById("glsl-red-value").textContent=r.toFixed(2),document.getElementById("glsl-green-value").textContent=s.toFixed(2),document.getElementById("glsl-blue-value").textContent=l.toFixed(2),this.updatePreview(r,s,l),this.positionPicker(i,a),document.getElementById("glsl-color-picker-overlay").style.display="block",this.highlightColor(e,n,o)}updatePreview(e,t,n){const o=document.getElementById("glsl-color-preview"),i=Math.min(255,Math.max(0,Math.round(255*e))),a=Math.min(255,Math.max(0,Math.round(255*t))),r=Math.min(255,Math.max(0,Math.round(255*n)));o.style.backgroundColor=`rgb(${i}, ${a}, ${r})`}highlightColor(e,t,n){e.focus(),e.setSelectionRange(t,n)}applyColor(){if(!this.currentTextarea)return;const e=parseFloat(document.getElementById("glsl-red").value)||0,t=parseFloat(document.getElementById("glsl-green").value)||0,n=parseFloat(document.getElementById("glsl-blue").value)||0,o=`(${e.toFixed(1)}, ${t.toFixed(1)}, ${n.toFixed(1)})`,i=this.currentTextarea.value,a=i.substring(0,this.currentStartPos)+o+i.substring(this.currentEndPos);this.currentTextarea.value=a;const r=new Event("input",{bubbles:!0});this.currentTextarea.dispatchEvent(r),this.closePicker()}cancelPicker(){if(this.currentTextarea&&this.originalValues){const e=`(${this.originalValues.r.toFixed(1)}, ${this.originalValues.g.toFixed(1)}, ${this.originalValues.b.toFixed(1)})`,t=this.currentTextarea.value,n=t.substring(0,this.currentStartPos)+e+t.substring(this.currentEndPos);this.currentTextarea.value=n;const o=new Event("input",{bubbles:!0});this.currentTextarea.dispatchEvent(o)}this.closePicker()}closePicker(){document.getElementById("glsl-color-picker-overlay").style.display="none",this.currentTextarea=null,this.currentMatch=null,this.originalValues={r:0,g:0,b:0},this.removeTab()}highlightColorsInTextarea(e){const t=e.value,n=this.ColorRegex();let o;const i=[];for(;null!==(o=n.exec(t));)i.push({text:o[0],start:o.index,end:o.index+o[0].length,r:parseFloat(o[1]),g:parseFloat(o[2]),b:parseFloat(o[3])});return i}destroy(){this.removeTab(),this.removeClickOutsideHandler();const e=document.getElementById("glsl-color-picker-overlay");e&&e.remove();document.querySelectorAll("textarea[data-glsl-color-picker-attached]").forEach((e=>{e._glslClickHandler&&(e.removeEventListener("click",e._glslClickHandler),delete e._glslClickHandler),delete e.dataset.glslColorPickerAttached})),this.isInitialized=!1}}if("loading"===document.readyState)document.addEventListener("DOMContentLoaded",(()=>{try{window.ColorPicker=new p}catch(e){console.error("Failed to initialize GLSL Color Picker:",e)}}));else try{window.ColorPicker=new p}catch(e){console.error("Failed to initialize GLSL Color Picker:",e)}"undefined"!=typeof module&&module.exports&&(module.exports=p),function(){const e=["attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","bool","true","false","vec2","vec3","vec4","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","mat2","mat3","mat4","sampler2D","samplerCube","void","main","gl_Position","gl_FragColor","gl_FragData","gl_FragCoord","gl_FrontFacing","texture2D","textureCube","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","reflect","refract","precision","lowp","mediump","highp"];let t=null,n=!1,o="",i="";function a(){(document.fullscreenElement||document.body).insertAdjacentHTML("beforeend",'\n            <div class="glsl-formatter-modal-overlay" id="glslFormatterModal">\n                <div class="glsl-formatter-modal">\n                    <div class="glsl-formatter-modal-header">\n                        <button class="glsl-formatter-modal-close" onclick="GLSLFormatter.closeModal()"></button>\n                        <h2 class="glsl-formatter-modal-title">GLSL Formatter</h2>\n                    </div>\n                    <div class="glsl-formatter-switches">\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslFormatSwitch">\n                                <span class="glsl-formatter-slider format"></span>\n                                <span class="glsl-formatter-switch-label">Format</span>\n                            </label>\n                        </div>\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslRemoveExtraLinesSwitch">\n                                <span class="glsl-formatter-slider remove-lines"></span>\n                                <span class="glsl-formatter-switch-label">Remove Extra Lines</span>\n                            </label>\n                        </div>\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslRemoveCommentsSwitch">\n                                <span class="glsl-formatter-slider remove-comments"></span>\n                                <span class="glsl-formatter-switch-label">Remove Comments</span>\n                            </label>\n                        </div>\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslMinifySwitch">\n                                <span class="glsl-formatter-slider minify"></span>\n                                <span class="glsl-formatter-switch-label">Minify</span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class="glsl-formatter-actions">\n                        <button class="glsl-formatter-btn glsl-formatter-btn-primary" onclick="GLSLFormatter.saveChanges()">Save</button>\n                        <button class="glsl-formatter-btn glsl-formatter-btn-secondary" onclick="GLSLFormatter.cancelChanges()">Cancel</button>\n                    </div>\n                </div>\n            </div>\n        '),t=document.getElementById("glslFormatterModal"),function(){const e=document.getElementById("glslFormatSwitch"),o=document.getElementById("glslMinifySwitch"),i=document.getElementById("glslRemoveCommentsSwitch"),a=document.getElementById("glslRemoveExtraLinesSwitch");e.addEventListener("change",(()=>{e.checked&&o.checked&&(o.checked=!1),o.disabled=e.checked,c()})),o.addEventListener("change",(()=>{o.checked&&e.checked&&(e.checked=!1),e.disabled=o.checked,c()})),i.addEventListener("change",c),a.addEventListener("change",c),t.addEventListener("click",(e=>{e.target===t&&h()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&n&&h()}))}()}function r(t){let n=t.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"");n=n.replace(/\s+/g," ").trim();let o="",i=!1,a=0;for(let e=0;e<n.length;e++){const t=n[e],r=e>0?n[e-1]:"",s=e<n.length-1?n[e+1]:"";"("===t&&a++,")"===t&&a--,i||"f"!==t||"for"!==n.substr(e,3)||0!==e&&!/\s/.test(r)||(i=!0),i&&")"===t&&0===a&&(i=!1),o+=t,";"!==t||i||0!==a?("{"===t||"}"===t&&s&&";"!==s&&"}"!==s)&&(o+="\n"):o+="\n"}o=o.replace(/\s*([{}();,=+\-*/<>!&|])\s*/g,"$1");for(let t of e){const e=new RegExp(`\\b${t}\\b`,"g");o=o.replace(e,` ${t} `)}o=o.replace(/\s+/g," ").trim(),o=o.replace(/\s*([{}();,=+\-*/<>!&|])\s*/g,"$1");return o.split("\n").map((e=>e.trim())).filter((e=>e.length>0)).join("\n")}function s(e){if(!e.trim())return e;let t=e;const n=document.getElementById("glslRemoveCommentsSwitch"),o=document.getElementById("glslRemoveExtraLinesSwitch"),i=document.getElementById("glslFormatSwitch"),a=document.getElementById("glslMinifySwitch");return n.checked&&(t=function(e){let t=e;return t=t.replace(/\/\/.*$/gm,""),t=t.replace(/\/\*[\s\S]*?\*\//g,""),t=t.replace(/ +$/gm,""),t}(t)),o.checked&&(t=function(e){const t=e.split("\n"),n=[];for(let e of t)""!==e.trim()&&n.push(e);return n.join("\n")}(t)),i.checked?t=function(e){const t=e.split("\n").filter((e=>e.trim().length>0));let n;if(t.reduce(((e,t)=>e+t.length),0)/(t.length||1)>100||t.length<5){let t=e.replace(/\s+/g," ").trim(),o="",i=!1,a=0;for(let e=0;e<t.length;e++){const n=t[e],r=e>0?t[e-1]:"",s=e<t.length-1?t[e+1]:"";"("===n&&a++,")"===n&&a--,i||"f"!==n||"for"!==t.substr(e,3)||0!==e&&!/\s/.test(r)||(i=!0),i&&")"===n&&0===a&&(i=!1),o+=n,";"!==n||i||0!==a?("{"===n||"}"===n&&s&&";"!==s&&"}"!==s)&&(o+="\n"):o+="\n"}n=o}else n=e;const o=n.split("\n"),i=[];let a=0;for(let e of o){const t=e.trim();if(!t){i.push("");continue}if(t.startsWith("#")){i.push(t);continue}t.startsWith("}")&&(a=Math.max(0,a-1));const n="  ".repeat(a);i.push(n+t),t.endsWith("{")&&a++}return i.join("\n")}(t):a.checked&&(t=function(e){const t=e.split("\n"),n=[];let o=[];for(let e of t){const t=e.trim();t.startsWith("#")?(o.length&&(n.push({type:"code",lines:o.slice()}),o=[]),n.push({type:"directive",content:t})):o.push(e)}o.length&&n.push({type:"code",lines:o.slice()});const i=[];for(let e of n)if("directive"===e.type)i.push(e.content);else if("code"===e.type){const t=e.lines.join("\n");if(t.trim()){const e=r(t).split("\n");for(let t of e)i.push(t)}}return i.join("\n").trim()}(t)),t}function l(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");o=e?e.value:"",i=t?t.value:""}function c(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&(e.value=s(o)),t&&(t.value=s(i))}function d(){t||a(),l(),t.style.display="flex",n=!0,setTimeout((()=>{t.classList.add("show")}),10)}function u(){t&&(t.classList.remove("show"),n=!1,setTimeout((()=>{t.style.display="none"}),300))}function m(){l(),u()}function h(){!function(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&(e.value=o),t&&(t.value=i)}(),u()}function p(e){e.altKey&&"KeyM"===e.code&&(e.preventDefault(),n?h():d())}function g(){document.addEventListener("keydown",p),document.addEventListener("fullscreenchange",(()=>{const e=document.getElementById("glslFormatterModal"),t=document.getElementById("glslFormatterToggleButton"),n=document.fullscreenElement||document.body;t&&n.appendChild(t),e&&n.appendChild(e)})),window.GLSLFormatter={openModal:d,closeModal:u,saveChanges:m,cancelChanges:h}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()}(),function(){let e=null;const t={vertex:{"Vertex Input":{pattern:/attribute\s+\w+\s+\w+|in\s+\w+\s+\w+/,priority:1},"Position Transform":{pattern:/gl_Position\s*=|mvp|modelViewProjection/,priority:8},"Vertex Output":{pattern:/varying\s+\w+\s+\w+|out\s+\w+\s+\w+/,priority:7},"Matrix Operations":{pattern:/mat[2-4]|transpose|inverse/,priority:5},"Vertex Lighting":{pattern:/dot\s*\(.*normal|reflect\s*\(/,priority:6}},fragment:{"Fragment Input":{pattern:/varying\s+\w+\s+\w+|in\s+\w+\s+\w+/,priority:1},"Screen Coordinates":{pattern:/gl_FragCoord/,priority:2},"UV Mapping":{pattern:/uv\s*=|texCoord/,priority:2},"Texture Sampling":{pattern:/texture2D|texture|sampler/,priority:4},"Coordinate Transform":{pattern:/atan|length|normalize/,priority:3},"Polar Coordinates":{pattern:/atan\s*\(|polar|radius|angle/,priority:3},"Mathematical Operations":{pattern:/mod\s*\(|fract\s*\(|step\s*\(/,priority:5},"Fractal Iteration":{pattern:/z\s*=\s*z.*\+|mandelbrot|julia/,priority:6},"Shape Functions":{pattern:/circle|rectangle|superformula|pow\s*\(/,priority:5},Rotation:{pattern:/rot2|cos\s*\(.*sin\s*\(|rotation/,priority:4},"Time Animation":{pattern:/u_time|time|iTime/,priority:3},"Color Generation":{pattern:/vec3\s*\(.*,.*,.*\)|rgb|hsv/,priority:7},"Color Mixing":{pattern:/mix\s*\(|lerp\s*\(/,priority:8},Lighting:{pattern:/dot\s*\(.*normal|specular|diffuse/,priority:6},"Distance Fields":{pattern:/length\s*\(|distance\s*\(|sdf/,priority:5},"Noise Functions":{pattern:/noise\s*\(|random\s*\(|perlin/,priority:4},"Fragment Output":{pattern:/gl_FragColor\s*=|FragColor\s*=/,priority:9}},common:{Conditionals:{pattern:/if\s*\(|else|switch/,priority:0},Loops:{pattern:/for\s*\(|while\s*\(/,priority:0},Functions:{pattern:/\w+\s*\([^)]*\)\s*{/,priority:0},Constants:{pattern:/const\s+\w+|#define/,priority:0},Uniforms:{pattern:/uniform\s+\w+\s+\w+/,priority:0}}};function n(e,t){const n=e.split("\n"),o=[];return n.forEach(((e,n)=>{t.test(e)&&o.push({lineNumber:n+1,lineContent:e.trim(),match:e.match(t)?.[0]||""})})),o}function o(e,o){const i=[],a={...t.common,...t[o]};for(const[t,r]of Object.entries(a)){const a=n(e,r.pattern);a.length>0&&i.push({name:t,type:"vertex"===o?"vertex":"fragment"===o?"fragment":"common",priority:r.priority||0,matches:a})}return i.sort(((e,t)=>e.priority-t.priority)),i}function i(e,t){const n=document.getElementById("flowchartTooltip")||function(){const e=document.createElement("div");return e.className="flowchart-tooltip",e.id="flowchartTooltip",document.body.appendChild(e),e}();let o=`${t.name}\n\nFound on lines:\n`;t.matches.forEach((e=>{o+=`Line ${e.lineNumber}: ${e.lineContent}\n`})),n.textContent=o;const i=n.getBoundingClientRect(),a=window.innerWidth,r=window.innerHeight;let s=e.pageX+10,l=e.pageY+10;s+i.width>a&&(s=e.pageX-i.width-10),l+i.height>r&&(l=e.pageY-i.height-10),n.style.left=s+"px",n.style.top=l+"px",n.classList.add("show")}function a(){const e=document.getElementById("flowchartTooltip");e&&e.classList.remove("show")}function r(e,t,n=9){const o=e.split(/,\s*/),i=[];let a="";const r=.6*n,s=Math.floor(t/r);for(let e of o)a.length+e.length+2<=s?(a&&(a+=", "),a+=e):(a&&i.push(a),a=e);return a&&i.push(a),i}function s(){const t=document.getElementById("vertCode")?.value||"",n=document.getElementById("fragCode")?.value||"",s=o(t,"vertex"),l=o(n,"fragment");e={vertexStages:s,fragmentStages:l,vertexCode:t,fragmentCode:n,timestamp:(new Date).toISOString()},function(e,t){const n=document.getElementById("flowchartSVG");n.innerHTML="";const o=200,s=15,l=e=>{const t=r(e.matches.map((e=>`L${e.lineNumber}`)).join(", "),180);return Math.max(50,50+12*(t.length-1))},c=e.map(l),d=t.map(l),u=c.reduce(((e,t)=>e+t+s),0)-s,m=d.reduce(((e,t)=>e+t+s),0)-s,h=50+Math.max(u,m)+30;n.setAttribute("width","100%"),n.setAttribute("height",h),n.setAttribute("viewBox",`0 0 550 ${h}`),n.style.minHeight=h+"px";const p=document.createElementNS("http://www.w3.org/2000/svg","defs");p.innerHTML='\n            <marker id="flowchart-arrow-marker" viewBox="0 0 10 10" refX="9" refY="3"\n                    markerWidth="6" markerHeight="6" orient="auto">\n                <path d="M0,0 L0,6 L9,3 z" fill="#666"/>\n            </marker>\n        ',n.appendChild(p);const g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",125),g.setAttribute("y",25),g.setAttribute("class","flowchart-label"),g.setAttribute("font-size","16"),g.setAttribute("font-weight","bold"),g.textContent="Vertex Shader",n.appendChild(g);const v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",425),v.setAttribute("y",25),v.setAttribute("class","flowchart-label"),v.setAttribute("font-size","16"),v.setAttribute("font-weight","bold"),v.textContent="Fragment Shader",n.appendChild(v);let f=50;if(e.forEach(((t,l)=>{const d=c[l],u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("x",25),u.setAttribute("y",f),u.setAttribute("width",o),u.setAttribute("height",d),u.setAttribute("rx",6),u.setAttribute("class",`flowchart-node ${t.type}`),u.addEventListener("mouseenter",(e=>i(e,t))),u.addEventListener("mouseleave",a),u.addEventListener("mousemove",(e=>{const n=document.getElementById("flowchartTooltip");n&&n.classList.contains("show")&&i(e,t)})),n.appendChild(u);const m=document.createElementNS("http://www.w3.org/2000/svg","text");if(m.setAttribute("x",125),m.setAttribute("y",f+d/2-10),m.setAttribute("class","flowchart-label"),m.textContent=t.name,n.appendChild(m),r(t.matches.map((e=>`L${e.lineNumber}`)).join(", "),180).forEach(((e,t)=>{const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",125),o.setAttribute("y",f+d/2+5+12*t),o.setAttribute("class","flowchart-line-number"),o.textContent=e,n.appendChild(o)})),l<e.length-1){const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",125),e.setAttribute("y1",f+d),e.setAttribute("x2",125),e.setAttribute("y2",f+d+s),e.setAttribute("class","flowchart-arrow"),n.appendChild(e)}f+=d+s})),f=50,t.forEach(((e,l)=>{const c=d[l],u=325,m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("x",u),m.setAttribute("y",f),m.setAttribute("width",o),m.setAttribute("height",c),m.setAttribute("rx",6),m.setAttribute("class",`flowchart-node ${e.type}`),m.addEventListener("mouseenter",(t=>i(t,e))),m.addEventListener("mouseleave",a),m.addEventListener("mousemove",(t=>{const n=document.getElementById("flowchartTooltip");n&&n.classList.contains("show")&&i(t,e)})),n.appendChild(m);const h=document.createElementNS("http://www.w3.org/2000/svg","text");if(h.setAttribute("x",425),h.setAttribute("y",f+c/2-10),h.setAttribute("class","flowchart-label"),h.textContent=e.name,n.appendChild(h),r(e.matches.map((e=>`L${e.lineNumber}`)).join(", "),180).forEach(((e,t)=>{const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",425),o.setAttribute("y",f+c/2+5+12*t),o.setAttribute("class","flowchart-line-number"),o.textContent=e,n.appendChild(o)})),l<t.length-1){const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",425),e.setAttribute("y1",f+c),e.setAttribute("x2",425),e.setAttribute("y2",f+c+s),e.setAttribute("class","flowchart-arrow"),n.appendChild(e)}f+=c+s})),e.length>0&&t.length>0){const e=50+u/2,t=50+d[0]/2,o=Math.max(e,t),i=document.createElementNS("http://www.w3.org/2000/svg","path"),a=225,r=325;i.setAttribute("d",`M ${a} ${o} L ${r} ${o}`),i.setAttribute("class","flowchart-arrow"),i.setAttribute("stroke-dasharray","5,5"),n.appendChild(i)}}(s,l)}function l(){document.getElementById("flowchartOverlay").classList.add("show"),document.getElementById("flowchartWindow").classList.add("show"),s()}function c(){document.getElementById("flowchartOverlay").classList.remove("show"),document.getElementById("flowchartWindow").classList.remove("show"),a()}function d(){const e=document.createElement("div");e.id="flowchartOverlay",e.className="flowchart-overlay",e.addEventListener("click",c);const t=document.createElement("div");t.id="flowchartWindow",t.innerHTML='\n            <div class="flowchart-header">\n                <h3>Flowchart <span style="font-size:12px;color:var(--a)">(Hover nodes for details)</span></h3>\n                <div class="flowchart-controls">\n                    <div class="export-dropdown" id="exportDropdown">\n                        <button onclick="glslFlowchart.toggleExport()">Export </button>\n                        <div class="export-dropdown-content">\n                            <button onclick="glslFlowchart.exportPNG()">PNG Image</button>\n                            <button onclick="glslFlowchart.exportJSON()">JSON Data</button>\n                            <button onclick="glslFlowchart.exportTXT()">Text Report</button>\n                        </div>\n                    </div>\n                    <button class="flowchartclose-btn" onclick="glslFlowchart.close()">Close</button>\n                </div>\n            </div>\n            <div class="flowchart-content">\n                <svg id="flowchartSVG"></svg>\n            </div>\n        ',t.addEventListener("click",(e=>e.stopPropagation())),document.body.appendChild(e),document.body.appendChild(t)}function u(){document.addEventListener("keydown",(e=>{if(e.altKey&&"KeyV"===e.code){e.preventDefault();document.getElementById("flowchartWindow").classList.contains("show")?c():l()}"Escape"===e.key&&document.getElementById("flowchartWindow").classList.contains("show")&&c()}))}document.addEventListener("click",(function(e){const t=document.getElementById("exportDropdown");t&&!t.contains(e.target)&&t.classList.remove("show")})),window.glslFlowchart={open:l,close:c,exportPNG:function(){const e=document.getElementById("flowchartSVG");if(!e)return;const t=e.cloneNode(!0),n=(window.getComputedStyle(document.documentElement),{"--0":"rgba(0,0,0,0.3)","--1":"rgba(0,0,0,0.1)","--2":"#1a1a1a","--3":"#333333","--4":"#2a2a2a","--5":"#666666","--6":"#444444","--7":"#ffffff","--a":"#4a9eff","--b":"#ff6b6b","--m":"#ff9f43","--r":"#ee5a52","--ah":"#357abd","--rh":"#d63031"});!function e(t){["fill","stroke"].forEach((e=>{const o=t.getAttribute(e);if(o&&o.startsWith("var(")){const i=o.match(/var\((--[^)]+)\)/)?.[1];i&&n[i]&&t.setAttribute(e,n[i])}}));const o=t.getAttribute("style");if(o){let e=o;Object.entries(n).forEach((([t,n])=>{e=e.replace(new RegExp(`var\\(${t}\\)`,"g"),n)})),t.setAttribute("style",e)}Array.from(t.children).forEach((t=>e(t)))}(t);const o=document.createElementNS("http://www.w3.org/2000/svg","style");o.textContent="\n            .flowchart-node { fill: #1a1a1a; stroke: #333333; stroke-width: 2px; }\n            .flowchart-node.vertex { fill: #1a1a1a; stroke: #4a9eff; }\n            .flowchart-node.fragment { fill: #1a1a1a; stroke: #ff9f43; }\n            .flowchart-node.common { fill: #1a1a1a; stroke: #ff6b6b; }\n            .flowchart-label { font-family: Arial, sans-serif; fill: #ffffff; text-anchor: middle; dominant-baseline: middle; }\n            .flowchart-line-number { font-family: monospace; fill: #666666; text-anchor: middle; }\n            .flowchart-arrow { stroke: #666666; stroke-width: 2px; fill: none; }\n        ",t.insertBefore(o,t.firstChild);const i=t.querySelector("defs");if(i){const e=i.querySelector("#flowchart-arrow-marker path");e&&e.setAttribute("fill","#666666")}const a=e.getBoundingClientRect();t.setAttribute("width",a.width),t.setAttribute("height",a.height);const r=(new XMLSerializer).serializeToString(t),s=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),l=document.createElement("canvas"),c=l.getContext("2d"),d=new Image;l.width=2*a.width,l.height=2*a.height,d.onload=function(){c.fillStyle="#ffffff",c.fillRect(0,0,l.width,l.height),c.scale(2,2),c.drawImage(d,0,0),l.toBlob((function(e){if(e){const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="glsl-flowchart.png",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}}),"image/png"),URL.revokeObjectURL(d.src)},d.onerror=function(){console.error("Failed to load SVG for PNG conversion"),alert("Failed to export PNG. Try the SVG export instead."),URL.revokeObjectURL(d.src)};const u=URL.createObjectURL(s);d.src=u},exportJSON:function(){if(!e)return void alert("Please generate a flowchart first");const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download="glsl-flowchart.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)},exportTXT:function(){if(!e)return void alert("Please generate a flowchart first");let t="GLSL Shader Flowchart Analysis\n";t+=`Generated: ${e.timestamp}\n\n`,t+="=== VERTEX SHADER STAGES ===\n",e.vertexStages.forEach(((e,n)=>{t+=`\n${n+1}. ${e.name} (${e.type})\n`,t+=`   Priority: ${e.priority}\n`,t+="   Found on lines:\n",e.matches.forEach((e=>{t+=`     Line ${e.lineNumber}: ${e.lineContent}\n`}))})),t+="\n=== FRAGMENT SHADER STAGES ===\n",e.fragmentStages.forEach(((e,n)=>{t+=`\n${n+1}. ${e.name} (${e.type})\n`,t+=`   Priority: ${e.priority}\n`,t+="   Found on lines:\n",e.matches.forEach((e=>{t+=`     Line ${e.lineNumber}: ${e.lineContent}\n`}))})),t+="\n=== ORIGINAL CODE ===\n\n",t+=`--- Vertex Shader ---\n${e.vertexCode}\n\n`,t+=`--- Fragment Shader ---\n${e.fragmentCode}\n`;const n=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download="glsl-flowchart.txt",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)},toggleExport:function(){document.getElementById("exportDropdown").classList.toggle("show")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{d(),u()})):(d(),u(),document.addEventListener("fullscreenchange",(()=>{const e=document.getElementById("flowchartOverlay"),t=document.getElementById("flowchartWindow");document.fullscreenElement?(document.fullscreenElement.appendChild(e),document.fullscreenElement.appendChild(t)):(document.body.appendChild(e),document.body.appendChild(t))})))}();class g{constructor(){this.initialized=!1,this.contexts=[{type:"public",tabId:"tabPublic",listId:"publicShaderList",inputId:"publicSearchInput",clearBtnId:"publicClearBtn",placeholder:"Search public shaders..."},{type:"local",tabId:"tabLocal",listId:"localShaderList",inputId:"localSearchInput",clearBtnId:"localClearBtn",placeholder:"Search local shaders..."}],this.Inputs()}Inputs(){this.initialized||(this.initialized=!0,this.contexts.forEach((e=>{const t=document.getElementById(e.tabId);if(!t)return;if(t.querySelector(".search-container"))return;const n=t.querySelector("h3");if(!n)return;const o=document.createElement("div");o.className="search-container",o.innerHTML=`\n        <input type="text"\n               id="${e.inputId}"\n               placeholder="${e.placeholder}"\n               class="search-input">\n        <button id="${e.clearBtnId}" class="clear-btn" style="display:none;"></button>\n      `,n.insertAdjacentElement("afterend",o)})),this.EventListeners(),this.setupTabObserver())}EventListeners(){this.contexts.forEach((e=>{const t=document.getElementById(e.inputId),n=document.getElementById(e.clearBtnId);t&&t.addEventListener("input",(t=>{const o=t.target.value;this.Search(o,e.type),this.Clear(o,n)})),n&&t&&n.addEventListener("click",(()=>{t.value="",this.Search("",e.type),this.Clear("",n),t.focus()}))}))}Clear(e,t){t&&(t.style.display=e&&e.length>0?"inline-block":"none")}Search(e,t){const n=e.toLowerCase().trim(),o=this.contexts.find((e=>e.type===t));if(!o)return;const i=document.getElementById(o.listId);if(!i)return;const a=i.querySelectorAll(".shader-card");let r=0;a.forEach((e=>{const t=this.getTitle(e),o=this.getAuthor(e);""===n||t.toLowerCase().includes(n)||o.toLowerCase().includes(n)?(e.style.display="",r++):e.style.display="none"})),this.NoResults(i,0===r&&""!==n,t)}getTitle(e){const t=e.querySelector("strong");return t&&(t.textContent||t.innerText)||""}getAuthor(e){const t=e.querySelector(".shader-author");if(!t)return"";return(t.textContent||t.innerText||"").replace(/^by\s+/i,"")}NoResults(e,t,n){const o=e.querySelector(".no-results-message");if(t&&!o){const t=document.createElement("div");t.className="no-results-message",t.innerHTML=`<p>No ${n} shaders found matching your search.</p>`,e.appendChild(t)}else!t&&o&&o.remove()}refresh(){this.contexts.forEach((e=>{const t=document.getElementById(e.inputId);t&&t.value&&this.Search(t.value,e.type)}))}clear(){this.contexts.forEach((e=>{const t=document.getElementById(e.inputId),n=document.getElementById(e.clearBtnId);t&&(t.value="",this.Search("",e.type),this.Clear("",n))}))}setupTabObserver(){const e=new MutationObserver((e=>{e.forEach((e=>{if("attributes"===e.type&&"style"===e.attributeName){const t=e.target;if("block"===t.style.display||""===t.style.display){const e=this.contexts.find((e=>e.tabId===t.id));e&&setTimeout((()=>{this.refreshTabIfNeeded(e.type)}),10)}}}))}));this.contexts.forEach((t=>{const n=document.getElementById(t.tabId);n&&e.observe(n,{attributes:!0,attributeFilter:["style"]})}))}refreshTabIfNeeded(e){const t=this.contexts.find((t=>t.type===e));if(!t)return;const n=document.getElementById(t.inputId),o=document.getElementById(t.clearBtnId);n&&n.value&&(this.Search(n.value,t.type),this.Clear(n.value,o))}}function v(){window.shaderSearch||(window.shaderSearch=new g)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",v):v(),function(){const e=[{row:1,keys:[{key:"Esc",width:"4em",id:"escape"},{key:"F1",width:"3em"},{key:"F2",width:"3em"},{key:"F3",width:"3em"},{key:"F4",width:"3em"},{key:"F5",width:"3em"},{key:"F6",width:"3em"},{key:"F7",width:"3em"},{key:"F8",width:"3em"},{key:"F9",width:"3em"},{key:"F10",width:"3em"},{key:"F11",width:"3em"},{key:"F12",width:"3em"}]},{row:2,keys:[{key:"`",width:"3em"},{key:"1",width:"3em"},{key:"2",width:"3em"},{key:"3",width:"3em"},{key:"4",width:"3em"},{key:"5",width:"3em"},{key:"6",width:"3em"},{key:"7",width:"3em"},{key:"8",width:"3em"},{key:"9",width:"3em"},{key:"0",width:"3em"},{key:"-",width:"3em"},{key:"=",width:"3em"},{key:"Backspace",width:"6em"}]},{row:3,keys:[{key:"Tab",width:"4.5em"},{key:"Q",width:"3em"},{key:"W",width:"3em"},{key:"E",width:"3em"},{key:"R",width:"3em"},{key:"T",width:"3em"},{key:"Y",width:"3em"},{key:"U",width:"3em"},{key:"I",width:"3em"},{key:"O",width:"3em"},{key:"P",width:"3em",id:"p"},{key:"[",width:"3em"},{key:"]",width:"3em"},{key:"\\",width:"4.5em"}]},{row:4,keys:[{key:"Caps",width:"5.25em"},{key:"A",width:"3em"},{key:"S",width:"3em"},{key:"D",width:"3em"},{key:"F",width:"3em",id:"f"},{key:"G",width:"3em"},{key:"H",width:"3em"},{key:"J",width:"3em"},{key:"K",width:"3em"},{key:"L",width:"3em"},{key:";",width:"3em"},{key:"'",width:"3em"},{key:"Enter",width:"6.75em"}]},{row:5,keys:[{key:"Shift",width:"7em",class:"modifier",id:"shift"},{key:"Z",width:"3em"},{key:"X",width:"3em"},{key:"C",width:"3em"},{key:"V",width:"3em",id:"v"},{key:"B",width:"3em"},{key:"N",width:"3em"},{key:"M",width:"3em",id:"m"},{key:",",width:"3em"},{key:".",width:"3em"},{key:"/",width:"3em"},{key:"Shift",width:"7em",class:"modifier",id:"shift-right"}]},{row:6,keys:[{key:"Ctrl",width:"4em",class:"modifier",id:"ctrl"},{key:"Win",width:"3em",class:"modifier"},{key:"Alt",width:"3em",class:"modifier",id:"alt"},{key:"Space",width:"18em"},{key:"Alt",width:"3em",class:"modifier",id:"alt-right"},{key:"Menu",width:"3em",class:"modifier"},{key:"Ctrl",width:"4em",class:"modifier",id:"ctrl-right"},{key:"",width:"3em",id:"arrow-left"},{key:"UD",width:"3em",id:"arrow-stack",isStack:!0},{key:"",width:"3em",id:"arrow-right"}]}],t=[{desc:"Close any modal (hold to exit fullscreen)",keys:"Esc",highlight:["escape"],id:"close"},{desc:"Fullscreen/Open + Close Editor panel",keys:"Control + F",highlight:["ctrl","s"],id:"Open"},{desc:"Enable / Disable Window Focus",keys:"Control + P",highlight:["ctrl","p"],id:"focus"},{desc:"Performance mode (hide buttons)",keys:"Control + Shift + D",highlight:["ctrl","shift","d"],id:"performance"},{desc:"Switch between local shaders",keys:"L + Arrow Keys",highlight:["l","arrow-right","arrow-left"],id:"local-shaders"},{desc:"Switch between public shaders",keys:"P + Arrow Keys",highlight:["p","arrow-right","arrow-left"],id:"public-shaders"},{desc:"Format/minify code",keys:"Option + M",highlight:["alt","m"],id:"format"},{desc:"Visualize code with flowchart modal",keys:"Option + V",highlight:["alt","v"],id:"visualize"}];window.userLoggedIn&&t.push({desc:"Find code snippets",keys:"Control + S",highlight:["ctrl","s"],id:"find"}),window.KeyboardShortcuts={modal:null,isOpen:!1,currentHighlight:null,resizeTimeout:null,calculateKeyboardSize:function(){const e=this.modal,t=document.getElementById("keyboard");if(!e||!t)return;const n=window.innerWidth,o=(e.querySelector(".keyboard-container"),n<=480?20:60),i=(Math.min(.95*n,1200)-o)/900;let a=Math.min(i,1);n<=480?a=Math.max(a,.55):n<=600?a=Math.max(a,.65):n<=800&&(a=Math.max(a,.75)),a=Math.max(a,.45),t.style.transform=`scale(${a})`;t.querySelectorAll(".key").forEach((e=>{a<.6?(e.style.fontSize="9px",e.style.minHeight="24px"):a<.8?(e.style.fontSize="10px",e.style.minHeight="28px"):(e.style.fontSize="11px",e.style.minHeight="32px")}));t.querySelectorAll(".key.half-height").forEach((e=>{e.style.fontSize=a<.6?"8px":"9px"}))},init:function(){document.body.insertAdjacentHTML("beforeend",`\n        <div class="shortcut-modal" id="shortcut-modal">\n            <div class="shortcut">\n                <button class="close-btn" onclick="KeyboardShortcuts.close()">&times;</button>\n                <div class="shortcut-header">\n                    <h2 class="shortcut-title">Keyboard Shortcuts</h2>\n                </div>\n                <div class="shortcut-content">\n                    <div class="commands-list-container">\n                        <div class="commands-list" id="commands-list">\n                            ${t.map((e=>`\n                                <div class="command-item" data-shortcut="${e.id}">\n                                    <span class="command-desc">${e.desc}</span>\n                                    <span class="command-keys">${e.keys}</span>\n                                </div>\n                            `)).join("")}\n                        </div>\n                    </div>\n                    <div class="keyboard-container">\n                        <div class="keyboard" id="keyboard">\n                            ${e.map((e=>`\n                            <div class="keyboard-row" style="grid-template-columns: repeat(${e.keys.length}, auto);">\n                                ${e.keys.map((e=>e.isStack?`\n                                            <div class="arrow-stack" style="width: ${e.width};">\n                                                <div class="key half-height" data-key="arrow-up" id="key-arrow-up"></div>\n                                                <div class="key half-height" data-key="arrow-down" id="key-arrow-down"></div>\n                                            </div>\n                                        `:`\n                                            <div class="key ${e.class||""}" \n                                                style="width: ${e.width};" \n                                                data-key="${e.id||e.key.toLowerCase()}"\n                                                id="key-${e.id||e.key.toLowerCase()}">\n                                                ${e.key}\n                                            </div>\n                                        `)).join("")}\n                            </div>\n                        `)).join("")}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `),this.modal=document.getElementById("shortcut-modal"),this.bindEvents(),window.addEventListener("resize",(()=>{this.isOpen&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.calculateKeyboardSize()}),100))}))},bindEvents:function(){document.querySelectorAll(".command-item").forEach((e=>{e.addEventListener("mouseenter",(e=>{const n=e.target.dataset.shortcut,o=t.find((e=>e.id===n));o&&(this.highlightKeys(o.highlight),e.target.classList.add("active"))})),e.addEventListener("mouseleave",(e=>{this.clearHighlight(),e.target.classList.remove("active")}))})),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.close()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isOpen&&this.close()}))},highlightKeys:function(e){this.clearHighlight(),this.currentHighlight=e,e.forEach((e=>{let t=document.getElementById(`key-${e}`);if(!t)switch(e){case"alt":t=document.getElementById("key-alt")||document.getElementById("key-alt-right");break;case"ctrl":t=document.getElementById("key-ctrl")||document.getElementById("key-ctrl-right");break;case"shift":t=document.getElementById("key-shift")||document.getElementById("key-shift-right")}t&&t.classList.add("highlight")}))},clearHighlight:function(){this.currentHighlight&&(this.currentHighlight.forEach((e=>{document.querySelectorAll(`[data-key="${e}"], #key-${e}`).forEach((e=>e.classList.remove("highlight")))})),document.querySelectorAll(".key.highlight").forEach((e=>{e.classList.remove("highlight")})),this.currentHighlight=null)},open:function(){(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.body).appendChild(this.modal),this.modal.classList.add("show"),this.isOpen=!0,setTimeout((()=>this.calculateKeyboardSize()),50)},close:function(){this.modal.classList.remove("show"),this.isOpen=!1,this.clearHighlight()}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{KeyboardShortcuts.init()})):KeyboardShortcuts.init()}(),function(){let e=!1,t=new Map,n=new Map;function o(){["#editors","#divider","#fsBtn","#lint",".lbtn","#shaderWindow"].forEach((e=>{document.querySelectorAll(e).forEach((e=>{t.set(e,e.style.display),e.classList.add("performance-mode-hidden")}))}));const o=document.getElementById("glcanvas"),i=document.getElementById("preview-panel"),a=document.getElementById("app");o&&i&&a&&(t.set("canvas",{width:o.style.width,height:o.style.height,position:o.style.position,top:o.style.top,left:o.style.left,zIndex:o.style.zIndex}),t.set("previewPanel",{width:i.style.width,height:i.style.height,position:i.style.position,top:i.style.top,left:i.style.left,zIndex:i.style.zIndex}),t.set("app",{overflow:a.style.overflow}),n.set(o,o.className),n.set(i,i.className),n.set(a,a.className),n.set(document.body,document.body.className),o.classList.add("performance-mode-canvas"),i.classList.add("performance-mode-preview"),a.classList.add("performance-mode-app"),document.body.classList.add("performance-mode-body"),o.width=window.innerWidth,o.height=window.innerHeight,window.dispatchEvent(new Event("resize"))),e=!0}function i(){t.forEach(((e,t)=>{"string"!=typeof t&&(t.classList.remove("performance-mode-hidden"),t.style.display=e)}));const o=document.getElementById("glcanvas"),i=document.getElementById("preview-panel"),a=document.getElementById("app");if(o&&n.has(o)&&(o.className=n.get(o)),i&&n.has(i)&&(i.className=n.get(i)),a&&n.has(a)&&(a.className=n.get(a)),n.has(document.body)&&(document.body.className=n.get(document.body)),o&&t.has("canvas")){const e=t.get("canvas");Object.assign(o.style,e)}if(i&&t.has("previewPanel")){const e=t.get("previewPanel");Object.assign(i.style,e)}a&&t.has("app")&&(a.style.overflow=t.get("app").overflow),window.dispatchEvent(new Event("resize")),e=!1}function a(){e?i():o()}document.addEventListener("keydown",(function(t){("F11"===t.key||t.ctrlKey&&t.shiftKey&&"D"===t.key)&&(t.preventDefault(),a()),"Escape"===t.key&&e&&i()})),window.addEventListener("resize",(function(){if(e){const e=document.getElementById("glcanvas");e&&(e.width=window.innerWidth,e.height=window.innerHeight)}})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("glcanvas");e&&e.addEventListener("dblclick",(function(e){e.preventDefault(),a()}))})),window.webglPerformanceMode={enter:o,exit:i,toggle:a,isActive:function(){return e}}}(),(()=>{let e=0,t=0,n=[],o=[];const i=new Set,a={lastLoad:0,loadTimes:[],maxPerSecond:1,maxPer30Seconds:10,window30s:3e4,minInterval:1e3};function r(){n=function(){const e=[],t=document.getElementById("publicShaderList");return t?(t.querySelectorAll("[data-public-token]").forEach((t=>{const n=t.getAttribute("data-public-token"),o=t.closest("div");if(o&&n){const t=o.querySelector("strong"),i=t?t.textContent:"Unknown",a=o.querySelector('span[style*="color"]'),r=a?a.textContent.replace("by ",""):"Unknown";e.push({token:n,title:i,user:r})}})),e):e}(),o=function(){const e=[],t=document.getElementById("localShaderList");return t?(t.querySelectorAll("[data-local-index]").forEach((t=>{const n=parseInt(t.getAttribute("data-local-index")),o=t.closest("div");if(o&&!isNaN(n)){const t=o.querySelector("strong"),i=t?t.textContent:"Unknown";e.push({index:n,title:i})}})),e):e}(),e>=n.length&&(e=Math.max(0,n.length-1)),t>=o.length&&(t=Math.max(0,o.length-1))}function s(){const e=Date.now(),t=a;if(e-t.lastLoad<t.minInterval){Math.ceil((t.minInterval-(e-t.lastLoad))/1e3);return{allowed:!1,message:"Slow down!"}}if(t.loadTimes=t.loadTimes.filter((n=>e-n<t.window30s)),t.loadTimes.length>=t.maxPer30Seconds){const n=Math.min(...t.loadTimes),o=Math.ceil((t.window30s-(e-n))/1e3);return{allowed:!1,message:`Rate limit exceeded! You can only load ${t.maxPer30Seconds} public shaders per 30 seconds. Please wait ${o} second${o>1?"s":""}.`}}return{allowed:!0}}function l(e){if(e<0||e>=n.length)return!1;const t=s();if(!t.allowed)return c(t.message,"error"),!1;const o=n[e],i=document.getElementById("publicShaderList");if(!i)return!1;const r=i.querySelector(`[data-public-token="${o.token}"]`);return!!r&&(r.click(),function(){const e=Date.now();a.lastLoad=e,a.loadTimes.push(e)}(),!0)}function c(e,t="info"){"function"!=typeof window.showToast?console.log(`[${t.toUpperCase()}] ${e}`):window.showToast(e,t)}function d(t){if(r(),0===n.length)return void c("No public shaders available","warning");e="next"===t?(e+1)%n.length:(e-1+n.length)%n.length;n[e];l(e)}function u(e){if(r(),0===o.length)return void c("No local shaders available","warning");t="next"===e?(t+1)%o.length:(t-1+o.length)%o.length;o[t];!function(e){if(e<0||e>=o.length)return!1;const t=o[e],n=document.getElementById("localShaderList");if(!n)return!1;const i=n.querySelector(`[data-local-index="${t.index}"]`);!!i&&i.click()}(t)}function m(e){const t=e.key.toLowerCase();i.add(t),i.has("p")&&("ArrowRight"===e.key?(e.preventDefault(),d("next")):"ArrowLeft"===e.key&&(e.preventDefault(),d("prev"))),i.has("l")&&("ArrowRight"===e.key?(e.preventDefault(),u("next")):"ArrowLeft"===e.key&&(e.preventDefault(),u("prev")))}function h(e){const t=e.key.toLowerCase();i.delete(t)}async function p(){await new Promise((e=>{const t=setInterval((()=>{document.getElementById("shaderWindow")&&(clearInterval(t),e())}),100)})),setTimeout((()=>{document.addEventListener("keydown",m),document.addEventListener("keyup",h),window.addEventListener("blur",(()=>{i.clear()})),r()}),500)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p(),window.shaderKeyboardNav={updateShaderLists:r,navigatePublicShaders:d,navigateLocalShaders:u,getStatus:()=>({publicShaders:n.length,localShaders:o.length,publicIndex:e,localIndex:t,publicList:n,localList:o,rateLimitStatus:{lastLoad:a.lastLoad,recentLoads:a.loadTimes.length,canLoadNow:s().allowed}})}})();new MutationObserver(((e,t)=>{document.getElementById("preview-panel")&&(t.disconnect(),(()=>{function e(){const e=document.getElementById("preview-panel");e.style.position="relative";const t=document.getElementById("glcanvas"),n=document.createElement("canvas");n.id="canvas3D",n.style.display="none",e.appendChild(n);const o=document.createElement("button");o.id="threeLoadBtn",o.textContent="3D",e.appendChild(o);const i=document.createElement("div");i.id="threedModalBg";const a=document.createElement("div");a.id="threedModal",a.innerHTML='\n      <h2>Load 3D Model</h2>\n      <div id="threedDropZone">\n        <p>Drag and drop a 3D model file here<br>or click to browse</p>\n        <div class="format-info">Supports: OBJ, PLY, STL, OFF</div>\n        <input type="file" id="objFileInput" accept=".obj,.ply,.stl,.off" hidden />\n      </div>\n      <div style="margin:10px 0; display:flex; gap:10px;">\n        <label class="checkbox-container">\n          <input type="checkbox" id="objCull" checked />\n          <span class="custom-checkbox"></span>\n          <span style="margin-left:5px;">Face Culling</span>\n        </label>\n        <label class="checkbox-container">\n          <input type="checkbox" id="objWire" />\n          <span class="custom-checkbox"></span>\n          <span style="margin-left:5px;">Wireframe</span>\n        </label>\n      </div>\n      <div id="threedInfo">No model loaded</div>\n      <div id="threedErr"></div>\n      <footer>\n        <button id="threedRevert">Revert Shaders</button>\n        <button id="threedClose">Cancel</button>\n      </footer>\n    ',i.appendChild(a),e.appendChild(i),o.onclick=()=>i.classList.add("show"),a.querySelector("#threedClose").onclick=()=>i.classList.remove("show");const r=a.querySelector("#threedDropZone"),s=a.querySelector("#objFileInput");return r.addEventListener("click",(()=>s.click())),r.addEventListener("dragover",(e=>{e.preventDefault(),r.classList.add("dragover")})),r.addEventListener("dragleave",(e=>{e.preventDefault(),r.classList.remove("dragover")})),r.addEventListener("drop",(e=>{e.preventDefault(),r.classList.remove("dragover"),e.dataTransfer.files.length&&(s.files=e.dataTransfer.files,s.dispatchEvent(new Event("change")))})),{canvas:n,originalCanvas:t,fileInput:s,cullChk:a.querySelector("#objCull"),wireChk:a.querySelector("#objWire"),info:a.querySelector("#threedInfo"),err:a.querySelector("#threedErr"),revertBtn:a.querySelector("#threedRevert"),hide:()=>i.classList.remove("show")}}let t={vertex:"",fragment:""};const n={vertex:"attribute vec3 a_position, a_normal;\nuniform mat4 u_modelMatrix, u_viewMatrix, u_projectionMatrix;\nuniform mat3 u_normalMatrix;\nvarying vec3 v_normal, v_position;\nvoid main() {\n  vec4 worldPosition = u_modelMatrix * vec4(a_position, 1.0);\n  v_position = worldPosition.xyz;\n  v_normal = normalize(u_normalMatrix * a_normal);\n  gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;\n}",fragment:"precision mediump float;\nvarying vec3 v_normal, v_position;\nuniform vec3 u_lightPosition, u_viewPosition;\nuniform bool u_wireframe;\nuniform float u_time;\nvoid main() {\n  vec3 normal = normalize(v_normal);\n  vec3 lightDir = normalize(u_lightPosition - v_position);\n  vec3 viewDir = normalize(u_viewPosition - v_position);\n  vec3 reflectDir = reflect(-lightDir, normal);\n  float ambient = 0.3;\n  float diffuse = max(dot(normal, lightDir), 0.0);\n  float specular = pow(max(dot(viewDir, reflectDir), 0.0), 32.0) * 0.5;\n  vec3 base = u_wireframe ? vec3(0.0, 1.0, 0.0) : vec3(0.7, 0.8, 1.0);\n  vec3 timeColor = vec3(\n    0.5 + 0.5 * sin(u_time * 0.8),\n    0.5 + 0.5 * sin(u_time * 1.2 + 2.0),\n    0.5 + 0.5 * sin(u_time * 0.6 + 4.0)\n  );\n  vec3 color = u_wireframe \n    ? base \n    : mix(base, timeColor * 0.3 + base, 0.3) * (ambient + diffuse) + vec3(1.0) * specular;\n  gl_FragColor = vec4(color, 1.0);\n}"};function o(){const e=document.getElementById("vertCode"),n=document.getElementById("fragCode");e&&n&&(t.vertex=e.value,t.fragment=n.value)}function i(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&(e.value=n.vertex,t.value=n.fragment,window.rebuildProgram&&window.rebuildProgram())}function a(){const e=document.getElementById("vertCode"),n=document.getElementById("fragCode");e&&n&&t.vertex&&t.fragment&&(e.value=t.vertex,n.value=t.fragment,window.rebuildProgram&&window.rebuildProgram())}const r={identity:()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],perspective:(e,t,n,o)=>{const i=1/Math.tan(e/2),a=1/(n-o);return[i/t,0,0,0,0,i,0,0,0,0,(o+n)*a,-1,0,0,2*o*n*a,0]},lookAt:(e,t,n)=>{const o=s.normalize(s.sub(t,e)),i=s.normalize(s.cross(o,n)),a=s.cross(i,o);return[i[0],a[0],-o[0],0,i[1],a[1],-o[1],0,i[2],a[2],-o[2],0,-s.dot(i,e),-s.dot(a,e),s.dot(o,e),1]},rotateX:e=>{const t=Math.cos(e),n=Math.sin(e);return[1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1]},rotateY:e=>{const t=Math.cos(e),n=Math.sin(e);return[t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1]},scale:(e,t=e,n=e)=>[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1],multiply:(e,t)=>{const n=new Array(16).fill(0);for(let o=0;o<4;o++)for(let i=0;i<4;i++)for(let a=0;a<4;a++)n[4*o+i]+=e[4*o+a]*t[4*a+i];return n}},s={normalize:e=>{const t=Math.hypot(e[0],e[1],e[2]);return t>1e-5?[e[0]/t,e[1]/t,e[2]/t]:[0,0,1]},sub:(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],cross:(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]};function l(e,t,n=!0){return e.getFloat32(t,n)}function c(e,t,n=!0){return e.getUint32(t,n)}function d(e,t){return e.getUint8(t)}function u(e){const t=[],n=[],o=[];return e.split(/\r?\n/).forEach((e=>{const i=e.trim().split(/\s+/);if("v"===i[0]&&t.push(i.slice(1).map(Number)),"vn"===i[0]&&n.push(i.slice(1).map(Number)),"f"===i[0]){const e=i.slice(1).map((e=>{const[t,,n]=e.split("/");return{v:+t-1,n:n?+n-1:-1}}));e.length>=3&&o.push(e)}})),g(t,n,o,"OBJ")}function m(e){const t="string"==typeof e;let n,o,i=0,a=0,r="ascii";t?(n=e.split(/\r?\n/),o=n.findIndex((e=>"end_header"===e.trim()))):(n=(new TextDecoder).decode(e.slice(0,1e3)).split(/\r?\n/),o=n.findIndex((e=>"end_header"===e.trim())));for(let e=0;e<=o;e++){const t=n[e].trim();t.startsWith("format")?r=t.includes("binary")?"binary":"ascii":t.startsWith("element vertex")?i=parseInt(t.split(" ")[2]):t.startsWith("element face")&&(a=parseInt(t.split(" ")[2]))}const s=[],u=[];if("ascii"===r&&t){let e=o+1;for(let t=0;t<i;t++){const t=n[e++].trim().split(/\s+/).map(Number);s.push([t[0],t[1],t[2]])}for(let t=0;t<a;t++){const t=n[e++].trim().split(/\s+/).map(Number),o=t[0],i=[];for(let e=1;e<=o;e++)i.push({v:t[e],n:-1});i.length>=3&&u.push(i)}}else if("binary"===r&&!t){const t=(new TextEncoder).encode(n.slice(0,o+1).join("\n")+"\n").length,r=new DataView(e.buffer||e);let m=t;for(let e=0;e<i;e++){const e=l(r,m),t=l(r,m+4),n=l(r,m+8);s.push([e,t,n]),m+=12}for(let e=0;e<a;e++){const e=d(r,m++),t=[];for(let n=0;n<e;n++)t.push({v:c(r,m),n:-1}),m+=4;t.length>=3&&u.push(t)}}return g(s,[],u,"PLY")}function h(e){const t="string"==typeof e,n=[],o=[];let i=new Map,a=0;function r(e,t,o){const r=`${e.toFixed(6)},${t.toFixed(6)},${o.toFixed(6)}`;return i.has(r)?i.get(r):(i.set(r,a),n.push([e,t,o]),a++)}if(t){const t=e.split(/\r?\n/);let n=[];for(const e of t){const t=e.trim();if(t.startsWith("vertex")){const e=t.split(/\s+/).slice(1).map(Number),i=r(e[0],e[1],e[2]);n.push({v:i,n:-1}),3===n.length&&(o.push([...n]),n=[])}}}else{const t=new DataView(e.buffer||e),n=c(t,80);let i=84;for(let e=0;e<n;e++){i+=12;const e=[];for(let n=0;n<3;n++){const n=r(l(t,i),l(t,i+4),l(t,i+8));e.push({v:n,n:-1}),i+=12}o.push(e),i+=2}}return g(n,[],o,"STL")}function p(e){const t=e.split(/\r?\n/).filter((e=>e.trim()&&!e.trim().startsWith("#")));let n=0;"OFF"===t[n].trim()&&n++;const o=t[n++].trim().split(/\s+/).map(Number),i=o[0],a=o[1],r=[],s=[];for(let e=0;e<i;e++){const e=t[n++].trim().split(/\s+/).map(Number);r.push([e[0],e[1],e[2]])}for(let e=0;e<a;e++){const e=t[n++].trim().split(/\s+/).map(Number),o=e[0],i=[];for(let t=1;t<=o;t++)i.push({v:e[t],n:-1});i.length>=3&&s.push(i)}return g(r,[],s,"OFF")}function g(e,t,n,o){const i=[],a=[],r=[];let l=0;n.forEach((n=>{for(let o=1;o<n.length-1;o++)[n[0],n[o],n[o+1]].forEach((c=>{const d=e[c.v],u=c.n>=0&&t[c.n]?t[c.n]:(()=>{const t=e[n[0].v],i=e[n[o].v],a=e[n[o+1].v];return s.normalize(s.cross(s.sub(i,t),s.sub(a,t)))})();i.push(...d),a.push(...u),r.push(l++)}))}));const c=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(let e=0;e<i.length;e+=3)c[0]=Math.min(c[0],i[e]),c[1]=Math.min(c[1],i[e+1]),c[2]=Math.min(c[2],i[e+2]),d[0]=Math.max(d[0],i[e]),d[1]=Math.max(d[1],i[e+1]),d[2]=Math.max(d[2],i[e+2]);const u=[(c[0]+d[0])/2,(c[1]+d[1])/2,(c[2]+d[2])/2],m=2/Math.max(d[0]-c[0],d[1]-c[1],d[2]-c[2]);for(let e=0;e<i.length;e+=3)i[e]=(i[e]-u[0])*m,i[e+1]=(i[e+1]-u[1])*m,i[e+2]=(i[e+2]-u[2])*m;return{verts:i,norms:a,idxs:r,stats:{vertices:e.length,faces:n.length,triangles:r.length/3,format:o}}}function v(e,t){const n=e.name.toLowerCase().split(".").pop();try{switch(n){case"obj":return u(t);case"ply":return m(t);case"stl":return h(t);case"off":return p(t);default:throw new Error(`Unsupported format: ${n}`)}}catch(e){throw new Error(`Failed to parse ${n.toUpperCase()} file: ${e.message}`)}}function f(e){const t=e.getContext("webgl");if(!t)throw new Error("WebGL unavailable");let n=null;const o={},i=(e,n)=>{const o=t.createShader(e);if(t.shaderSource(o,n),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(o));return o},a=()=>{const e=document.getElementById("vertCode"),a=document.getElementById("fragCode");if(!e||!a)return!1;try{if(n&&t.deleteProgram(n),n=t.createProgram(),t.attachShader(n,i(t.VERTEX_SHADER,e.value)),t.attachShader(n,i(t.FRAGMENT_SHADER,a.value)),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(n));return t.useProgram(n),o.attrPos=t.getAttribLocation(n,"a_position"),o.attrNorm=t.getAttribLocation(n,"a_normal"),o.uniM=t.getUniformLocation(n,"u_modelMatrix"),o.uniV=t.getUniformLocation(n,"u_viewMatrix"),o.uniP=t.getUniformLocation(n,"u_projectionMatrix"),o.uniN=t.getUniformLocation(n,"u_normalMatrix"),o.uniL=t.getUniformLocation(n,"u_lightPosition"),o.uniU=t.getUniformLocation(n,"u_viewPosition"),o.uniW=t.getUniformLocation(n,"u_wireframe"),o.uniTime=t.getUniformLocation(n,"u_time"),!0}catch(e){return console.error("Shader compilation error:",e.message),!1}};return a(),{gl:t,updateProgram:a,getLocations:()=>o}}function y(e){e.originalCanvas&&(e.originalCanvas.style.display="none"),e.canvas.style.display="block",window.objCanvasActive=!0}function w(e){e.canvas.style.display="none",e.originalCanvas&&(e.originalCanvas.style.display="block"),window.objCanvasActive=!1}const b=e();let E=null,x=null;const C={drag:!1,last:[0,0],rot:[0,0],zoom:1};let S=performance.now();o(),b.revertBtn.addEventListener("click",(()=>{a(),w(b),x&&(x=null),E=null,b.fileInput.value="",b.info.textContent="Reverted to original shaders",b.hide()}));const L=document.getElementById("vertCode"),k=document.getElementById("fragCode");function T(){const e=b.canvas;e.style.width="100%",e.style.height="100%",e.width=e.clientWidth,e.height=e.clientHeight,x=f(e);const t=x.gl;x.bV=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,x.bV),t.bufferData(t.ARRAY_BUFFER,new Float32Array(E.verts),t.STATIC_DRAW),x.bN=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,x.bN),t.bufferData(t.ARRAY_BUFFER,new Float32Array(E.norms),t.STATIC_DRAW);const n=t.getExtension("OES_element_index_uint")&&E.idxs.length>65535,o=n?new Uint32Array(E.idxs):new Uint16Array(E.idxs);x.bI=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,x.bI),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW),E.indexType=n?t.UNSIGNED_INT:t.UNSIGNED_SHORT,E.indexCount=o.length,t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),e.addEventListener("mousedown",(e=>{C.drag=!0,C.last=[e.clientX,e.clientY]})),window.addEventListener("mousemove",(e=>{C.drag&&(C.rot[0]+=.01*(e.clientY-C.last[1]),C.rot[1]+=.01*(e.clientX-C.last[0]),C.last=[e.clientX,e.clientY])})),window.addEventListener("mouseup",(()=>C.drag=!1)),e.addEventListener("wheel",(e=>{e.preventDefault(),C.zoom*=e.deltaY>0?1.1:.9,C.zoom=Math.min(Math.max(C.zoom,.1),10)})),window.addEventListener("resize",(()=>{e.width=e.clientWidth,e.height=e.clientHeight})),requestAnimationFrame(I)}function I(){if(!x||!E)return;const e=x.gl,t=x.getLocations();e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);const n=r.multiply(r.rotateY(C.rot[1]),r.multiply(r.rotateX(C.rot[0]),r.scale(C.zoom))),o=r.lookAt([0,0,3],[0,0,0],[0,1,0]),i=r.perspective(Math.PI/3,e.canvas.width/e.canvas.height,.01,1e3),a=[n[0],n[1],n[2],n[4],n[5],n[6],n[8],n[9],n[10]];t.uniM&&e.uniformMatrix4fv(t.uniM,!1,n),t.uniV&&e.uniformMatrix4fv(t.uniV,!1,o),t.uniP&&e.uniformMatrix4fv(t.uniP,!1,i),t.uniN&&e.uniformMatrix3fv(t.uniN,!1,a),t.uniL&&e.uniform3fv(t.uniL,[5,5,5]),t.uniU&&e.uniform3fv(t.uniU,[0,0,3]),t.uniW&&e.uniform1i(t.uniW,b.wireChk.checked?1:0),t.uniTime&&e.uniform1f(t.uniTime,.001*(performance.now()-S)),b.cullChk.checked?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),t.attrPos>=0&&(e.bindBuffer(e.ARRAY_BUFFER,x.bV),e.enableVertexAttribArray(t.attrPos),e.vertexAttribPointer(t.attrPos,3,e.FLOAT,!1,0,0)),t.attrNorm>=0&&(e.bindBuffer(e.ARRAY_BUFFER,x.bN),e.enableVertexAttribArray(t.attrNorm),e.vertexAttribPointer(t.attrNorm,3,e.FLOAT,!1,0,0)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,x.bI),e.drawElements(e.TRIANGLES,E.indexCount,E.indexType,0),requestAnimationFrame(I)}L&&k&&[L,k].forEach((e=>{e.addEventListener("input",(()=>{x&&x.updateProgram()}))})),b.fileInput.addEventListener("change",(e=>{const t=e.target.files[0];if(!t)return;b.err.style.display="none",b.info.textContent="Loading...";const n=t.name.toLowerCase().split(".").pop(),o=["stl","ply"].includes(n),a=new FileReader;a.onload=()=>{try{E=v(t,a.result),y(b),i(),T(),b.info.textContent=`Format: ${E.stats.format} | Verts: ${E.stats.vertices} | Faces: ${E.stats.faces} | Triangles: ${E.stats.triangles}`,b.hide()}catch(e){b.err.textContent=e.message,b.err.style.display="block",b.info.textContent="Failed to load model"}},o?a.readAsArrayBuffer(t):a.readAsText(t)}))})())})).observe(document.body,{childList:!0,subtree:!0}),function(){let e=!1,t={vertex:"",fragment:""},n=null,o=null,i=null,a=Date.now(),r={x:0,y:0,clickX:0,clickY:0,isPressed:!1,lastClickTime:0},s={bass:0,mid:0,treble:0,volume:0};window.jsCanvasState={isJSMode:()=>e,getCanvas:()=>o,getContext:()=>i,getAudioData:()=>s};function l(){if(!e&&window.webgpuState&&window.webgpuState.isWebGPUMode()){const e=document.getElementById("webgpuToggle");return e&&e.click(),void setTimeout((()=>l()),200)}const s=$("jsToggleBtn"),u=$("vertPanel"),m=$("fragPanel"),h=$("rowDivider"),p=$("glcanvas"),g=$("vertCode"),v=$("fragCode");if(e){e=!1,n&&(cancelAnimationFrame(n),n=null),s.innerHTML="JS",s.title="Switch to JavaScript Mode",s.classList.remove("active"),m.style.removeProperty("display"),h.style.removeProperty("display"),u.style.height="50%",m.style.height="50%";u.querySelector(".panel-header span").textContent="Vertex Shader",g.value=t.vertex,v.value=t.fragment,p.style.display="block",o&&(o.resizeObserver&&o.resizeObserver.disconnect(),o.remove(),o=null,i=null),window.rebuildProgram&&window.rebuildProgram(),console.log("WebGL")}else{e=!0,t.vertex=g.value,t.fragment=v.value,s.innerHTML="GL",s.title="Switch back to WebGL Mode",s.classList.add("active"),m.style.display="none",h.style.display="none",u.style.height="100%";u.querySelector(".panel-header span").textContent="JavaScript Animation",g.value="// JavaScript Canvas Animation with Audio Reactivity\n// Available variables: ctx, width, height, time, mouse, audio\n// ctx - 2D canvas context\n// width, height - canvas dimensions  \n// time - elapsed time in seconds\n// mouse - {x, y, clickX, clickY, isPressed, lastClickTime}\n// audio - {bass, mid, treble, volume} (0.0-1.0)\n// Clear with audio-reactive transparency\nctx.fillStyle = `rgba(0, 0, 0, ${0.05 + audio.volume * 0.15})`;\nctx.fillRect(0, 0, width, height);\n// Audio-reactive gradient\nconst centerX = width / 2 + Math.sin(time + audio.bass * 10) * (50 + audio.treble * 100);\nconst centerY = height / 2 + Math.cos(time * 0.7 + audio.mid * 8) * (40 + audio.bass * 80);\nconst gradient = ctx.createRadialGradient(\n    centerX, centerY, 20 + audio.volume * 80,\n    width / 2, height / 2, \n    Math.max(width, height) / 2 * (1 + audio.volume * 0.5)\n);\ngradient.addColorStop(0, `hsl(${(time * 20 + audio.bass * 180) % 360}, ${70 + audio.mid * 30}%, ${60 + audio.treble * 30}%)`);\ngradient.addColorStop(1, `hsl(${(time * 20 + 180 + audio.treble * 180) % 360}, ${50 + audio.volume * 30}%, 20%)`);\nctx.fillStyle = gradient;\nctx.fillRect(0, 0, width, height);\n// Audio-reactive particles\nconst particleCount = 8 + Math.floor(audio.volume * 12);\nfor (let i = 0; i < particleCount; i++) {\n    const angle = (time + i * 0.5 + audio.bass * 5) * (0.8 + audio.mid * 2);\n    const distance = 100 + i * 20 + audio.treble * 150;\n    const x = width / 2 + Math.cos(angle) * distance;\n    const y = height / 2 + Math.sin(angle) * distance * 0.8;\n    const radius = 20 + Math.sin(time * 2 + i + audio.volume * 10) * (10 + audio.bass * 20);\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, Math.PI * 2);\n    ctx.fillStyle = `hsla(${(time * 30 + i * 45 + audio.treble * 120) % 360}, ${80 + audio.mid * 20}%, ${70 + audio.volume * 20}%, ${0.6 + audio.volume * 0.4})`;\n    ctx.fill();\n    // Audio-reactive glow effect\n    if (audio.volume > 0.3) {\n        ctx.shadowColor = ctx.fillStyle;\n        ctx.shadowBlur = 20 + audio.volume * 30;\n        ctx.fill();\n        ctx.shadowBlur = 0;\n    }\n}\n// Mouse interaction with audio influence\nif (mouse.isPressed) {\n    const rippleTime = (Date.now() - mouse.lastClickTime) / 1000;\n    const baseRadius = rippleTime * 200;\n    const audioRadius = baseRadius * (1 + audio.volume * 2);\n    const alpha = Math.max(0, 1 - rippleTime);\n    if (alpha > 0) {\n        ctx.beginPath();\n        ctx.arc(mouse.clickX, mouse.clickY, audioRadius, 0, Math.PI * 2);\n        ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * (0.5 + audio.volume * 0.5)})`;\n        ctx.lineWidth = 3 + audio.bass * 5;\n        ctx.stroke();\n        // Secondary ripple with different frequency\n        ctx.beginPath();\n        ctx.arc(mouse.clickX, mouse.clickY, audioRadius * 0.6, 0, Math.PI * 2);\n        ctx.strokeStyle = `rgba(${255 * audio.bass}, ${255 * audio.mid}, ${255 * audio.treble}, ${alpha * 0.3})`;\n        ctx.lineWidth = 1;\n        ctx.stroke();\n    }\n}\n// Mouse cursor with audio visualization\nif (mouse.x > 0 && mouse.y > 0) {\n    const cursorRadius = 30 + Math.sin(time * 3) * 10 + audio.volume * 40;\n    ctx.beginPath();\n    ctx.arc(mouse.x, mouse.y, cursorRadius, 0, Math.PI * 2);\n    ctx.strokeStyle = `hsla(${(time * 50 + audio.bass * 180) % 360}, 100%, ${80 + audio.treble * 20}%, ${0.6 + audio.mid * 0.4})`;\n    ctx.lineWidth = 2 + audio.volume * 4;\n    ctx.stroke();\n    // Inner audio visualization\n    for (let i = 0; i < 4; i++) {\n        const audioValue = [audio.bass, audio.mid, audio.treble, audio.volume][i];\n        const angle = (time * 2 + i * Math.PI / 2) + audioValue * 10;\n        const innerRadius = 10 + audioValue * 15;\n        const innerX = mouse.x + Math.cos(angle) * innerRadius;\n        const innerY = mouse.y + Math.sin(angle) * innerRadius;\n        ctx.beginPath();\n        ctx.arc(innerX, innerY, 3 + audioValue * 5, 0, Math.PI * 2);\n        const colors = ['#ff4444', '#44ff44', '#4444ff', '#ffff44'];\n        ctx.fillStyle = colors[i];\n        ctx.fill();\n    }\n}",p.style.display="none",function(){const e=$("preview-panel");o=document.createElement("canvas"),o.id="jsCanvas",e.appendChild(o),i=o.getContext("2d"),c()}(),function(){if(!o)return;const e=e=>{const t=o.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}};o.addEventListener("mousemove",(t=>{const n=e(t);r.x=n.x,r.y=n.y})),o.addEventListener("mousedown",(t=>{const n=e(t);r.isPressed=!0,r.clickX=n.x,r.clickY=n.y,r.lastClickTime=Date.now()})),o.addEventListener("mouseup",(()=>{r.isPressed=!1})),o.addEventListener("mouseleave",(()=>{r.isPressed=!1}))}(),function(){if(!o)return;const t=new ResizeObserver((()=>{e&&c()})),n=$("preview-panel");t.observe(n),o.resizeObserver=t}(),a=Date.now(),d(),console.log("JavaScript")}}function c(){if(!o)return;const e=$("preview-panel").getBoundingClientRect(),t=e.width,n=e.height;o.width===t&&o.height===n||(o.width=t,o.height=n,r.x=0,r.y=0)}function d(){if(!e||!o||!i)return;!function(){if(window.audioReactiveInstance&&window.audioReactiveInstance.analyser&&window.audioReactiveInstance.isActive){const e=window.audioReactiveInstance.analyser,t=window.audioReactiveInstance.sensitivity,n=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(n);const o=(e,t,o,i=1)=>Math.min(1,n.slice(e,t).reduce(((e,t)=>e+t))/(t-e)/255*o*i);s={bass:o(0,20,t.bass,.4),mid:o(20,60,t.mid),treble:o(60,120,t.treble),volume:o(0,n.length,t.volume)}}else s={bass:0,mid:0,treble:0,volume:0}}();const t=$("vertCode"),l=(Date.now()-a)/1e3,u=o.width,m=o.height;0!==u&&0!==m||c();try{const e=`\n                try {\n                    ${t.value}\n                } catch (e) {\n                    ctx.fillStyle = 'var(--r)';\n                    ctx.font = '14px monospace';\n                    ctx.fillText('Error: ' + e.message, 10, 30);\n                    console.error('Animation error:', e);\n                }\n            `;new Function("ctx","width","height","time","mouse","audio",e)(i,u,m,l,r,s)}catch(e){i.fillStyle="#ff0000",i.font="14px monospace",i.fillText("Error: "+e.message,10,30),console.error("JavaScript animation error:",e)}n=requestAnimationFrame(d)}function u(){const t=()=>{if(!$("preview-panel")||!$("vertCode"))return void setTimeout(t,100);!function(){const e=document.createElement("button");e.id="jsToggleBtn",e.innerHTML="JS",e.title="JavaScript Canvas Mode",e.addEventListener("click",l);const t=$("preview-panel");t.classList.add("preview-panel-relative"),t.appendChild(e)}(),function(){let t;$("vertCode").addEventListener("input",(()=>{e&&(clearTimeout(t),t=setTimeout((()=>{console.log("JavaScript code updated")}),100))}))}();const n=new MutationObserver((()=>{if(e){const e=$("vertPanel");e&&"100%"!==e.style.height&&(e.style.height="100%")}}));setTimeout((()=>{const e=$("vertPanel");e&&n.observe(e,{attributes:!0,attributeFilter:["style"]})}),1e3)};t()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}(),function(){const e='\n<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">\n  <rect x="3" y="7" width="18" height="13" rx="2"/>\n  <path d="M8 7l1.5-2h5L16 7"/>\n  <circle cx="12" cy="13.5" r="3.5"/>\n</svg>\n';class t{constructor(){this.stream=null,this.video=null,this.texture=null,this.isActive=!1,this.devices=[],this.currentDeviceId=null,this.gl=null,this.program=null,this.originalFragCode=null,this.originalVertCode=null,this.autoInjectShader=!0,this.cameraRenderLoopId=null,this.originalRenderFn=null,this.originalRebuildFn=null,this.createUI(),this.setupEventListeners(),this.enumerateDevices()}getCameraFragmentShader(){return"#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform float u_time;\nuniform vec2 u_resolution;\nuniform sampler2D u_camera;\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / u_resolution.xy;\n    uv.x = 1.0 - uv.x;\n    uv.y = 1.0 - uv.y;\n    vec4 cameraColor = texture2D(u_camera, uv);\n    gl_FragColor = vec4(cameraColor.rgb, 1.0);\n}"}getCameraVertexShader(){return"attribute vec2 a_position;\nvoid main() {\n  gl_Position = vec4(a_position, 0., 1.);\n}"}createUI(){const t=document.getElementById("preview-panel");this.cameraBtn=document.createElement("button"),this.cameraBtn.className="camera-btn",this.cameraBtn.innerHTML=`${e}`,this.cameraBtn.title="Webcam Support",t.appendChild(this.cameraBtn),this.modal=document.createElement("div"),this.modal.className="camera-modal",this.modal.innerHTML='\n                <div class="camera-content">\n                    <div class="camera-header">\n                        <h3>Webcam Setup</h3>\n                        <button class="camera-close"></button>\n                    </div>\n                    <video class="camera-preview" id="cameraPreview" autoplay muted playsinline></video>\n                    <div class="camera-controls">\n                        <select class="camera-device-select" id="cameraDeviceSelect">\n                            <option value="">Select Camera...</option>\n                        </select>\n                        <div class="camera-auto-inject">\n                            <label>\n                                <input type="checkbox" id="autoInjectCheckbox" checked>\n                                Auto-inject camera preview shader\n                            </label>\n                        </div>\n                        <div class="camera-buttons">\n                            <button class="camera-control-btn" id="startCameraBtn">Start Camera</button>\n                            <button class="camera-control-btn stop" id="stopCameraBtn" disabled>Stop Camera</button>\n                        </div>\n                        <div class="camera-status" id="cameraStatus">Camera not active</div>\n                    </div>\n                    <div class="camera-info">\n                        <h4>Using Camera in Shaders:</h4>\n                        <p>Once enabled, use <code>uniform sampler2D u_camera;</code> to access the webcam texture in your fragment shader.</p>\n                        <p>Example: <code>vec4 camColor = texture2D(u_camera, uv);</code></p>\n                        <p><strong>Note:</strong> Camera texture coordinates are flipped horizontally by default for mirror effect.</p>\n                        <p><strong>Auto-inject:</strong> When enabled, starting the camera will temporarily replace your fragment shader with a camera preview. Stopping the camera restores your original code.</p>\n                    </div>\n                </div>\n            ',document.body.appendChild(this.modal),this.preview=document.getElementById("cameraPreview"),this.deviceSelect=document.getElementById("cameraDeviceSelect"),this.startBtn=document.getElementById("startCameraBtn"),this.stopBtn=document.getElementById("stopCameraBtn"),this.status=document.getElementById("cameraStatus"),this.closeBtn=this.modal.querySelector(".camera-close"),this.autoInjectCheckbox=document.getElementById("autoInjectCheckbox")}setupEventListeners(){this.cameraBtn.addEventListener("click",(()=>this.openModal())),this.closeBtn.addEventListener("click",(()=>this.closeModal())),this.startBtn.addEventListener("click",(()=>this.startCamera())),this.stopBtn.addEventListener("click",(()=>this.stopCamera())),this.autoInjectCheckbox.addEventListener("change",(e=>{this.autoInjectShader=e.target.checked})),this.deviceSelect.addEventListener("change",(e=>{this.currentDeviceId=e.target.value,this.isActive&&this.startCamera()})),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.closeModal()})),this.setupShaderIntegration(),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.modal.classList.contains("show")&&this.closeModal()}))}async enumerateDevices(){try{const e=await navigator.mediaDevices.enumerateDevices();this.devices=e.filter((e=>"videoinput"===e.kind)),this.deviceSelect.innerHTML='<option value="">Select Camera...</option>',this.devices.forEach((e=>{const t=document.createElement("option");t.value=e.deviceId,t.textContent=e.label||`Camera ${this.devices.indexOf(e)+1}`,this.deviceSelect.appendChild(t)})),0===this.devices.length&&(this.status.textContent="No cameras found",this.status.className="camera-error")}catch(e){console.error("Error enumerating devices:",e),this.status.textContent="Error accessing camera devices",this.status.className="camera-error"}}injectCameraShader(){const e=document.getElementById("fragCode"),t=document.getElementById("vertCode");e&&this.autoInjectShader&&(null===this.originalFragCode&&(this.originalFragCode=e.value),t&&null===this.originalVertCode&&(this.originalVertCode=t.value),e.value=this.getCameraFragmentShader(),t&&(t.value=this.getCameraVertexShader()),this.uniformWarningShown=!1,window.rebuildProgram&&(window.rebuildProgram(),setTimeout((()=>{this.isActive&&(this.createTexture(),setTimeout((()=>this.bindTexture()),100))}),100)))}restoreOriginalShader(){const e=document.getElementById("fragCode"),t=document.getElementById("vertCode");e&&null!==this.originalFragCode&&this.autoInjectShader&&(e.value=this.originalFragCode,this.originalFragCode=null),t&&null!==this.originalVertCode&&this.autoInjectShader&&(t.value=this.originalVertCode,this.originalVertCode=null),window.rebuildProgram&&window.rebuildProgram()}forceAnimationReset(){window.pauseAnimation&&"function"==typeof window.pauseAnimation&&window.pauseAnimation(),this.gl&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.flush(),this.gl.finish()),setTimeout((()=>{window.resumeAnimation&&"function"==typeof window.resumeAnimation?window.resumeAnimation():window.render&&"function"==typeof window.render&&window.render()}),150)}cancelCameraRenderLoop(){this.cameraRenderLoopId&&(cancelAnimationFrame(this.cameraRenderLoopId),this.cameraRenderLoopId=null)}async startCamera(){try{this.stream&&this.stopCamera();const t={video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}}};this.currentDeviceId&&(t.video.deviceId={exact:this.currentDeviceId}),this.stream=await navigator.mediaDevices.getUserMedia(t),this.preview.srcObject=this.stream,await new Promise(((e,t)=>{this.preview.onloadedmetadata=()=>e(),this.preview.onerror=e=>t(e)})),await this.preview.play(),this.isActive=!0,this.cameraBtn.classList.add("active"),this.cameraBtn.innerHTML=`${e}`,this.startBtn.disabled=!0,this.stopBtn.disabled=!1,this.status.textContent=`Camera active (${this.preview.videoWidth}x${this.preview.videoHeight})`,this.status.className="camera-status",this.gl||this.initGL(),this.createTexture(),this.injectCameraShader();const n=()=>{this.isActive?(this.updateTexture(),this.bindTexture(),window.render&&window.render(),this.cameraRenderLoopId=requestAnimationFrame(n)):this.cameraRenderLoopId=null};this.cameraRenderLoopId=requestAnimationFrame(n)}catch(t){console.error("Camera error:",t),this.status.textContent=`Error: ${t.message}`,this.status.className="camera-error",this.isActive=!1,this.cameraBtn.classList.remove("active"),this.cameraBtn.innerHTML=`${e}`}}stopCamera(){this.cancelCameraRenderLoop(),this.isActive=!1,this.texture&&this.gl&&(this.gl.deleteTexture(this.texture),this.texture=null),this.stream&&(this.stream.getTracks().forEach((e=>{e.stop()})),this.stream=null),this.preview&&(this.preview.srcObject=null),this.cameraBtn.classList.remove("active"),this.cameraBtn.innerHTML=`${e}`,this.startBtn.disabled=!1,this.stopBtn.disabled=!0,this.status.textContent="Camera stopped",this.status.className="camera-status",this.restoreOriginalShader(),setTimeout((()=>{this.forceAnimationReset()}),50)}openModal(){this.modal.remove(),(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.body).appendChild(this.modal),this.modal.classList.add("show"),this.devices.length||this.enumerateDevices()}closeModal(){this.modal.classList.remove("show")}createTexture(){this.gl&&this.preview&&(this.texture&&this.gl.deleteTexture(this.texture),this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR))}updateTexture(){if(this.gl&&this.texture&&this.preview&&this.isActive){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture);try{this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.preview)}catch(e){console.warn("Error updating camera texture:",e)}}}bindTexture(){if(!this.gl||!this.texture||!this.isActive)return!1;if(this.program&&window.uniforms){const e=["u_camera","uCamera","iCamera","camera"];for(const t of e)if(window.uniforms[t])return this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.uniform1i(window.uniforms[t].loc,0),!0}return!1}setupShaderIntegration(){this.originalRenderFn=window.render,this.originalRebuildFn=window.rebuildProgram,this.originalRenderFn&&(window.render=()=>{this.isActive&&this.gl&&this.program&&(this.updateTexture(),this.bindTexture()),this.originalRenderFn()}),this.originalRebuildFn&&(window.rebuildProgram=()=>{this.originalRebuildFn(),setTimeout((()=>{this.gl=window.gl||document.getElementById("glcanvas").getContext("webgl2")||document.getElementById("glcanvas").getContext("webgl"),this.program=window.program,this.isActive&&this.gl&&this.createTexture()}),10)})}initGL(){const e=document.getElementById("glcanvas");this.gl=e.getContext("webgl2")||e.getContext("webgl"),this.program=window.program}destroy(){this.stopCamera(),this.originalRenderFn&&(window.render=this.originalRenderFn),this.originalRebuildFn&&(window.rebuildProgram=this.originalRebuildFn),this.cameraBtn&&this.cameraBtn.parentNode&&this.cameraBtn.parentNode.removeChild(this.cameraBtn),this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal)}}function n(){document.getElementById("glcanvas")?(window.cameraSystem=new t,window.cameraSystem.initGL()):setTimeout(n,100)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.addEventListener("beforeunload",(()=>{window.cameraSystem&&window.cameraSystem.destroy()}))}(),function(){if(document.getElementById("pm-root"))return;const e=document.createElement("button");e.id="pm-toggle-btn",e.title="Sequencer",e.innerHTML='\n    <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none"\n        xmlns="http://www.w3.org/2000/svg">\n      <path fill="currentColor" d="M8 5v14l11-7z"/>\n    </svg>\n  ',document.body.appendChild(e);const t=document.createElement("div");t.id="pm-root",t.style.display="none",t.innerHTML='\n    <div class="pm-header">\n      <div id="pm-controls">\n        <button class="pm-btn pm-small" id="pm-add-step">+ Step</button>\n        <button class="pm-btn pm-small" id="pm-play">Play </button>\n        <button class="pm-btn pm-small" id="pm-pause" disabled>Pause </button>\n        <button class="pm-btn pm-small" id="pm-stop" disabled>Stop </button>\n        <button class="pm-btn pm-small" id="pm-step-back"></button>\n        <button class="pm-btn pm-small" id="pm-step-forward"></button>\n        <label style="display:flex;align-items:center;gap:6px;margin-left:6px;">\n          <input type="checkbox" id="pm-loop"> Loop\n        </label>\n      </div>\n      <button class="pm-btn" id="pm-close"></button>\n    </div>\n    <div id="pm-body">\n      <div id="pm-steps-area">\n        <div class="pm-steps-row" id="pm-steps-row"></div>\n      </div>\n    </div>\n  ',document.body.appendChild(t);const n={root:t,stepsRow:t.querySelector("#pm-steps-row"),addBtn:t.querySelector("#pm-add-step"),playBtn:t.querySelector("#pm-play"),pauseBtn:t.querySelector("#pm-pause"),stopBtn:t.querySelector("#pm-stop"),stepBack:t.querySelector("#pm-step-back"),stepFwd:t.querySelector("#pm-step-forward"),loopChk:t.querySelector("#pm-loop"),closeBtn:t.querySelector("#pm-close"),toggleBtn:e},o=document.getElementById("vertCode"),i=document.getElementById("fragCode");o&&i||console.warn("Main shader textareas (#vertCode or #fragCode) not found. The manager will still load but playback will do nothing.");let a=[],r=!1,s=!1,l=0,c=null,d=0,u=0,m=null,h=!1;const p=(()=>{let e=1;return()=>"pm-step-"+e++})();function g(e,t){const n=document.createElement("div");n.className="pm-step",n.dataset.stepId=e.id,n.innerHTML=`\n      <div class="pm-header">\n        <div>\n          <div class="pm-step-title">Step ${t+1}</div>\n        </div>\n        <div class="pm-actions">\n          <button class="pm-btn pm-small pm-copy">Copy</button>\n          <button class="pm-btn pm-small pm-dup">Dup</button>\n          <button class="pm-btn pm-small pm-remove"></button>\n        </div>\n      </div>\n      <label for="pm-vert-${e.id}">Vertex shader (step)</label>\n      <textarea id="pm-vert-${e.id}" name="pm-vert-${e.id}" class="pm-vert" spellcheck="false"></textarea>\n      <label for="pm-frag-${e.id}">Fragment shader (step)</label>\n      <textarea id="pm-frag-${e.id}" name="pm-frag-${e.id}" class="pm-frag" spellcheck="false"></textarea>\n      <div style="display:flex;justify-content:space-between;align-items:center;">\n        <div>\n          <label for="pm-delay-${e.id}" style="font-size:12px;color:#aaa">Delay (s)</label>\n          <input id="pm-delay-${e.id}" name="pm-delay-${e.id}" class="pm-delay" type="number" min="0" step="0.1" value="${e.delay}">\n        </div>\n      </div>\n    `,n.querySelector(".pm-vert").value=e.vert||"",n.querySelector(".pm-frag").value=e.frag||"",n.addEventListener("click",(t=>{t.target.closest("textarea, input, label, .pm-actions, .pm-remove, .pm-copy, .pm-dup")||y(e.id,{previewOnly:!0})})),n.querySelector(".pm-remove").addEventListener("click",(t=>{t.stopPropagation(),function(e){const t=a.findIndex((t=>t.id===e));if(-1===t)return;a.splice(t,1),r&&(t<l&&l--,t===l&&k());f()}(e.id)})),n.querySelector(".pm-copy").addEventListener("click",(e=>{e.stopPropagation(),w(n.querySelector(".pm-vert").value,n.querySelector(".pm-frag").value),B("Copied to main editors")})),n.querySelector(".pm-dup").addEventListener("click",(e=>{e.stopPropagation();v({vert:n.querySelector(".pm-vert").value,frag:n.querySelector(".pm-frag").value,delay:parseFloat(n.querySelector(".pm-delay").value)||1},t+1)}));const o=()=>{const t=e.id,o=a.find((e=>e.id===t));o&&(o.vert=n.querySelector(".pm-vert").value,o.frag=n.querySelector(".pm-frag").value,o.delay=parseFloat(n.querySelector(".pm-delay").value)||0)};return n.querySelector(".pm-vert").addEventListener("input",o),n.querySelector(".pm-frag").addEventListener("input",o),n.querySelector(".pm-delay").addEventListener("input",o),n}function v(e={vert:"",frag:"",delay:1},t=null){const n={id:p(),vert:e.vert||"",frag:e.frag||"",delay:"number"==typeof e.delay?e.delay:parseFloat(e.delay)||1};return null===t||t>=a.length?a.push(n):a.splice(t,0,n),f(),y(n.id,{previewOnly:!0}),n}function f(){if(n.stepsRow.innerHTML="",0===a.length){const e=document.createElement("div");return e.style.color="#777",e.style.padding="12px",e.innerText="No steps yet. Click + Step to add.",void n.stepsRow.appendChild(e)}a.forEach(((e,t)=>{const o=g(e,t);if(0!==t){const e=document.createElement("div");e.className="pm-arrow",e.innerHTML='\n          <svg width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">\n            <g fill="none" stroke="#7fbfff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <path d="M4 18 H26"></path>\n              <path d="M20 12 L28 18 L20 24"></path>\n            </g>\n          </svg>\n        ',n.stepsRow.appendChild(e)}n.stepsRow.appendChild(o)})),n.stepsRow.querySelectorAll(".pm-step").forEach(((e,t)=>{const n=e.querySelector(".pm-step-title");n&&(n.textContent=`Step ${t+1}`)})),b()}function y(e,{previewOnly:t=!1}={}){const n=a.findIndex((t=>t.id===e));if(-1===n)return;l=n;const o=a[n];w(o.vert,o.frag),b(),t||E(n)}function w(e,t){if(o&&(o.value=e,o.dispatchEvent(new Event("input",{bubbles:!0}))),i&&(i.value=t,i.dispatchEvent(new Event("input",{bubbles:!0}))),"function"==typeof window.rebuildProgram)try{window.rebuildProgram()}catch(e){console.warn("rebuildProgram error",e)}}function b(){Array.from(n.stepsRow.querySelectorAll(".pm-step")).forEach(((e,t)=>{e.classList.remove("pm-active","pm-future"),r?t<l||(t===l?e.classList.add("pm-active"):e.classList.add("pm-future")):t===l&&e.classList.add("pm-active")}))}function E(e=0){0!==a.length?(e<0&&(e=0),e>=a.length&&(e=a.length-1),r=!0,s=!1,l=e,h=n.loopChk.checked,n.playBtn.disabled=!0,n.pauseBtn.disabled=!1,n.stopBtn.disabled=!1,x(),b()):B("No steps to play")}function x(){T();const e=a[l];e?(w(e.vert,e.frag),d=Date.now(),u=d+Math.max(0,1e3*(e.delay||0)),m=null,c=e.delay<=0?setTimeout((()=>{C()}),20):setTimeout((()=>{C()}),Math.max(10,1e3*(e.delay||0))),b()):k()}function C(){T(),l++,l>=a.length?h?(l=0,x()):k():x()}function S(){r&&!s&&(s=!0,c?(m=Math.max(0,u-Date.now()),T()):m=null,n.pauseBtn.disabled=!0,n.playBtn.disabled=!1,b())}function L(){r&&s&&(s=!1,n.pauseBtn.disabled=!1,n.playBtn.disabled=!0,null!=m?(d=Date.now(),u=d+m,c=setTimeout((()=>{C()}),m),m=null,b()):x())}function k(){T(),r=!1,s=!1,l=0,n.playBtn.disabled=!1,n.pauseBtn.disabled=!0,n.stopBtn.disabled=!0,b()}function T(){c&&(clearTimeout(c),c=null)}let I=null;function B(e,t=1200){if(!document.getElementById("pm-toast")){const e=document.createElement("div");e.id="pm-toast",e.style.position="fixed",e.style.right="12px",e.style.bottom="12px",e.style.zIndex=1e5,e.style.background="rgba(0,0,0,0.7)",e.style.color="#fff",e.style.padding="8px 12px",e.style.borderRadius="8px",e.style.fontSize="13px",document.body.appendChild(e)}const n=document.getElementById("pm-toast");n.textContent=e,n.style.opacity="1",clearTimeout(I),I=setTimeout((()=>{n.style.opacity="0"}),t)}n.addBtn.addEventListener("click",(()=>v({vert:o?o.value:"",frag:i?i.value:"",delay:1}))),n.playBtn.addEventListener("click",(()=>{r?s&&L():E(l||0)})),n.pauseBtn.addEventListener("click",(()=>S())),n.stopBtn.addEventListener("click",(()=>k())),n.stepFwd.addEventListener("click",(()=>function(){if(0===a.length)return;if(r&&!s)return void C();l=Math.min(a.length-1,l+1);const e=a[l];e&&w(e.vert,e.frag),b()}())),n.stepBack.addEventListener("click",(()=>function(){if(0===a.length)return;if(r&&!s)return l=Math.max(0,l-1),void x();l=Math.max(0,l-1);const e=a[l];e&&w(e.vert,e.frag),b()}())),n.loopChk.addEventListener("change",(()=>{h=n.loopChk.checked})),n.closeBtn.addEventListener("click",(()=>{t.style.display="none"})),n.toggleBtn.addEventListener("click",(()=>{[e,t].forEach((e=>{const t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.body;t.contains(e)||t.appendChild(e)})),t.style.display="none"===t.style.display?"flex":"none"})),t.addEventListener("keydown",(e=>{"Space"===e.code&&(e.preventDefault(),r?s?L():n.pauseBtn.click():n.playBtn.click())})),document.addEventListener("keydown",(e=>{"Escape"===e.code&&"none"!==t.style.display&&(e.preventDefault(),t.style.display="none")})),n.toggleBtn.addEventListener("dblclick",(()=>{t.style.right="12px",t.style.top="52px",t.style.transform="none",t.style.width="820px",t.style.height="520px"})),0===a.length&&(v({vert:o?o.value:"attribute vec2 a_position;\\nvoid main(){ gl_Position = vec4(a_position,0.,1.); }",frag:i?i.value:"// fragment step 1",delay:3}),v({vert:o?o.value:"attribute vec2 a_position;\\nvoid main(){ gl_Position = vec4(a_position,0.,1.); }",frag:i?i.value:"// fragment step 2",delay:3})),f(),window.PerformanceManager={createStep:v,startPlayback:E,stopPlayback:k,pausePlayback:S,resumePlayback:L,steps:a,selectStepById:y,savePreset:function(e="pm-last"){try{localStorage.setItem(e,JSON.stringify(a)),B("Saved preset")}catch(e){console.warn("savePreset",e)}},loadPreset:function(e="pm-last"){try{const t=localStorage.getItem(e);if(!t)return;const n=JSON.parse(t);Array.isArray(n)&&(a=n.map((e=>({id:p(),vert:e.vert||"",frag:e.frag||"",delay:parseFloat(e.delay)||0}))),f(),B("Loaded preset"))}catch(e){console.warn("loadPreset",e)}}},window.addEventListener("beforeunload",(()=>{T()})),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].forEach((n=>{document.addEventListener(n,(()=>{[e,t].forEach((e=>{const t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.body;t.contains(e)||t.appendChild(e)}))}))})),t.style.display="none"}(),function(){function e(){["vertCode","fragCode"].forEach((e=>{const a=document.getElementById(e);a&&function(e){const a=window.getComputedStyle(e),r=document.createElement("div");r.className="glsl-editor-wrapper";const s=document.createElement("div");s.className="glsl-editor",s.setAttribute("contenteditable","true"),s.setAttribute("spellcheck","false"),s.setAttribute("data-associated-textarea-id",e.id),e.classList.add("glsl-hidden-textarea"),function(e,t,n){const o=window.getComputedStyle(e);n.forEach((e=>{const n=o.getPropertyValue(e);n&&t.style.setProperty(e,n)}))}(e,r,["padding","margin","width","height","border","border-radius","flex","flex-grow","flex-shrink","flex-basis","min-width","min-height","max-width","max-height","box-shadow"]),s.style.fontFamily=a.getPropertyValue("font-family"),s.style.fontSize=a.getPropertyValue("font-size"),s.style.lineHeight=a.getPropertyValue("line-height"),s.style.padding=a.getPropertyValue("padding"),s.style.border="none",s.style.margin="0",e.parentNode.replaceChild(r,e),r.appendChild(e),r.appendChild(s);const l=e.value||"";s.innerHTML=n(t(l)),s.addEventListener("input",(()=>{const[a,r]=o(s);let l=s.innerText.replace(/\r\n/g,"\n");e.value.endsWith("\n")&&!l.endsWith("\n")&&(l+="\n"),e.value=l,s.innerHTML=n(t(l)),i(s,a,r),e.dispatchEvent(new Event("input",{bubbles:!0}))}));new MutationObserver((()=>{const a=e.value||"";if(s.innerText.replace(/\r\n/g,"\n")!==a){const[e,r]=o(s);s.innerHTML=n(t(a)),i(s,e,r)}})).observe(e,{characterData:!0,childList:!0,subtree:!0,attributes:!0});let c=e.value;setInterval((()=>{if(e.value!==c){c=e.value;const[a,r]=o(s);s.innerHTML=n(t(e.value)),i(s,a,r)}}),100),s.addEventListener("keydown",(a=>{if("Enter"===a.key){a.preventDefault();const[r,l]=o(s);let c=s.innerText.replace(/\r\n/g,"\n");c=c.slice(0,r)+"\n"+c.slice(l),e.value=c,s.innerHTML=n(t(c)),i(s,r+1,r+1),e.dispatchEvent(new Event("input",{bubbles:!0}))}}))}(a)}))}function t(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(e){const t="\\b(?:"+["precision","uniform","attribute","varying","layout","const","in","out","inout","if","else","for","while","do","return","break","continue","discard"].join("|")+")\\b",n="\\b(?:"+["void","bool","int","float","vec2","vec3","vec4","mat2","mat3","mat4","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","sampler2D","samplerCube","lowp","mediump","highp"].join("|")+")\\b",o="\\b(?:"+["gl_Position","gl_FragCoord","gl_FragColor","gl_PointSize","radians","degrees","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","faceforward","reflect","refract","texture2D","textureCube","texture2DProj","texture2DLod","dFdx","dFdy","fwidth"].join("|")+")\\b",i="\\b(?:"+["time","mouse","resolution","iTime","iResolution"].join("|")+")\\b",a=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)|(\\/\\/.*)|("+t+")|("+n+")|("+o+")|(\\b\\d+(?:\\.\\d+)?(?:[eE][+-]?\\d+)?\\b)|("+i+")|(\\b[ua][A-Za-z0-9_]*\\b)|(\\b[A-Za-z_]\\w*)(?=\\s*\\()","g");return e.replace(a,((e,t,n,o,i,a,r,s,l,c)=>t?`<span class="token-comment">${t}</span>`:n?`<span class="token-comment">${n}</span>`:o?`<span class="token-keyword">${o}</span>`:i?`<span class="token-type">${i}</span>`:a?`<span class="token-builtin">${a}</span>`:r?`<span class="token-number">${r}</span>`:s?`<span class="token-variable">${s}</span>`:l?`<span class="token-variable">${l}</span>`:c?`<span class="token-function">${c}</span>`:e))}function o(e){const t=window.getSelection();let n=0,o=-1,i=-1;return function e(a){if(a)if(a.nodeType===Node.TEXT_NODE){const e=a.textContent.replace(/\r\n/g,"\n");t.anchorNode===a&&(o=n+t.anchorOffset),t.focusNode===a&&(i=n+t.focusOffset),n+=e.length}else for(let t=0;t<a.childNodes.length&&(e(a.childNodes[t]),-1===i||-1===o);t++);}(e),o<0&&(o=i=0),[Math.min(o,i),Math.max(o,i)]}function i(e,t,n){let o=0,i=null,a=0,r=null,s=0;if(function e(l){if(l&&!r)if(l.nodeType===Node.TEXT_NODE){const e=l.textContent.replace(/\r\n/g,"\n"),c=o+e.length;null===i&&t<=c&&(i=l,a=t-o),null===r&&n<=c&&(r=l,s=n-o),o=c}else for(let t=0;t<l.childNodes.length&&(e(l.childNodes[t]),!r);t++);}(e),i&&r){const e=document.createRange();e.setStart(i,a),e.setEnd(r,s);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}(),(()=>{const e={lowThreshold:20,criticalThreshold:5,chargingAutoHideMs:3e3,debounceMs:200,storageKey:"batteryAlertDismissedLevel_v1"},t=document.createElement("style");t.textContent='\n  .__bat-alert{position: fixed;right: 20px;bottom: 20px;display: flex;gap: 10px;align-items: center;padding: 10px 14px;border-radius: 12px;background: var(--2);color: var(--l);border: 1px solid var(--3);box-shadow: var(--1);z-index: 999999;font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;transform-origin: bottom right;transition: opacity .26s ease, transform .26s ease;opacity: 0;pointer-events: none;}\n  .__bat-alert.__visible{opacity: 1;transform: translateY(0);pointer-events: auto;}\n  .__bat-alert.__hidden{transform: translateY(12px);opacity: 0;pointer-events: none;}\n  .__bat-svg{width: 56px;height: 28px;flex: 0 0 56px;}\n  .__bat-svg rect.shell{fill:none;stroke: currentColor;stroke-width:1.6;opacity:0.85;rx:2;}\n  .__bat-fill{transform-origin: left center;transition: transform .35s ease, fill .35s ease;rx:1.5;ry:1.5;}\n  .__bat-tip{fill:currentColor;opacity:0.85;}\n  .__bat-warning{stroke-width: 2;stroke-linecap: round;opacity:0;transition: opacity .2s;}\n  .__bat-msg{font-size: 13px;line-height:1;min-width: 120px;}\n  .__bat-actions{display:flex;gap:6px;align-items:center;margin-left:6px;}\n  .__bat-dismiss{background: none;border: none;color: inherit;font-size: 16px;cursor: pointer;padding: 6px;border-radius: 6px;}\n  .__bat-dismiss:focus{outline: 2px solid var(--rh);}\n  .__bat-critic{box-shadow: 0 6px 20px var(--rh);border-color: var(--rh);}\n  .__bat-warn{box-shadow: 0 6px 20px var(--ah);border-color: var(--ah);}\n  @keyframes __bat-pulse{0%{filter: brightness(1);}\n  50%{filter: brightness(1.14);}\n  100%{filter: brightness(1);}}\n  .__bat-charging .__bat-fill{animation: __bat-pulse 1s infinite;}\n  @keyframes __bat-blink{from{opacity:.25;}\n  to{opacity:1;}}\n  .__bat-warning.__on{opacity: 1;animation: __bat-blink 0.9s infinite alternate;}\n  @media (prefers-reduced-motion: reduce){.__bat-svg, .__bat-fill{transition: none !important;animation: none !important;}}\n  ',document.head.appendChild(t);const n=document.createElement("div");n.className="__bat-alert __hidden",n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.innerHTML='\n    <svg class="__bat-svg" viewBox="0 0 52 24" aria-hidden="true">\n      <rect class="shell" x="1" y="4" width="46" height="16" rx="2" ry="2"></rect>\n      <rect class="__bat-fill" x="3" y="6" width="40" height="12" rx="1.5" ry="1.5"></rect>\n      <rect class="__bat-tip" x="47" y="9" width="4" height="6" rx="1" ry="1"></rect>\n      <line class="__bat-warning" x1="15" y1="6" x2="31" y2="18"></line>\n      <line class="__bat-warning" x1="31" y1="6" x2="15" y2="18"></line>\n    </svg>\n    <div class="__bat-msg" id="__bat-msg">Battery</div>\n    <div class="__bat-actions">\n      <button class="__bat-dismiss" aria-label="Dismiss battery alert" title="Dismiss"></button>\n    </div>\n  ',document.body.appendChild(n);const o=n.querySelector(".__bat-fill"),i=(n.querySelector(".__bat-tip"),n.querySelector("#__bat-msg")),a=n.querySelector(".__bat-dismiss"),r=Array.from(n.querySelectorAll(".__bat-warning"));let s=null,l=!1,c=null,d=null,u=null,m=Number(localStorage.getItem(e.storageKey))||null;function h(){c&&(clearTimeout(c),c=null)}function p(t,s=!1){h(),u=t,(t=>{const n=Math.max(0,Math.min(1,t/100));o.style.transform=`scaleX(${n})`,o.style.fill=t<=e.criticalThreshold?"var(--r)":t<=e.lowThreshold?"var(--rh)":"var(--a)"})(t),i.textContent=s?`Charging  ${t}%`:t<=e.criticalThreshold?`Critical battery  ${t}% remaining`:`Low battery: ${t}%`,n.classList.remove("__hidden"),n.classList.add("__visible"),n.classList.toggle("__bat-charging",Boolean(s)),n.classList.toggle("__bat-critic",t<=e.criticalThreshold&&!s),n.classList.toggle("__bat-warn",t>e.criticalThreshold&&t<=e.lowThreshold&&!s),r.forEach((n=>n.classList.toggle("__on",t<=e.lowThreshold&&!s)));const d=!s&&t>e.criticalThreshold;a.style.display=d?"":"none",l=!0,s&&(c=setTimeout(g,e.chargingAutoHideMs))}function g(){h(),n.classList.remove("__visible"),n.classList.add("__hidden"),l=!1}function v(t,n){d&&clearTimeout(d),d=setTimeout((()=>{d=null,function(t,n){const o=(i=100*t,Math.max(0,Math.min(100,Math.round(i))));var i;!function(t,n){return!(null!=m&&t>=m)&&(n?t<100&&t<=e.lowThreshold:t<=e.lowThreshold)}(o,n)?n?o>=100||o>e.lowThreshold+2?g():l&&p(o,!0):l&&o>e.lowThreshold+2&&g():p(o,n);u=o}(t,n)}),e.debounceMs)}a.addEventListener("click",(()=>{null!=u&&(m=Math.max(0,Math.round(u)),localStorage.setItem(e.storageKey,String(m))),g()})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&l&&a.click()})),n.addEventListener("mouseenter",(()=>{h()})),n.addEventListener("mouseleave",(()=>{s&&s.charging&&l&&(h(),c=setTimeout(g,e.chargingAutoHideMs))}));const f={showNow(e=15,t=!1){p(e,t)},hideNow(){g()},destroy(){g(),n.remove(),t.remove();try{navigator.getBattery().then((e=>{e.removeEventListener("levelchange",y),e.removeEventListener("chargingchange",y)}))}catch(e){}delete window.BatteryAlert},options:e,clearDismissal(){m=null,localStorage.removeItem(e.storageKey)}};function y(){s&&v(s.level,s.charging)}window.BatteryAlert=f,"getBattery"in navigator?navigator.getBattery().then((e=>{s=e,v(s.level,s.charging),e.addEventListener("levelchange",y),e.addEventListener("chargingchange",y)})).catch((e=>{console.warn("Battery API available but failed:",e)})):console.warn("Battery API not supported in this browser.")})(),function(){const e="tutorial_state";function t(){try{const t=localStorage.getItem(e);return t?JSON.parse(t):{viewCount:0,skipped:!1}}catch(e){return{viewCount:0,skipped:!1}}}function n(t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("Failed to save tutorial state:",e)}}window.startTutorial=function(){l()},window.resetTutorial=function(){localStorage.removeItem(e),console.log("Tutorial state reset")};const o='\n    <div class="tutorial-overlay"></div>\n    <div class="tutorial-controls">\n      <button class="tutorial-skip-btn">Skip Tutorial</button>\n    </div>\n    <div class="tutorial-navigation">\n      <button class="tutorial-nav-btn tutorial-prev-btn"></button>\n      <div class="tutorial-step-indicator">\n        <span class="tutorial-current-step">1</span> / <span class="tutorial-total-steps">4</span>\n      </div>\n      <button class="tutorial-nav-btn tutorial-next-btn"></button>\n    </div>\n    <div class="tutorial-highlight"></div>\n    <div class="tutorial-textbox">\n      <div class="tutorial-textbox-content"></div>\n    </div>\n  ',i=[{selector:'button.lbtn.ellips[onclick="openShaderWindow()"]',text:"This is where you go to save animations or browse public ones."},{selector:"button#tabPublicBtn",text:"Here you can view public animations."},{selector:'button.closebtn[onclick="closeShaderWindow()"]',text:"Use this to close the shader window and return to the coding interface."},{selector:'button.audio-reactive-button[title="Audio Reactivity"]',text:"This enables audio reactivity  animations that respond to sound."},{selector:"button#audio-toggle",text:"Select your microphone here (internal audio compatible)."},{selector:"button#file-upload-btn",text:"Upload audio files to use in your animations."},{selector:"button#info-toggle",text:"Get instructions on how to incorporate audio reactive uniforms."},{selector:"button#recBtn",text:"Open recording settings to capture your animations."},{selector:"button.camera-btn",text:"Turn the canvas into a webcam feed  customize with fragment/vertex shaders."},{selector:"button#mediaUploadBtn",text:"Upload images or videos to be reflected onto the WebGL canvas."},{selector:"button#effectsTab",text:"Add effects to your uploaded media."},{selector:"button#pm-toggle-btn",text:"Open the sequencer to create timed animations."},{selector:"button#theme-manager-btn",text:"Customize the app colors with the theme manager."},{selector:"button#toggle-editor",text:"Customize any color individually with the color editor."},{selector:"button#fsBtn",text:"Open/close code editors, or double-click to launch app in fullscreen."},{selector:"button.glsl-performance-monitor-toggle",text:"Monitor FPS, draw calls, and memory for performant animations."},{selector:"button#jsToggleBtn",text:"Turn the canvas into a 2D canvas powered by JavaScript animations."},{selector:"button#webgpuToggle",text:"Switch to WebGPU canvas with WGSL coding."},{selector:"button#threeLoadBtn",text:"Load 3D models (.glb, .obj, .stl)."},{selector:"button#uploadHTMLBtn",text:"Upload whole HTML files to be separated."},{selector:'button.expbtn[title="Export Full HTML"]',text:"Export your animations as HTML files."}];let a,r=0,s={};function l(){const e=document.createElement("div");e.className="tutorial-container",e.innerHTML=o,document.body.appendChild(e),s.container=e,s.overlay=e.querySelector(".tutorial-overlay"),s.skipBtn=e.querySelector(".tutorial-skip-btn"),s.prevBtn=e.querySelector(".tutorial-prev-btn"),s.nextBtn=e.querySelector(".tutorial-next-btn"),s.highlight=e.querySelector(".tutorial-highlight"),s.textbox=e.querySelector(".tutorial-textbox"),s.textboxContent=e.querySelector(".tutorial-textbox-content"),s.currentStepEl=e.querySelector(".tutorial-current-step"),s.totalStepsEl=e.querySelector(".tutorial-total-steps"),s.totalStepsEl.textContent=i.length,s.skipBtn.addEventListener("click",(()=>{!function(){const e=t();e.skipped=!0,n(e)}(),m()})),s.prevBtn.addEventListener("click",(()=>c(-1))),s.nextBtn.addEventListener("click",(()=>c(1))),s.overlay.addEventListener("click",u),d(0)}function c(e){const t=r+e;t>=0&&t<i.length?d(t):t>=i.length&&m()}function d(e){r=e;const t=i[e];s.currentStepEl.textContent=e+1,s.prevBtn.disabled=0===e,s.nextBtn.textContent=e===i.length-1?"":"";const n=document.querySelector(t.selector);n&&(s.currentTarget&&s.currentClickHandler&&s.currentTarget.removeEventListener("click",s.currentClickHandler),s.currentTarget=n,s.currentClickHandler=e=>{setTimeout((()=>{c(1)}),100)},n.addEventListener("click",s.currentClickHandler,!0),function(e){const t=e.getBoundingClientRect(),n=8;s.highlight.style.top=t.top-n+"px",s.highlight.style.left=t.left-n+"px",s.highlight.style.width=`${t.width+2*n}px`,s.highlight.style.height=`${t.height+2*n}px`}(n),function(e,t){s.textboxContent.textContent=t;const n=e.getBoundingClientRect(),o=s.textbox.getBoundingClientRect(),i=20,a=window.innerWidth,r=window.innerHeight;let l,c,d;s.textbox.className="tutorial-textbox",n.bottom+i+o.height<r-100?(l=n.bottom+i,c=n.left+n.width/2-o.width/2,d="pos-bottom"):n.top-i-o.height>100?(l=n.top-i-o.height,c=n.left+n.width/2-o.width/2,d="pos-top"):n.right+i+o.width<a?(l=n.top+n.height/2-o.height/2,c=n.right+i,d="pos-right"):n.left-i-o.width>0?(l=n.top+n.height/2-o.height/2,c=n.left-i-o.width,d="pos-left"):(l=r/2-o.height/2,c=a/2-o.width/2,d="pos-bottom");c=Math.max(10,Math.min(c,a-o.width-10)),l=Math.max(100,Math.min(l,r-o.height-100)),s.textbox.style.top=`${l}px`,s.textbox.style.left=`${c}px`,s.textbox.classList.add(d)}(n,t.text),n.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}))}function u(e){}function m(){s.currentTarget&&s.currentClickHandler&&s.currentTarget.removeEventListener("click",s.currentClickHandler),s.container&&s.container.remove(),s.style&&s.style.remove(),window.dispatchEvent(new Event("tutorial:end"))}window.addEventListener("resize",(()=>{clearTimeout(a),a=setTimeout((()=>{r<i.length&&d(r)}),100)})),function(){const e=t();return!(e.skipped&&e.viewCount>=2)&&!(!e.skipped&&e.viewCount>=10)}()&&(!function(){const e=t();e.viewCount++,n(e)}(),l())}();
</script>
</body>
</html>