<!-- 
░█▀▀░█░█░█▀█░█▀▄░█▀▀░█▀▄    
░▀▀█░█▀█░█▀█░█░█░█▀▀░█▀▄    
░▀▀▀░▀░▀░▀░▀░▀▀░░▀▀▀░▀░▀    
░█▀▀░█▀█░█▀█░█▀▄░█▀▄░█▀█░█░█
░▀▀█░█▀█░█░█░█░█░█▀▄░█░█░▄▀▄
░▀▀▀░▀░▀░▀░▀░▀▀░░▀▀░░▀▀▀░▀░▀
Created By Max Warren
https://max.x10.mx/
SPDX-License-Identifier: GPL-3.0-or-later

Last Offline Build: 1/20/26 | 1:20
-->
<!DOCTYPE html><html lang="en"><head><title>MW - SHADER</title><meta charset="UTF-8"><meta name="description" content="A browser-based animation editor for writing, previewing, recording, and exporting WebGL WebGPU and JS animations"><meta name="keywords" content="GLSL, WebGL, shader editor, live coding, Max, browser shader tool, WebGL editor, animation coding, audio reactive shader, WebGPU, Render, Coding Sandbox, animation, audio reactive, record"><meta name="author" content="github.com/composedbymax"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"><meta name="theme-color" content="#252525"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Shader Sandbox"><meta name="format-detection" content="telephone=no"><meta name="application-name" content="Shader Sandbox"><meta name="HandheldFriendly" content="true"><meta name="apple-touch-fullscreen" content="yes"><meta name="msapplication-TileColor" content="#252525"><meta name="robots" content="index, nofollow"><meta name="referrer" content="no-referrer"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Shader Sandbox"><meta name="twitter:description" content="A browser-based animation editor for writing, previewing, recording, and exporting WebGL WebGPU and JS animations"><meta name="twitter:site" content="@composedbymax"><meta property="og:title" content="Shader Sandbox" /><meta property="og:type" content="website" /><meta property="og:description" content=" browser-based animation editor for writing, previewing, recording, and exporting WebGL WebGPU and JS animations" /><meta property="og:site_name" content="Shader Sandbox" /><meta http-equiv="Content-Security-Policy" content="default-src 'self';script-src 'self' 'unsafe-inline' 'unsafe-eval';worker-src 'self' blob:;style-src 'self' 'unsafe-inline';img-src 'self' data:;connect-src 'self';font-src 'self';object-src 'none';media-src 'self' blob:;"><meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload"><meta http-equiv="X-Content-Type-Options" content="nosniff"><meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(self), camera=(self), fullscreen=(self), clipboard-read=(self), clipboard-write=(self)"><meta http-equiv="X-XSS-Protection" content="1; mode=block"><meta http-equiv="X-UA-Compatible" content="IE=edge"> <script>(function(){const DB_NAME="ShaderEditorDB";const STORE_NAME="shaders";const KEY="autosave_data";let db=null;let worker=null;function getCurrentAnimationType(){if(window.jsCanvasState&&window.jsCanvasState.isJSMode()){return"js"}else if(window.webgpuState&&window.webgpuState.isWebGPUMode()){return"webgpu"}else{return"webgl"}}function switchToAnimationType(type){const currentType=getCurrentAnimationType();if(currentType===type){return}switch(type){case"js":if(currentType!=="js"){const jsBtn=document.getElementById("jsToggleBtn");if(jsBtn)jsBtn.click()}break;case"webgpu":if(currentType!=="webgpu"){const webgpuBtn=document.getElementById("webgpuToggle");if(webgpuBtn)webgpuBtn.click()}break;case"webgl":if(currentType==="js"){const jsBtn=document.getElementById("jsToggleBtn");if(jsBtn)jsBtn.click()}else if(currentType==="webgpu"){const webgpuBtn=document.getElementById("webgpuToggle");if(webgpuBtn)webgpuBtn.click()}break}}function createWorker(){const workerScript=`\nlet db=null;const DB_NAME="ShaderEditorDB";const STORE_NAME="shaders";const KEY="autosave_data";function initWorkerDB(){return new Promise(((resolve,reject)=>{if("indexedDB"in self){const request=indexedDB.open(DB_NAME,1);request.onupgradeneeded=function(e){db=e.target.result;if(!db.objectStoreNames.contains(STORE_NAME)){db.createObjectStore(STORE_NAME)}};request.onsuccess=function(e){db=e.target.result;resolve(db)};request.onerror=function(){reject("IndexedDB error in worker")}}else{reject("IndexedDB not supported in worker")}}))}async function saveDataInWorker(data){try{if(db){const tx=db.transaction(STORE_NAME,"readwrite");const store=tx.objectStore(STORE_NAME);const saveData={...data,timestamp:Date.now()};return new Promise(((resolve,reject)=>{const request=store.put(saveData,KEY);request.onsuccess=()=>{self.postMessage({type:"save_success",timestamp:saveData.timestamp});resolve()};request.onerror=()=>{reject("IndexedDB save failed")}}))}else{throw new Error("Database not initialized")}}catch(error){self.postMessage({type:"save_error",error:error.message});throw error}}async function loadDataInWorker(){try{if(db){const tx=db.transaction(STORE_NAME,"readonly");const store=tx.objectStore(STORE_NAME);return new Promise(((resolve,reject)=>{const request=store.get(KEY);request.onsuccess=function(e){const data=e.target.result;self.postMessage({type:"load_success",data:data});resolve(data)};request.onerror=function(){reject("IndexedDB load failed")}}))}else{throw new Error("Database not initialized")}}catch(error){self.postMessage({type:"load_error",error:error.message});throw error}}self.onmessage=async function(e){const{type:type,data:data}=e.data;try{switch(type){case"init":await initWorkerDB();self.postMessage({type:"init_success"});break;case"save":await saveDataInWorker(data);break;case"load":await loadDataInWorker();break;case"autosave":await saveDataInWorker(data);break;default:self.postMessage({type:"error",error:"Unknown message type"})}}catch(error){self.postMessage({type:"error",error:error.message})}};\n        `;const blob=new Blob([workerScript],{type:"application/javascript"});const workerUrl=URL.createObjectURL(blob);worker=new Worker(workerUrl);worker.addEventListener("message",(function handleInit(e){if(e.data.type==="init_success"||e.data.type==="error"){URL.revokeObjectURL(workerUrl);worker.removeEventListener("message",handleInit)}}));return worker}function initDB(){worker=createWorker();worker.onmessage=function(e){const{type:type,data:data,error:error,timestamp:timestamp}=e.data;switch(type){case"init_success":checkForSavedData();break;case"load_success":handleSavedData(data);break;case"save_success":console.log("Autosave:",new Date(timestamp).toLocaleTimeString());break;case"save_error":case"load_error":case"error":console.error("Worker error:",error);fallbackToLocalStorage();break}};worker.onerror=function(error){console.error("Worker error:",error);fallbackToLocalStorage()};worker.postMessage({type:"init"})}function fallbackToLocalStorage(){console.log("Falling back to localStorage");if(worker){worker.terminate();worker=null}checkForSavedDataLocalStorage()}async function saveData(){const vertCodeEl=document.getElementById("vertCode");const fragCodeEl=document.getElementById("fragCode");if(!vertCodeEl||!fragCodeEl){console.warn("Editor elements not found for autosave");return}const vertCode=vertCodeEl.value;const fragCode=fragCodeEl.value;const canvasType=getCurrentAnimationType();const data={vertCode:vertCode,fragCode:fragCode,canvasType:canvasType};try{if(worker){worker.postMessage({type:"save",data:data})}else{const saveData={...data,timestamp:Date.now()};localStorage.setItem(KEY,JSON.stringify(saveData));console.log("Saved to localStorage fallback")}}catch(error){console.error("Save failed:",error);try{const saveData={...data,timestamp:Date.now()};localStorage.setItem(KEY,JSON.stringify(saveData));console.log("Saved to localStorage (last resort)")}catch(lsError){console.error("All save methods failed:",lsError)}}}async function checkForSavedData(){if(worker){worker.postMessage({type:"load"})}else{checkForSavedDataLocalStorage()}}function checkForSavedDataLocalStorage(){try{const stored=localStorage.getItem(KEY);const data=stored?JSON.parse(stored):null;handleSavedData(data)}catch(error){console.error("LocalStorage load failed:",error)}}function getCurrentEditorContent(){const vertCodeEl=document.getElementById("vertCode");const fragCodeEl=document.getElementById("fragCode");if(!vertCodeEl||!fragCodeEl){return{vertCode:"",fragCode:""}}return{vertCode:vertCodeEl.value||"",fragCode:fragCodeEl.value||""}}function isCodeDifferent(savedData,currentData){const normalize=str=>str.trim().replace(/\s+/g," ");const savedVert=normalize(savedData.vertCode||"");const savedFrag=normalize(savedData.fragCode||"");const currentVert=normalize(currentData.vertCode||"");const currentFrag=normalize(currentData.fragCode||"");return savedVert!==currentVert||savedFrag!==currentFrag}function handleSavedData(data){if(!data)return;const SEVEN_DAYS=7*24*60*60*1e3;if(Date.now()-data.timestamp<SEVEN_DAYS){const currentContent=getCurrentEditorContent();if(isCodeDifferent(data,currentContent)){showLoadPrompt(data)}else{console.log("No save found")}}}function showLoadPrompt(data){const create=(tag,props={},className="",children=[])=>{const el=document.createElement(tag);Object.assign(el,props);if(className)el.className=className;children.forEach((child=>el.appendChild(child)));return el};const overlay=create("div",{},"autosave-overlay");const title=create("h3",{textContent:"Load Autosaved Data?"},"autosave-title");const timeAgo=getTimeAgo(data.timestamp);const canvasTypeText=data.canvasType?` (${data.canvasType.toUpperCase()} mode)`:"";const message=create("p",{textContent:`We found autosaved shader code from ${timeAgo}${canvasTypeText}. Would you like to load it?`},"autosave-message");const noBtn=create("button",{textContent:"No, Start Fresh"},"autosave-btn autosave-btn-no");const yesBtn=create("button",{textContent:"Yes, Load Data"},"autosave-btn autosave-btn-yes");const buttonContainer=create("div",{},"autosave-button-container",[noBtn,yesBtn]);const dialog=create("div",{},"autosave-dialog",[title,message,buttonContainer]);overlay.appendChild(dialog);noBtn.onclick=()=>{overlay.remove()};yesBtn.onclick=()=>{restoreEditors(data);overlay.remove()};document.body.appendChild(overlay)}function getTimeAgo(timestamp){const now=Date.now();const diff=now-timestamp;const minutes=Math.floor(diff/6e4);const hours=Math.floor(diff/36e5);const days=Math.floor(diff/864e5);if(days>0)return`${days} day${days>1?"s":""} ago`;if(hours>0)return`${hours} hour${hours>1?"s":""} ago`;if(minutes>0)return`${minutes} minute${minutes>1?"s":""} ago`;return"just now"}function restoreEditors(data){if(!data){console.log("No data to restore");return}if(data.canvasType){const currentType=getCurrentAnimationType();if(currentType!==data.canvasType){switchToAnimationType(data.canvasType);setTimeout((()=>restoreCode(data)),100);return}}restoreCode(data)}function restoreCode(data){const vertCodeEl=document.getElementById("vertCode");const fragCodeEl=document.getElementById("fragCode");if(!vertCodeEl||!fragCodeEl){console.error("Editor elements not found");return}vertCodeEl.value=data.vertCode||"";fragCodeEl.value=data.fragCode||"";vertCodeEl.dispatchEvent(new Event("input",{bubbles:true}));fragCodeEl.dispatchEvent(new Event("input",{bubbles:true}));console.log("Restored",data.canvasType||"unknown","animation")}function setupAutoSave(){setTimeout(saveData,3e4);setInterval(saveData,3e4);window.addEventListener("beforeunload",(()=>{saveData();if(worker){try{const vertCode=document.getElementById("vertCode")?.value||"";const fragCode=document.getElementById("fragCode")?.value||"";const canvasType=getCurrentAnimationType();const data={vertCode:vertCode,fragCode:fragCode,canvasType:canvasType,timestamp:Date.now()};localStorage.setItem(KEY,JSON.stringify(data))}catch(error){console.error("Beforeunload save failed:",error)}worker.terminate()}}))}window.addEventListener("DOMContentLoaded",(function(){initDB();setupAutoSave()}))})();</script> <style>*{--pad: 6px 10px;margin: 0;padding: 0;box-sizing: border-box;font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;}html,body{width: 100%;height: 100%;overflow: hidden;overscroll-behavior: none;-webkit-overflow-scrolling: none;background: var(--1);color: var(--l);overflow: hidden;font: 16px/1.6 sans-serif;}input[type="range"]{width: 100%;height: 12px;-webkit-appearance: none;appearance: none;background: var(--d);border-radius: 10px;outline: none;transition: 0.6s ease;}input[type="range"]:hover{background: var(--D);}input[type="range"]::-webkit-slider-thumb{-webkit-appearance: none;appearance: none;width: 34px;height: 26px;border-radius: 2px;background: var(--D);border: 0.5px solid var(--a);cursor: pointer;transition: 0.3s ease;}input[type="range"]:focus::-webkit-slider-thumb{background: var(--b);transform: scale(1.1);}input[type="range"]::-moz-range-thumb{width: 34px;height: 26px;border-radius: 2px;background: var(--l);border: 0.5px solid var(--a);cursor: pointer;transition: 0.3s ease;}input[type="range"]:focus::-moz-range-thumb{background: var(--b);transform: scale(1.1);}::-webkit-scrollbar{width:14px;height:12px;}::-webkit-scrollbar-thumb{background-color:var(--4);border-radius:4px;border:3px solid var(--d);min-height:5rem;}::-webkit-scrollbar-thumb:hover{background-color:var(--5);border-radius:4rem;}::-webkit-scrollbar-track{background:var(--3);border-radius:4px;}html.font-courier{--font-main: 'Courier New', Courier, monospace;}html.font-courier-new{--font-main: Courier, 'Courier New', monospace;}html.font-monaco{--font-main: Monaco, 'Lucida Console', monospace;}html.font-jetbrains{--font-main: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;}html.font-monospace{--font-main: monospace;}html.font-verdana{--font-main: Verdana, Geneva, sans-serif;}html.font-lucida{--font-main: 'Lucida Console', Monaco, monospace;}html.font-arial{--font-main: Arial, Helvetica, sans-serif;}html.font-sans-serif{--font-main: sans-serif;}html, body, *{font-family: var(--font-main) !important;}#app{display: flex;height: 100%;}#editors{z-index: 100;width: 33%;background: var(--2);display: flex;flex-direction: column;border-right: 2px solid var(--4);position: relative;}.editor-panel{flex: none;display: flex;flex-direction: column;overflow: hidden;white-space: nowrap;z-index:2;}.panel-header{background: var(--3);color: var(--6);padding: var(--pad);font-size: 0.9em;display: flex;justify-content: space-between;align-items: center;gap:0.5rem;}.panel-header input[type=file]{display: none;}.file-name{color: var(--6);font-size: 0.9em;}.panel-header button{background: var(--4);border: none;padding: 2px 6px;cursor: pointer;}.panel-header button:hover, #divider:hover,#fsBtn:hover{background: var(--5);}#rowDivider{height: 10px;background: var(--4);cursor: row-resize;flex: none;transition:0.5s all;}textarea{flex: 1;background: var(--2);color: var(--6);border: none;padding: 4px;font-size: 0.95em;line-height: 1.4;resize: none;overflow: auto;outline: none;}#divider{width: 12px;background: var(--3);cursor: col-resize;transition:0.5s all;}#preview-panel{flex: 1;position: relative;background: var(--1);display: flex;justify-content: center;align-items: center;}#lint{position: absolute;bottom: 0;z-index: 10000;left: 0;width: 100%;max-height: 30%;background: var(--0);color: var(--r);font-size: 0.9em;overflow: auto;white-space: pre-wrap;}#copyErrorsBtn{position: absolute;top: 5px;right: 40px;background: var(--3);color: var(--7);border: none;padding: 4px 8px;cursor: pointer;z-index: 10001;}#copyErrorsBtn:hover{background: var(--5);}#closeLintBtn{position: absolute;top: 5px;right: 5px;background: var(--r);border: none;color: var(--7);cursor: pointer;padding: 4px 8px;z-index: 10001;}#closeLintBtn:hover{background: var(--0);color:var(--r);}#lintContent{padding: 0 10px 0 10px;}#glcanvas{width: 100%;height: 100%;display: block;}#fsBtn{position: absolute;top: 10px;right: 10px;z-index: 10;background: var(--d);color: var(--6);border: none;padding: var(--pad);font-size: 1em;cursor: pointer;width:2rem;height:2rem;}.lbtn{height:39px;position: absolute;bottom: 10px;right: 10px;background: var(--d);color: var(--l);padding: 12px 10px;border: none;cursor: pointer;z-index:10;}.expbtn:hover{background:var(--5);}.expbtn{position: absolute;bottom: 10px;right: 10px;background: var(--d);color: var(--l);height:39px;border: none;cursor: pointer;z-index:4;width:4.25rem;}.lbtn:hover{background:var(--5);}.savew{display:none;position:absolute;width:100%;height:100%;background:var(--2);color:var(--6);padding:10px;z-index:100;}.toggles{display:flex;margin-bottom:10px;}.togbtn{flex: 1;border: none;padding: 16px 0px;cursor: pointer;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;text-align: center;color:var(--6);}.savesct{display:none;overflow:auto;height:90%;padding:10px;}.closebtn{width: 100%;position: absolute;bottom: 10px;right: 10px;background: var(--5);color: var(--l);border: none;cursor: pointer;padding: 12px;max-width:7.8rem;}.savebtn, .sharebtn{background: var(--5);color: var(--7);border: none;cursor: pointer;padding: var(--pad);text-align: center;margin-bottom: 0.5rem;max-height:4rem;max-width: 6rem;word-break: break-word;overflow-wrap: break-word;white-space: normal;}.savebtn{overflow: hidden;}.savebtn:hover, .sharebtn:hover{background: var(--4);}.upldzone{border:2px dashed var(--4);padding:20px;text-align:center;margin-bottom:10px;cursor:pointer;background:var(--3);color:var(--7);overflow-wrap: break-word;max-height:300px;}.ellips, .upldzone p{white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}.saveinput{width:100%;padding:5px;margin-bottom:10px;background:var(--3);color:var(--7);border:none;}.img{margin:6px 0;max-width:100%;}.ldbtn{padding:6px;background:var(--5);color:var(--7);border:none;cursor:pointer;width:80%;max-width:12.5rem;}.xbtn{float:right;padding:4px;background:var(--5);color:var(--7);border:none;cursor:pointer;}@media (max-width: 767px){#divider{width: 14px;transition:0.5s all;}#rowDivider{height: 12px;transition:0.5s all;}}.none{display:none;}#canvas3D{position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index: 0;}#threeLoadBtn{position: absolute;bottom: 10px;right: 146px;z-index: 2;background: var(--d);color: var(--l);border: none;cursor: pointer;width:4.25rem;height:39px;}#threeLoadBtn:hover{background: var(--5);color: var(--l);}#threedModalBg{display: none;position: fixed;inset: 0;background: rgba(0, 0, 0, 0.5);z-index: 100;justify-content: center;align-items: center;}#threedModalBg.show{display: flex;}#threedModal{background: var(--2);padding: 20px;border-radius: 6px;color: var(--7);min-width: 320px;border: 1px solid var(--4);}#threedModal h2{margin-top: 0;color: var(--6);}#threedDropZone{border: 2px dashed var(--5);background: var(--3);padding: 30px;text-align: center;border-radius: 6px;cursor: pointer;transition: background 0.2s, border-color 0.2s;color: var(--7);user-select: none;}#threedDropZone:hover{background: var(--4);}#threedDropZone.dragover{border-color: var(--rh);background: var(--4);}#threedDropZone p{margin: 0;font-size: 14px;color: var(--6);}#threedModal label{color: var(--6);}#threedInfo{margin-top: 10px;color: var(--6);font-size: 14px;}#threedErr{margin-top: 10px;color: var(--rh);font-size: 14px;display: none;}#threedModal footer{margin-top: 20px;text-align: right;display: flex;gap: 10px;justify-content: flex-end;}#threedClose, #threedRevert{padding: 6px 12px;background: var(--3);color: var(--6);border: 1px solid var(--4);border-radius: 4px;cursor: pointer;}#threedClose:hover, #threedRevert:hover{background: var(--4);color: var(--l);}#threedRevert{background: var(--5);color: var(--l);}#threedRevert:hover{background: var(--6);}.format-info{margin-top: 5px;font-size: 12px;color: var(--5);}.audio-reactive-button{background-color: var(--d);position: absolute;top: 50%;right: 10px;transform: translateY(-50%);padding: 8px;background-color: var(--d);color: var(--6);border: none;border-radius: 0;cursor: pointer;font-size: 12px;display: flex;transition: all .2s ease;z-index: 2;height: 2rem;width: 2rem;}.audio-reactive-button.active{background-color: var(--a);}.audio-reactive-button.active:hover{background-color: var(--ah);}.audio-reactive-button:hover{background-color: var(--5);}.audio-reactive-modal{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background-color: none;display: none;z-index: 10000;}.audio-reactive-modal-wrap{position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);background-color: var(--3);border-radius: 2px;padding: 24px;border: 0.1px solid var(--4);min-width: 250px;max-width: 600px;max-height: 80vh;overflow-y: auto;}.audio-reactive-header{display: flex;align-items: center;justify-content: space-between;margin-bottom: 20px;}.audio-reactive-title{margin: 0;color: var(--7);display: flex;align-items: center;gap: 8px;}.audio-reactive-button-group{display: flex;gap: 8px;}.audio-reactive-info-btn{background: none;border: none;color: var(--7);font-size: 16px;cursor: pointer;padding: 4px;border-radius: 2px;transition: background .2s ease;}.audio-reactive-info-btn:hover{background-color: var(--5);}.audio-reactive-close-btn{background: none;border: none;color: var(--7);font-size: 30px;cursor: pointer;}.audio-reactive-mic-section{margin-bottom: 15px;}.audio-reactive-label{display: block;color: var(--7);margin-bottom: 8px;font-size: 14px;}.audio-reactive-select{width: 100%;padding: 8px;background: var(--3);border: 1px solid var(--4);color: var(--7);border-radius: 2px;font-size: 14px;cursor: pointer;}.audio-reactive-toggle-section{margin-bottom: 20px;padding: 0px;background: var(--d);border-radius: 2px;}.audio-reactive-toggle-btn{width: 100%;padding: 12px;background: var(--3);border: none;color: var(--7);border-radius: 2px;cursor: pointer;transition: all .2s ease;}.audio-reactive-status{margin-top: 8px;font-size: 12px;color: var(--7);text-align: center;}.audio-reactive-slider-group{margin-bottom: 10px;}.audio-reactive-slider-label{display: block;color: var(--7);margin-bottom: 4px;}.audio-reactive-slider-value{margin-left: 8px;}.audio-reactive-slider{width: 100%;}.audio-reactive-levels{margin-top: 20px;padding: 16px;background: var(--d);border-radius: 0px;}.audio-reactive-levels-title{margin: 0 0 12px 0;color: var(--7);font-size: 14px;}.audio-reactive-bars{display: flex;gap: 8px;height: 60px;align-items: end;}.audio-bar{flex: 1;border-radius: 2px;min-height: 2px;transition: height .1s ease;}.audio-bar[data-type="bass"]{background: #ff4444;}.audio-bar[data-type="mid"]{background: #44ff44;}.audio-bar[data-type="treble"]{background: #4444ff;}.audio-bar[data-type="volume"]{background: #ffff44;}.audio-reactive-bar-labels{display: flex;justify-content: space-between;color: var(--7);margin-top: 8px;}.audio-reactive-bar-label{font-size: 12px;}.audio-reactive-info-content{color: var(--7);line-height: 1.6;display: none;}.audio-reactive-info-title{color: var(--7);margin: 0 0 16px 0;}.audio-reactive-info-text{margin: 0 0 16px 0;}.audio-reactive-code-block{background: var(--d);padding: 16px;border-radius: 4px;margin: 16px 0;font-size: 13px;}.audio-reactive-code-comment{color: #8be9fd;margin-bottom: 8px;}.audio-reactive-code-type{color: #50fa7b;}.audio-reactive-code-var{color: #f8f8f2;}.audio-reactive-code-inline-comment{color: #6272a4;}.audio-reactive-example-title{color: var(--7);margin: 20px 0 12px 0;}.audio-reactive-notes-title{color: var(--7);margin: 20px 0 12px 0;}.audio-reactive-notes-list{margin: 0;padding-left: 20px;}.audio-reactive-notes-item{margin-bottom: 8px;}.audio-reactive-tip-box{background: #1a4b32;padding: 12px;border-radius: 4px;margin: 16px 0;border-left: 4px solid var(--a);}.audio-reactive-tip-strong{color: var(--a);}.audio-reactive-tip-text{color: var(--7);}.audio-reactive-file-drop{margin-bottom: 20px;padding: 20px;background: var(--d);border: 2px dashed var(--4);text-align: center;cursor: pointer;transition: border-color .2s ease;}.audio-reactive-file-drop.dragover{border-color: var(--7);}.audio-reactive-file-text{color: var(--7);}.audio-reactive-upload-btn{background: var(--5);border-radius: 2px;text-decoration: none;padding: 0.5rem 1rem;border: none;color: var(--7);cursor: pointer;}.audio-reactive-file-input{display: none;}.audio-reactive-file-audio{width: 100%;display: none;margin-top: 10px;}.audio-reactive-clear-btn{display: none;margin-top: 10px;padding: 6px 12px;background: var(--d);border: none;color: var(--7);cursor: pointer;}.audio-code-span{color:#ff79c6;}.banner{position: fixed;top: 0;left: 0;right: 0;background: var(--2);color: var(--7);padding: 12px 16px;display: flex;justify-content: space-between;align-items: center;z-index: 9999;font-size: 16px;transition: transform 0.3s ease, opacity 0.3s ease;}.banner-link{color: var(--a);margin-left: 4px;text-decoration: underline;}.banner-auth-button{margin-left: 4px;background: var(--3);color: var(--7);padding: 0.3rem 0.6rem;border: none;cursor: pointer;font-size: 1rem;}.banner-close{background: none;border: none;color: var(--7);font-size: 20px;cursor: pointer;margin-left: 20px;}.banner-no-transition{transition: none !important;}.camera-btn{position: absolute;top: 42px;right: 42px;background: var(--d);color: var(--6);border: none;width: 2rem;height: 2rem;cursor: pointer;font-size: 14px;z-index: 2;transition: background 0.2s;}.camera-btn:hover{background: var(--5);}.camera-btn.active{background: var(--r);}.camera-modal{display: none;position: fixed;top: 0;left: 0;width: 100%;height: 100%;z-index: 100;justify-content: center;align-items: center;}.camera-modal.show{display: flex;}.camera-content{background: var(--4);padding: 20px;border-radius: 8px;max-width: 600px;width: 90%;max-height: 90%;overflow-y: auto;position: relative;}.camera-header{display: flex;justify-content: space-between;align-items: center;margin-bottom: 20px;color: var(--l);}.camera-close{background: none;border: none;color: var(--l);font-size: 24px;cursor: pointer;padding: 0;width: 30px;height: 30px;display: flex;align-items: center;justify-content: center;}.camera-close:hover{color: var(--l);}.camera-preview{width: 100%;max-width: 400px;height: 300px;background: var(--2);border: 2px solid var(--5);border-radius: 4px;margin: 0 auto 20px;display: block;object-fit: cover;}.camera-controls{display: flex;flex-direction: column;gap: 10px;align-items: center;}.camera-device-select{width: 100%;max-width: 300px;padding: 8px 12px;background: var(--4);color: var(--l);border: 1px solid var(--5);border-radius: 4px;margin-bottom: 15px;}.camera-buttons{display: flex;gap: 10px;flex-wrap: wrap;justify-content: center;}.camera-control-btn{background: var(--a);color: var(--l);border: none;padding: 10px 20px;border-radius: 4px;cursor: pointer;font-size: 14px;min-width: 100px;}.camera-control-btn:hover{background: var(--ah);}.camera-control-btn:disabled{background: var(--3);cursor: not-allowed;}.camera-control-btn.stop{background: var(--r);}.camera-control-btn.stop:hover{background: var(--rh);}.camera-status{color: var(--l);text-align: center;margin-top: 10px;font-size: 14px;}.camera-error{color: var(--r);text-align: center;margin-top: 10px;font-size: 14px;}.camera-info{background: var(--2);padding: 15px;border-radius: 4px;margin-top: 20px;color: var(--7);font-size: 13px;line-height: 1.4;}.camera-info h4{margin: 0 0 10px 0;color: var(--l);}.camera-info code{background: var(--4);padding: 2px 4px;border-radius: 2px;color: var(--a);}.camera-auto-inject{margin-top: 10px;}.camera-auto-inject label{display: flex;align-items: center;gap: 8px;color: var(--l);cursor: pointer;}.camera-auto-inject input[type="checkbox"]{margin: 0;}.glsl-color-picker-overlay{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: transparent;z-index: 10000;display: none;pointer-events: none;}.glsl-color-picker{position: absolute;background: var(--2);border-radius: 8px;padding: 20px;color: var(--7);min-width: 300px;max-width: 350px;pointer-events: auto;border: 1px solid var(--4);}.glsl-color-picker h3{margin: 0 0 15px 0;color: var(--7);font-size: 16px;}.glsl-color-preview{width: 100%;height: 60px;border-radius: 4px;margin-bottom: 15px;border: 2px solid var(--4);}.glsl-color-inputs{display: grid;grid-template-columns: 1fr 1fr 1fr;gap: 10px;margin-bottom: 15px;}.glsl-input-group{display: flex;flex-direction: column;}.glsl-input-group label{font-size: 12px;color: var(--5);margin-bottom: 5px;}.glsl-input-group input{background: var(--3);border: 1px solid var(--4);border-radius: 4px;color: var(--7);padding: 8px;font-family: inherit;}.glsl-input-group input:focus{outline: none;border-color: var(--r);}.glsl-color-sliders{margin-bottom: 15px;}.glsl-slider-group{display: flex;align-items: center;margin-bottom: 8px;gap: 10px;}.glsl-slider-group label{width: 20px;font-size: 12px;color: var(--5);}.glsl-slider-group input[type="range"]{flex: 1;background: var(--3);}.glsl-slider-group span{width: 50px;font-size: 12px;color: var(--7);text-align: right;}.glsl-color-buttons{display: flex;gap: 10px;justify-content: flex-end;}.glsl-btn{padding: 8px 16px;border: none;border-radius: 4px;cursor: pointer;font-family: inherit;font-size: 14px;}.glsl-btn-cancel{background: var(--5);color: var(--7);}.glsl-btn-apply{background: var(--r);color: var(--7);}.glsl-btn:hover{opacity: 0.8;}.glsl-color-highlight{background-color: var(--ah) !important;border-radius: 2px;}.glsl-tab{position: absolute;width: 24px;height: 24px;background: var(--1);border: 1px solid var(--4);border-radius: 4px;display: flex;justify-content: center;align-items: center;cursor: pointer;z-index: 10001;transition: opacity 0.2s ease;}.glsl-tab:hover{opacity: 0.8;}.glsl-tab svg{width: 16px;height: 16px;fill: var(--7);}#flowchartWindow{position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 90vw;max-width: 1000px;height: 80vh;border-radius: 4px;z-index: 999999;display: none;flex-direction: column;}#flowchartWindow.show{display: flex;}.flowchart-header{background: var(--4);padding: 15px 20px;border-bottom: 1px solid var(--6);display: flex;justify-content: space-between;align-items: center;border-radius: 4px 4px 0 0;}.flowchart-header h3{margin: 0;color: var(--7);font-size: 18px;}.flowchart-controls{display: flex;gap: 10px;align-items: center;}.flowchart-controls button{padding: 8px 15px;background: var(--a);color: var(--0);border: none;border-radius: 2px;cursor: pointer;font-size: 14px;}.flowchart-controls button:hover{background: var(--ah);}.flowchart-controls .flowchartclose-btn{background: var(--r);margin-left: 10px;}.flowchart-controls .flowchartclose-btn:hover{background: var(--rh);}.export-dropdown{position: relative;display: inline-block;}.export-dropdown-content{display: none;position: absolute;right: 0;background-color: var(--4);min-width: 120px;box-shadow: 0px 8px 16px rgba(0,0,0,0.2);z-index: 1;border-radius: 4px;overflow: hidden;}.export-dropdown-content button{display: block;width: 100%;text-align: left;padding: 8px 12px;border: none;background: var(--4);color: var(--7);cursor: pointer;font-size: 14px;}.export-dropdown-content button:hover{background: var(--5);}.export-dropdown.show .export-dropdown-content{display: block;}.flowchart-content{flex: 1;overflow: auto;display: flex;flex-direction: column;min-height: 0;}#flowchartSVG{flex: 1;width: 100%;background: var(--3);overflow: auto;min-height: 300px;}.flowchart-node{fill: var(--2);stroke: var(--3);stroke-width: 2px;filter: drop-shadow(2px 2px 4px var(--0));cursor: pointer;}.flowchart-node:hover{stroke-width: 3px;filter: drop-shadow(3px 3px 6px var(--1));}.flowchart-node.vertex{stroke: var(--a);}.flowchart-node.fragment{stroke: var(--m);}.flowchart-node.common{stroke: var(--b);}.flowchart-label{font-size: 11px;text-anchor: middle;dominant-baseline: middle;fill: var(--7);font-weight: 500;pointer-events: none;}.flowchart-line-number{font-size: 9px;text-anchor: middle;fill: var(--5);pointer-events: none;}.flowchart-arrow{stroke: var(--5);stroke-width: 2px;fill: none;marker-end: url(#flowchart-arrow-marker);}.flowchart-overlay{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: var(--0);z-index: 99999;display: none;}.flowchart-overlay.show{display: block;}.flowchart-tooltip{position: absolute;background: var(--4);color: var(--7);padding: 8px 12px;border-radius: 4px;font-size: 12px;white-space: pre-wrap;max-width: 300px;z-index: 9999999;pointer-events: none;opacity: 0;transition: opacity 0.2s;}.flowchart-tooltip.show{opacity: 1;}.glsl-formatter-modal-overlay{position: fixed;top: 0;right: 0;bottom: 0;z-index: 10000;display: flex;opacity: 0;transition: opacity 0.3s ease;}.glsl-formatter-modal-overlay.show{opacity: 1;}.glsl-formatter-modal{background: var(--2);padding: 30px;width:50vw;transform: scale(0.8) translateY(20px);transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);}.glsl-formatter-modal-overlay.show .glsl-formatter-modal{transform: scale(1) translateY(0);}.glsl-formatter-modal-header{text-align: center;margin-bottom: 25px;position: relative;}.glsl-formatter-modal-title{font-size: 1.8rem;font-weight: 700;color:var(--a);margin: 0;}.glsl-formatter-modal-close{position: absolute;top: -16px;right: -16px;background: var(--r);border: none;width: 2rem;height: 2rem;cursor: pointer;font-size: 1.5rem;display: flex;align-items: center;justify-content: center;transition: all 0.2s ease;color:var(--0);}.glsl-formatter-modal-close:hover{background: var(--rh);}.glsl-formatter-switches{display: grid;gap: 20px;margin-bottom: 25px;}.glsl-formatter-switch-group{display: flex;align-items: center;gap: 15px;padding: 15px;background: var(--4);border-radius: 12px;transition: all 0.2s ease;}.glsl-formatter-switch-group:hover{background: var(--5);}.glsl-formatter-switch{position: relative;display: flex;align-items: center;cursor: pointer;gap: 15px;}.glsl-formatter-switch input{opacity: 0;width: 0;height: 0;}.glsl-formatter-slider{position: relative;width: 50px;height: 26px;background: var(--1);border-radius: 26px;transition: all 0.3s ease;}.glsl-formatter-slider:before{position: absolute;content: "";height: 20px;width: 20px;left: 3px;top: 3px;background: var(--6);border-radius: 50%;transition: all 0.3s ease;}.glsl-formatter-switch input:checked + .glsl-formatter-slider:before{transform: translateX(24px);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.format{background: var(--a);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.remove-lines{background: var(--ah);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.remove-comments{background: var(--rh);}.glsl-formatter-switch input:checked + .glsl-formatter-slider.minify{background: var(--b);}.glsl-formatter-switch input:disabled + .glsl-formatter-slider{opacity: 0.5;cursor: not-allowed;}.glsl-formatter-switch-label{color: var(--7);font-size: 15px;user-select: none;flex: 1;}.glsl-formatter-switch input:disabled ~ .glsl-formatter-switch-label{opacity: 0.5;color: var(--5);}.glsl-formatter-actions{display: flex;gap: 12px;justify-content: center;}.glsl-formatter-btn{padding: 12px 24px;border: none;border-radius: 12px;font-weight: 600;cursor: pointer;transition: all 0.2s ease;font-size: 14px;}.glsl-formatter-btn-primary{background: var(--a);color: var(--0);}.glsl-formatter-btn-primary:hover{background: var(--ah);}.glsl-formatter-btn-secondary{background: var(--r);color: var(--0);}.glsl-formatter-btn-secondary:hover{background: var(--rh);}.webgpu-toggle{position: absolute;bottom: 10px;right: 214px;cursor: pointer;font-size: 12px;border: none;height:39px;width: 4.25rem;font-style: inherit;color: var(--l);}.webgpu-toggle.webgl-mode{background-color: var(--d);}.webgpu-toggle.webgl-mode:hover{background-color: var(--5);}.webgpu-toggle.webgpu-mode{background-color: var(--r);}.webgpu-toggle.webgpu-mode:hover{background-color: var(--rh);}.editor-panel .panel-header span{font-weight: bold;}#webgpu-canvas{display: block;width: 100%;height: 100%;}#preview-panel .instruction-btn{position: absolute;left: 10px;top: 50%;transform: translateY(-50%);z-index: 1;background: var(--d);color: var(--6);border: none;font-size: 1em;cursor: pointer;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;}#preview-panel .instruction-btn:hover{background: var(--5);}#preview-panel .instruction-overlay{position: absolute;top: 0;left: 0;right: 0;bottom: 0;background-color: var(--0);display: flex;flex-direction: column;align-items: center;justify-content: flex-start;z-index: 9999;color: var(--7);font-size: 1rem;padding: 20px;box-sizing: border-box;overflow-y: auto;overflow-x: hidden;}#preview-panel .instruction-modal{margin-top: 4rem;width: 100%;max-width: 800px;min-width: 0;line-height: 1.5em;box-sizing: border-box;word-wrap: break-word;overflow-wrap: break-word;}#preview-panel .instruction-modal h2{color: var(--6);margin-bottom: 1rem;word-wrap: break-word;}#preview-panel .instruction-modal ul{text-align: left;padding-left: 1.2em;list-style-type: disc;margin: 0;word-wrap: break-word;}#preview-panel .instruction-modal li{margin-bottom: 0.8em;}#preview-panel .instruction-modal code{word-break: break-all;background: var(--3);padding: 2px 4px;border-radius: 3px;}#preview-panel .instruction-close-btn{position: fixed;top: 10px;right: 10px;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;cursor: pointer;border: none;background-color: var(--3);color: var(--r);font-size: 1.2rem;z-index: 10000;}#preview-panel .instruction-close-btn:hover{background-color: var(--4);}#preview-panel .tutorial-trigger-btn{position: fixed;top: 10px;right: 74px;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;cursor: pointer;border: none;background-color: var(--3);color: var(--r);font-size: 1.2rem;z-index: 10000;padding: 0;border-radius: 0;}#preview-panel .tutorial-trigger-btn:hover{background-color: var(--4);}#jsToggleBtn{z-index:2;position: absolute;bottom: 49px;right: 10px;width: 40px;height: 40px;background: var(--d);color: var(--l);border: none;cursor: pointer;z-index: 2;transition: all 0.6s ease;}#jsToggleBtn:hover{background: var(--5);}#jsToggleBtn.active{background: var(--a);}#jsCanvas{width: 100%;height: 100%;display: block;background: #000000;position: absolute;top: 0;left: 0;}.preview-panel-relative{position: relative;}.shortcut-modal{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: var(--0);display: none;justify-content: center;align-items: center;z-index: 10000;padding: 20px;box-sizing: border-box;}.shortcut-modal.show{display: flex;}.shortcut{background: var(--1);border-radius: 12px;padding: 30px;height: 90vh;max-width: 95vw;width: 100%;color: var(--7);box-shadow: 0 20px 40px var(--0);border: 1px solid var(--3);display: flex;flex-direction: column;position: relative;}.shortcut-header{flex-shrink: 0;margin-bottom: 20px;}.shortcut-title{font-size: 28px;margin-bottom: 0;color: var(--a);font-weight: 600;text-align: center;}.shortcut-content{display: flex;flex-direction: column;flex: 1;min-height: 0;}.commands-list-container{flex: 1;overflow-y: auto;overflow-x: hidden;margin-bottom: 20px;padding-right: 8px;scroll-behavior: smooth;direction: ltr;}.commands-list-container::-webkit-scrollbar{width: 10px;}.commands-list{display: grid;grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));gap: 15px;padding-bottom: 10px;}.command-item{display: flex;justify-content: space-between;align-items: center;padding: 12px 16px;background: var(--2);border-radius: 8px;border: 2px solid transparent;transition: all 0.3s ease;cursor: pointer;}.command-item:hover{border-color: var(--a);background: var(--3);}.command-item.active{border-color: var(--a);background: var(--d);}.command-desc{font-size: 14px;color: var(--6);}.command-keys{font-size: 13px;color: var(--a);font-weight: bold;}.keyboard-container{flex-shrink: 0;display: flex;justify-content: center;overflow: hidden;padding: 10px 0;width: 100%;box-sizing: border-box;}.keyboard{display: grid;gap: 4px;padding: 20px;background: var(--2);border-radius: 12px;border: 1px solid var(--4);min-width: fit-content;transform-origin: center;transition: transform 0.2s ease;}.keyboard-row{display: grid;gap: 4px;justify-content: center;}.key{background: var(--4);border: 1px solid var(--5);border-radius: 4px;color: var(--6);font-size: 11px;font-weight: 500;display: flex;align-items: center;justify-content: center;text-align: center;transition: all 0.2s ease;cursor: pointer;position: relative;min-height: 32px;padding: 2px;white-space: nowrap;}.key:hover{background: var(--5);border-color: var(--6);}.key.highlight{background: var(--a);border-color: var(--ah);color: var(--1);box-shadow: 0 0 10px var(--ah);transform: translateY(-1px);}.key.modifier{background: var(--3);}.key.modifier.highlight{background: var(--r);border-color: var(--rh);color: var(--1);}.close-btn{position: absolute;top: 15px;right: 20px;background: none;border: none;color: var(--5);font-size: 24px;cursor: pointer;transition: color 0.2s;z-index: 1;}.close-btn:hover{color: var(--7);}#preview-panel .shortcut-trigger-btn{position: fixed;top: 10px;right: 42px;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;cursor: pointer;border: none;background-color: var(--3);color: var(--r);font-size: 1.2rem;z-index: 10000;padding: 0;border-radius: 0;}#preview-panel .shortcut-trigger-btn:hover{background-color: var(--4);}.arrow-stack{display: flex;flex-direction: column;gap: 2px;height: 32px;box-sizing: border-box;}.key.half-height{min-height: calc(50% - 1px) !important;height: calc(50% - 1px) !important;max-height: calc(50% - 1px);font-size: 9px;flex: none;}@media (max-width: 800px){.shortcut{padding: 20px;height: 92vh;}.shortcut-title{font-size: 24px;}.commands-list{grid-template-columns: 1fr;}.key{min-height: 28px;font-size: 10px;}}@media (max-width: 600px){.shortcut{padding: 15px;height: 95vh;}.shortcut-title{font-size: 22px;margin-bottom: 15px;}.shortcut-header{margin-bottom: 15px;}.commands-list-container{margin-bottom: 15px;}}@media (max-width: 480px){.shortcut-modal{padding: 10px;}.shortcut{padding: 15px;height: 96vh;}.shortcut-title{font-size: 20px;}.commands-list-container{padding-right: 4px;}}#mediaUploadBtn{z-index: 2;cursor: pointer;position: absolute;top: 42px;right: 10px;background: var(--d);color: var(--6);border: none;width: 2rem;height: 2rem;padding: 0.25rem;display: flex;align-items: center;justify-content: center;}#mediaUploadBtn svg{width: 1.25rem;height: 1.25rem;}#mediaUploadBtn:hover{background: var(--5);}#baseImportBtn{background: var(--a);color: var(--l);border: none;border-radius: 4px;padding: 10px 20px;margin: 10px;cursor: pointer;font-size: 14px;}#baseImportBtn:hover{background: var(--ah);}#mediaCloseBtn{position: absolute;top: 10px;right: 15px;background: var(--r);color: var(--l);border: none;border-radius: 50%;width: 30px;height: 30px;font-size: 18px;cursor: pointer;display: flex;align-items: center;justify-content: center;}#mediaCloseBtn:hover{background: var(--rh);}#mediaModal{position: fixed;top: 0;left: 0;right: 0;bottom: 0;display: none;align-items: center;justify-content: center;z-index: 99999;max-width: 60vw;margin: auto;}#mediaModal .modal-content{background: var(--4);padding: 20px;border-radius: 8px;max-width: 90vw;max-height: 90vh;overflow: auto;text-align: center;position: relative;width: 100%;box-sizing: border-box;}#mediaModal img{max-width: 100%;max-height: 40vh;display: block;margin: 10px auto;}#mediaModal video{max-width: 100%;max-height: 30vh;display: block;margin: 10px auto;background: var(--0);}#mediaDropButton{padding: 40px 60px;border: 2px dashed var(--6);background: var(--3);border-radius: 8px;cursor: pointer;font-size: 16px;color: var(--6);margin: 20px 0;transition: all 0.3s ease;}#mediaDropButton:hover{background: var(--5);border-color: var(--a);color: var(--7);}#mediaDropButton.dragover{background: var(--5);border-color: var(--a);color: var(--7);}#mediaDragOverlay{position: absolute;top: 0;left: 0;width: 100%;height: 100%;background: var(--d);backdrop-filter: blur(5px);z-index: 2000;display: none;align-items: center;justify-content: center;flex-direction: column;color: var(--l);font-size: 24px;text-align: center;}#mediaDragOverlay .filename{margin-top: 10px;font-size: 18px;opacity: 0.8;}.modal-toggle{display: flex;background: var(--3);border-radius: 6px;margin: 10px 0;overflow: hidden;}.modal-toggle button{background: none;border: none;padding: 10px 20px;cursor: pointer;color: var(--6);transition: all 0.3s ease;flex: 1;}.modal-toggle button.active{background: var(--a);color: var(--l);}.modal-toggle button:hover:not(.active){background: var(--5);}.modal-view{display: none;}.modal-view.active{display: block;}.video-controls{display: flex;align-items: center;justify-content: center;gap: 10px;margin: 15px 0;padding: 15px;background: var(--3);border-radius: 8px;}.video-controls button{background: var(--a);color: var(--l);border: none;border-radius: 4px;padding: 8px 16px;cursor: pointer;font-size: 14px;}.video-controls button:hover{background: var(--ah);}.video-controls button:disabled{background: var(--5);cursor: not-allowed;}.video-controls .time-info{color: var(--6);font-size: 14px;margin: 0 10px;}.video-progress{width: 100%;height: 6px;background: var(--5);border-radius: 3px;margin: 10px 0;cursor: pointer;overflow: hidden;}.video-progress-bar{height: 100%;background: var(--a);border-radius: 3px;transition: width 0.1s ease;}.effects-grid{display: grid;grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));gap: 15px;margin: 20px 0;}.effect-card{background: var(--3);border: 2px solid var(--5);border-radius: 8px;padding: 15px;cursor: pointer;transition: all 0.3s ease;text-align: left;}.effect-card:hover{border-color: var(--a);background: var(--5);}.effect-card.active{border-color: var(--a);background: var(--ah);}.effect-card h4{margin: 0 0 8px 0;color: var(--7);font-size: 14px;}.effect-card p{margin: 0;color: var(--6);font-size: 12px;}.effect-controls{margin-top: 20px;padding-top: 20px;border-top: 1px solid var(--5);}.effect-control{display: flex;align-items: center;gap: 10px;margin: 10px 0;}.effect-control label{color: var(--6);font-size: 14px;min-width: 80px;}.effect-control input[type="range"]{flex: 1;height: 20px;}.effect-control input[type="number"]{width: 60px;padding: 4px;border: 1px solid var(--5);background: var(--3);color: var(--6);border-radius: 4px;}.active-effects{margin-top: 20px;padding-top: 20px;border-top: 1px solid var(--5);}.active-effect{display: flex;align-items: center;justify-content: space-between;background: var(--3);padding: 8px 12px;border-radius: 4px;margin: 5px 0;}.active-effect span{color: var(--6);font-size: 14px;}.active-effect button{background: var(--r);color: var(--l);border: none;border-radius: 4px;padding: 4px 8px;cursor: pointer;font-size: 12px;}.active-effect button:hover{background: var(--rh);}.apply-effects-btn{background: var(--a);color: var(--l);border: none;border-radius: 4px;padding: 12px 24px;margin: 20px 0;cursor: pointer;font-size: 16px;width: 100%;}.apply-effects-btn:hover{background: var(--ah);}.apply-effects-btn:disabled{background: var(--5);cursor: not-allowed;}.loadmediawarn{font-size: 12px;color: var(--6);opacity: 0.8;}.download-modal-overlay{position: fixed;inset: 0;backdrop-filter: blur(4px);display: flex;align-items: center;justify-content: center;z-index: 9999;opacity: 0;pointer-events: none;transition: opacity .25s ease;}.download-modal-overlay.active{opacity: 1;pointer-events: auto;}.download-modal{background: var(--3);color: var(--d);border: 2px solid var(--7);border-radius: 8px;padding: 20px;width: 280px;box-shadow: 0 0 20px var(--0);display: flex;flex-direction: column;gap: 15px;}.download-modal h2{margin: 0;font-size: 18px;color: var(--D);}.download-modal p{margin: 0;font-size: 14px;color: var(--l);}.sdownload-sbtn-row{display: flex;justify-content: space-between;margin-top: 10px;}.sdownload-sbtn{padding: 8px 14px;cursor: pointer;border: none;border-radius: 6px;font-size: 14px;transition: background .2s ease;}.sbtn-confirm{background: var(--a);color: var(--1);}.sbtn-confirm:hover{background: var(--ah);}.sbtn-cancel{background: var(--r);color: var(--1);}.sbtn-cancel:hover{background: var(--rh);}#uploadHTMLBtn{position: absolute;bottom: 10px;right: 78px;background: var(--d);color: var(--l);border: none;cursor: pointer;height: 39px;z-index: 2;width: 4.25rem;transition: background 0.2s;}#uploadHTMLBtn:hover{background: var(--5);}#uploadHTMLInput{display: none;}#editFileToggle{position: absolute;bottom: 54px;right: 78px;background: var(--d);color: var(--l);border: none;cursor: pointer;height: 36px;z-index: 3;width: 4.25rem;font-size: 0.8rem;transition: background 0.2s, opacity 0.2s;opacity: 0.95;}#editFileToggle:hover{background: var(--5);opacity: 1;}.glsl-performance-monitor-container{position: absolute;z-index: 1;}.glsl-performance-monitor-toggle{width: 2rem;height: 2rem;border: none;background-color: var(--d);cursor: pointer;padding: 7px;display: flex;justify-content: center;align-items: center;}.glsl-performance-monitor-toggle:hover{background-color: var(--5);}.glsl-performance-monitor-panel{padding: 12px;background-color: var(--d);color: var(--7);font-size: 12px;width: 60%;}.glsl-performance-monitor-header{display: flex;justify-content: space-between;align-items: center;margin-bottom: 10px;}.glsl-performance-monitor-title{font-weight: bold;color: var(--7);}.glsl-performance-monitor-display{margin-bottom: 6px;}.glsl-performance-monitor-value{color: var(--ah);}.glsl-performance-monitor-details{padding-left: 10px;color: var(--6);}.glsl-performance-monitor-highlight{color: var(--7);}.glsl-performance-monitor-container.top-left{top: 10px;left: 10px;}.glsl-performance-monitor-container.top-right{top: 10px;right: 10px;}.glsl-performance-monitor-container.bottom-left{bottom: 10px;left: 10px;}.glsl-performance-monitor-container.bottom-right{bottom: 10px;right: 10px;}.audio-notification{display: flex;align-items: center;justify-content: center;position: fixed;top: 10px;right: 44px;background: var(--1);color: var(--a);border: 1px solid var(--a);border-radius: 0px;font-size: 16px;font-weight: bold;z-index: 10000;box-shadow: 0 4px 12px var(--0);animation: countdownPulse 0.8s ease-out;min-width: 2rem;min-height: 2rem;text-align: center;}@keyframes countdownPulse{0%{transform: scale(0.9);opacity: 0;}50%{transform: scale(1.05);opacity: 1;}100%{transform: scale(1);opacity: 1;}}.audio-wrapper{display: flex;flex-direction: column;gap: 8px;padding: 0.5em 0;border-radius: 10px;color: var(--7);min-width: 400px;}.audio-time-container{display: flex;align-items: center;justify-content: center;gap: 5px;font-size: 12px;color: var(--6);min-width: 80px;}.audio-controls-row{display: flex;align-items: center;gap: 10px;position: relative;}.audio-play-pause{background: var(--a);color: var(--1);border: none;border-radius: 5px;cursor: pointer;width: 3rem;height: 2rem;font-size: 14px;flex-shrink: 0;}.audio-seek-bar{flex: 1;appearance: none;height: 2rem;border-radius: 2px;background: var(--4);outline: none;}.audio-volume-container{position: relative;flex-shrink: 0;height: 2rem;display: flex;align-items: center;}.audio-volume-button{background: none;border: none;cursor: pointer;font-size: 14px;color: var(--7);padding: 0;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;}.audio-volume-panel{position: absolute;bottom: 100%;left: 50%;transform: translateX(-50%);background: var(--1);border: 1px solid var(--4);border-radius: 8px;padding: 10px 8px;margin-bottom: 5px;box-shadow: 0 4px 12px var(--0);opacity: 0;visibility: hidden;transition: opacity 0.2s, visibility 0.2s;z-index: 1000;display: flex;flex-direction: column;align-items: center;gap: 8px;}.audio-volume-panel.visible{opacity: 1;visibility: visible;}.audio-volume-display{font-size: 11px;color: var(--7);font-weight: bold;min-width: 30px;text-align: center;}.audio-slider-track{width: 4px;height: 80px;background: var(--4);border-radius: 2px;position: relative;cursor: pointer;}.audio-slider-fill{width: 100%;background: var(--a);border-radius: 2px;position: absolute;bottom: 0;transition: height 0.1s ease;}.audio-slider-handle{width: 12px;height: 12px;background: var(--a);border-radius: 50%;position: absolute;left: 50%;transform: translateX(-50%);cursor: pointer;border: 2px solid var(--1);box-shadow: 0 2px 4px var(--0);}.audio-countdown-toggle{border: none;border-radius: 5px;cursor: pointer;width: 2rem;height: 2rem;font-size: 12px;flex-shrink: 0;transition: background 0.2s;display: flex;align-items: center;justify-content: center;}.audio-countdown-toggle.enabled{background: var(--a);color: var(--1);}.audio-countdown-toggle.disabled{background: var(--4);color: var(--7);}#recSettings{display: none;position: absolute;bottom: 42px;left: 10px;background: var(--d);color: var(--l);padding: 10px;z-index: 100;font-size: 0.9rem;min-width: 240px;max-height:80%;overflow-y: auto;}#recSettings label{display: block;margin-bottom: 6px;}#recSettings input{margin-left: 4px;}#recSettings .preset{margin-right: 4px;margin-top: 4px;}#recSettings button{padding: 4px 8px;margin: 2px;cursor: pointer;border:0px;border-radius:6px;}#recSettings .active{background:var(--a);color: var(--7);}#recBtn{width:2rem;height:2rem;position: absolute;bottom: 10px;left: 10px;background: var(--d);color: var(--l);border: none;padding: 8px;cursor: pointer;z-index: 1;font-size: 1rem;display: flex;align-items: center;justify-content: center;}#recBtn:hover{background:var(--5);}#recBtn svg{width: 14px;height: 14px;}#recBtn svg circle{fill: var(--r);}#recordingIndicator{display: none;position: absolute;top: 10px;right: 10px;background:var(--rh);color: var(--1);padding: 5px 10px;border-radius: 4px;z-index: 100;animation: pulse 1.5s infinite;}@keyframes pulse{0%{opacity: 1;}50%{opacity: 0.6;}100%{opacity: 1;}}input, select{padding: 1rem;border-radius: 5px;border: 0px;width: 100%;background: var(--d);color: var(--l);}.checkbox-container{position: relative;display: inline-flex;align-items: center;cursor: pointer;margin-left: 8px;}.checkbox-container input[type="checkbox"]{opacity: 0;position: absolute;width: 18px;height: 18px;margin: 0;padding: 0;cursor: pointer;}.custom-checkbox{width: 18px;height: 18px;border: 2px solid var(--l);border-radius: 3px;background: var(--d);position: relative;display: flex;align-items: center;justify-content: center;transition: all 0.2s ease;}.checkbox-container input[type="checkbox"]:checked + .custom-checkbox{background: var(--a);border-color: var(--a);}.custom-checkbox::after{content: '';position: absolute;width: 5px;height: 9px;border: solid var(--7);border-width: 0 2px 2px 0;transform: rotate(45deg) scale(0);transition: transform 0.15s ease-in-out;top: 1px;}.checkbox-container input[type="checkbox"]:checked + .custom-checkbox::after{transform: rotate(45deg) scale(1);}.checkbox-container:hover .custom-checkbox{border-color: var(--a);}#videoPreview{display: none;margin-top: 10px;padding: 10px;background: var(--1);border-radius: 5px;}#videoPreview video{width: 100%;max-height: 200px;border-radius: 5px;background: var(--1);}#videoPreview .controls{margin-top: 10px;display: flex;gap: 5px;flex-wrap: wrap;}#videoPreview .controls button{padding: 6px 12px;border: none;border-radius: 5px;cursor: pointer;font-size: 12px;flex: 1;min-width: 70px;}#videoPreview .download-btn{background: var(--m);color: var(--1);}#videoPreview .download-btn:hover{background: var(--6);color: var(--7);}#videoPreview .delete-btn{background: var(--r);color: var(--7);}#videoPreview .delete-btn:hover{background: var(--rh);color: var(--1);}#videoPreview .info{color: var(--l);font-size: 11px;margin-top: 8px;line-height: 1.3;}.status-block{background: var(--d);padding: 6px;border-radius: 6px;margin: 5px 0px;font-size: 11px;color: var(--7);}.status-block .canvas-mode,.status-block .audio-status{background: none;padding: 2px 0;margin: 0;border-radius: 0;color: inherit;}.custom-context-menu{background:var(--d);border:0.3px solid var(--l);border-radius:4px;user-select:none;position:absolute;z-index:99999;min-width:150px;display:none;}.custom-context-menu-item{padding:8px 12px;color:var(--7);cursor:pointer;font-size:12px;}.custom-context-menu-item:hover{background:var(--D);}.custom-context-menu-item.disabled{color:var(--3);cursor:not-allowed;}.custom-context-menu-item.disabled:hover{background:transparent;}.custom-context-menu-separator{height:2px;background:var(--4);margin:5px 0;}.line-info{padding:8px 12px;color:var(--6);font-size:12px;border-bottom:1px solid var(--4);text-align:center;}.inline-control{padding:8px 12px;background:var(--D);}.inline-control label{display:block;color:var(--7);margin-bottom:4px;font-size:11px;}.inline-control input{width:100%;padding:4px;border-radius:3px;border:1px solid var(--5);background:var(--d);color:var(--7);font-size:11px;}.inline-control input[type="range"]{margin:4px 0;}.inline-buttons{display:flex;gap:4px;margin-top:6px;}.inline-buttons button{padding:4px 8px;border-radius:3px;border:none;cursor:pointer;font-size:11px;flex:1;}.btn-cancel{background:var(--3);color:var(--7);}.btn-confirm{background:var(--a);color:var(--1);}.slider-value{color:var(--6);font-size:10px;text-align:center;margin-top:2px;}#toastContainer{position: fixed;bottom: 20px;left: 50%;transform: translateX(-50%);z-index: 10000;pointer-events: none;}.toast{color: var(--7);padding: 10px 16px;border-radius: 0;box-shadow: 0 4px 12px var(--1);margin-bottom: 10px;font-weight: 500;font-size: 14px;max-width: 400px;text-align: center;opacity: 0;transform: translateY(20px);transition: all 0.3s ease;pointer-events: auto;}.toast.success{background: var(--2);border: 2px solid var(--a);}.toast.error{background: var(--r);border: 2px solid var(--1);}.toast.info{background: var(--a);border: 2px solid var(--1);}.toast.warning{background: var(--r);border: 2px solid var(--1);}.toast.visible{opacity: 1;transform: translateY(0);}.toast.hiding{opacity: 0;transform: translateY(-20px);}.shader-card{border: 1px solid var(--4);padding: 4px;margin-bottom: 8px;}.shader-card-header{display: flex;align-items: center;gap: 4px;}.shader-title{display: inline-block;max-width: 160px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}.shader-author{font-size: 0.85em;color: var(--5);}.upload-zone.dragover{background: var(--4);}.upload-zone{background: var(--3);}.search-container{position: relative;margin: 10px 0;width: 100%;}.search-input{width: 100%;padding: 8px 12px;padding-right: 35px;border: 1px solid var(--4);border-radius: 2px;font-size: 14px;background-color: var(--2);color: var(--7);box-sizing: border-box;}.search-input:focus{outline: none;border-color: var(--a);}.search-input::placeholder{color: var(--5);}.clear-btn{position: absolute;right: 8px;top: 50%;transform: translateY(-50%);background: none;border: none;font-size: 16px;cursor: pointer;color: var(--6);width: 20px;height: 20px;display: none;align-items: center;justify-content: center;border-radius: 50%;line-height: 1;}.clear-btn:hover{background-color: var(--r);color: var(--0);}.no-results-message{text-align: center;padding: 20px;color: var(--4);font-style: italic;margin: 0;}#pm-toggle-btn{z-index:2;position: absolute;top: 10px;right: 74px;background: var(--d);color: var(--6);border: none;width: 2rem;height: 2rem;cursor: pointer;z-index: 10;display: flex;align-items: center;justify-content: center;}#pm-toggle-btn:hover{background:var(--5);}#pm-toggle-btn svg{width: 60%;height: 60%;}#pm-root{position: fixed;right: 12px;top: 10px;width: 90%;max-width: calc(100% - 24px);height: 420px;background: var(--4);color: var(--7);border-radius: 4px;padding: 12px;box-shadow: 0 12px 36px var(--1);z-index:100;display: flex;flex-direction: column;gap: 8px;}#pm-root .pm-header{display:flex;align-items:center;justify-content:space-between;gap:8px;}#pm-controls{display:flex;gap:8px;align-items:center;}.pm-btn{background:var(--5);color:var(--l);border:1px solid var(--5);padding:6px 8px;border-radius:4px;cursor:pointer;font-size:13px;}.pm-btn:active{transform: translateY(1px);}#pm-body{display:flex;gap:12px;height: calc(100% - 58px);}#pm-steps-area{flex: 1 1 420px;background:var(--4);border-radius: 8px;padding:10px;overflow:auto;display:flex;align-items:center;}.pm-steps-row{display:flex;align-items:flex-start;gap:10px;padding-bottom:6px;}.pm-step{width: 250px;min-width: 200px;background: var(--2);border: 1px solid var(--5);border-radius:8px;padding:8px;display:flex;flex-direction:column;gap:6px;}.pm-step.pm-future{opacity: 0.45;filter: grayscale(20%);pointer-events: none;}.pm-step.pm-active{outline: 2px solid var(--a);opacity: 1;pointer-events: auto;}.pm-step .pm-header{display:flex;gap:6px;align-items:center;justify-content:space-between;}.pm-step label{font-size:12px;color:#aaa;}.pm-step textarea{width:100%;height:88px;background:var(--1);color:#cfe;border:1px solid var(--5);resize:vertical;font-size:12px;padding:6px;}.pm-step input.pm-delay{width: 70px;padding:6px;border-radius:6px;border:1px solid var(--6);background:#111;color:var(--l);font-size:13px;}.pm-step .pm-actions{display:flex;gap:6px;justify-content:flex-end;align-items:center;}.pm-arrow{width:40px;height:40px;display:flex;align-items:center;justify-content:center;user-select:none;opacity:0.9;}.pm-small{font-size:12px;padding:5px 8px;}.pm-step .pm-step-title{font-size:13px;color:var(--l);font-weight:600;}.performance-mode-canvas{position: fixed;top: 0;left: 0;width: 100vw;height: 100vh;z-index: 99999999;}.performance-mode-preview{position: fixed;top: 0;left: 0;width: 100vw;height: 100vh;z-index: 99999998;}.performance-mode-body{overflow: hidden;cursor: none !important;}.performance-mode-app{overflow: hidden;}.performance-mode-hidden{display: none;}.glsl-editor-wrapper{position: relative;box-sizing: border-box;width: 100%;height: 100%;}.glsl-editor{position: relative;width: 100%;height: 100%;box-sizing: border-box;font-family: inherit;font-size: inherit;line-height: inherit;border: inherit;outline: none;background: transparent;color: var(--6);overflow: auto;white-space: pre-wrap;word-wrap: break-word;caret-color: var(--caret, #ffffff);}.glsl-hidden-textarea{display: none !important;}.token-comment{color: var(--token-comment);}.token-keyword{color: var(--token-keyword);}.token-type{color: var(--token-type);}.token-number{color: var(--token-number);}.token-function{color: var(--token-function);}.token-builtin{color: var(--token-builtin);}.token-variable{color: var(--token-variable);}#theme-manager-btn{z-index:2;position: absolute;top: 10px;right: 42px;z-index: 1;background: var(--d);border: none;width: 2rem;height: 2rem;font-size: 20px;cursor: pointer;transition: all 0.2s ease;display: flex;align-items: center;justify-content: center;padding: 0;pointer-events: auto;}#theme-manager-btn:hover{background-color: var(--5);}#theme-confirm-modal{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: var(--d);z-index: 1010;display: none;justify-content: center;align-items: center;}.theme-confirm-modal-content{background: var(--2);border: 1px solid var(--5);border-radius: 6px;padding: 20px;max-width: 300px;width: 90%;text-align: center;}.theme-confirm-theme-modal-title{margin: 0 0 15px 0;color: var(--6);font-size: 16px;}.theme-confirm-modal-message{margin: 0 0 20px 0;color: var(--6);font-size: 14px;line-height: 1.4;}.theme-confirm-modal-buttons{display: flex;gap: 10px;justify-content: center;}.theme-confirm-cancel-btn{padding: 8px 16px;background: var(--4);color: var(--6);border: 1px solid var(--5);border-radius: 4px;cursor: pointer;font-size: 12px;transition: background-color 0.2s;}.theme-confirm-delete-btn{padding: 8px 16px;background: var(--r);color: var(--7);border: none;border-radius: 4px;cursor: pointer;font-size: 12px;transition: background-color 0.2s;}#theme-modal{position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 300px;max-height: calc(100vh - 40px);background: var(--3);color: var(--1);border-radius: 4px;z-index: 1005;display: none;overflow: hidden;border: 1px solid var(--2);}.theme-modal-header{padding: 20px;border-bottom: 1px solid var(--2);background: var(--2);}.theme-modal-header-content{display: flex;justify-content: space-between;align-items: center;}.theme-modal-title{margin: 0;color: var(--6);font-size: 18px;}.theme-modal-close-btn{background: none;border: none;font-size: 20px;cursor: pointer;color: var(--r);padding: 0;width: 24px;height: 24px;}.theme-select-container{margin-top: 15px;}.theme-select-label{display: block;font-size: 11px;margin-bottom: 4px;color: var(--6);}.theme-select{width: 100%;padding: 8px;background: var(--3);border: 1px solid var(--5);border-radius: 4px;cursor: pointer;font-size: 12px;box-sizing: border-box;color: var(--6);}.theme-toggle-editor-container{margin-top: 12px;}.theme-toggle-editor-btn{width: 100%;padding: 8px;background: var(--b);color: var(--7);border: none;border-radius: 4px;cursor: pointer;font-size: 12px;}.color-editor-controls{padding: 15px;border-bottom: 1px solid var(--5);background: var(--4);}.theme-name-container{margin-bottom: 12px;}.theme-name-label{display: block;font-size: 11px;margin-bottom: 4px;color: var(--6);}.theme-name-input{width: 100%;padding: 6px 8px;border: 1px solid var(--5);border-radius: 4px;font-size: 12px;margin-bottom: 8px;box-sizing: border-box;}.theme-action-buttons{display: flex;gap: 6px;}.save-theme-btn{flex: 1;padding: 6px 8px;background: var(--a);color: var(--7);border: none;border-radius: 4px;cursor: pointer;font-size: 11px;}.delete-theme-btn{padding: 6px 8px;background: var(--r);color: var(--7);border: none;border-radius: 4px;cursor: pointer;font-size: 11px;}.color-inputs-container{max-height: calc(100vh - 300px);overflow-y: auto;padding: 15px;}.reset-section{padding: 15px;border-top: 1px solid var(--5);background: var(--7);}.theme-reset-btn{width: 100%;padding: 8px;background: var(--4);color: var(--7);border: none;border-radius: 4px;cursor: pointer;font-size: 12px;}.theme-color-picker-container{margin-bottom: 12px;padding: 10px;border: 1px solid var(--5);border-radius: 2px;background: var(--4);}.theme-color-picker-header{display: flex;align-items: center;justify-content: space-between;margin-bottom: 8px;}.property-label{font-weight: bold;font-size: 12px;color: var(--1);}.theme-color-preview{width: 30px;height: 20px;border: 1px solid var(--5);border-radius: 3px;}.theme-color-input-label{display: block;font-size: 10px;margin-bottom: 4px;color: var(--1);}.theme-color-input{width: 100%;height: 30px;border: none;border-radius: 4px;cursor: pointer;margin-bottom: 6px;}.alpha-label{display: block;font-size: 10px;margin-bottom: 4px;color: var(--1);}.alpha-slider{width: 100%;height: 15px;}.autosave-overlay{position: fixed;bottom: 20px;right: 20px;z-index: 10000;pointer-events: none;}.autosave-dialog{background-color: var(--2);border: 1px solid var(--4);border-radius: 2px;padding: 16px;max-width: 320px;width: 100%;animation: slideIn 1.5s ease-out;pointer-events: auto;}.autosave-title{margin-bottom: 16px;color: var(--7);font-size: 18px;font-weight: 600;}.autosave-message{margin-bottom: 24px;color: var(--6);line-height: 1.5;}.autosave-button-container{display: flex;gap: 12px;justify-content: flex-end;}.autosave-btn{padding: 8px 16px;border-radius: 2px;cursor: pointer;font-size: 14px;transition: all 0.2s ease;}.autosave-btn-no{border: 1px solid var(--4);background-color: var(--3);color: var(--6);}.autosave-btn-no:hover{background-color: var(--4);color: var(--7);}.autosave-btn-yes{font-weight: 500;border: 1px solid var(--a);background-color: var(--a);color: var(--l);}.autosave-btn-yes:hover{background-color: var(--ah);}@keyframes slideIn{from{opacity: 0;transform: translateY(-20px) scale(0.95);}to{opacity: 1;transform: translateY(0) scale(1);}}</style> <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebApplication","name":"MW – Shader Sandbox","description":"A WebGL shader sandbox and audio-reactive visual performance environment for real-time experimentation and live visuals.","applicationCategory":"MultimediaApplication","operatingSystem":"Web","url":"/shader","browserRequirements":"Requires WebGL and Web Audio API support"}</script> </head><body><div id="app"><div id="editors"><button class="lbtn ellips" onclick="openShaderWindow()" title="Save shaders and browse public gallery">Save / Browse</button><div id="shaderWindow" class="savew"><div class="toggles"><button id="tabSaveBtn" onclick="showTab('save')" class="togbtn">Save</button><button id="tabLocalBtn" onclick="showTab('local')" class="togbtn">Local</button></div><div id="tabSave" class="savesct"><h3>Save</h3><div id="uploadZone" class="upldzone"><p>Drag & Drop Image Here<br>or</p><button id="chooseFileBtn" class="savebtn">Choose File</button><input type="file" id="shaderImage" accept="image/*" style="display:none;"><div id="fileName" class="ellips"></div></div><input type="text" id="shaderTitle" placeholder="Shader Title" class="saveinput"><br><button class="sharebtn" onclick="saveLink()">Share &nbsp;Link&nbsp;</button><button class="sharebtn" onclick="saveLocally()">Save Locally</button></div><div id="tabLocal" class="savesct"><h3>Local</h3><div id="localShaderList"></div></div><button class="closebtn" onclick="closeShaderWindow()">Close</button></div><div id="vertPanel" class="editor-panel"><div class="panel-header"><span>Vertex Shader</span><button type="button" id="vertFileBtn" title="Upload a Vertex Shader (.frag,.fs,.txt)">Upload<span class="file-name" id="vertFileName"></span></button><input type="file" id="vertFile" accept=".vert,.vs,.txt" /></div><textarea spellcheck="false" id="vertCode">
attribute vec2 a_position;
void main() {
  gl_Position = vec4(a_position, 0., 1.);
}</textarea></div><div id="rowDivider"></div><div id="fragPanel" class="editor-panel"><div class="panel-header"><span>Fragment Shader</span><button type="button" id="fragFileBtn" title="Upload a Fragment Shader (.frag,.fs,.txt)">Upload<span class="file-name" id="fragFileName"></span></button><input type="file" id="fragFile" accept=".frag,.fs,.txt" /></div><textarea spellcheck="false" id="fragCode">
//WebGL editor - Created By: Max Warren
precision mediump float;
uniform vec2 u_resolution;
uniform float u_time;
uniform float u_volume;
uniform float u_treble;
uniform float u_mid;
uniform float u_bass;
uniform vec2 u_scroll;
uniform vec2 mouse;
vec2 axel = vec2(1.0);
float hash(vec2 p) {
    p = fract(p * vec2(123.34, 456.21));
    p += dot(p, p + 78.23);
    return fract(p.x * p.y);
}
float boxSDF(vec3 p, vec3 b) {
    vec3 d = abs(p) - b;
    return length(max(d, 0.0)) + min(max(d.x, max(d.y, d.z)), 0.0);
}
float sceneSDF(vec3 p) {
    vec2 gridPos = floor(p.xz / 4.0);
    vec2 localPos = mod(p.xz, 4.0) - 2.0;
    float h = hash(gridPos) * 10.0 + u_volume;
    float d = boxSDF(vec3(localPos.x, p.y, localPos.y), vec3(1.0, h, 1.0));
    return d;
}
float raymarch(vec3 ro, vec3 rd, float maxDist) {
    float t = 0.0;
    for(int i = 0; i < 100; i++) {
        vec3 p = ro + rd * t;
        float d = sceneSDF(p);
        if(d < 0.001 || t > maxDist) break;
        t += d * 0.1;
    }
    return t;
}
vec3 getNormal(vec3 p) {
    float e = 0.001;
    return normalize(vec3(
        sceneSDF(p + vec3(e, 0, 0)) - sceneSDF(p - vec3(e, 0, 0)),
        sceneSDF(p + vec3(0, e, 0)) - sceneSDF(p - vec3(0, e, 0)),
        sceneSDF(p + vec3(0, 0, e)) - sceneSDF(p - vec3(0, 0, e))
    ));
}
void main() {
    axel = mouse;
    vec2 uv = (gl_FragCoord.xy / u_resolution) * 2.0 - 1.0 + (axel * 0.1);
    uv.x *= u_resolution.x / u_resolution.y;
    vec3 ro = vec3(0.0, 2.0, u_time *5.0 - (0.1*u_scroll));
    vec3 lookAt = vec3(0.0, 2.0, ro.z + 5.0);
    vec3 forward = normalize(lookAt - ro);
    vec3 right = normalize(cross(vec3(0.0,1.0,0.0), forward));
    vec3 up = cross(forward, right);
    vec3 rd = normalize(uv.x * right + uv.y * up + 1.5 * forward);
    float t = raymarch(ro, rd, 100.0);
    vec3 col = vec3(0.0);
    if(t < 100.0) {
        vec3 p = ro + rd * t;
        vec3 n = getNormal(p);
        float diff = clamp(dot(n, vec3(0.5, 1.0, 0.5)), u_treble, 1.0);
        float glow = u_bass;
        if(abs(mod(p.y, 2.0) - 1.0) < 0.1) {
            glow = 1.0;
        }
        col = mix(vec3(u_mid, 0.5, 1.0) * diff, vec3(0.8, 0.2, 1.0), glow);
        col = mix(col, vec3(0.0), 1.0 - exp(-0.02 * t * t));
    }
    gl_FragColor = vec4(col, 1.0);
}</textarea></div></div><div id="divider"></div><div id="preview-panel"><canvas id="glcanvas"></canvas><button id="fsBtn">⛶</button><div id="lint"><button id="copyErrorsBtn" style="display: none;">Copy All Errors</button><button id="closeLintBtn" style="display: none;">✕</button><div id="lintContent"></div></div></div></div><script>!function(){const e=document.getElementById("preview-panel");if(!e)return;const t=document.createElement("div");t.id="mediaDragOverlay",t.innerHTML='\n    <div>Drop file to upload</div>\n    <div class="filename"></div>\n  ',e.appendChild(t);const n=t.querySelector(".filename");let i=0;function o(t){const n=e.getBoundingClientRect();return t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom}function a(e){if(e.type.startsWith("image/")||e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif"))return"image";if(e.type.startsWith("video/"))return"video";if(e.type.startsWith("audio/"))return"audio";const t=e.name.split(".").pop().toLowerCase();if(["obj","ply","stl","off"].includes(t))return"3dmodel";if(["html","js","frag","vert","vs","fs","wgsl","txt"].includes(t))return"code";return["mp3","wav","ogg","flac","m4a","aac","opus"].includes(t)?"audio":"unknown"}window.mediaUpload=window.mediaUpload||{},window.mediaUpload.isModalOpen=function(){const e=document.getElementById("mediaModal"),t=document.querySelector(".audio-reactive-modal"),n=document.getElementById("threedModalBg");return e&&"flex"===e.style.display||t&&"block"===t.style.display||n&&n.classList.contains("show")},window.mediaUpload.onFileReceived=null,window.mediaUpload.onCodeFileReceived=null,window.mediaUpload.onAudioFileReceived=null,window.mediaUpload.on3DModelReceived=null,window.mediaUpload.showDragOverlay=function(e,i=""){e?(n.textContent=i||"File",t.style.display="flex"):t.style.display="none"},window.addEventListener("dragenter",(e=>{if(e.preventDefault(),i++,!window.mediaUpload.isModalOpen()&&((a=e.dataTransfer).items&&[...a.items].some((e=>{if("file"!==e.kind)return!1;const t=e.type.toLowerCase();return!!(t.startsWith("image/")||t.startsWith("video/")||t.startsWith("audio/"))||"text/html"===t||"text/plain"===t||"application/javascript"===t||"text/javascript"===t||!("application/octet-stream"!==t&&!t.startsWith("model/"))||""===t||!t})))&&o(e)){const i=function(e){if(e.items&&e.items.length>0){const t=e.items[0];if(t.type){if(e.files&&e.files.length>0)return e.files[0].name;const n=t.getAsFile();return n?.name||"File"}return"Code/Shader file"}return"File"}(e.dataTransfer);n.textContent=i,t.style.display="flex"}var a})),window.addEventListener("dragover",(e=>{e.preventDefault()})),window.addEventListener("dragleave",(e=>{e.preventDefault(),i=Math.max(i-1,0),o(e)&&0!==i||(t.style.display="none")})),window.addEventListener("drop",(e=>{e.preventDefault(),t.style.display="none",i=0;const n=e.dataTransfer.files[0];if(n&&o(e)){const e=a(n);if("unknown"!==e)if(function(e){if(!e)return;const t=a(e);if("unknown"!==t)if("3dmodel"!==t)if("image"!==t&&"video"!==t)if("audio"!==t){if("code"===t)if(window.mediaUpload.onCodeFileReceived)window.mediaUpload.onCodeFileReceived(e);else{const t=document.getElementById("uploadHTMLInput");if(t){const n=new DataTransfer;n.items.add(e),t.files=n.files,t.dispatchEvent(new Event("change",{bubbles:!0}))}}}else window.mediaUpload.onAudioFileReceived?window.mediaUpload.onAudioFileReceived(e):window.audioReactiveInstance&&(window.audioReactiveInstance.show(),setTimeout((()=>{window.audioReactiveInstance.loadFileFromDrop(e)}),100));else window.mediaUpload.onFileReceived&&window.mediaUpload.onFileReceived(e);else if(window.mediaUpload.on3DModelReceived)window.mediaUpload.on3DModelReceived(e);else{const t=document.getElementById("objFileInput");if(t){const n=new DataTransfer;n.items.add(e),t.files=n.files,t.dispatchEvent(new Event("change",{bubbles:!0}))}}else window.showToast&&window.showToast(`Unsupported file type: ${e.name}`,"error")}(n),"image"===e||"video"===e){const e=document.getElementById("mediaModal");e&&(e.style.display="flex")}else if("3dmodel"===e){const e=document.getElementById("threedModalBg");e&&e.classList.add("show")}}})),document.addEventListener("fullscreenchange",(()=>{(document.fullscreenElement||e).appendChild(t)})),window.addEventListener("beforeunload",(()=>{i=0,t.style.display="none"}))}(),window.getCurrentAnimationType=function(){return window.is3DModelActive?.()?"3d":window.jsCanvasState?.isJSMode()?"js":window.webgpuState?.isWebGPUMode()?"webgpu":"webgl"},window.switchToAnimationType=function(e){const t=window.getCurrentAnimationType();t!==e&&("3d"===t&&window.deactivate3DModel?.(),"js"===e?document.getElementById("jsToggleBtn")?.click():"webgpu"===e?document.getElementById("webgpuToggle")?.click():"webgl"===e&&("js"===t&&document.getElementById("jsToggleBtn")?.click(),"webgpu"===t&&document.getElementById("webgpuToggle")?.click()))},(()=>{const e=e=>document.getElementById(e),t=e("shaderWindow"),n=e("shaderImage"),i=e("shaderTitle"),o=e("vertCode"),a=e("fragCode"),s=e("fileName"),r=e("uploadZone"),l=e("chooseFileBtn"),c=e=>e[0].toUpperCase()+e.slice(1);window._localShaderList=[];function d(e,t="info"){!function(){const e=document.fullscreenElement||document.documentElement;let t=document.getElementById("toastContainer");t?t.parentNode!==e&&(t.remove(),e.appendChild(t)):(t=document.createElement("div"),t.id="toastContainer",e.appendChild(t))}();const n=document.createElement("div");n.className=`toast ${t}`,n.textContent=e,document.getElementById("toastContainer").appendChild(n),requestAnimationFrame((()=>{n.classList.add("visible")})),setTimeout((()=>{n.classList.add("hiding"),n.classList.remove("visible"),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n)}),300)}),5e3)}const u=()=>t.style.display="none";function m(t){["save","local"].forEach((n=>{e(`tab${c(n)}`).style.display=n===t?"block":"none",e(`tab${c(n)}Btn`).style.background=`var(--${n===t?3:4})`})),"local"===t&&h()}function h(){const t=e("localShaderList");t.innerHTML="",window._localShaderList=[],Object.entries(localStorage).filter((([e])=>e.startsWith("shader_")&&!e.includes("cache")&&!e.includes("fetch"))).forEach((([e,n])=>{try{const i=JSON.parse(n),o=window._localShaderList.length;window._localShaderList.push(i),t.appendChild(function(e,t,n){const i=document.createElement("div");return i.className="shader-card",i.innerHTML=`\n      <div class="shader-card-header">\n        <strong class="shader-title" title="${e.title}">${e.title}</strong>\n      </div>\n      <img src="${e.preview}" class="img"><br>\n      <button class="ldbtn" data-local-index="${n}">Load</button>\n      <button class="xbtn" onclick='deleteLocal("${t}")'>X</button>\n    `,i}(i,e,o))}catch{}}))}function p(){document.querySelectorAll(".ldbtn").forEach((e=>{e.disabled=!0,e.dataset.originalText=e.textContent,e.textContent="Loading..."}))}function g(){document.querySelectorAll(".ldbtn").forEach((e=>{e.disabled=!1,e.textContent=e.dataset.originalText||"Load"}))}function v(e){if(e.animationType){switchToAnimationType(e.animationType);const t="webgl"===e.animationType?500:300;setTimeout((()=>{i.value=e.title,o.value=e.vert,a.value=e.frag,window.rebuildProgram&&window.rebuildProgram(),window.render&&window.render(),u(),g()}),t)}else i.value=e.title,o.value=e.vert,a.value=e.frag,window.rebuildProgram&&window.rebuildProgram(),window.render&&window.render(),u(),g()}l.addEventListener("click",(()=>n.click())),n.addEventListener("change",(()=>{s.textContent=n.files[0]?.name||""})),["dragover","dragleave","drop"].forEach((e=>r.addEventListener(e,(t=>{t.preventDefault(),r.classList.toggle("dragover","dragover"===e),"drop"===e&&t.dataTransfer.files.length&&(n.files=t.dataTransfer.files,s.textContent=t.dataTransfer.files[0].name)})))),document.body.addEventListener("click",(e=>{if(e.target.classList.contains("ldbtn")){const t=e.target.getAttribute("data-public-token"),n=e.target.getAttribute("data-local-index");function i(e){if(e>=0&&e<window._localShaderList.length){const t=window._localShaderList[e];v(t),d(`Loaded "${t.title}"`,"success")}else g()}p(),null!==t?window.loadPublicShader&&/^\d+(\.\d+)?$/.test(t)?window.loadPublicShader(t):loadPublicShader(t):null!==n&&i(parseInt(n))}})),window.openShaderWindow=()=>(t.style.display="block",m("save")),window.closeShaderWindow=u,window.deleteLocal=function(e){const t=e.replace("shader_","");confirm(`Delete "${t}"?`)&&(localStorage.removeItem(e),h(),d(`Deleted "${t}"`,"info"))},window.showTab=m,window.saveLocally=function(){const e=i.value.trim(),t=n.files[0];return e?t?void function(e,t){const n=new Image,i=new FileReader;i.onload=e=>{n.src=e.target.result,n.onload=()=>{const e=document.createElement("canvas"),i=200/n.width;e.width=200,e.height=n.height*i,e.getContext("2d").drawImage(n,0,0,e.width,e.height),t(e.toDataURL("image/jpeg",.5))}},i.readAsDataURL(e)}(t,(t=>{localStorage.setItem(`shader_${e}`,JSON.stringify({title:e,vert:o.value,frag:a.value,preview:t,animationType:getCurrentAnimationType()})),d(`Saved "${e}" locally`,"success")})):d("Please upload a preview image","warning"):d("Please provide a title","warning")},window.showToast=d,window.enableAllLoadButtons=g,window.disableAllLoadButtons=p,window.loadShaderData=v})(),function(){let e=!1,t=null,n=null,i=null,o=null,a=null,s=null,r=null,l=null,c=null,d=null,u=null,m=null,h=null,p=null,g=null,v=new Map,f=performance.now(),w=0,y=0,b=0,E=60;let C=null;const x=()=>{const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&(C={vert:e.value,frag:t.value})},S=()=>{document.getElementById("vertCode"),document.getElementById("fragCode");v.forEach(((e,t)=>{t.removeEventListener("input",e)})),v.clear()},L=e=>{const t=document.getElementById("vertCode"),n=document.getElementById("fragCode"),i=document.getElementById("vertPanel"),o=document.getElementById("fragPanel");if(e){(()=>{const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&null===m&&null===h&&(m=e.value,h=t.value)})();const e=i?.querySelector(".panel-header span"),a=o?.querySelector(".panel-header span");e&&(e.textContent="Vertex Shader (WGSL)"),a&&(a.textContent="Fragment Shader (WGSL)");const s=document.getElementById("vertFile"),r=document.getElementById("fragFile");s&&(s.accept=".wgsl,.txt"),r&&(r.accept=".wgsl,.txt"),t&&(t.value="// WebGPU Vertex Shader (WGSL)\n//  Created by Max Warren\nstruct VertexOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv: vec2<f32>,\n}\n@vertex\nfn vs_main(@location(0) position: vec2<f32>) -> VertexOutput {\n    var output: VertexOutput;\n    output.position = vec4<f32>(position, 0.0, 1.0);\n    output.uv = position * 0.5 + 0.5;\n    return output;\n}"),n&&(n.value="// WebGPU Fragment Shader (WGSL)\nstruct Uniforms {\n    resolution: vec2<f32>,\n    time: f32,\n    delta_time: f32,\n    mouse: vec2<f32>,\n    mouse_click: vec2<f32>,\n    mouse_pressed: f32,\n    frame: f32,\n    fps: f32,\n    aspect: f32,\n    pixel_size: vec2<f32>,\n    bass: f32,\n    mid: f32,\n    treble: f32,\n    volume: f32,\n    padding: f32,\n}\n@group(0) @binding(0) var<uniform> u: Uniforms;\n@fragment  \nfn fs_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n    let fragCoord = uv * u.resolution;\n    let mouse_influence = length(fragCoord - u.mouse) / max(u.resolution.x, u.resolution.y);\n    let click_influence = length(fragCoord - u.mouse_click) / max(u.resolution.x, u.resolution.y);\n    let r = sin(u.time * 2.0 + fragCoord.x * 0.01 + mouse_influence * 10.0 + u.bass * 5.0) * 0.5 + 0.5;\n    let g = sin(u.time * 1.5 + fragCoord.y * 0.01 + click_influence * 5.0 + u.mid * 3.0) * 0.5 + 0.5;\n    let b = sin(u.time * 3.0 + u.frame * 0.01 + u.treble * 7.0) * 0.5 + 0.5;\n    let press_effect = u.mouse_pressed * 0.3;\n    let fps_effect = u.fps / 60.0 * 0.1;\n    let delta_effect = clamp(u.delta_time * 10.0, 0.0, 0.2);\n    let volume_boost = 1.0 + u.volume * 0.5;\n    let color = vec3<f32>(r + press_effect, g + fps_effect, b + delta_effect) * volume_boost;\n    return vec4<f32>(color, 1.0);\n}")}else{i&&i.querySelector(".panel-header span")&&(i.querySelector(".panel-header span").textContent="Vertex Shader"),o&&o.querySelector(".panel-header span")&&(o.querySelector(".panel-header span").textContent="Fragment Shader");const e=document.getElementById("vertFile"),a=document.getElementById("fragFile");e&&(e.accept=".vert,.vs,.txt"),a&&(a.accept=".frag,.fs,.txt"),t&&null!==m&&(t.value=m),n&&null!==h&&(n.value=h)}},k=async()=>{if(!navigator.gpu)return!1;try{const o=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!o)return!1;if(t=await o.requestDevice({requiredFeatures:[],requiredLimits:{}}),d=document.getElementById("glcanvas"),c=document.createElement("canvas"),c.id="webgpu-canvas",c.style.cssText=d.style.cssText,c.className=d.className,x(),d.style.display="none",d.parentNode.insertBefore(c,d),n=c.getContext("webgpu"),!n)return!1;const a=navigator.gpu.getPreferredCanvasFormat();return n.configure({device:t,format:a,alphaMode:"premultiplied"}),f=performance.now(),w=0,y=0,b=0,E=60,(()=>{if(!c)return;u&&(u.disconnect(),u=null);const t=()=>{if(!c||!n)return;const t=c.parentElement;if(!t)return;const o=t.getBoundingClientRect(),a=Math.floor(o.width),s=Math.floor(o.height);if((c.width!==a||c.height!==s)&&(c.width=a,c.height=s,e&&i)){const e=performance.now()-(window.startTime||0);T(.001*e)}};window.ResizeObserver?(u=new ResizeObserver((e=>{for(let n of e)t()})),u.observe(c.parentElement)):window.addEventListener("resize",t),t()})(),!0}catch(e){return!1}},T=e=>{if(!(i&&n&&t&&c))return;const r=performance.now();b=(r-y)/1e3,y=r,w++,w%10==0&&(E=.9*E+1/b*.1);const l=window.mouse||{x:0,y:0,clickX:0,clickY:0,isPressed:!1},d=(()=>{const e=window.audioReactiveInstance;if(e&&e.analyser&&e.isActive){const t=new Uint8Array(e.analyser.frequencyBinCount);e.analyser.getByteFrequencyData(t);const n=(e,n,i,o=1)=>Math.min(1,t.slice(e,n).reduce(((e,t)=>e+t))/(n-e)/255*i*o);return{bass:n(0,20,e.sensitivity.bass,.4),mid:n(20,60,e.sensitivity.mid),treble:n(60,120,e.sensitivity.treble),volume:n(0,t.length,e.sensitivity.volume)}}return{bass:0,mid:0,treble:0,volume:0}})(),u=new Float32Array(20);let m=0;u[m++]=c.width,u[m++]=c.height,u[m++]=e,u[m++]=b,u[m++]=l.x,u[m++]=l.y,u[m++]=l.clickX||0,u[m++]=l.clickY||0,u[m++]=l.isPressed?1:0,u[m++]=w,u[m++]=E,u[m++]=c.width/c.height,u[m++]=1/c.width,u[m++]=1/c.height,u[m++]=d.bass,u[m++]=d.mid,u[m++]=d.treble,u[m++]=d.volume,u[m++]=0,u[m++]=0,t.queue.writeBuffer(a,0,u);const h=t.createCommandEncoder(),p=h.beginRenderPass({colorAttachments:[{view:n.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});p.setPipeline(i),p.setBindGroup(0,o),p.setVertexBuffer(0,s),p.draw(6),p.end(),t.queue.submit([h.finish()])},A=()=>{if(!e)return;const t=performance.now();T(.001*(t-f)),r=requestAnimationFrame(A)},I=e=>{const t=document.getElementById("lint"),n=document.getElementById("lintContent"),i=document.getElementById("copyErrorsBtn"),o=document.getElementById("closeLintBtn");n&&(n.textContent="WebGPU Error: "+e),i&&(i.style.display="block"),o&&(o.style.display="block"),t&&(t.style.display="block")},B=()=>{const e=document.getElementById("lint"),t=document.getElementById("copyErrorsBtn"),n=document.getElementById("closeLintBtn");e&&(e.style.display="none"),t&&(t.style.display="none"),n&&(n.style.display="none")},P=()=>{const e=document.getElementById("vertCode"),n=document.getElementById("fragCode");if(!e||!n)return;const r=document.getElementById("lint"),l=document.getElementById("copyErrorsBtn"),c=document.getElementById("closeLintBtn");r&&(r.style.display="none"),l&&(l.style.display="none"),c&&(c.style.display="none");((e,n)=>{try{[i,o]=[null,null],[a,s].forEach((e=>{e&&e.destroy?.()})),a=s=null,a=t.createBuffer({size:80,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const r=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);s=t.createBuffer({size:r.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),t.queue.writeBuffer(s,0,r);const l=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),c=t.createPipelineLayout({bindGroupLayouts:[l]});return i=t.createRenderPipeline({layout:c,vertex:{module:t.createShaderModule({code:e}),entryPoint:"vs_main",buffers:[{arrayStride:8,attributes:[{format:"float32x2",offset:0,shaderLocation:0}]}]},fragment:{module:t.createShaderModule({code:n}),entryPoint:"fs_main",targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]},primitive:{topology:"triangle-list"}}),o=t.createBindGroup({layout:l,entries:[{binding:0,resource:{buffer:a}}]}),!0}catch(e){return I(e.message),!1}})(e.value,n.value)},M=()=>{if(!c)return;const e=(e,t=!1,n)=>{const i=((e,t=!1)=>{const n=c.getBoundingClientRect(),i=t?e.touches[0]||e.changedTouches[0]:e;return{x:i.clientX-n.left,y:n.height-(i.clientY-n.top)}})(e,t);let o=window.mouse||{x:0,y:0,clickX:0,clickY:0,isPressed:!1,lastClickTime:0};"move"===n?(o.x=i.x,o.y=i.y):"down"===n?(o.isPressed=!0,o.clickX=i.x,o.clickY=i.y,o.lastClickTime=performance.now()):"up"===n&&(o.isPressed=!1),window.mouse=o,t&&e.preventDefault()};["mousemove","mousedown","mouseup","mouseleave","touchmove","touchstart","touchend"].forEach((e=>{c.removeEventListener(e,(()=>{}))})),c.addEventListener("mousemove",(t=>e(t,!1,"move"))),c.addEventListener("mousedown",(t=>e(t,!1,"down"))),c.addEventListener("mouseup",(t=>e(t,!1,"up"))),c.addEventListener("mouseleave",(()=>{window.mouse&&(window.mouse.isPressed=!1)})),c.addEventListener("touchmove",(t=>e(t,!0,"move")),{passive:!1}),c.addEventListener("touchstart",(t=>e(t,!0,"down")),{passive:!1}),c.addEventListener("touchend",(t=>e(t,!0,"up")),{passive:!1})},R=async()=>{if(!e&&window.jsCanvasState&&window.jsCanvasState.isJSMode()){const e=document.getElementById("jsToggleBtn");return e&&e.click(),void setTimeout((()=>R()),200)}!e&&window.is3DModelActive?.()&&window.deactivate3DModel?.(),!e&&window.cameraSystem?.isActive&&(await window.cameraSystem.stopCamera(),await new Promise((e=>setTimeout(e,250))));const m=document.getElementById("webgpuToggle"),h=(e,t)=>{m.textContent=e,m.className="lbtn webgpu-toggle "+t},f=()=>{[l,window.animationId,r].forEach((e=>{e&&cancelAnimationFrame(e)})),l=window.animationId=r=null},w=e=>(e&&e.destroy(),null);e?(f(),B(),u&&(u.disconnect(),u=null),s=w(s),a=w(a),t&&(t.destroy(),t=null),[n,i,o]=[null,null,null],c&&d&&(c.remove(),d.style.display="block",c=null),e=!1,h("WebGPU","webgl-mode"),S(),L(!1),(()=>{if(!C)return;const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&(({vert:e.value,frag:t.value}=C),C=null)})(),p&&(window.rebuildProgram=p),g&&(window.render=g),(()=>{const e=document.getElementById("glcanvas");if(e){if(window.gl=e.getContext("webgl2")||e.getContext("webgl"),!window.gl)return!1;const t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n=window.gl.createBuffer();return window.gl.bindBuffer(window.gl.ARRAY_BUFFER,n),window.gl.bufferData(window.gl.ARRAY_BUFFER,t,window.gl.STATIC_DRAW),window.gl.enable(window.gl.BLEND),window.gl.blendFunc(window.gl.SRC_ALPHA,window.gl.ONE_MINUS_SRC_ALPHA),window.gl.clearColor(0,0,0,1),window.gl.clear(window.gl.COLOR_BUFFER_BIT),window.buf=n,!0}return!1})()&&((()=>{const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&p&&(e.addEventListener("input",p),t.addEventListener("input",p))})(),setTimeout((()=>{window.rebuildProgram&&window.rebuildProgram(),window.render&&window.render()}),150))):(!p&&window.rebuildProgram&&(p=window.rebuildProgram),!g&&window.render&&(g=window.render),x(),f(),window.gl&&window.program&&(window.gl.deleteProgram(window.program),window.program=null),window.animationId&&(cancelAnimationFrame(window.animationId),window.animationId=null),B(),await k()&&(e=!0,h("GLSL","webgpu-mode"),S(),L(!0),window.rebuildProgram=P,window.render=A,(()=>{const t=document.getElementById("vertCode"),n=document.getElementById("fragCode");if(t&&n){const i=()=>{e&&P()};v.set(t,i),v.set(n,i),t.addEventListener("input",i),n.addEventListener("input",i)}})(),M(),setTimeout((()=>{P(),A()}),100)))},F=async()=>{if(navigator.gpu)try{if(!await navigator.gpu.requestAdapter({powerPreference:"high-performance"}))return;(()=>{const e=Object.assign(document.createElement("button"),{id:"webgpuToggle",className:"lbtn webgpu-toggle webgl-mode",textContent:"WebGPU",title:"Toggle between WebGL and WebGPU rendering"}),t=document.getElementById("glcanvas");return(t?.parentElement||document.body).appendChild(e),e})().addEventListener("click",R)}catch(e){return}};window.webgpuState={isWebGPUMode:()=>e,getCanvas:()=>c},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",F):setTimeout(F,500)}(),function(){const e=document.getElementById("glcanvas");if(!e)return;const t=window.gl||e.getContext("webgl2")||e.getContext("webgl"),n=window.uniforms||{};let i=null,o=null,a=null,s=!1,r=null,l=[],c="upload";function d(e){const t=parseFloat(e);return isNaN(t)?"0.0":t%1==0?t+".0":t.toString()}const u={blur:{name:"Blur",description:"Adds a gaussian blur effect",params:{strength:.5},controls:[{name:"strength",label:"Strength",type:"range",min:0,max:2,step:.1}],shader:"\nvec4 blur(vec4 color, vec2 uv, float strength) {\n  vec4 sum = vec4(0.0);\n  float off = strength * 0.01;\n  for (int i = -2; i <= 2; i++) {\n    for (int j = -2; j <= 2; j++) {\n      sum += texture2D(u_texture, uv + vec2(float(i), float(j)) * off);\n    }\n  }\n  vec4 blurred = sum / 25.0;\n  return mix(color, blurred, strength);\n}\n      "},sepia:{name:"Sepia",description:"Applies a sepia tone effect",params:{intensity:.8},controls:[{name:"intensity",label:"Intensity",type:"range",min:0,max:1,step:.1}],shader:"\nvec4 sepia(vec4 color, float intensity) {\n  float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n  vec3 sep = vec3(gray) * vec3(1.2, 1.0, 0.8);\n  return vec4(mix(color.rgb, sep, intensity), color.a);\n}\n      "},vignette:{name:"Vignette",description:"Adds a dark vignette around the edges",params:{intensity:.5,radius:.8},controls:[{name:"intensity",label:"Intensity",type:"range",min:0,max:1,step:.1},{name:"radius",label:"Radius",type:"range",min:.1,max:1,step:.1}],shader:"\nvec4 vignette(vec4 color, vec2 uv, float intensity, float radius) {\n  float d = distance(uv, vec2(0.5));\n  float vig = smoothstep(radius, radius - 0.1, d);\n  return vec4(color.rgb * mix(1.0, vig, intensity), color.a);\n}\n      "},chromatic:{name:"Chromatic Aberration",description:"Separates color channels for a glitch effect",params:{strength:.01},controls:[{name:"strength",label:"Strength",type:"range",min:0,max:.5,step:.01}],shader:"\nvec4 chromatic(vec4 color, vec2 uv, float strength) {\n  vec2 off = vec2(strength, 0.0);\n  vec3 ca;\n  ca.r = texture2D(u_texture, uv - off).r;\n  ca.g = texture2D(u_texture, uv).g;\n  ca.b = texture2D(u_texture, uv + off).b;\n  return vec4(mix(color.rgb, ca, strength), color.a);\n}\n      "},pixelate:{name:"Pixelate",description:"Creates a pixelated effect",params:{size:64},controls:[{name:"size",label:"Size",type:"range",min:8,max:256,step:8}],shader:"\nvec4 pixelate(vec4 color, vec2 uv, float pixelSize) {\n  vec2 gridUV = floor(uv * pixelSize) / pixelSize;\n  vec4 p = texture2D(u_texture, gridUV);\n  return p;\n}\n      "},contrast:{name:"Contrast",description:"Adjusts image contrast",params:{amount:1.2},controls:[{name:"amount",label:"Amount",type:"range",min:.5,max:2,step:.1}],shader:"\nvec4 contrast(vec4 color, float amount) {\n  vec3 c = ((color.rgb - 0.5) * amount) + 0.5;\n  return vec4(c, color.a);\n}\n      "}};function m(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&(e.value="\nattribute vec2 a_position;\nvarying   vec2 v_uv;\nvoid main() {\n  v_uv       = a_position * 0.5 + 0.5;\n  gl_Position = vec4(a_position, 0.0, 1.0);\n}",t.value=function(){if(0===l.length)return"video"===a?"\nprecision mediump float;\nuniform sampler2D u_video;\nvarying   vec2      v_uv;\nvoid main() {\n  vec4 color = texture2D(u_video, v_uv);\n  gl_FragColor = color;\n}":"\nprecision mediump float;\nuniform sampler2D u_image;\nvarying   vec2      v_uv;\nvoid main() {\n  vec4 color = texture2D(u_image, v_uv);\n  gl_FragColor = color;\n}";let e=`\nprecision mediump float;\nuniform sampler2D ${"video"===a?"u_video":"u_image"};\n`;return e+=`\n#define u_texture ${"video"===a?"u_video":"u_image"}\n`,e+="varying vec2 v_uv;\n",l.forEach((t=>{e+=u[t.type].shader+"\n"})),e+=`\nvoid main() {\n  vec2 uv    = v_uv;\n  vec4 color = texture2D(${"video"===a?"u_video":"u_image"}, uv);\n`,l.forEach((t=>{const n={...u[t.type].params,...t.params};switch(t.type){case"blur":e+=`  color = blur(color, uv, ${d(n.strength)});\n`;break;case"sepia":e+=`  color = sepia(color, ${d(n.intensity)});\n`;break;case"vignette":e+=`  color = vignette(color, uv, ${d(n.intensity)}, ${d(n.radius)});\n`;break;case"chromatic":e+=`  color = chromatic(color, uv, ${d(n.strength)});\n`;break;case"pixelate":e+=`  color = pixelate(color, uv, ${d(n.size)});\n`;break;case"contrast":e+=`  color = contrast(color, ${d(n.amount)});\n`}})),e+="\n  gl_FragColor = color;\n}",e}(),e.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("input",{bubbles:!0})))}function h(){if(!o||!i)return;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o);const e="video"===a?"uVideo":"uImage",s=(n["video"===a?"u_video":"u_image"]||n[e]||{}).loc;null!=s&&(t.useProgram(window.program),t.uniform1i(s,0))}function p(){s&&o&&!o.paused&&(h(),g()),s&&(r=requestAnimationFrame(p))}function g(){const e=document.getElementById("videoProgressBar"),t=document.getElementById("videoTimeInfo");if(e&&t&&o&&"video"===a){const n=o.currentTime/o.duration*100;e.style.width=n+"%";const i=Math.floor(o.currentTime/60),a=Math.floor(o.currentTime%60),s=Math.floor(o.duration/60),r=Math.floor(o.duration%60);t.textContent=`${i}:${a.toString().padStart(2,"0")} / ${s}:${r.toString().padStart(2,"0")}`}}const v=document.createElement("button");v.id="mediaUploadBtn",v.innerHTML='\n    <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none"\n        xmlns="http://www.w3.org/2000/svg">\n        <path fill="currentColor" d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 \n        0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 \n        0 2-2ZM5 5h14v8.59l-3.29-3.3a1 1 \n        0 0 0-1.42 0L8 17l-3-3V5Zm0 \n        14v-2.41l3-3 5.29 5.3a1 1 0 0 \n        0 1.42 0L19 15.41V19H5Z"/>\n        <circle cx="8" cy="8" r="1.5" fill="currentColor"/>\n    </svg>\n  ',v.title="Upload Image/Video",document.body.appendChild(v);const f=document.createElement("input");f.type="file",f.accept="image/*,video/*",f.id="mediaFileInput",f.style.display="none",document.body.appendChild(f);const w=document.createElement("div");w.id="mediaModal",w.innerHTML=`\n    <div class="modal-content">\n      <button id="mediaCloseBtn">×</button>\n      <h3>Media & Effects Editor</h3>\n      <div class="modal-toggle">\n        <button id="uploadTab" class="active">Upload Media</button>\n        <button id="effectsTab">Add Effects</button>\n      </div>\n      <div id="uploadView" class="modal-view active">\n        <p>Select an image or video to use in your shader.</p>\n        <button id="mediaDropButton">Choose File or Drag and Drop</button>\n        <div id="mediaPreview"></div>\n        <div class="video-controls" id="videoControls" style="display:none;">\n          <button id="playPauseBtn">Play</button>\n          <div class="time-info" id="videoTimeInfo">0:00 / 0:00</div>\n        </div>\n        <div class="video-progress" id="videoProgress" style="display:none;">\n          <div class="video-progress-bar" id="videoProgressBar"></div>\n        </div>\n        <p class="loadmediawarn">Importing base shaders will delete current text area code</p>\n        <button id="baseImportBtn">Import Base Shaders</button>\n      </div>\n      <div id="effectsView" class="modal-view">\n        <div id="effectsContent">\n          <p>Select effects to apply to your ${a||"media"}:</p>\n          <div class="effects-grid" id="effectsGrid"></div>\n          <div class="effect-controls" id="effectControls" style="display:none;">\n            <h4>Effect Parameters</h4>\n            <div id="controlsContainer"></div>\n          </div>\n          <div class="active-effects" id="activeEffectsContainer">\n            <h4>Active Effects</h4>\n            <div id="activeEffectsList"></div>\n            <button class="apply-effects-btn" id="applyEffectsBtn">Apply Effects to Shader</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `,document.body.appendChild(w);const y=w.querySelector("#mediaDropButton"),b=w.querySelector("#mediaPreview"),E=w.querySelector("#mediaCloseBtn"),C=w.querySelector("#baseImportBtn"),x=w.querySelector("#uploadTab"),S=w.querySelector("#effectsTab"),L=w.querySelector("#uploadView"),k=w.querySelector("#effectsView"),T=w.querySelector("#effectsGrid"),A=w.querySelector("#effectControls"),I=w.querySelector("#controlsContainer"),B=w.querySelector("#activeEffectsList"),P=w.querySelector("#applyEffectsBtn"),M=w.querySelector("#videoControls"),R=w.querySelector("#playPauseBtn"),F=w.querySelector("#videoProgress");let D=null;function _(){const e=k.querySelector("p");e&&(e.textContent=`Select effects to apply to your ${a||"media"}:`)}function N(){B.innerHTML="",l.forEach(((e,t)=>{const n=document.createElement("div");n.className="active-effect",n.innerHTML=`\n        <span>${u[e.type].name}</span>\n        <button onclick="removeEffect(${t})">Remove</button>\n      `,B.appendChild(n)}))}async function $(e){const t=e.type.startsWith("video/");let n=e.type.startsWith("image/");const i=e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif");if(i)try{"undefined"==typeof heic2any&&await new Promise(((e,t)=>{const n=document.createElement("script");n.src="/shader/scripts/utils/heic2any.min.js",n.onload=e,n.onerror=()=>t(new Error("Failed to load heic2any library")),document.head.appendChild(n)})),window.showToast("Converting HEIC image...","info");const t=await heic2any({blob:e,toType:"image/jpeg",quality:.9});e=new File([t],e.name.replace(/\.heic$/i,".jpg").replace(/\.heif$/i,".jpg"),{type:"image/jpeg"}),n=!0,window.showToast("HEIC conversion complete","success")}catch(e){return void window.showToast(`Failed to convert HEIC image: ${e.message}`,"error")}if(!n||["image/jpeg","image/png","image/gif","image/webp"].includes(e.type)||i)if(t||n||i){if(a=t?"video":"image","video"===a){o=document.createElement("video"),o.crossOrigin="anonymous",o.loop=!0,o.muted=!0,o.controls=!1;const t=URL.createObjectURL(e);o.src=t,o.addEventListener("loadeddata",(function(){U(),b.innerHTML="",b.appendChild(o),M.style.display="flex",F.style.display="block",g()})),o.addEventListener("timeupdate",g)}else{const t=new FileReader;t.onload=function(e){o=new Image,o.onload=function(){U(),b.innerHTML="",b.appendChild(o),M.style.display="none",F.style.display="none"},o.src=e.target.result},t.readAsDataURL(e)}_()}else window.showToast(`Unsupported media type: ${e.name}`,"error");else window.showToast(`Unsupported image format: ${e.name}`,"error")}function U(){i&&t.deleteTexture(i),i=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),"video"===a&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o);const e="video"===a?"uVideo":"uImage",s=(n["video"===a?"u_video":"u_image"]||n[e]||{}).loc;null!=s&&(t.useProgram(window.program),t.uniform1i(s,0))}x.addEventListener("click",(()=>{c="upload",x.classList.add("active"),S.classList.remove("active"),L.classList.add("active"),k.classList.remove("active")})),S.addEventListener("click",(()=>{c="effects",S.classList.add("active"),x.classList.remove("active"),k.classList.add("active"),L.classList.remove("active"),_()})),window.removeEffect=function(e){l.splice(e,1),N(),m()},window.mediaUpload=window.mediaUpload||{},window.mediaUpload.onFileReceived=$,R.addEventListener("click",(()=>{o&&"video"===a&&(o.paused?(o.play(),R.textContent="Pause",s=!0,p()):(o.pause(),R.textContent="Play",s=!1,r&&(cancelAnimationFrame(r),r=null)))})),F.addEventListener("click",(e=>{if(!o||"video"!==a)return;const t=F.getBoundingClientRect(),n=(e.clientX-t.left)/t.width;o.currentTime=n*o.duration})),C.addEventListener("click",(async()=>{const e=window.getCurrentAnimationType?.();e&&"webgl"!==e&&(window.switchToAnimationType?.("webgl"),await new Promise((e=>setTimeout(e,300)))),window.cameraSystem?.isActive&&(await window.cameraSystem.stopCamera(),await new Promise((e=>setTimeout(e,250)))),l=[],N(),m(),await new Promise((e=>setTimeout(e,100))),window.rebuildProgram&&window.rebuildProgram(),await new Promise((e=>setTimeout(e,100))),o&&i&&(U(),h())})),P.addEventListener("click",(()=>{m()})),v.addEventListener("click",(()=>w.style.display="flex")),E.addEventListener("click",(()=>w.style.display="none")),w.addEventListener("click",(e=>{e.target===w&&(w.style.display="none")})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&(w.style.display="none")})),y.addEventListener("click",(()=>f.click())),f.addEventListener("change",(()=>{f.files[0]&&$(f.files[0])})),["dragenter","dragover"].forEach((e=>{y.addEventListener(e,(e=>{e.preventDefault(),y.classList.add("dragover")}))})),["dragleave","drop"].forEach((e=>{y.addEventListener(e,(e=>{e.preventDefault(),y.classList.remove("dragover")}))})),y.addEventListener("drop",(e=>{const t=e.dataTransfer.files[0];t&&$(t)})),T.innerHTML="",Object.keys(u).forEach((e=>{const t=u[e],n=document.createElement("div");n.className="effect-card",n.innerHTML=`\n        <h4>${t.name}</h4>\n        <p>${t.description}</p>\n      `,n.addEventListener("click",(()=>function(e){D=e,T.querySelectorAll(".effect-card").forEach((e=>{e.classList.remove("active")})),event.target.closest(".effect-card").classList.add("active"),function(e){const t=u[e];A.style.display="block",I.innerHTML="",t.controls.forEach(((n,i)=>{const o=document.createElement("div");o.className="effect-control";const a=t.params[n.name],s=`${e}_${n.name}_range_${i}`,r=`${e}_${n.name}_number_${i}`;o.innerHTML=`\n        <label for="${s}">${n.label}:</label>\n        <input type="range" \n              id="${s}"\n              name="${s}"\n              min="${n.min}" \n              max="${n.max}" \n              step="${n.step}" \n              value="${a}"\n              data-param="${n.name}"\n              aria-label="${n.label} range slider">\n        <input type="number" \n              id="${r}"\n              name="${r}"\n              min="${n.min}" \n              max="${n.max}" \n              step="${n.step}" \n              value="${a}"\n              data-param="${n.name}"\n              aria-label="${n.label} numeric input">\n      `;const l=o.querySelector('input[type="range"]'),c=o.querySelector('input[type="number"]');l.addEventListener("input",(e=>{const i=parseFloat(e.target.value);c.value=i,t.params[n.name]=i})),c.addEventListener("input",(e=>{const i=parseFloat(e.target.value);l.value=i,t.params[n.name]=i})),I.appendChild(o)}));const n=document.createElement("button");n.textContent="Add Effect",n.className="apply-effects-btn",n.style.width="auto",n.style.margin="10px 0",n.addEventListener("click",(()=>function(e){const t=u[e],n={type:e,params:{...t.params}};l.push(n),N(),m()}(e))),I.appendChild(n)}(e)}(e))),T.appendChild(n)})),document.addEventListener("fullscreenchange",(()=>{const e=document.fullscreenElement||document.body;[v,w].forEach((t=>e.appendChild(t)))})),window.addEventListener("beforeunload",(()=>{o&&"video"===a&&(o.pause(),o.src&&URL.revokeObjectURL(o.src)),r&&cancelAnimationFrame(r),i&&t.deleteTexture(i)}))}(),(()=>{async function e(){const e=document.querySelector('button[onclick="saveLink()"]')||document.querySelector(".savebtn2")||document.querySelector("button.savebtn2"),t=e?e.textContent:"Copy Link",n=document.getElementById("vertCode"),i=document.getElementById("fragCode"),o=document.getElementById("shaderTitle"),a={v:n?.value||"",f:i?.value||"",t:o?.value||"Untitled Shader",type:window.getCurrentAnimationType?.()||"webgl"},s=function(e){const t=new Map,n=Array.from(e).map((e=>e.charCodeAt(0)));let i=[],o=256,a=[];for(let e of n){let n=i.concat(e),s=n.join(",");if(t.has(s)||e<256&&1===n.length)i=n;else{let n=i.length>1?t.get(i.join(",")):i[0];a.push(n),t.set(s,o++),i=[e]}}if(i.length){let e=i.length>1?t.get(i.join(",")):i[0];a.push(e)}const s=new Uint16Array(a),r=new Uint8Array(s.buffer);let l="";for(let e of r)l+=String.fromCharCode(e);return btoa(l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(JSON.stringify(a));let r;if("admin"===window.userRole||"premium"===window.userRole){if(r=await async function(e){try{const t=await fetch("/shader/api/link.php?action=create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})});if(!t.ok)throw new Error("Failed to create short link");return(await t.json()).url}catch(e){return null}}(s),!r){const e=window.location.origin+window.location.pathname;r=`${e}#s=${s}`}}else{const e=window.location.origin+window.location.pathname;r=`${e}#s=${s}`}(async function(e){if(navigator.clipboard&&window.isSecureContext)try{return void await navigator.clipboard.writeText(e)}catch{}const t=document.createElement("textarea");t.value=e,Object.assign(t.style,{position:"fixed",opacity:"0",left:"-999999px",top:"-999999px"}),document.body.appendChild(t),t.focus(),t.select();try{if(!document.execCommand("copy"))throw 0}finally{document.body.removeChild(t)}})(r).then((()=>{e&&(e.textContent="Copied!"),setTimeout((()=>{e&&(e.textContent=t)}),2e3)})).catch((()=>{e&&(e.textContent="Copy Failed"),setTimeout((()=>{e&&(e.textContent=t)}),2e3);try{prompt("Copy this link:",r)}catch{}}))}function t(e,t=5e3,n=100){return new Promise((i=>{const o=performance.now();!function a(){try{if(e())return i(!0)}catch{}if(performance.now()-o>=t)return i(!1);setTimeout(a,n)}()}))}function n(e,n=5e3){return t((()=>!!document.querySelector(e)),n)}async function i(e=3e3){if("function"==typeof window.rebuildProgram)try{return window.rebuildProgram(),!0}catch{}if("function"==typeof compileShader)try{return compileShader(),!0}catch{}if(await t((()=>"function"==typeof window.rebuildProgram||"function"==typeof compileShader),e,120)){if("function"==typeof window.rebuildProgram)try{return window.rebuildProgram(),!0}catch{}if("function"==typeof compileShader)try{return compileShader(),!0}catch{}}return!1}async function o(){const e=window.location.hash.slice(1),o=new URLSearchParams(e).get("s"),a=new URLSearchParams(window.location.search).get("c");let s=o;if(a)try{const e=await fetch(`api/link.php?action=get&code=${a}`);if(e.ok){s=(await e.json()).data,window.history.replaceState({},document.title,window.location.pathname)}}catch(e){}if(!s)return!1;try{const e=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";let n=atob(t),i=Uint8Array.from(n,(e=>e.charCodeAt(0))),o=new Uint16Array(i.buffer),a=new Map;for(let e=0;e<256;e++)a.set(e,String.fromCharCode(e));let s=o[0],r=a.get(s),l=[r],c=r,d=256;for(let e=1;e<o.length;e++){let t;if(s=o[e],a.has(s))t=a.get(s);else{if(s!==d)throw new Error("Invalid compressed code");t=c+c[0]}l.push(t),a.set(d++,c+t[0]),c=t}return l.join("")}(s);if(!e)throw 0;const a=JSON.parse(e),r=document.getElementById("vertCode"),l=document.getElementById("fragCode"),c=document.getElementById("shaderTitle");r&&a.v&&(r.value=a.v),l&&a.f&&(l.value=a.f),c&&a.t&&(c.value=a.t),o&&window.history.replaceState({},document.title,window.location.href.split("#")[0]);const d=a.type||"webgl";if(!await t((()=>"function"==typeof window.switchToAnimationType&&"function"==typeof window.getCurrentAnimationType),1e4,100))return await i(3500),!0;"js"===d?await n("#jsToggleBtn",1e4):"webgpu"===d&&await n("#webgpuToggle",1e4),await new Promise((e=>setTimeout(e,200)));try{window.switchToAnimationType(d),"js"===d?await t((()=>window.jsCanvasState?.isJSMode?.()),8e3,150):"webgpu"===d?(await t((()=>window.webgpuState?.isWebGPUMode?.()),8e3,150),await t((()=>"function"==typeof window.webgpuState?.getCanvas&&window.webgpuState.getCanvas()),5e3,150)):"3d"===d&&await t((()=>window.is3DModelActive?.()),8e3,150),await new Promise((e=>setTimeout(e,300)))}catch(e){}return await i(4e3),!0}catch(e){return!1}}async function a(){try{await o()}catch{}const t=document.querySelector(".savebtn2")||document.querySelector('button[onclick="saveLink()"]');t&&t.addEventListener("click",e)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):setTimeout(a,200),window.saveLink=e})(),(()=>{class e{constructor(){this.dbName="ThemeManagerDB",this.dbVersion=3,this.storeName="themes",this.db=null,this.currentTheme="default",this.isModalOpen=!1,this.showColorEditor=!1,this.defaultColors={"--0":"rgba(0, 0, 0, 0.9)","--1":"#000000","--2":"rgba(28, 28, 28, 0.99)","--3":"rgba(37, 37, 37, 0.8)","--4":"rgba(64, 64, 64, 0.9)","--5":"rgba(113, 113, 113, 0.7)","--6":"rgba(174, 174, 174, 0.9)","--7":"rgba(227, 227, 227, 0.9)","--d":"rgba(15, 17, 23, .885)","--D":"#070a12","--l":"#f8fafc","--a":"#10b981","--ah":"rgba(36, 214, 154, 0.848)","--b":"#1e293b","--m":"#94a3b8","--r":"#b91040","--rh":"rgba(227, 48, 98, 0.79)","--token-comment":"#6A9955","--token-keyword":"#569CD6","--token-type":"#4EC9B0","--token-number":"#B5CEA8","--token-function":"#DCDCAA","--token-builtin":"#DCDCAA","--token-variable":"#9CDCFE"},this.fontOptions=[{name:"Courier",value:"Courier, 'Courier New', monospace"},{name:"Courier New",value:"'Courier New', Courier, monospace"},{name:"Monaco",value:"Monaco, 'Lucida Console', monospace"},{name:"Monospace",value:"monospace"},{name:"Verdana",value:"Verdana, Geneva, sans-serif"},{name:"Lucida Console",value:"'Lucida Console', Monaco, monospace"},{name:"Arial",value:"Arial, Helvetica, sans-serif"},{name:"Sans-serif",value:"sans-serif"}],this.defaultFont="'JetBrains Mono', 'Fira Code', 'Courier New', monospace",this.presetThemes={CODE:{"--0":"rgba(0, 0, 0, 0.9)","--1":"#000000","--2":"rgba(0, 12, 24, 0.99)","--3":"rgba(16, 25, 44, 0.8)","--4":"rgba(24, 29, 41, 0.63)","--5":"rgba(76, 83, 93, 0.7)","--6":"rgba(174, 174, 174, 0.9)","--7":"rgba(227, 227, 227, 0.9)","--D":"#070a12","--a":"rgba(4, 35, 108, 1)","--ah":"rgba(13, 82, 242, 0.72)","--b":"#1e293b","--d":"rgba(15, 17, 23, .885)","--l":"#f8fafc","--m":"#94a3b8","--r":"#b91040","--rh":"rgba(227, 48, 98, 1)","--token-comment":"#6A9955","--token-keyword":"#569CD6","--token-type":"#4EC9B0","--token-number":"#B5CEA8","--token-function":"#DCDCAA","--token-builtin":"#DCDCAA","--token-variable":"#9CDCFE"},DARK:{"--0":"rgba(0, 0, 0, 0.9)","--1":"#000000","--2":"rgba(10, 10, 10, 0.99)","--3":"rgba(33, 33, 33, 0.47)","--4":"rgba(38, 38, 38, 0.9)","--5":"rgba(113, 113, 113, 0.7)","--6":"rgba(50, 226, 205, 0.9)","--7":"rgba(186, 186, 186, 0.9)","--d":"rgba(28, 28, 28, 0.89)","--D":"#070a12","--l":"#f8fafc","--a":"rgba(180, 19, 137, 1)","--ah":"rgba(255, 15, 155, 0.85)","--b":"#1e293b","--m":"#94a3b8","--r":"rgba(199, 0, 0, 1)","--rh":"rgba(255, 20, 20, 0.84)","--token-comment":"#6A9955","--token-keyword":"#569CD6","--token-type":"#4EC9B0","--token-number":"#B5CEA8","--token-function":"#DCDCAA","--token-builtin":"#DCDCAA","--token-variable":"#9CDCFE"},LIGHT:{"--0":"rgba(255, 255, 255, 0.9)","--1":"rgba(255, 255, 255, 0.99)","--2":"rgba(217, 217, 217, 0.98)","--3":"rgba(186, 186, 186, 0.61)","--4":"rgba(174, 174, 174, 0.86)","--5":"rgba(156, 156, 156, 0.9)","--6":"rgba(9, 9, 9, 0.9)","--7":"rgba(37, 37, 37, 0.9)","--d":"rgba(255, 255, 255, 0.23)","--D":"rgba(78, 78, 78, 0.3)","--l":"#0f172a","--a":"rgba(180, 19, 137, 1)","--ah":"rgba(255, 15, 155, 0.85)","--b":"#e2e8f0","--m":"#475569","--r":"rgba(199, 0, 0, 1)","--rh":"rgba(255, 20, 20, 0.84)","--token-comment":"#1f6200","--token-keyword":"#003865","--token-type":"#006f59","--token-number":"#3ba800","--token-function":"#9e9e00","--token-builtin":"#a0a000","--token-variable":"#006ca6"}},this.init()}async init(){this.applyDefaultColors(),this.applyDefaultFont(),await this.initDB(),this.createButton(),this.createModal(),this.createConfirmModal(),await this.loadSavedTheme()}applyDefaultColors(){const e=document.documentElement;Object.entries(this.defaultColors).forEach((([t,n])=>{e.style.setProperty(t,n)}))}applyDefaultFont(){this.setHtmlFontClass(this.defaultFont)}applyFont(e){this.setHtmlFontClass(e)}setHtmlFontClass(e){const t=document.documentElement;t.classList.forEach((e=>{e.startsWith("font-")&&t.classList.remove(e)}));const n=this.fontOptions.find((t=>t.value===e))?.name.toLowerCase().replace(/\s+/g,"-")||"jetbrains";t.classList.add(`font-${n}`)}initDB(){return new Promise(((e,t)=>{const n=indexedDB.open(this.dbName);n.onsuccess=()=>{const i=n.result.version;n.result.close();const o=Math.max(i,this.dbVersion),a=indexedDB.open(this.dbName,o);a.onerror=()=>t(a.error),a.onsuccess=()=>{this.db=a.result,e()},a.onupgradeneeded=e=>{const t=e.target.result;if(t.objectStoreNames.contains(this.storeName)){if(e.oldVersion<2){const t=e.target.transaction.objectStore(this.storeName),n=t.getAll();n.onsuccess=()=>{n.result.forEach((e=>{e.font||(e.font=this.defaultFont,t.put(e))}))}}}else{t.createObjectStore(this.storeName,{keyPath:"name"}).add({name:"default",colors:this.defaultColors,font:this.defaultFont,created:(new Date).toISOString()})}}},n.onerror=()=>t(n.error)}))}createButton(){const e=document.createElement("button");e.id="theme-manager-btn",e.title="Theme Manager",e.setAttribute("aria-label","Open Theme Manager"),e.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15"\n          viewBox="0 0 24 24" fill="none" stroke="var(--6)" stroke-width="2"\n          stroke-linecap="round" stroke-linejoin="round"\n          style="pointer-events: none;">\n          <path d="M2 18c0 1.1.9 2 2 2h1l3-3-2-2-3 3v1z"></path>\n          <path d="M20.7 7.3a1 1 0 0 0 0-1.4L18.1 3.3a1 1 0 0 0-1.4 0l-9.3 9.3 2 2 9.3-9.3z"></path>\n        </svg>\n      ',e.onclick=()=>this.toggleModal(),document.addEventListener("fullscreenchange",(()=>{const t=document.getElementById("theme-modal"),n=document.getElementById("theme-confirm-modal");document.fullscreenElement?(document.fullscreenElement.appendChild(e),t&&document.fullscreenElement.appendChild(t),n&&document.fullscreenElement.appendChild(n)):(document.body.appendChild(e),t&&document.body.appendChild(t),n&&document.body.appendChild(n))})),document.body.appendChild(e)}createConfirmModal(){const e=document.createElement("div");e.id="theme-confirm-modal",e.innerHTML='\n        <div class="theme-confirm-modal-content">\n          <h4 class="theme-confirm-theme-modal-title">Delete Theme</h4>\n          <p id="confirm-message" class="theme-confirm-modal-message"></p>\n          <div class="theme-confirm-modal-buttons">\n            <button id="confirm-cancel" class="theme-confirm-cancel-btn">Cancel</button>\n            <button id="confirm-delete" class="theme-confirm-delete-btn">Delete</button>\n          </div>\n        </div>\n      ',document.body.appendChild(e),this.setupConfirmModalEvents()}setupConfirmModalEvents(){const e=document.getElementById("theme-confirm-modal"),t=document.getElementById("confirm-cancel"),n=document.getElementById("confirm-delete"),i=()=>{e.style.display="none",this.confirmCallback=null};t.onclick=i,n.onclick=()=>{this.confirmCallback&&this.confirmCallback(),e.style.display="none",this.confirmCallback=null},e.onclick=t=>{t.target===e&&i()},document.addEventListener("keydown",(t=>{"Escape"===t.key&&"none"!==e.style.display&&i()}))}showCustomConfirm(e,t){const n=document.getElementById("theme-confirm-modal");document.getElementById("confirm-message").textContent=e,this.confirmCallback=t,n.style.display="flex"}createModal(){const e=document.createElement("div");e.id="theme-modal",e.innerHTML='\n        <div class="theme-modal-header">\n          <div class="theme-modal-header-content">\n            <h3 class="theme-modal-title">Theme Manager</h3>\n            <button id="close-modal" class="theme-modal-close-btn" aria-label="Close Theme Manager">×</button>\n          </div>\n          <div class="theme-select-container">\n            <label for="theme-select" class="theme-select-label">Select Theme:</label>\n            <select id="theme-select" class="theme-select">\n              <option value="">Choose a theme...</option>\n            </select>\n          </div>\n          <div class="theme-toggle-editor-container">\n            <button id="toggle-editor" class="theme-toggle-editor-btn">\n              Editor\n            </button>\n          </div>\n        </div>\n        <div id="color-editor-section" style="display: none;">\n          <div class="color-editor-controls">\n            <div class="theme-name-container">\n              <label for="theme-name" class="theme-name-label">Theme Name:</label>\n              <input type="text" id="theme-name" placeholder="Enter custom theme name" class="theme-name-input">\n              <div class="theme-action-buttons">\n                <button id="save-theme" class="save-theme-btn">Save</button>\n                <button id="delete-theme" class="delete-theme-btn">Delete</button>\n              </div>\n            </div>\n            <div class="font-select-container">\n              <label for="font-select" class="font-select-label">Font Family:</label>\n              <select id="font-select" class="font-select">\n              </select>\n            </div>\n          </div>\n          <div id="color-inputs" class="color-inputs-container">\n          </div>\n          <div class="reset-section">\n            <button id="reset-colors" class="theme-reset-btn">Reset to Default</button>\n          </div>\n        </div>\n      ',document.body.appendChild(e),this.setupModalEvents(),this.createColorInputs(),this.createFontSelect()}createFontSelect(){const e=document.getElementById("font-select");e&&(this.fontOptions.forEach((t=>{const n=document.createElement("option");n.value=t.value,n.textContent=t.name,n.style.fontFamily=t.value,e.appendChild(n)})),e.value=this.defaultFont)}setupModalEvents(){const e=document.getElementById("theme-modal"),t=document.getElementById("close-modal"),n=document.getElementById("theme-select"),i=document.getElementById("toggle-editor"),o=document.getElementById("save-theme"),a=document.getElementById("delete-theme"),s=document.getElementById("reset-colors"),r=document.getElementById("font-select");t.onclick=()=>this.closeModal(),n.onchange=()=>this.loadSelectedTheme(n.value),i.onclick=()=>this.toggleColorEditor(),o.onclick=()=>this.saveTheme(),a.onclick=()=>this.deleteTheme(),s.onclick=()=>this.resetToDefault(),r&&(r.onchange=()=>{this.applyFont(r.value)});const l=t=>{this.isModalOpen&&("click"===t.type&&!e.contains(t.target)&&"theme-manager-btn"!==t.target.id||"keydown"===t.type&&"Escape"===t.key)&&this.closeModal()};document.addEventListener("click",l),document.addEventListener("keydown",l)}toggleColorEditor(){const e=document.getElementById("color-editor-section"),t=document.getElementById("toggle-editor");this.showColorEditor=!this.showColorEditor,this.showColorEditor?(e.style.display="block",t.textContent="Hide Editor",t.style.background="var(--r)"):(e.style.display="none",t.textContent="Editor",t.style.background="var(--b)")}async loadSelectedTheme(e,t=!0){if(e){if(this.presetThemes[e])return this.applyThemeColors(this.presetThemes[e]),this.currentTheme=e,void(t&&this.showToast(`"${e}" preset loaded!`,"success"));try{const n=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),i=await new Promise(((t,i)=>{const o=n.get(e);o.onsuccess=()=>t(o.result),o.onerror=()=>i(o.error)}));if(i){if(this.applyThemeColors(i.colors),i.font){this.applyFont(i.font);const e=document.getElementById("font-select");e&&(e.value=i.font)}this.currentTheme=e,t&&this.showToast(`"${e}" loaded!`,"success")}}catch(e){t&&this.showToast("Load failed!","error")}}}applyThemeColors(e){const t=document.documentElement;Object.entries(e).forEach((([e,n])=>{if(t.style.setProperty(e,n),this.showColorEditor){const t=e.replace("--",""),i=document.getElementById(`preview-${t}`),o=document.getElementById(`color-${t}`),a=document.getElementById(`alpha-${t}`);if(i&&(i.style.background=n),o&&(o.value=this.extractHexFromColor(n)),a){const e=this.colorToRgb(n);a.value=e.a;const t=a.previousElementSibling;t&&(t.textContent=`α: ${e.a.toFixed(2)}`)}}}))}async updateThemesList(){const e=document.getElementById("theme-select");if(e)try{e.innerHTML='<option value="">Choose a theme...</option>';const t=document.createElement("option");t.value="default",t.textContent="Default",e.appendChild(t);const n=document.createElement("optgroup");n.label="Presets",Object.keys(this.presetThemes).forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)})),e.appendChild(n);const i=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),o=await new Promise(((e,t)=>{const n=i.getAll();n.onsuccess=()=>e(n.result||[]),n.onerror=()=>t(n.error)}));if(o.length>0){const t=document.createElement("optgroup");t.label="Custom",o.forEach((e=>{if("default"===e.name)return;const n=document.createElement("option");n.value=e.name,n.textContent=e.name,t.appendChild(n)})),e.appendChild(t)}}catch(e){}}async deleteTheme(){const e=document.getElementById("theme-select"),t=e.value;t?this.presetThemes[t]?this.showToast("Cannot delete preset themes!","error"):"default"!==t?this.showCustomConfirm(`Are you sure you want to delete the theme "${t}"? This action cannot be undone.`,(async()=>{try{const n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName);await new Promise(((e,i)=>{const o=n.delete(t);o.onsuccess=()=>e(),o.onerror=()=>i(o.error)})),await this.updateThemesList(),this.showToast(`"${t}" deleted!`,"success"),e.value=""}catch(e){this.showToast("Delete failed!","error")}})):this.showToast("Cannot delete default theme!","error"):this.showToast("Select a theme first!","error")}updateColorRealTime(e,t,n=null){const i=document.documentElement;let o=t;if(null!==n&&t.startsWith("#")){const e=this.colorToRgb(t);o=`rgba(${e.r}, ${e.g}, ${e.b}, ${n})`}i.style.setProperty(e,o)}colorToRgb(e){let t,n,i,o=1;if(e.includes("rgba")||e.includes("rgb")){const a=e.match(/rgba?\(([^)]+)\)/);if(a){const e=a[1].split(",").map((e=>parseFloat(e.trim())));t=e[0],n=e[1],i=e[2],void 0!==e[3]&&(o=e[3])}}else{if(!e.startsWith("#"))return{r:0,g:0,b:0,a:1};{const o=e.slice(1);t=parseInt(o.substr(0,2),16),n=parseInt(o.substr(2,2),16),i=parseInt(o.substr(4,2),16)}}return{r:Math.round(t),g:Math.round(n),b:Math.round(i),a:o}}rgbToHex(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}createCompactColorPicker(e,t,n){const i=document.createElement("div");i.className="theme-color-picker-container";const o=document.createElement("div");o.className="theme-color-picker-header";const a=document.createElement("span");a.textContent=e,a.className="property-label";const s=document.createElement("div");s.id=`preview-${e.replace("--","")}`,s.className="theme-color-preview",s.style.background=t,o.appendChild(a),o.appendChild(s);const r=document.createElement("label");r.setAttribute("for",`color-${e.replace("--","")}`),r.className="theme-color-input-label",r.textContent="Color:";const l=document.createElement("input");l.type="color",l.id=`color-${e.replace("--","")}`,l.value=this.extractHexFromColor(t),l.className="theme-color-input",l.addEventListener("input",(t=>{const o=t.target.value,a=i.querySelector(`#alpha-${e.replace("--","")}`),r=a?parseFloat(a.value):1;if(this.updateColorRealTime(e,o,r),r<1){const e=this.colorToRgb(o);s.style.background=`rgba(${e.r}, ${e.g}, ${e.b}, ${r})`}else s.style.background=o;n(o)})),i.appendChild(o),i.appendChild(r),i.appendChild(l);const c=this.colorToRgb(t);if(t.includes("rgba")||c.a<1){const t=document.createElement("div"),n=document.createElement("label");n.setAttribute("for",`alpha-${e.replace("--","")}`),n.textContent=`α: ${c.a.toFixed(2)}`,n.className="alpha-label";const o=document.createElement("input");o.type="range",o.min="0",o.max="1",o.step="0.01",o.value=c.a,o.id=`alpha-${e.replace("--","")}`,o.className="alpha-slider",o.addEventListener("input",(()=>{const t=parseFloat(o.value);n.textContent=`α: ${t.toFixed(2)}`;const i=l.value;this.updateColorRealTime(e,i,t);const a=this.colorToRgb(i);s.style.background=`rgba(${a.r}, ${a.g}, ${a.b}, ${t})`})),t.appendChild(n),t.appendChild(o),i.appendChild(t)}return i}extractHexFromColor(e){if(e.startsWith("#"))return e;if(e.includes("rgb")){const t=this.colorToRgb(e);return this.rgbToHex(t.r,t.g,t.b)}return"#000000"}createColorInputs(){const e=document.getElementById("color-inputs");Object.entries(this.defaultColors).forEach((([t,n])=>{const i=this.createCompactColorPicker(t,n,(e=>{}));e.appendChild(i)}))}resetToDefault(){this.applyThemeColors(this.defaultColors),this.applyFont(this.defaultFont);const e=document.getElementById("font-select");e&&(e.value=this.defaultFont),this.showToast("Reset to default!","success")}async saveTheme(){const e=document.getElementById("theme-name"),t=document.getElementById("font-select"),n=e.value.trim();if(!n)return void this.showToast("Enter theme name!","error");if(this.presetThemes[n])return void this.showToast("Cannot overwrite preset themes!","error");const i={},o=document.documentElement;Object.keys(this.defaultColors).forEach((e=>{const t=getComputedStyle(o).getPropertyValue(e).trim();i[e]=t||this.defaultColors[e]}));const a=t?t.value:this.defaultFont;try{const t=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName);await new Promise(((e,o)=>{const s=t.put({name:n,colors:i,font:a,created:(new Date).toISOString()});s.onsuccess=()=>e(),s.onerror=()=>o(s.error)})),this.currentTheme=n,await this.updateThemesList(),this.showToast(`"${n}" saved!`,"success"),e.value=""}catch(e){this.showToast("Save failed!","error")}}async loadSavedTheme(){const e=localStorage.getItem("currentTheme"),t=localStorage.getItem("currentFont");t&&this.applyFont(t),e&&"default"!==e&&await this.loadSelectedTheme(e,!1)}showToast(e,t="info"){"function"==typeof window.showToast&&window.showToast(e,t)}toggleModal(){this.isModalOpen?this.closeModal():this.openModal()}async openModal(){document.getElementById("theme-modal").style.display="block",this.isModalOpen=!0,await this.updateThemesList()}closeModal(){document.getElementById("theme-modal").style.display="none",this.isModalOpen=!1,this.showColorEditor=!1;const e=document.getElementById("toggle-editor"),t=document.getElementById("color-editor-section");e&&t&&(e.textContent="Editor",e.style.background="var(--b)",t.style.display="none"),localStorage.setItem("currentTheme",this.currentTheme);const n=document.getElementById("font-select");n&&localStorage.setItem("currentFont",n.value)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{window.themeManager=new e})):window.themeManager=new e,"undefined"!=typeof module&&module.exports&&(module.exports=e)})(),window.AudioReactive=class{constructor(){this.isActive=!1,this.audioContext=null,this.analyser=null,this.gl=null,this.program=null,this.sensitivity={bass:1,mid:1,treble:1,volume:1},this.showingInfo=!1,this.micStream=null,this.fileSource=null,this.fileActive=!1,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.init(),window.audioReactiveInstance=this})):(this.init(),window.audioReactiveInstance=this)}init(){this.previewPanel=document.getElementById("preview-panel"),this.previewPanel&&("static"===getComputedStyle(this.previewPanel).position&&(this.previewPanel.style.position="relative"),this.button(),this.Modal(),navigator.mediaDevices.addEventListener("devicechange",(()=>this.loadAudioDevices())),this.loadAudioDevices())}EL(e,t={},n="",i=""){const o=document.createElement(e);return Object.assign(o,t),n&&(o.className=n),i&&(o.innerHTML=i),o}style(e,t){Object.assign(e.style,t)}button(){this.button=this.EL("button",{innerHTML:this.SVG(),title:"Audio Reactivity"},"audio-reactive-button"),this.button.addEventListener("mouseleave",(()=>{this.button.classList.toggle("active",this.isActive)})),this.button.onclick=()=>this.show(),this.previewPanel.appendChild(this.button)}SVG(){return'\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n        <path d="M12 1c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2s2-.9 2-2V3c0-1.1-.9-2-2-2z"/>\n        <path d="M19 10v1c0 3.87-3.13 7-7 7s-7-3.13-7-7v-1\n                 c0-.55-.45-1-1-1s-1 .45-1 1v1\n                 c0 4.72 3.56 8.61 8 9.19V22\n                 c0 .55.45 1 1 1s1-.45 1-1v-2.81\n                 c4.44-.58 8-4.47 8-9.19v-1\n                 c0-.55-.45-1-1-1s-1 .45-1 1z"/>\n        <circle cx="12" cy="20" r="2" opacity="0.3"/>\n      </svg>\n    '}InfoSVG(){return'\n     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">\n      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1" fill="none"/>\n      <line x1="12" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>\n      <circle cx="12" cy="8" r="1" fill="currentColor"/>\n    </svg>\n    '}Modal(){this.modal=this.EL("div",{},"audio-reactive-modal");const e=this.EL("div",{},"audio-reactive-modal-wrap"),t=this.EL("div",{},"",`<div class="audio-reactive-header">\n        <h3 class="audio-reactive-title">\n          ${this.SVG()} <span id="modal-title">Audio</span>\n        </h3>\n        <div class="audio-reactive-button-group">\n          <button id="info-toggle" class="audio-reactive-info-btn" title="Show Documentation">\n            ${this.InfoSVG()}\n          </button>\n          <button id="close-modal" class="audio-reactive-close-btn">×</button>\n        </div>\n      </div>`);e.appendChild(t),this.settingsContent=this.EL("div",{id:"settings-content"}),this.settingsContent.appendChild(this.EL("div",{},"",'<div class="audio-reactive-mic-section">\n        <span class="audio-reactive-label">\n          Microphone Input:\n        </span>\n        <select id="mic-select" class="audio-reactive-select">\n          <option value="">Loading devices...</option>\n        </select>\n      </div>')),this.settingsContent.appendChild(this.EL("div",{},"",'<div class="audio-reactive-toggle-section">\n        <button id="audio-toggle" class="audio-reactive-toggle-btn">\n          Enable Audio Input\n        </button>\n        <div id="audio-status" class="audio-reactive-status">\n          Click to enable microphone access\n        </div>\n      </div>'));const n=["bass","mid","treble","volume"].map((e=>`<div class="audio-reactive-slider-group">\n          <span class="audio-reactive-slider-label">\n            ${e[0].toUpperCase()+e.slice(1)} Sensitivity:\n            <span id="${e}-value" class="audio-reactive-slider-value" style="color:${this.color(e)};">1.0</span>\n          </span>\n          <input id="${e}-slider" class="audio-reactive-slider" type="range" min="0.1" max="3" step="0.1" value="1.0" />\n        </div>`)).join("");this.settingsContent.appendChild(this.EL("div",{},"",`${n}`)),this.settingsContent.appendChild(this.EL("div",{},"",`<div class="audio-reactive-levels">\n        <h4 class="audio-reactive-levels-title">\n          Audio Levels\n        </h4>\n        <div id="audio-bars" class="audio-reactive-bars">\n          ${["bass","mid","treble","volume"].map((e=>`<div class="audio-bar" data-type="${e}"></div>`)).join("")}\n        </div>\n        <div class="audio-reactive-bar-labels">\n          ${["Bass","Mid","Treble","Volume"].map((e=>`<span class="audio-reactive-bar-label">${e}</span>`)).join("")}\n        </div>\n      </div>`)),this.infoContent=this.EL("div",{id:"info-content"},"audio-reactive-info-content"),this.infoContent.appendChild(this.EL("div",{},"",'<div>\n        <h4 class="audio-reactive-info-title">Audio-Reactive Shader Uniforms</h4>\n        <p class="audio-reactive-info-text">\n          This system automatically passes audio data to your shaders as uniform variables. \n          Use these in your fragment shader code:\n        </p>\n        <div class="audio-reactive-code-block">\n          <div class="audio-reactive-code-comment">// Available uniforms:</div>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_bass;</span>    <span class="audio-reactive-code-inline-comment">// Bass frequencies (0.0-1.0)</span><br>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_mid;</span>     <span class="audio-reactive-code-inline-comment">// Mid frequencies (0.0-1.0)</span><br>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_treble;</span> <span class="audio-reactive-code-inline-comment">// High frequencies (0.0-1.0)</span><br>\n          <div class="audio-reactive-code-type">uniform float</div> <span class="audio-reactive-code-var">u_volume;</span> <span class="audio-reactive-code-inline-comment">// Overall volume (0.0-1.0)</span>\n        </div>\n        <h5 class="audio-reactive-example-title">Example Usage:</h5>\n        <div class="audio-reactive-code-block">\n          <div class="audio-reactive-code-comment">// Pulse effect with bass</div><br>\n          <span class="audio-reactive-code-var">vec3 color = baseColor * (</span><span class="audio-code-span">1.0</span><span class="audio-reactive-code-var"> + u_bass * </span><span class="audio-code-span">2.0</span><span class="audio-reactive-code-var">);</span><br><br>\n          <div class="audio-reactive-code-comment">// Frequency-based color mixing</div><br>\n          <span class="audio-reactive-code-var">vec3 audioColor = vec3(u_bass, u_mid, u_treble);</span><br><br>\n          <div class="audio-reactive-code-comment">// Time modulation with volume</div><br>\n          <span class="audio-reactive-code-var">float speed = u_time * (</span><span class="audio-code-span">1.0</span><span class="audio-reactive-code-var"> + u_volume * </span><span class="audio-code-span">5.0</span><span class="audio-reactive-code-var">);</span><br><br>\n          <div class="audio-reactive-code-comment">// Scale transformations</div><br>\n          <span class="audio-reactive-code-var">vec2 scaledUV = uv * (</span><span class="audio-code-span">1.0</span><span class="audio-reactive-code-var"> + u_bass * </span><span class="audio-code-span">0.5</span><span class="audio-reactive-code-var">);</span>\n        </div>\n        <h5 class="audio-reactive-notes-title">Notes:</h5>\n        <ul class="audio-reactive-notes-list">\n          <li class="audio-reactive-notes-item">Bass frequencies are dampened to prevent overwhelming effects</li>\n          <li class="audio-reactive-notes-item">Use sensitivity sliders to fine-tune responsiveness</li>\n          <li class="audio-reactive-notes-item">Combine multiple frequencies for complex animations</li>\n          <li class="audio-reactive-notes-item">Values are smoothed over time to reduce jitter</li>\n        </ul>\n        <div class="audio-reactive-tip-box">\n          <strong class="audio-reactive-tip-strong">Pro Tip:</strong> \n          <span class="audio-reactive-tip-text">Try multiplying audio values by larger numbers (2.0-10.0) for more dramatic effects, or use them as offsets in noise functions.</span>\n        </div>\n      </div>'));const i=this.EL("div",{id:"file-drop"},"audio-reactive-file-drop",'\n      <p class="audio-reactive-file-text">\n        Drag & drop an audio file here<br>\n        or <button id="file-upload-btn" class="audio-reactive-upload-btn">Browse files</button>\n      </p>\n      <input id="file-input" class="audio-reactive-file-input" type="file" accept="audio/mpeg, audio/mp3, audio/wav, audio/wave, audio/x-wav, audio/aac, audio/mp4, audio/x-m4a, audio/flac, audio/ogg, audio/opus, .mp3, .wav, .aac, .m4a, .flac, .ogg, .opus"/>\n      <audio id="file-audio" class="audio-reactive-file-audio" controls></audio>\n      <button id="clear-file-btn" class="audio-reactive-clear-btn">Clear File</button>\n    ');this.settingsContent.appendChild(i),e.appendChild(this.settingsContent),e.appendChild(this.infoContent),this.modal.appendChild(e),this.bindEvents()}color(e){return{bass:"#ff4444",mid:"#44ff44",treble:"#4444ff",volume:"#ffff44"}[e]}async loadAudioDevices(e){try{const t=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)),n=this.modal.querySelector("#mic-select"),i=e||n.value;n.innerHTML="",t.forEach(((e,t)=>{const i=document.createElement("option");i.value=e.deviceId,i.text=e.label||`Microphone ${t+1}`,n.appendChild(i)})),i&&[...n.options].some((e=>e.value===i))&&(n.value=i)}catch(e){}}bindEvents(){this.modal.querySelector("#close-modal").onclick=()=>this.hide(),this.modal.onclick=e=>{e.target===this.modal&&this.hide()},document.addEventListener("keydown",(e=>{"Escape"===e.key&&"none"!==this.modal.style.display&&this.hide()}),{once:!1});const e=this.modal.querySelector("#info-toggle"),t=this.modal.querySelector("#modal-title");e.onclick=()=>{this.showingInfo=!this.showingInfo,this.showingInfo?(this.settingsContent.style.display="none",this.infoContent.style.display="block",t.textContent="Documentation",e.innerHTML=this.SVG(),e.title="Show Settings"):(this.settingsContent.style.display="block",this.infoContent.style.display="none",t.textContent="Audio",e.innerHTML=this.InfoSVG(),e.title="Show Documentation")},this.modal.querySelector("#mic-select").addEventListener("change",(async()=>{this.isActive&&!this.fileActive&&await this.switchToMicrophone()}));const n=this.modal.querySelector("#audio-toggle");this.modal.querySelector("#audio-status"),n.onclick=async()=>{if(this.fileActive)await this.switchToMicrophone();else if(this.audioContext&&this.micStream)this.isActive=!this.isActive,this.isActive?(this.updateMicrophoneUI(!0,"Microphone active"),this.button.classList.add("active")):(this.cleanupMicrophone(),this.updateMicrophoneUI(!1,"Click to enable microphone access"),this.button.classList.remove("active"));else try{await this.getMic(),this.updateMicrophoneUI(!0,"Microphone active"),this.isActive=!0,this.fileActive=!1,this.button.classList.add("active")}catch{this.updateMicrophoneUI(!1,"Microphone access denied",!0)}},["bass","mid","treble","volume"].forEach((e=>{const t=this.modal.querySelector(`#${e}-slider`),n=this.modal.querySelector(`#${e}-value`);t.oninput=()=>{this.sensitivity[e]=+t.value,n.textContent=t.value}}));const i=this.modal.querySelector("#file-drop"),o=this.modal.querySelector("#file-input"),a=this.modal.querySelector("#file-upload-btn"),s=(this.modal.querySelector("#file-audio"),this.modal.querySelector("#clear-file-btn"));a.onclick=e=>{e.stopPropagation(),o.click()},["dragenter","dragover"].forEach((e=>i.addEventListener(e,(e=>{e.preventDefault(),i.classList.add("dragover")})))),["dragleave","drop"].forEach((e=>i.addEventListener(e,(e=>{e.preventDefault(),i.classList.remove("dragover")})))),i.addEventListener("drop",(e=>{const t=e.dataTransfer.files[0];t&&t.type.startsWith("audio/")&&this.loadFile(t)})),o.onchange=()=>{const e=o.files[0];e&&this.loadFile(e)},s.onclick=()=>this.clearFile()}updateMicrophoneUI(e,t,n=!1){const i=this.modal.querySelector("#audio-toggle"),o=this.modal.querySelector("#audio-status");n?(i.textContent="Access Denied",this.style(i,{backgroundColor:"var(--r)"}),o.style.color="var(--r)"):(i.textContent=e?"Microphone: ON":"Microphone: OFF",this.style(i,{backgroundColor:e?"var(--a)":"var(--1)"}),o.style.color="var(--7)"),o.textContent=t}async switchToMicrophone(){try{this.fileActive&&this.clearFileAudio(),await this.getMic(),this.updateMicrophoneUI(!0,"Microphone active"),this.isActive=!0,this.fileActive=!1,this.button.style.backgroundColor="var(--a)"}catch(e){this.updateMicrophoneUI(!1,"Failed to access microphone",!0)}}clearFileAudio(){const e=this.modal.querySelector("#file-audio"),t=this.modal.querySelector("#clear-file-btn");e&&(e.pause(),e.currentTime=0,e.style.display="none",e.src&&(URL.revokeObjectURL(e.src),e.src="")),t&&(t.style.display="none"),this.fileSource&&(this.fileSource.disconnect(),this.fileSource=null)}async show(){const e=document.fullscreenElement||document.webkitFullscreenElement||document.body;this.modal.parentNode!==e&&e.appendChild(this.modal),this.modal.style.display="block",this.showingInfo=!1,this.settingsContent.style.display="block",this.infoContent.style.display="none",this.modal.querySelector("#modal-title").textContent="Audio",this.modal.querySelector("#info-toggle").innerHTML=this.InfoSVG(),this.modal.querySelector("#info-toggle").title="Show Documentation",this.barAnimation()}hide(){this.modal.style.display="none"}barAnimation(){const e=()=>{if("none"!==this.modal.style.display){if(this.analyser&&this.isActive&&!this.showingInfo){const e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(e);const t={bass:e.slice(0,20).reduce(((e,t)=>e+t))/20*.4,mid:e.slice(20,60).reduce(((e,t)=>e+t))/40,treble:e.slice(60,120).reduce(((e,t)=>e+t))/60,volume:e.reduce(((e,t)=>e+t))/e.length};this.modal.querySelectorAll(".audio-bar").forEach((e=>{const n=e.dataset.type,i=Math.max(2,t[n]/255*60);e.style.height=i+"px"}))}requestAnimationFrame(e)}};requestAnimationFrame(e)}cleanupMicrophone(){this.micStream&&(this.micStream.getTracks().forEach((e=>e.stop())),this.micStream=null)}stopAudio(){this.cleanupMicrophone(),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null,this.analyser=null,this.fileSource=null}async getMic(){this.cleanupMicrophone();const e=this.modal.querySelector("#mic-select").value;try{this.micStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:e?{exact:e}:void 0,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}),this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),"suspended"===this.audioContext.state&&await this.audioContext.resume(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.3,this.audioContext.createMediaStreamSource(this.micStream).connect(this.analyser),await this.loadAudioDevices(e)}catch(e){throw this.cleanupMicrophone(),e}}async loadFileFromDrop(e){this.clearFileAudio();const t=this.modal.querySelector("#file-audio");t&&t.parentNode&&t.parentNode.removeChild(t);const n=this.EL("audio",{id:"file-audio",controls:!1,src:URL.createObjectURL(e)},"audio-reactive-file-audio");this.modal.querySelector("#file-drop").appendChild(n),this.modal.querySelector("#clear-file-btn").style.display="block";try{this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=new AudioContext),"suspended"===this.audioContext.state&&await this.audioContext.resume(),this.cleanupMicrophone(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.3,this.fileSource=this.audioContext.createMediaElementSource(n),this.fileSource.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.isActive=!0,this.fileActive=!0,this.button.style.backgroundColor="var(--a)",this.updateMicrophoneUI(!1,"Audio file active - Click to switch to microphone"),await new Promise(((e,t)=>{n.addEventListener("loadedmetadata",e,{once:!0}),n.addEventListener("error",t,{once:!0})}))}catch(e){this.clearFile()}}async loadFile(e){this.clearFileAudio();const t=this.EL("audio",{id:"file-audio",controls:!0,src:URL.createObjectURL(e)},"audio-reactive-file-audio");t.style.display="block",this.modal.querySelector("#clear-file-btn").style.display="block",this.modal.querySelector("#file-drop").appendChild(t);try{this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=new AudioContext),"suspended"===this.audioContext.state&&await this.audioContext.resume(),this.cleanupMicrophone(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.3,this.fileSource=this.audioContext.createMediaElementSource(t),this.fileSource.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.isActive=!0,this.fileActive=!0,this.button.style.backgroundColor="var(--a)",this.updateMicrophoneUI(!1,"Audio file active - Click to switch to microphone"),await t.play()}catch(e){this.clearFile()}}clearFile(){this.clearFileAudio(),this.fileActive=!1,this.isActive=!1,this.button.style.backgroundColor="var(--d)",this.updateMicrophoneUI(!1,"Click to enable microphone access")}setGLContext(e,t){this.gl=e,this.program=t}update(){if(!(this.analyser&&this.isActive&&this.gl&&this.program))return;const e=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(e);const t=(t,n,i,o=1)=>Math.min(1,e.slice(t,n).reduce(((e,t)=>e+t))/(n-t)/255*i*o),n={bass:t(0,20,this.sensitivity.bass,.4),mid:t(20,60,this.sensitivity.mid),treble:t(60,120,this.sensitivity.treble),volume:t(0,e.length,this.sensitivity.volume)};["bass","mid","treble","volume"].forEach((e=>{const t=this.gl.getUniformLocation(this.program,`u_${e}`);t&&this.gl.uniform1f(t,n[e])}))}},function(){const e=new WeakSet;let t=null,n=!1,i=!1,o=null,a=null,s=null;function r(e){if(isNaN(e)||!isFinite(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}function l(e){const t=document.createElement("div");t.textContent=e,t.className="audio-notification";(document.fullscreenElement||document.body).appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),900)}function c(){o&&(clearInterval(o),o=null),i=!1;document.querySelectorAll(".audio-notification").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))}function d(d){if(e.has(d))return;e.add(d),function(){if(t&&t.parentNode){const e=t.querySelector("audio");e&&(e.pause(),e.src="",e.load()),c(),t.parentNode.removeChild(t),t=null}s=null,a=null}(),s=d,a=d.src,d.controls=!1;const u=document.createElement("div");u.className="audio-wrapper",t=u;const m=document.createElement("div");m.className="audio-time-container";const h=document.createElement("div");h.textContent="0:00";const p=document.createElement("div");p.textContent="/";const g=document.createElement("div");g.textContent="0:00",m.appendChild(h),m.appendChild(p),m.appendChild(g);const v=document.createElement("div");v.className="audio-controls-row";const f=document.createElement("button");f.textContent="►",f.className="audio-play-pause";const w=document.createElement("input");w.type="range",w.min=0,w.max=100,w.value=0,w.disabled=!0,w.className="audio-seek-bar";const y=document.createElement("div");y.className="audio-volume-container";const b=document.createElement("button");b.className="audio-volume-button";const E=document.createElementNS("http://www.w3.org/2000/svg","svg"),C=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","currentColor"),E.setAttribute("width","20"),E.setAttribute("height","20"),C.setAttribute("d","M3 10v4h4l5 5V5l-5 5H3zm13.5 2c0-.83-.34-1.58-.88-2.12l1.42-1.42A5.985 5.985 0 0120.5 12c0 1.66-.67 3.16-1.76 4.24l-1.42-1.42c.54-.54.88-1.29.88-2.12zm-2.12-7.88l1.42 1.42A8.963 8.963 0 0122 12a8.963 8.963 0 01-4.2 7.46l-1.42-1.42A6.978 6.978 0 0019.5 12c0-2.21-.9-4.21-2.62-5.88z"),E.appendChild(C),b.appendChild(E);const x=document.createElement("div");x.className="audio-volume-panel";const S=document.createElement("div");S.textContent=Math.round(100*d.volume)+"%",S.className="audio-volume-display";const L=document.createElement("div");L.className="audio-slider-track";const k=document.createElement("div");k.className="audio-slider-fill";const T=document.createElement("div");function A(e){const t=100*e;k.style.height=t+"%",T.style.bottom=`calc(${t}% - 6px)`,S.textContent=Math.round(t)+"%",0===e?C.setAttribute("d","M5 9v6h4l5 5V4l-5 5H5z M16 10l4 4m0-4l-4 4"):e<.5?C.setAttribute("d","M5 9v6h4l5 5V4l-5 5H5z M17 12a3 3 0 00-1.2-2.4l.7-.7a4 4 0 010 6.2l-.7-.7A3 3 0 0017 12z"):C.setAttribute("d","M5 9v6h4l5 5V4l-5 5H5z M17 12a3 3 0 00-1.2-2.4l.7-.7a4 4 0 010 6.2l-.7-.7A3 3 0 0017 12z M20 12a5 5 0 00-2-4l.7-.7a6 6 0 010 9.4l-.7-.7a5 5 0 002-4z")}T.className="audio-slider-handle",L.appendChild(k),L.appendChild(T),x.appendChild(S),x.appendChild(L),A(d.volume),y.appendChild(b),y.appendChild(x);let I,B=!1;function P(e){const t=L.getBoundingClientRect(),n=e-t.top;return Math.max(0,Math.min(1,1-n/t.height))}function M(e){if(B){const t=P(e.clientY);d.volume=t,A(t)}}function R(){I=setTimeout((()=>{B||x.classList.remove("visible")}),500)}L.addEventListener("mousedown",(e=>{B=!0;const t=P(e.clientY);d.volume=t,A(t),document.addEventListener("mousemove",M),document.addEventListener("mouseup",(()=>{B=!1,document.removeEventListener("mousemove",M)}))})),b.addEventListener("mouseenter",(function(){clearTimeout(I),x.classList.add("visible")})),y.addEventListener("mouseleave",R),x.addEventListener("mouseenter",(()=>clearTimeout(I))),x.addEventListener("mouseleave",R);let F=d.volume;b.addEventListener("click",(()=>{d.volume>0?(F=d.volume,d.volume=0):d.volume=F||.5,A(d.volume)}));const D=document.createElement("button");D.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n      <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/>\n      <path d="M12.5 7H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>\n    </svg>',D.title="Toggle 10s countdown",D.className="audio-countdown-toggle "+(n?"enabled":"disabled"),v.appendChild(f),v.appendChild(w),v.appendChild(D),v.appendChild(y),d.parentNode.insertBefore(u,d),u.appendChild(m),u.appendChild(v),u.appendChild(d),D.addEventListener("click",(()=>{n=!n,D.className="audio-countdown-toggle "+(n?"enabled":"disabled")})),f.addEventListener("click",(()=>{if(d.src||a)if(d.paused)if(n&&!i){const e=function(e){const t=new(window.AudioContext||window.webkitAudioContext),n=t.sampleRate,i=t.createBuffer(1,e*n,n).length,o=new ArrayBuffer(44+2*i),a=new DataView(o),s=(e,t)=>{for(let n=0;n<t.length;n++)a.setUint8(e+n,t.charCodeAt(n))};s(0,"RIFF"),a.setUint32(4,36+2*i,!0),s(8,"WAVE"),s(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,n,!0),a.setUint32(28,2*n,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),s(36,"data"),a.setUint32(40,2*i,!0);for(let e=0;e<i;e++)a.setInt16(44+2*e,0,!0);return t.close(),new Blob([o],{type:"audio/wav"})}(10),t=URL.createObjectURL(e);d.src=t,d.load(),d.play(),function(e,t){if(i)return;i=!0;let n=10;l(n),o=setInterval((()=>{n--,n>0?l(n):(c(),e===s&&(e.src=t,e.load(),e.play()))}),1e3)}(d,a)}else d.play();else d.pause(),c()})),d.addEventListener("play",(()=>{f.textContent="❚❚",w.disabled=!1})),d.addEventListener("pause",(()=>{f.textContent="►"})),d.addEventListener("timeupdate",(()=>{isNaN(d.duration)||(w.value=d.currentTime/d.duration*100||0,h.textContent=r(d.currentTime),g.textContent=r(d.duration))})),d.addEventListener("loadedmetadata",(()=>{w.disabled=!1,h.textContent="0:00",g.textContent=r(d.duration)})),w.addEventListener("input",(()=>{isNaN(d.duration)||(d.currentTime=w.value/100*d.duration)})),d.addEventListener("volumechange",(()=>{A(d.volume)}))}new MutationObserver((e=>{for(let t of e)for(let e of t.addedNodes)1===e.nodeType&&"AUDIO"===e.tagName&&"file-audio"===e.id&&d(e)})).observe(document.body,{childList:!0,subtree:!0});const u=document.getElementById("file-audio");u&&d(u),document.addEventListener("keydown",(e=>{if(!e.altKey)return;if("KeyP"!==e.code)return;e.preventDefault(),e.stopPropagation();const t=document.getElementById("file-audio");t&&(t.paused?t.play().catch((()=>{})):t.pause())}),!0)}();class e{constructor(e,t={}){this.canvas=e,this.gl=e.getContext("webgl")||e.getContext("webgl2"),this.options={sampleSize:t.sampleSize||60,showFPS:void 0===t.showFPS||t.showFPS,showMemory:void 0===t.showMemory||t.showMemory,showGPUInfo:void 0===t.showGPUInfo||t.showGPUInfo,showDrawCalls:void 0===t.showDrawCalls||t.showDrawCalls,overlayPosition:t.overlayPosition||"top-right"},this.metrics={fps:{current:0,average:0,min:1/0,max:0,history:[]},drawCalls:0,triangleCount:0,memory:{jsHeapSizeLimit:0,totalJSHeapSize:0,usedJSHeapSize:0},gpuInfo:{vendor:"",renderer:""}},this.lastTimestamp=performance.now(),this.frameCount=0,this.isPanelOpen=!1,this.createUI(),this.options.showGPUInfo&&this.collectGPUInfo(),this.instrumentGLDrawCalls()}createUI(){this.container=document.createElement("div"),this.container.className="glsl-performance-monitor-container",this.updateContainerPosition(),this.toggleButton=document.createElement("button"),this.toggleButton.className="glsl-performance-monitor-toggle",this.toggleButton.title="Performance Monitor",this.toggleButton.innerHTML='\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M3 13H10V3H3V13ZM3 21H10V15H3V21ZM12 21H19V11H12V21ZM12 3V9H19V3H12Z" fill="var(--6)"/>\n        </svg>\n      ',this.overlay=document.createElement("div"),this.overlay.className="glsl-performance-monitor-panel",this.overlay.style.display="none";const e=document.createElement("div");e.className="glsl-performance-monitor-header";const t=document.createElement("div");t.textContent="Performance Monitor",t.className="glsl-performance-monitor-title",e.appendChild(t),this.overlay.appendChild(e),this.options.showFPS&&(this.fpsDisplay=document.createElement("div"),this.fpsDisplay.className="glsl-performance-monitor-display",this.overlay.appendChild(this.fpsDisplay)),this.options.showDrawCalls&&(this.drawCallsDisplay=document.createElement("div"),this.drawCallsDisplay.className="glsl-performance-monitor-display",this.overlay.appendChild(this.drawCallsDisplay)),this.options.showMemory&&(this.memoryDisplay=document.createElement("div"),this.memoryDisplay.className="glsl-performance-monitor-display",this.overlay.appendChild(this.memoryDisplay)),this.options.showGPUInfo&&(this.gpuInfoDisplay=document.createElement("div"),this.overlay.appendChild(this.gpuInfoDisplay)),this.toggleButton.addEventListener("click",(()=>this.togglePanel())),this.container.appendChild(this.toggleButton),this.container.appendChild(this.overlay),this.canvas.parentNode.style.position="relative",this.canvas.parentNode.appendChild(this.container),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isPanelOpen&&this.togglePanel()}))}updateContainerPosition(){this.container.classList.remove("top-left","top-right","bottom-left","bottom-right"),this.container.classList.add(this.options.overlayPosition)}togglePanel(){this.isPanelOpen=!this.isPanelOpen,this.overlay.style.display=this.isPanelOpen?"block":"none";const e=this.isPanelOpen?'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M3 13H10V3H3V13ZM3 21H10V15H3V21ZM12 21H19V11H12V21ZM12 3V9H19V3H12Z" fill="var(--rh)"/>\n          </svg>':'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M3 13H10V3H3V13ZM3 21H10V15H3V21ZM12 21H19V11H12V21ZM12 3V9H19V3H12Z" fill="var(--7)"/>\n          </svg>';this.toggleButton.innerHTML=e,this.isPanelOpen?this.start():this.stop()}start(){this.isRunning=!0,this.frameCount=0,this.lastTimestamp=performance.now(),this.metrics.fps.history=[],this.metrics.fps.min=1/0,this.metrics.fps.max=0,this.metrics.drawCalls=0,this.metrics.triangleCount=0,this.animate()}stop(){this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}animate(){if(!this.isRunning)return;const e=performance.now(),t=e-this.lastTimestamp;t>=1e3&&(this.metrics.fps.current=Math.round(1e3*this.frameCount/t),this.metrics.fps.min=Math.min(this.metrics.fps.min,this.metrics.fps.current),this.metrics.fps.max=Math.max(this.metrics.fps.max,this.metrics.fps.current),this.metrics.fps.history.push(this.metrics.fps.current),this.metrics.fps.history.length>this.options.sampleSize&&this.metrics.fps.history.shift(),this.metrics.fps.average=Math.round(this.metrics.fps.history.reduce(((e,t)=>e+t),0)/this.metrics.fps.history.length),this.options.showMemory&&window.performance&&performance.memory&&(this.metrics.memory={jsHeapSizeLimit:performance.memory.jsHeapSizeLimit,totalJSHeapSize:performance.memory.totalJSHeapSize,usedJSHeapSize:performance.memory.usedJSHeapSize}),this.updateDisplay(),this.frameCount=0,this.lastTimestamp=e,this.metrics.drawCalls=0,this.metrics.triangleCount=0),this.frameCount++,this.animationFrameId=requestAnimationFrame((()=>this.animate()))}updateDisplay(){if(this.overlay&&this.isPanelOpen){if(this.options.showFPS&&this.fpsDisplay&&(this.fpsDisplay.innerHTML=`\n          <div><b>FPS:</b> <span class="glsl-performance-monitor-value">${this.metrics.fps.current}</span></div>\n          <div class="glsl-performance-monitor-details">\n            avg: ${this.metrics.fps.average}, \n            min: ${this.metrics.fps.min}, \n            max: ${this.metrics.fps.max}\n          </div>\n        `),this.options.showDrawCalls&&this.drawCallsDisplay&&(this.drawCallsDisplay.innerHTML=`\n          <div><b>Draw calls:</b> <span class="glsl-performance-monitor-value">${this.metrics.drawCalls}</span></div>\n          <div class="glsl-performance-monitor-details">\n            Triangles: ~<span class="glsl-performance-monitor-highlight">${Math.round(this.metrics.triangleCount)}</span>\n          </div>\n        `),this.options.showMemory&&this.memoryDisplay&&window.performance&&performance.memory){const e=e=>(e/1048576).toFixed(2);this.memoryDisplay.innerHTML=`\n          <div><b>Memory:</b> <span class="glsl-performance-monitor-value">${e(this.metrics.memory.usedJSHeapSize)} MB</span></div>\n          <div class="glsl-performance-monitor-details">\n            Total: ${e(this.metrics.memory.totalJSHeapSize)} MB\n            (Limit: ${e(this.metrics.memory.jsHeapSizeLimit)} MB)\n          </div>\n        `}this.options.showGPUInfo&&this.gpuInfoDisplay&&(this.gpuInfoDisplay.innerHTML=`\n          <div><b>GPU:</b> <span class="glsl-performance-monitor-value">${this.metrics.gpuInfo.vendor}</span></div>\n          <div class="glsl-performance-monitor-details">\n            ${this.metrics.gpuInfo.renderer}\n          </div>\n        `)}}collectGPUInfo(){if(this.gl){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)this.metrics.gpuInfo.vendor=this.gl.getParameter(this.gl.VENDOR)||"Unknown",this.metrics.gpuInfo.renderer=this.gl.getParameter(this.gl.RENDERER)||"Unknown";else{const e=this.gl.getExtension("WEBGL_debug_renderer_info");e?(this.metrics.gpuInfo.vendor=this.gl.getParameter(e.UNMASKED_VENDOR_WEBGL)||"Unknown",this.metrics.gpuInfo.renderer=this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL)||"Unknown"):(this.metrics.gpuInfo.vendor=this.gl.getParameter(this.gl.VENDOR)||"Unknown",this.metrics.gpuInfo.renderer=this.gl.getParameter(this.gl.RENDERER)||"Unknown")}}}instrumentGLDrawCalls(){if(!this.gl||!this.options.showDrawCalls)return;const e=this.gl.drawArrays,t=this.gl.drawElements;this.gl.drawArrays=(t,n,i)=>{if(this.isPanelOpen)switch(this.metrics.drawCalls++,t){case this.gl.TRIANGLES:this.metrics.triangleCount+=i/3;break;case this.gl.TRIANGLE_STRIP:case this.gl.TRIANGLE_FAN:i>=3&&(this.metrics.triangleCount+=i-2)}return e.call(this.gl,t,n,i)},this.gl.drawElements=(e,n,i,o)=>{if(this.isPanelOpen)switch(this.metrics.drawCalls++,e){case this.gl.TRIANGLES:this.metrics.triangleCount+=n/3;break;case this.gl.TRIANGLE_STRIP:case this.gl.TRIANGLE_FAN:n>=3&&(this.metrics.triangleCount+=n-2)}return t.call(this.gl,e,n,i,o)}}getMetrics(){return this.metrics}setPosition(e){this.container&&(this.options.overlayPosition=e,this.updateContainerPosition())}destroy(){this.stop(),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.gl&&this.options.showDrawCalls&&(this._originalDrawArrays&&(this.gl.drawArrays=this._originalDrawArrays),this._originalDrawElements&&(this.gl.drawElements=this._originalDrawElements))}}function t(e,t,n="text/plain"){const i=new Blob([e],{type:n}),o=URL.createObjectURL(i);Object.assign(document.createElement("a"),{href:o,download:t}).click(),URL.revokeObjectURL(o)}function n(e){return e.replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$\{/g,"\\${").replace(/\r?\n/g,"\\n")}function i(e,t,n){const i=e.name.slice(e.name.lastIndexOf(".")).toLowerCase();if(![".txt",".vert",".vs",".frag",".fs",".wgsl",".js"].includes(i))return;const o=new FileReader;o.onload=e=>{t.value=e.target.result,rebuildProgram()},o.readAsText(e),n&&(n.textContent=e.name)}function o(e,t,n,o){e.onclick=()=>t.click(),t.onchange=()=>{o&&(o.textContent=t.files[0]?.name||""),t.files[0]&&i(t.files[0],n)}}function a(e,n){t(n,`shader.${e}`)}!function(){const t=e=>document.getElementById(e),n=t("app"),o=t("editors"),a=t("vertPanel"),s=t("fragPanel"),r=t("rowDivider"),l=t("divider"),d=t("preview-panel"),u=t("glcanvas"),m=t("vertCode"),h=t("fragCode"),p=t("vertFile"),g=t("fragFile"),v=t("fsBtn"),f=(t("lint"),new AudioReactive);let w,y=[],b=null,E=!1,C=0,x={x:0,y:0,clickX:0,clickY:0,isPressed:!1,lastClickTime:0,scrollX:0,scrollY:0,scrollDeltaX:0,scrollDeltaY:0};if(w=u.getContext("webgl2"),w||(w=u.getContext("webgl")),w||alert("WebGL is not supported in your browser."),!w)return void alert("WebGL not supported");let S=null,L=null,k=null,T={},A=performance.now(),I={type:null,startPos:0,startSize:0},B=!0,P=!0;const M=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),R=w.createBuffer(),F=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),D=w.createBuffer();new e(u,{sampleSize:120,showFPS:!0,showMemory:!0,showGPUInfo:!0,showDrawCalls:!0,overlayPosition:"top-left"});function _(e,t=!1){if(t&&e.includes("fwidth")){return w.getExtension("OES_standard_derivatives")?`#extension GL_OES_standard_derivatives : enable\n${e}`:`#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#else\n#define fwidth(x) (0.0)\n#endif\n${e}`}return e}w.bindBuffer(w.ARRAY_BUFFER,R),w.bufferData(w.ARRAY_BUFFER,M,w.STATIC_DRAW),w.bindBuffer(w.ARRAY_BUFFER,D),w.bufferData(w.ARRAY_BUFFER,F,w.STATIC_DRAW),w.enable(w.BLEND),w.blendFunc(w.SRC_ALPHA,w.ONE_MINUS_SRC_ALPHA),w.clearColor(0,0,0,1),w.clear(w.COLOR_BUFFER_BIT);const N=(e,t=!1,n)=>{if(I.type)return;const i=((e,t=!1)=>{const n=u.getBoundingClientRect(),i=t?e.touches[0]||e.changedTouches[0]:e;return{x:i.clientX-n.left,y:n.height-(i.clientY-n.top)}})(e,t);"move"===n?(x.x=i.x,x.y=i.y):"down"===n?(x.isPressed=!0,x.clickX=i.x,x.clickY=i.y,x.lastClickTime=performance.now()):"up"===n&&(x.isPressed=!1),t&&e.preventDefault()};u.addEventListener("mousemove",(e=>N(e,!1,"move"))),u.addEventListener("mousedown",(e=>N(e,!1,"down"))),u.addEventListener("mouseup",(e=>N(e,!1,"up"))),u.addEventListener("mouseleave",(()=>{x.isPressed=!1})),u.addEventListener("touchmove",(e=>N(e,!0,"move")),{passive:!1}),u.addEventListener("touchstart",(e=>N(e,!0,"down")),{passive:!1}),u.addEventListener("touchend",(e=>N(e,!0,"up")),{passive:!1}),u.addEventListener("wheel",(e=>{if(I.type)return;let t=1;e.deltaMode===WheelEvent.DOM_DELTA_LINE?t=16:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t=u.height);const n=e.deltaX*t,i=e.deltaY*t;x.scrollDeltaX+=n,x.scrollDeltaY+=i,x.scrollX+=n,x.scrollY+=i,e.preventDefault()}),{passive:!1});const $=()=>{const e=document.hidden||!document.hasFocus();P&&(e?U():O())},U=()=>{b&&!E&&(cancelAnimationFrame(b),b=null,E=!0,C=performance.now())},O=()=>{E&&(A+=performance.now()-C,E=!1,V())};function q(){if(B){const e=o.clientHeight-r.offsetHeight;a.style.height=s.style.height=e/2+"px"}H()}function H(){const e=d.clientWidth,t=d.clientHeight;u.width===e&&u.height===t||(u.width=e,u.height=t,w.viewport(0,0,e,t))}function j(){B=!B,B?(o.style.display="block",l.style.display="block",v.textContent="⛶",v.title="Hide Editors",n.style.gridTemplateColumns="1fr auto 1fr"):(o.style.display="none",l.style.display="none",v.textContent="⊞",v.title="Show Editors (2 quick clicks for fullscreen)",n.style.gridTemplateColumns="1fr auto 1fr");try{window.editorsVisible=B}catch(e){}setTimeout(H,10)}function G(e,t){const n=_(e),i=w.createShader(t);if(w.shaderSource(i,n),w.compileShader(i),!w.getShaderParameter(i,w.COMPILE_STATUS)){const e=w.getShaderInfoLog(i);return w.deleteShader(i),{shader:null,error:e}}return{shader:i,error:null}}function z(){if(window.jsCanvasState&&window.jsCanvasState.isJSMode())return;H();const e=document.getElementById("lint"),t=document.getElementById("lintContent"),n=document.getElementById("copyErrorsBtn"),i=document.getElementById("closeLintBtn"),o=o=>{t.textContent=o,n.style.display="block",i.style.display="block",e.style.display="block"};t.textContent="",n.style.display="none",i.style.display="none",e.style.display="none",S&&w.deleteProgram(S);const a=[],s=G(m.value,w.VERTEX_SHADER),r=G(_(h.value,!0),w.FRAGMENT_SHADER);if(s.error&&a.push("Vertex: "+s.error),r.error&&a.push("Fragment: "+r.error),a.length)return void o(a.join("\n"));const l=w.createProgram();if(w.attachShader(l,s.shader),w.attachShader(l,r.shader),w.linkProgram(l),!w.getProgramParameter(l,w.LINK_STATUS)){const e=w.getProgramInfoLog(l);if(e.includes("FRAGMENT varying")&&(e.includes("does not match any VERTEX varying")||e.includes("has static-use in the frag shader, but is undeclared in the vert shader"))){const t=e.match(/varying\s+(\w+)/);if(t){const e=t[1],n=`attribute vec3 position;\nattribute vec2 surfacePosAttrib;\nvarying vec2 ${e};\nvoid main() {\n    ${e} = surfacePosAttrib;\n    gl_Position = vec4(position, 1.0);\n}`;return m.value=n,showToast(`Auto-injected surface vertex shader for: ${e}`),void setTimeout((()=>z()),100)}}return o("Link: "+e),void w.deleteProgram(l)}S=l,f.setGLContext(w,S),w.useProgram(S);const c=["a_position","position","aPosition","a_pos"];L=-1;for(const e of c)if(L=w.getAttribLocation(S,e),-1!==L)break;if(-1!==L)w.bindBuffer(w.ARRAY_BUFFER,R),w.enableVertexAttribArray(L),w.vertexAttribPointer(L,2,w.FLOAT,!1,0,0);else{const e=w.getProgramParameter(S,w.ACTIVE_ATTRIBUTES);for(let t=0;t<e;t++){w.getActiveAttrib(S,t)}}const d=["surfacePosAttrib","surfacePos","a_surfacePos","a_surfacePosition"];k=-1;for(const e of d)if(k=w.getAttribLocation(S,e),-1!==k)break;-1!==k&&(w.bindBuffer(w.ARRAY_BUFFER,D),w.enableVertexAttribArray(k),w.vertexAttribPointer(k,2,w.FLOAT,!1,0,0)),T={};const u=w.getProgramParameter(S,w.ACTIVE_UNIFORMS);for(let e=0;e<u;e++){const t=w.getActiveUniform(S,e),n=w.getUniformLocation(S,t.name);T[t.name]={loc:n,type:t.type}}Object.keys(T).forEach((e=>{if(e.startsWith("u_")||e.startsWith("u")&&e[1]==e[1].toUpperCase())return;const t="u_"+e;t in T||(T[t]=T[e]);const n="u"+e[0].toUpperCase()+e.slice(1);n in T||(T[n]=T[e])}))}function V(){if(!S||E)return;H(),w.useProgram(S);const e=.001*(performance.now()-A),t=(e,t)=>{for(const n of e)if(T[n]){t(T[n].loc);break}};t(["u_time","uTime","iTime"],(t=>w.uniform1f(t,e))),t(["u_resolution","uResolution","iResolution"],(e=>w.uniform2f(e,u.width,u.height))),t(["u_mouse","uMouse","iMouse"],(e=>w.uniform2f(e,x.x/u.width,x.y/u.height))),t(["u_mouse_pixel","uMousePixel","iMousePixel"],(e=>w.uniform2f(e,x.x,x.y))),t(["u_mouse_click","uMouseClick","iMouseClick"],(e=>w.uniform2f(e,x.clickX/u.width,x.clickY/u.height))),t(["u_mouse_click_pixel","uMouseClickPixel","iMouseClickPixel"],(e=>w.uniform2f(e,x.clickX,x.clickY))),t(["u_mouse_pressed","uMousePressed","iMousePressed"],(e=>w.uniform1i(e,x.isPressed?1:0))),t(["u_mouse_click_time","uMouseClickTime","iMouseClickTime"],(e=>w.uniform1f(e,.001*(performance.now()-x.lastClickTime)))),t(["u_scroll","uScroll","iScroll"],(e=>w.uniform2f(e,x.scrollX,x.scrollY))),t(["u_scroll_delta","uScrollDelta","iScrollDelta"],(e=>w.uniform2f(e,x.scrollDeltaX,x.scrollDeltaY))),x.scrollDeltaX*=.9,x.scrollDeltaY*=.9,T.uColor&&w.uniform3f(T.uColor.loc,1,1,1),f.update(),w.drawArrays(w.TRIANGLES,0,6),b=requestAnimationFrame(V)}function W(){q(),c()}document.addEventListener("visibilitychange",$),window.addEventListener("focus",$),window.addEventListener("blur",(()=>P&&U())),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"p"===e.key.toLowerCase())return e.preventDefault(),P=!P,void showToast("Window Focus "+(P?"enabled":"disabled"));if(e.ctrlKey&&"f"===e.key.toLowerCase()){e.preventDefault();const t=performance.now();if(y.push(t),y.length>2&&y.shift(),2===y.length&&t-y[0]<600){y=[];const e=n,t=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen,i=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,o=document.fullscreenElement?i:t,a=document.fullscreenElement?document:e;o.call(a)}else j()}})),document.getElementById("copyErrorsBtn").addEventListener("click",(function(){const e=this,t=document.getElementById("lintContent").textContent;navigator.clipboard.writeText(t).then((()=>{const t=e.textContent;e.textContent="Copied!",setTimeout((()=>{e.textContent=t}),1e3)})).catch((e=>{}))})),document.getElementById("closeLintBtn").addEventListener("click",(function(){const e=document.getElementById("lint"),t=document.getElementById("copyErrorsBtn"),n=document.getElementById("closeLintBtn");e.style.display="none",t.style.display="none",n.style.display="none"})),"loading"===document.readyState?window.addEventListener("load",W):W(),window.addEventListener("resize",q),["mousedown","touchstart"].forEach((e=>{r.addEventListener(e,(e=>{I.type="row",I.startPos=e.clientY||e.touches[0].clientY,I.startSize=a.getBoundingClientRect().height,e.preventDefault()}),{passive:!1}),l.addEventListener(e,(e=>{I.type="col",I.startPos=e.clientX||e.touches[0].clientX,I.startSize=o.getBoundingClientRect().width,e.preventDefault()}),{passive:!1})})),["mousemove","touchmove"].forEach((e=>{document.addEventListener(e,(t=>{if(!I.type)return;const i=e.includes("touch")?t.touches[0]["row"===I.type?"clientY":"clientX"]:t["row"===I.type?"clientY":"clientX"];if("row"===I.type){const e=i-I.startPos,t=o.clientHeight-r.offsetHeight;let n=Math.max(50,Math.min(t-50,I.startSize+e));a.style.height=n+"px",s.style.height=t-n+"px"}else{const e=Math.max(100,Math.min(n.clientWidth-100,I.startSize+i-I.startPos));o.style.width=e+"px"}H(),t.preventDefault()}))})),["mouseup","touchend","touchcancel"].forEach((e=>{document.addEventListener(e,(()=>I.type=null))})),[m,h].forEach((e=>e.addEventListener("input",z))),p.addEventListener("change",(()=>i(p,m))),g.addEventListener("change",(()=>i(g,h))),v.onclick=e=>{const t=performance.now();if(y.push(t),y.length>2&&y.shift(),2===y.length&&t-y[0]<600){y=[];const e=n,t=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen,i=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,o=document.fullscreenElement?i:t,a=document.fullscreenElement?document:e;o.call(a)}else j()},z(),V(),window.rebuildProgram=z,window.$=e=>document.getElementById(e),window.render=V,window.editorsVisible=!0,window.pauseAnimation=U,window.resumeAnimation=O,window.toggleEditors=j,window.initApp=W}();const s={js:e=>`<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<title>JavaScript Canvas Animation</title>\n<style>\nbody { margin: 0; overflow: hidden; background: #000; }\ncanvas { width: 100vw; height: 100vh; display: block; }\n</style>\n</head>\n<body>\n<canvas id="canvas"></canvas>\n<script>\n(function(){\n    const canvas = document.getElementById('canvas');\n    const ctx = canvas.getContext('2d');\n    const startTime = Date.now();\n    const mouse = { x: 0, y: 0, clickX: 0, clickY: 0, isPressed: false, lastClickTime: 0 };\n    const audio = { bass: 0, mid: 0, treble: 0, volume: 0 };\n    const resize = () => {\n        if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {\n            canvas.width = canvas.clientWidth;\n            canvas.height = canvas.clientHeight;\n        }\n    };\n    const getPos = e => {\n        const rect = canvas.getBoundingClientRect();\n        return { x: e.clientX - rect.left, y: e.clientY - rect.top };\n    };\n    canvas.addEventListener('mousemove', e => Object.assign(mouse, getPos(e)));\n    canvas.addEventListener('mousedown', e => Object.assign(mouse, getPos(e), { isPressed: true, clickX: mouse.x, clickY: mouse.y, lastClickTime: Date.now() }));\n    canvas.addEventListener('mouseup', () => mouse.isPressed = false);\n    canvas.addEventListener('mouseleave', () => mouse.isPressed = false);\n    window.addEventListener('resize', resize);\n    resize();\n    const userAnimation = \`${n(e)}\`;\n    function render() {\n        const time = (Date.now() - startTime) / 1000;\n        try {\n            new Function('ctx', 'width', 'height', 'time', 'mouse', 'audio', userAnimation)(ctx, canvas.width, canvas.height, time, mouse, audio);\n        } catch (error) {\n            ctx.fillStyle = '#f00';\n            ctx.font = '14px monospace';\n            ctx.fillText('Error: ' + error.message, 10, 30);\n            console.error('Animation error:', error);\n        }\n        requestAnimationFrame(render);\n    }\n    render();\n})();\n<\/script>\n</body>\n</html>`,webgl:(e,t)=>`<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<title>WebGL Shader Animation</title>\n<style>\nbody { margin: 0; overflow: hidden; }\ncanvas { width: 100vw; height: 100vh; display: block; }\n</style>\n</head>\n<body>\n<canvas id="glcanvas"></canvas>\n<script>\n(function(){\n    const canvas = document.getElementById('glcanvas');\n    const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');\n    if (!gl) { alert('WebGL not supported'); return; }\n    const compileShader = (src, type) => {\n        const s = gl.createShader(type);\n        gl.shaderSource(s, src);\n        gl.compileShader(s);\n        if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {\n            console.error('Shader error:', gl.getShaderInfoLog(s));\n            return null;\n        }\n        return s;\n    };\n    const vs = compileShader(\`${n(e)}\`, gl.VERTEX_SHADER);\n    const fs = compileShader(\`${n(t)}\`, gl.FRAGMENT_SHADER);\n    if (!vs || !fs) return;\n    const program = gl.createProgram();\n    gl.attachShader(program, vs);\n    gl.attachShader(program, fs);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n        console.error('Link error:', gl.getProgramInfoLog(program));\n        return;\n    }\n    const buf = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buf);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]), gl.STATIC_DRAW);\n    const attribName = (\`${n(e)}\`.match(/(attribute|in)\\s+(?:vec\\d+|float|int)\\s+(\\w+)/)?.[2]) || 'a_position';\n    const attribLoc = gl.getAttribLocation(program, attribName);\n    if (attribLoc !== -1) {\n        gl.enableVertexAttribArray(attribLoc);\n        gl.vertexAttribPointer(attribLoc, 2, gl.FLOAT, false, 0, 0);\n    } else {\n        const fallback = ['a_position', 'position', 'a_vertex', 'vertex'].find(n => gl.getAttribLocation(program, n) !== -1);\n        if (fallback) {\n            const loc = gl.getAttribLocation(program, fallback);\n            gl.enableVertexAttribArray(loc);\n            gl.vertexAttribPointer(loc, 2, gl.FLOAT, false, 0, 0);\n        } else return;\n    }\n    const uniforms = {};\n    for (let i = 0; i < gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS); i++) {\n        const info = gl.getActiveUniform(program, i);\n        uniforms[info.name] = gl.getUniformLocation(program, info.name);\n    }\n    const startTime = performance.now();\n    const mouse = { x: 0, y: 0, clickX: 0, clickY: 0, lastClickTime: 0, isPressed: false };\n    const resize = () => {\n        if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {\n            canvas.width = canvas.clientWidth;\n            canvas.height = canvas.clientHeight;\n            gl.viewport(0, 0, canvas.width, canvas.height);\n        }\n    };\n    canvas.addEventListener('mousemove', e => {\n        const rect = canvas.getBoundingClientRect();\n        mouse.x = e.clientX - rect.left;\n        mouse.y = rect.height - (e.clientY - rect.top);\n    });\n    canvas.addEventListener('mousedown', e => {\n        const rect = canvas.getBoundingClientRect();\n        mouse.clickX = e.clientX - rect.left;\n        mouse.clickY = rect.height - (e.clientY - rect.top);\n        mouse.lastClickTime = performance.now() * 0.001;\n        mouse.isPressed = true;\n    });\n    canvas.addEventListener('mouseup', () => mouse.isPressed = false);\n    canvas.addEventListener('mouseleave', () => mouse.isPressed = false);\n    const setUniform = (names, fn, ...args) => {\n        const name = names.find(n => uniforms[n]);\n        if (name) fn(uniforms[name], ...args);\n    };\n    function render() {\n        resize();\n        gl.useProgram(program);\n        const time = (performance.now() - startTime) * 0.001;\n        setUniform(['time', 'u_time', 'uTime', 'iTime'], gl.uniform1f.bind(gl), time);\n        setUniform(['resolution', 'u_resolution', 'uResolution', 'iResolution'], gl.uniform2f.bind(gl), canvas.width, canvas.height);\n        setUniform(['uColor', 'u_color', 'color'], gl.uniform3f.bind(gl), 1, 1, 1);\n        setUniform(['mouse', 'u_mouse', 'uMouse', 'iMouse'], gl.uniform2f.bind(gl), mouse.x / canvas.width, mouse.y / canvas.height);\n        setUniform(['u_mouse_pixel', 'uMousePixel'], gl.uniform2f.bind(gl), mouse.x, mouse.y);\n        setUniform(['u_mouse_click', 'uMouseClick'], gl.uniform2f.bind(gl), mouse.clickX / canvas.width, mouse.clickY / canvas.height);\n        setUniform(['u_mouse_click_pixel', 'uMouseClickPixel'], gl.uniform2f.bind(gl), mouse.clickX, mouse.clickY);\n        setUniform(['u_mouseDown', 'uMouseDown'], gl.uniform1i.bind(gl), mouse.isPressed ? 1 : 0);\n        setUniform(['u_mouseTime', 'uMouseTime'], gl.uniform1f.bind(gl), (performance.now() - mouse.lastClickTime) * 0.001);\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n        requestAnimationFrame(render);\n    }\n    render();\n})();\n<\/script>\n</body>\n</html>`,webgpu:(e,t)=>`<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<title>WebGPU Shader Animation</title>\n<style>\nbody { margin: 0; overflow: hidden; background: #000; }\ncanvas { width: 100vw; height: 100vh; display: block; }\n#error { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-family: Arial; text-align: center; display: none; }\n</style>\n</head>\n<body>\n<canvas id="webgpu-canvas"></canvas>\n<div id="error"><h2>WebGPU Not Supported</h2><p>Please use a modern browser with WebGPU enabled.</p></div>\n<script>\n(async function(){\n    const canvas = document.getElementById('webgpu-canvas');\n    const errorDiv = document.getElementById('error');\n    if (!navigator.gpu) { errorDiv.style.display = 'block'; return; }\n    const mouse = { x: 0, y: 0, clickX: 0, clickY: 0, isPressed: false };\n    let startTime = performance.now(), frameCount = 0, lastFrameTime = 0, deltaTime = 0, fps = 60;\n    try {\n        const adapter = await navigator.gpu.requestAdapter({ powerPreference: 'high-performance' });\n        if (!adapter) throw new Error('No WebGPU adapter');\n        const device = await adapter.requestDevice();\n        const context = canvas.getContext('webgpu');\n        if (!context) throw new Error('No WebGPU context');\n        const format = navigator.gpu.getPreferredCanvasFormat();\n        context.configure({ device, format, alphaMode: 'premultiplied' });\n        const uniformBuffer = device.createBuffer({ size: 80, usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST });\n        const vertexBuffer = device.createBuffer({ size: 48, usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST });\n        device.queue.writeBuffer(vertexBuffer, 0, new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]));\n        const bindGroupLayout = device.createBindGroupLayout({\n            entries: [{ binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } }]\n        });\n        const pipeline = device.createRenderPipeline({\n            layout: device.createPipelineLayout({ bindGroupLayouts: [bindGroupLayout] }),\n            vertex: {\n                module: device.createShaderModule({ code: \`${n(e)}\` }),\n                entryPoint: 'vs_main',\n                buffers: [{ arrayStride: 8, attributes: [{ format: 'float32x2', offset: 0, shaderLocation: 0 }] }]\n            },\n            fragment: {\n                module: device.createShaderModule({ code: \`${n(t)}\` }),\n                entryPoint: 'fs_main',\n                targets: [{ format }]\n            },\n            primitive: { topology: 'triangle-list' }\n        });\n        const bindGroup = device.createBindGroup({\n            layout: bindGroupLayout,\n            entries: [{ binding: 0, resource: { buffer: uniformBuffer } }]\n        });\n        const getPos = (e, isTouch) => {\n            const rect = canvas.getBoundingClientRect();\n            const pt = isTouch ? (e.touches[0] || e.changedTouches[0]) : e;\n            return { x: pt.clientX - rect.left, y: rect.height - (pt.clientY - rect.top) };\n        };\n        const updateMouse = (e, isTouch, type) => {\n            const pos = getPos(e, isTouch);\n            if (type === 'move') Object.assign(mouse, pos);\n            else if (type === 'down') Object.assign(mouse, { isPressed: true, clickX: pos.x, clickY: pos.y });\n            else if (type === 'up') mouse.isPressed = false;\n            if (isTouch) e.preventDefault();\n        };\n        canvas.addEventListener('mousemove', e => updateMouse(e, false, 'move'));\n        canvas.addEventListener('mousedown', e => updateMouse(e, false, 'down'));\n        canvas.addEventListener('mouseup', e => updateMouse(e, false, 'up'));\n        canvas.addEventListener('mouseleave', () => mouse.isPressed = false);\n        canvas.addEventListener('touchmove', e => updateMouse(e, true, 'move'), { passive: false });\n        canvas.addEventListener('touchstart', e => updateMouse(e, true, 'down'), { passive: false });\n        canvas.addEventListener('touchend', e => updateMouse(e, true, 'up'), { passive: false });\n        const resize = () => {\n            if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {\n                canvas.width = canvas.clientWidth;\n                canvas.height = canvas.clientHeight;\n            }\n        };\n        window.addEventListener('resize', resize);\n        resize();\n        function render() {\n            const currentTime = performance.now();\n            deltaTime = (currentTime - lastFrameTime) / 1000;\n            lastFrameTime = currentTime;\n            if (++frameCount % 10 === 0) fps = fps * 0.9 + (1 / deltaTime) * 0.1;\n            const time = (currentTime - startTime) * 0.001;\n            const uniformData = new Float32Array([\n                canvas.width, canvas.height, time, deltaTime,\n                mouse.x, mouse.y, mouse.clickX || 0, mouse.clickY || 0,\n                mouse.isPressed ? 1 : 0, frameCount, fps, canvas.width / canvas.height,\n                1 / canvas.width, 1 / canvas.height, 0, 0, 0, 0, 0, 0\n            ]);\n            device.queue.writeBuffer(uniformBuffer, 0, uniformData);\n            const encoder = device.createCommandEncoder();\n            const pass = encoder.beginRenderPass({\n                colorAttachments: [{\n                    view: context.getCurrentTexture().createView(),\n                    clearValue: { r: 0, g: 0, b: 0, a: 1 },\n                    loadOp: 'clear',\n                    storeOp: 'store'\n                }]\n            });\n            pass.setPipeline(pipeline);\n            pass.setBindGroup(0, bindGroup);\n            pass.setVertexBuffer(0, vertexBuffer);\n            pass.draw(6);\n            pass.end();\n            device.queue.submit([encoder.finish()]);\n            requestAnimationFrame(render);\n        }\n        render();\n    } catch (error) {\n        console.error('WebGPU error:', error);\n        errorDiv.style.display = 'block';\n        errorDiv.innerHTML = \`<h2>WebGPU Error</h2><p>\${error.message}</p>\`;\n    }\n})();\n<\/script>\n</body>\n</html>`};function r(){const e=window.$||(e=>document.getElementById(e)),n=e("vertCode"),i=e("fragCode"),o=window.jsCanvasState?.isJSMode(),a=window.webgpuState?.isWebGPUMode(),r=n?.value||"",l=i?.value||"";r.trim()||l.trim()?o?t(s.js(r),"js-canvas-animation.html","text/html"):a?t(s.webgpu(r,l),"webgpu-shader.html","text/html"):t(s.webgl(r,l),"webgl-shader.html","text/html"):alert("No code to export!")}var l=!1;function c(){if(l)return;const e=window.$||(e=>document.getElementById(e)),t=e("vertPanel"),n=e("fragPanel"),s=e("preview-panel"),c=e("vertCode"),d=e("fragCode"),u=e("vertFile"),m=e("fragFile"),h=e("vertFileBtn"),p=e("fragFileBtn"),g=e("vertFileName"),v=e("fragFileName");if(!(t&&n&&s&&c&&d))return;l=!0,h&&u&&g&&o(h,u,c,g),p&&m&&v&&o(p,m,d,v),[c,d].forEach((e=>{["dragover","dragenter"].forEach((t=>e.addEventListener(t,(e=>e.preventDefault())))),e.addEventListener("drop",(t=>{t.preventDefault(),t.dataTransfer.files[0]&&i(t.dataTransfer.files[0],e,e===c?g:v)}))}));const f=(e,t,n)=>{if(!e)return;const i=e.querySelector(".panel-header");if(!i)return;if(i.querySelector("button[data-export-btn]"))return;const o=document.createElement("button");o.textContent="Export",o.title=t,o.onclick=n,o.setAttribute("data-export-btn","true"),i.appendChild(o)};f(t,"Export Vertex Shader",(()=>{const e=window.jsCanvasState?.isJSMode(),t=window.webgpuState?.isWebGPUMode();a(e?"js":t?"wgsl":"vert",c.value)})),f(n,"Export Fragment Shader",(()=>{const e=window.webgpuState?.isWebGPUMode();a(e?"wgsl":"frag",d.value)}));const w=Object.assign(document.createElement("button"),{textContent:"Export",title:"Export Full HTML",onclick:r});w.style.position="absolute",w.classList.add("expbtn"),s.appendChild(w)}window.addExportButtons=c,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):setTimeout(c,0),(()=>{function e(){if(window.jsCanvasState&&window.jsCanvasState.isJSMode())return window.jsCanvasState.getCanvas();const e=document.getElementById("canvas3D");return e&&"none"!==e.style.display?e:window.webgpuState&&window.webgpuState.isWebGPUMode()?window.webgpuState.getCanvas():document.getElementById("glcanvas")}const t=e(),n=document.getElementById("preview-panel");if(!t||!n)return;let i=null;window.webgpuState&&window.webgpuState.isWebGPUMode()||(i=t.getContext("webgl",{preserveDrawingBuffer:!0})||t.getContext("experimental-webgl",{preserveDrawingBuffer:!0}));const o=document.createElement("div");o.id="recordingIndicator",o.textContent="● RECORDING",n.appendChild(o);const a=document.createElement("button");a.id="recBtn",a.title="Record Settings",a.innerHTML='<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45"/></svg>',n.appendChild(a);const s=document.createElement("div");s.id="videoPreview",s.innerHTML='\n    <video id="previewVideo" controls></video>\n    <div class="controls">\n      <button class="download-btn" id="downloadFromPreview">Download</button>\n      <button class="delete-btn" id="deleteVideo">Delete</button>\n    </div>\n    <div class="info" id="videoInfo"></div>\n  ';const r=navigator.userAgent,l=/^((?!chrome|android).)*safari/i.test(r),c=/iPad|iPhone|iPod/.test(r)&&!window.MSStream,d=/firefox/i.test(r),u=document.createElement("div");u.id="recSettings",u.innerHTML=`\n    <label>Width: <input type="number" id="recWidth" value="1920" min="100"/></label>\n    <label>Height: <input type="number" id="recHeight" value="1080" min="100"/></label>\n    <label>FPS: \n      <select id="recFPS">\n        <option value="30">30</option>\n        <option value="60" selected>60</option>\n        <option value="120">120</option>\n      </select>\n    </label>\n    <label>Quality:\n      <input type="range" id="recQuality" min="1000" max="50000" step="1000" value="20000"/>\n      <span id="recQualityVal">20000</span> kbps\n    </label>\n    <label>Codec: \n      <select id="recCodec">\n        ${d?'\n          <option value="h264" disabled>H.264 (Not supported in Firefox)</option>\n          <option value="vp9" disabled>VP9 (Not supported in Firefox)</option>\n          <option value="vp8" selected>VP8 (WebM)</option>\n        ':l||c?'\n          <option value="h264" selected>H.264 (MP4)</option>\n          <option value="vp9" disabled>VP9 (Not supported in Safari)</option>\n          <option value="vp8" disabled>VP8 (Not supported in Safari)</option>\n        ':'\n          <option value="h264" selected>H.264 (MP4)</option>\n          <option value="vp9">VP9 (WebM)</option>\n          <option value="vp8">VP8 (WebM)</option>\n        '}\n      </select>\n    </label>\n    <label style="display: flex; align-items: center;">\n      Include Audio\n      <div class="checkbox-container">\n        <input type="checkbox" id="includeAudio" checked/>\n        <div class="custom-checkbox"></div>\n      </div>\n    </label>\n    <div id="statusBlock" class="status-block">\n      <div id="canvasMode" class="canvas-mode">Canvas: WebGL</div>\n      <div id="audioStatus" class="audio-status">Audio: Not detected</div>\n    </div>\n    <button id="recRotate" title="Rotate dimensions">⟲ Rotate</button>\n    <div id="recPresets">\n      <button class="preset active" data-w="1920" data-h="1080">1080p</button>\n      <button class="preset" data-w="2560" data-h="1440">1440p</button>\n      <button class="preset" data-w="3840" data-h="2160">4K</button>\n      <button class="preset" data-w="1280" data-h="720">720p</button>\n    </div>\n    <button class="start" id="startRec">Start Recording</button>\n    <button class="stop" id="stopRec" disabled>Stop</button>\n    <a id="downloadLink" style="border:0px;border-radius:6px;background:var(--m);display:none;text-decoration:none; color:var(--1);">Download</a>\n    <div id="recStats" style="margin-top: 8px; display: none;"></div>\n  `,n.appendChild(u),u.appendChild(s),document.addEventListener("keydown",(e=>{if("Escape"===e.key){const e=document.getElementById("recSettings");e&&(e.style.display="none")}}));const m=u.querySelector("#recWidth"),h=u.querySelector("#recHeight"),p=u.querySelector("#recFPS"),g=u.querySelector("#recQuality"),v=u.querySelector("#recQualityVal"),f=u.querySelector("#recCodec"),w=u.querySelector("#recRotate"),y=u.querySelector("#includeAudio"),b=u.querySelector("#audioStatus"),E=u.querySelector("#canvasMode"),C=u.querySelectorAll(".preset"),x=u.querySelector("#startRec"),S=u.querySelector("#stopRec"),L=u.querySelector("#downloadLink"),k=u.querySelector("#recStats"),T=s.querySelector("#previewVideo"),A=s.querySelector("#downloadFromPreview"),I=s.querySelector("#deleteVideo"),B=s.querySelector("#videoInfo");let P,M,R,F,D,_=[],N=!1,$=null,U=null,O=null;function q(){if(N){if(window.AudioReactive&&window.audioReactiveInstance){const e=window.audioReactiveInstance;e.isActive?e.fileActive?b.textContent="Audio: File audio active":e.micStream?b.textContent="Audio: Microphone active":b.textContent="Audio: Active but no source":b.textContent="Audio: Inactive"}else b.textContent="Audio: AudioReactive not found";window.jsCanvasState&&window.jsCanvasState.isJSMode()?E.textContent="Canvas: JavaScript 2D":window.webgpuState&&window.webgpuState.isWebGPUMode()?E.textContent="Canvas: WebGPU":E.textContent="Canvas: WebGL"}}function H(){x.disabled=!(+m.value>0&&+h.value>0)}setInterval(q,1e3),g.addEventListener("input",(()=>{v.textContent=g.value})),w.addEventListener("click",(()=>{[m.value,h.value]=[h.value,m.value],H()})),C.forEach((e=>{e.addEventListener("click",(()=>{C.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),m.value=e.dataset.w,h.value=e.dataset.h,H()}))})),[m,h].forEach((e=>{e.addEventListener("input",H)})),H(),a.addEventListener("click",(()=>{N=!N,u.style.display=N?"block":"none",N&&q()})),A.addEventListener("click",(()=>{if($&&O){const e=document.createElement("a");e.href=U,e.download=`recording_${O.width}x${O.height}_${O.codec}.${O.extension}`,e.click()}})),I.addEventListener("click",(()=>{U&&URL.revokeObjectURL(U),$=null,U=null,O=null,s.style.display="none",T.src="",L.style.display="none",k.style.display="none"}));const j=(e,t)=>{const n={vp8:["video/webm; codecs=vp8","video/webm;codecs=vp8",'video/webm; codecs="vp8"','video/webm;codecs="vp8"'],vp9:["video/webm; codecs=vp9","video/webm;codecs=vp9",'video/webm; codecs="vp9"','video/webm;codecs="vp9"'],h264:["video/mp4; codecs=avc1.42E01E","video/mp4;codecs=avc1.42E01E",'video/mp4; codecs="avc1.42E01E"','video/mp4;codecs="avc1.42E01E"',"video/webm; codecs=h264","video/webm;codecs=h264","video/mp4"]},i=navigator.userAgent,o=/iPad|iPhone|iPod/.test(i)&&!window.MSStream,a=/^((?!chrome|android).)*safari/i.test(i),s=o&&a&&{h264:['video/mp4; codecs="avc1.42E01E"',"video/mp4; codecs=avc1.42E01E","video/mp4"]}[e]||n[e];if(!s)return null;if(o&&a&&t){for(const e of s)if(MediaRecorder.isTypeSupported(e))return e;const e=["mp4a.40.2","aac"];for(const t of e)for(const e of s)if(e.includes("codecs=")){const n=e.replace(/codecs="?([^"]+)"?/,`codecs="$1,${t}"`);if(MediaRecorder.isTypeSupported(n))return n}return null}return(t?[",opus",", opus"]:[""]).flatMap((e=>s.map((t=>t.endsWith('"')?t.replace(/"$/,`${e}"`):t+e)))).find((e=>MediaRecorder.isTypeSupported(e)))||null};x.addEventListener("click",(()=>{L.style.display=k.style.display="none",k.textContent="";const t=+m.value,n=+h.value,i=+p.value,a=e();if(!a)return void alert("Canvas not found. Make sure the visualization is running.");M=Object.assign(document.createElement("canvas"),{width:t,height:n}),R=M.getContext("2d",{alpha:!1});const r=M.captureStream(i);let l=y.checked&&function(){if(window.AudioReactive&&window.audioReactiveInstance){const e=window.audioReactiveInstance;if(e.isActive&&e.audioContext)try{const t=e.audioContext.createMediaStreamDestination();if(e.fileActive&&e.fileSource)return e.fileSource.connect(t),b.textContent="Audio: File audio detected",t.stream;if(e.micStream&&e.analyser)return e.audioContext.createMediaStreamSource(e.micStream).connect(t),b.textContent="Audio: Microphone detected",t.stream}catch(e){b.textContent="Audio: Error capturing audio"}}return b.textContent="Audio: Not detected",null}();const c=navigator.userAgent,d=/iPad|iPhone|iPod/.test(c)&&!window.MSStream,u=/^((?!chrome|android).)*safari/i.test(c);l&&!l.getAudioTracks().length&&(l=null),d&&u&&y.checked&&!l&&(b.textContent="Audio: Not available on iOS");const v=l?new MediaStream([...r.getVideoTracks(),...l.getAudioTracks()]):r,w=1e3*g.value,E=f.value;let C=j(E,!!l);if(!C&&d&&u&&(C=j("h264",!1),C&&(f.value="h264",l&&(v.getAudioTracks().forEach((e=>{v.removeTrack(e),e.stop()})),l=null))),C||(C=["h264","vp9","vp8"].reduce(((e,t)=>e||j(t,!!l)&&(f.value=t,j(t,!!l))),null)),!C&&(l&&(v.getAudioTracks().forEach((e=>{v.removeTrack(e),e.stop()})),C=j(E,!1)||j("h264",!1),C&&alert("Audio recording not supported on this device. Recording video only.")),!C))return alert("No supported codecs found for video recording on this device.");if(C&&C!==j(E,!!l)){const e=v.getAudioTracks().length>0;alert(`Using ${f.value} codec${e?" with audio":" (video only)"}.`)}!function(e,t,n,i,a,r,l){const c={mimeType:t,videoBitsPerSecond:n};e.getAudioTracks().length>0&&(c.audioBitsPerSecond=128e3);try{P=new MediaRecorder(e,c)}catch(e){return void alert(`Recording failed: ${e.message}. Try a different codec or lower quality.`)}function d(){const t=((Date.now()-D)/1e3).toFixed(1),n=e.getAudioTracks().length>0,i=window.webgpuState&&window.webgpuState.isWebGPUMode()?"GPU":"GL";o.textContent=`● RECORDING ${t}s ${n?"♪":""} ${i}`}function u(){R.imageSmoothingEnabled=!0,R.imageSmoothingQuality="high",R.clearRect(0,0,i,a),R.drawImage(l,0,0,i,a),F=requestAnimationFrame(u)}_=[],D=Date.now(),P.ondataavailable=e=>{e.data&&e.data.size>0&&(_.push(e.data),d())},P.onstop=()=>{const t="h264"===r?"mp4":"webm",n=new Blob(_,{type:"h264"===r?"video/mp4":"video/webm"}),l=(n.size/1048576).toFixed(2),c=((Date.now()-D)/1e3).toFixed(1),d=e.getAudioTracks().length>0,u=window.jsCanvasState&&window.jsCanvasState.isJSMode()?"JavaScript":window.webgpuState&&window.webgpuState.isWebGPUMode()?"WebGPU":"WebGL";U&&URL.revokeObjectURL(U),$=n,U=URL.createObjectURL(n),O={width:i,height:a,codec:r,extension:t,size:l,duration:c,bitrate:g.value,hasAudio:d,canvasType:u},T.src=U,B.innerHTML=`\n        <div><strong>File:</strong> ${l} MB • ${c}s • ${i}×${a}</div>\n        <div><strong>Settings:</strong> ${r} • ${g.value} kbps • ${u}</div>\n        <div><strong>Audio:</strong> ${d?"Included":"Video only"}</div>\n      `,s.style.display="block",L.style.display="none",k.style.display="none",o.style.display="none",x.disabled=!1,cancelAnimationFrame(F)},u(),P.start(1e3),o.style.display="block",x.disabled=!0,S.disabled=!1;const m=setInterval((()=>{P&&"recording"===P.state?P.requestData():clearInterval(m)}),2e3)}(v,C,w,t,n,f.value,a)})),S.addEventListener("click",(()=>{P&&"recording"===P.state&&(P.stop(),S.disabled=!0)}))})(),function(){function e(e,t={},n=document.body){const i=document.createElement(e);return Object.entries(t).forEach((([e,t])=>i[e]=t)),n.appendChild(i),i}document.addEventListener("fullscreenchange",(()=>{const e=document.fullscreenElement;e&&!e.contains(t)?(e.appendChild(t),e.appendChild(n),e.appendChild(i)):e||(document.body.appendChild(t),document.body.appendChild(n),document.body.appendChild(i))}));const t=e("button",{id:"uploadHTMLBtn",textContent:"Upload",title:"Upload HTML, JS, WGSL, or shader file"}),n=e("input",{id:"uploadHTMLInput",type:"file",accept:".html,.js,.frag,.vert,.vs,.fs,.wgsl,.txt"}),i=e("button",{id:"editFileToggle",textContent:"Edit File",title:"Enable direct file editing with File System Access API"});i.style.display="none";let o=null,a=!1;const s=document.getElementById("vertCode"),r=document.getElementById("fragCode"),l=document.getElementById("vertFileName"),c=document.getElementById("fragFileName"),d="showOpenFilePicker"in window;let u;const m=()=>{d&&(clearTimeout(u),i.style.display="block")},h=()=>{u=setTimeout((()=>{a||(i.style.display="none")}),300)};function p(e){window.switchToAnimationType&&window.switchToAnimationType(e)}function g(){"function"==typeof rebuildProgram&&rebuildProgram(),"function"==typeof render&&render()}function v(e){return e.includes("@vertex")||e.includes("@fragment")||e.includes("vec4<f32>")||e.includes("var<uniform>")?"webgpu":!(e.includes("ctx.")||e.includes("fillRect")||e.includes("beginPath"))||e.includes("gl_")||e.includes("attribute")||e.includes("varying")?"webgl":"js"}function f(e){return e.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\r/g,"\r").replace(/\\"/g,'"').replace(/\\'/g,"'")}function w(e,t){p("webgpu"),setTimeout((()=>{e.includes("@vertex")&&(s.value=e.trim(),l.textContent=`(${t})`),e.includes("@fragment")&&(r.value=e.trim(),c.textContent=`(${t})`),g()}),150)}function y(e,t){p(v(e)),setTimeout((()=>{s.value=e.trim(),l.textContent=`(${t})`,g()}),150)}function b(e,t){p(v(e)),setTimeout((()=>{r.value=e.trim(),c.textContent=`(${t})`,g()}),150)}function E(e,t){const n=new RegExp(`(?:const|let|var)\\s+${t}\\s*=\\s*`,"g").exec(e);if(!n)return null;let i=n.index+n[0].length;const o=e[i];if("`"===o){let t=1,n=i+1;for(;n<e.length;n++){const o=e[n],a=e[n+1];if("\\"!==o||"`"!==a){if("`"===o&&1===t)return e.substring(i+1,n);"$"!==o||"{"!==a?"}"===o&&t>1&&t--:(t++,n++)}else n++}return null}if('"'===o||"'"===o){const t=e.indexOf(o,i+1);return-1!==t?e.substring(i+1,t):null}return null}function C(e,t){const n=(new DOMParser).parseFromString(e,"text/html"),i=n.querySelectorAll("script");for(let e of i){const n=e.textContent,i=E(n,"userAnimation");if(i)return void L(i,t);if(n.includes("createShaderModule")){const e=n.match(/vertex:\s*{\s*module:\s*device\.createShaderModule\(\s*{\s*code:\s*`([\s\S]*?)`\s*}\)/),i=n.match(/fragment:\s*{\s*module:\s*device\.createShaderModule\(\s*{\s*code:\s*`([\s\S]*?)`\s*}\)/);if(e&&i)return void S(e[1],i[1],t,"webgpu")}if(n.includes("compileShader")){const e=n.match(/const\s+vs\s*=\s*compileShader\(`([\s\S]*?)`\s*,\s*gl\.VERTEX_SHADER\)/),i=n.match(/const\s+fs\s*=\s*compileShader\(`([\s\S]*?)`\s*,\s*gl\.FRAGMENT_SHADER\)/);if(e&&i)return void S(e[1],i[1],t,"webgl")}const o=E(n,"vs")||E(n,"vertexShaderSource")||E(n,"vertexShader")||E(n,"vsSource"),a=E(n,"fs")||E(n,"fragmentShaderSource")||E(n,"fragmentShader")||E(n,"fsSource");if(o&&a){return void S(o,a,t,v(o+a))}}const o=n.querySelector('script[type="x-shader/x-vertex"]'),a=n.querySelector('script[type="x-shader/x-fragment"]');o&&a&&S(o.textContent,a.textContent,t,"webgl")}function x(e,t){const n=E(e,"userAnimation");if(n)return void L(n,t);if(e.includes("createShaderModule")){const n=e.match(/createShaderModule\(\s*{\s*code:\s*`([\s\S]*?@vertex[\s\S]*?)`\s*}\)/),i=e.match(/createShaderModule\(\s*{\s*code:\s*`([\s\S]*?@fragment[\s\S]*?)`\s*}\)/);if(n&&i)return void S(n[1],i[1],t,"webgpu")}const i=E(e,"vs")||E(e,"vertexShaderSource")||E(e,"vertexShader")||E(e,"vsSource"),o=E(e,"fs")||E(e,"fragmentShaderSource")||E(e,"fragmentShader")||E(e,"fsSource");if(i&&o){S(i,o,t,v(i+o))}else;}function S(e,t,n,i){p(i),setTimeout((()=>{s.value=f(e.trim()),r.value=f(t.trim()),l.textContent=c.textContent=`(${n})`,g()}),150)}function L(e,t){p("js"),setTimeout((()=>{s.value=f(e.trim()),l.textContent=`(${t})`}),150)}t.addEventListener("mouseenter",m),t.addEventListener("mouseleave",h),t.addEventListener("touchstart",m,{passive:!0}),t.addEventListener("touchend",(()=>setTimeout(h,2e3))),i.addEventListener("mouseenter",(()=>clearTimeout(u))),i.addEventListener("mouseleave",h),i.addEventListener("click",(async()=>{if(a){if(o)try{const e=await o.createWritable(),t=s.value+"\n\n"+r.value;await e.write(t),await e.close()}catch(e){}}else try{const[e]=await window.showOpenFilePicker({types:[{description:"Shader Files",accept:{"text/*":[".html",".js",".frag",".vert",".vs",".fs",".wgsl",".txt"]}}],multiple:!1});o=e;const n=await e.getFile(),s=await n.text(),r=n.name.split(".").pop().toLowerCase();"wgsl"===r?w(s,n.name):"frag"===r||"fs"===r?b(s,n.name):"vert"===r||"vs"===r?y(s,n.name):"html"===r?C(s,n.name):"js"===r&&x(s,n.name),a=!0,i.textContent="Save File",i.style.background="var(--5)",t.textContent="Close"}catch(e){e.name}})),t.addEventListener("click",(()=>{a?(a=!1,o=null,i.textContent="Edit File",i.style.background="",t.textContent="Upload",i.style.display="none"):(n.value="",n.click())})),n.addEventListener("change",(()=>{const e=n.files[0];if(!e)return;const t=new FileReader;t.onload=t=>{const n=t.target.result,i=e.name.split(".").pop().toLowerCase();"wgsl"===i?w(n,e.name):"frag"===i||"fs"===i?b(n,e.name):"vert"===i||"vs"===i?y(n,e.name):"html"===i?C(n,e.name):"js"===i&&x(n,e.name)},t.readAsText(e)}))}(),function(){const e=document.getElementById("authModal");window.addEventListener("beforeunload",(function(t){e&&"block"===e.style.display||(t.preventDefault(),t.returnValue="")}))}(),(()=>{let e=null,t=null,n=!1,i=!1,o="";const a=new Set,s={stack:[],index:-1,maxSize:50,push(e){this.stack=this.stack.slice(0,this.index+1),this.stack.push(e),this.stack.length>this.maxSize?this.stack.shift():this.index++},canUndo(){return this.index>=0},canRedo(){return this.index<this.stack.length-1},undo(){if(!this.canUndo())return null;const e=this.stack[this.index];return this.index--,e},redo(){if(!this.canRedo())return null;this.index++;return this.stack[this.index]}},r=(e,t="unknown")=>{if("INPUT"===e.tagName&&"file"===e.type)return;if(!e)return;let n,i,o;if(["INPUT","TEXTAREA"].includes(e.tagName))n=e.value,i=e.selectionStart,o=e.selectionEnd;else{if(!e.isContentEditable)return;{n=e.innerHTML;const t=window.getSelection();if(t.rangeCount>0){const e=t.getRangeAt(0);i=e.startOffset,o=e.endOffset}}}s.push({element:e,value:n,selectionStart:i,selectionEnd:o,operation:t,timestamp:Date.now()})},l=e=>{if(!e||!e.element)return;const{element:t,value:n,selectionStart:i,selectionEnd:o}=e;if("INPUT"!==t.tagName||"file"!==t.type){if(["INPUT","TEXTAREA"].includes(t.tagName)){if(t.value=n,"function"==typeof t.setSelectionRange&&Number.isInteger(i)&&Number.isInteger(o))try{t.setSelectionRange(i,o)}catch(e){}}else if(t.isContentEditable&&(t.innerHTML=n,Number.isInteger(i)&&Number.isInteger(o)))try{const e=document.createRange(),n=t.firstChild;if(n){const t=Math.min(i,n.textContent.length),a=Math.min(o,n.textContent.length);e.setStart(n,t),e.setEnd(n,a);const s=window.getSelection();s.removeAllRanges(),s.addRange(e)}}catch(e){t.focus()}t.focus(),window.rebuildProgram?.(),window.render?.()}else t.focus()},c=e=>{if("INPUT"===e.tagName&&"file"===e.type)return;if(a.has(e))return;a.add(e);let t=null,n=e.value||e.textContent||"";r(e,"initial");const i=()=>{clearTimeout(t),t=setTimeout((()=>{const t=e.value||e.textContent||"";t!==n&&(r(e,"manual-edit"),n=t)}),2e3)};e.addEventListener("input",i),e.addEventListener("paste",(()=>{setTimeout((()=>i()),10)})),e.addEventListener("keydown",(i=>{"Backspace"!==i.key&&"Delete"!==i.key||(t&&clearTimeout(t),r(e,"delete-operation"),n=e.value||e.textContent||"")}))};document.addEventListener("keydown",(e=>{if(!e.metaKey&&!e.ctrlKey||e.shiftKey||"z"!==e.key){if((e.metaKey||e.ctrlKey)&&e.shiftKey&&"z"===e.key||(e.metaKey||e.ctrlKey)&&"y"===e.key){e.preventDefault();const t=s.redo();t&&l(t)}}else{e.preventDefault();const t=s.undo();t&&l(t)}}));const d=(e,t={},n="")=>{const i=document.createElement(e);return Object.entries(t).forEach((([e,t])=>i.setAttribute(e,t))),n&&(i.innerHTML=n),i},u=d("div",{class:"custom-context-menu"});document.body.append(u);const m=e=>e.style.display="none";m(u);const h=()=>clearTimeout(e),p=(e,t,n=!1)=>{const i=d("div",{class:"custom-context-menu-item"+(n?" disabled":"")});i.textContent=e,n||i.addEventListener("click",(e=>{e.stopPropagation(),m(u),t()})),u.append(i)},g=e=>{const t=d("div",{class:"inline-control"});return t.innerHTML=e,u.append(t),t},v=(e,t)=>{if(!e)return null;let n,i;if(["INPUT","TEXTAREA"].includes(e.tagName))n=e.value,i=e.selectionStart;else{if(!e.isContentEditable)return null;{n=e.textContent;const t=window.getSelection();if(t.rangeCount){const n=t.getRangeAt(0).cloneRange();n.selectNodeContents(e),n.setEnd(t.getRangeAt(0).endContainer,t.getRangeAt(0).endOffset),i=n.toString().length}else i=0}}if(void 0!==t&&(i=t),void 0===i)return null;const o=n.slice(0,i).split("\n"),a=n.split("\n").length;return{currentLine:o.length,totalLines:a,column:o[o.length-1].length+1,cursorPos:i}};document.addEventListener("touchstart",(t=>{e=setTimeout((()=>{const e=t.touches[0],n=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY});t.target.dispatchEvent(n)}),600)}),{passive:!0}),["touchend","touchmove"].forEach((e=>document.addEventListener(e,h,{passive:!0}))),document.addEventListener("contextmenu",(e=>{if(e.preventDefault(),t=e.target,n=["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable,o=window.getSelection().toString(),i=!!o,u.innerHTML="",n){let n;if(["INPUT","TEXTAREA"].includes(t.tagName)){const i=function(e,t){if(!["INPUT","TEXTAREA"].includes(t.tagName))return null;try{if("TEXTAREA"===t.tagName){if(t.focus(),document.caretPositionFromPoint){const n=document.caretPositionFromPoint(e.clientX,e.clientY);if(n&&n.offsetNode===t.firstChild)return n.offset}if(document.caretRangeFromPoint){const n=document.caretRangeFromPoint(e.clientX,e.clientY);if(n&&n.startContainer===t.firstChild)return n.startOffset}}return t.selectionStart}catch{return t.selectionStart}}(e,t);n=null!=i?i:t.selectionStart}const i=v(t,n);if(i){const e=d("div",{class:"line-info"});e.textContent=`Line ${i.currentLine} of ${i.totalLines} (Col: ${i.column})`,u.append(e)}}if(i&&/^-?\d+(\.\d+)?$/.test(o)){const e=`slider-${Date.now()}`,n=`slider-label-${Date.now()}`,i=g(`\n        <label id="${n}" for="${e}">Adjust Value:</label>\n        <input type="range" id="${e}" name="value-slider" class="slider-input" aria-labelledby="${n}">\n        <div class="slider-value"></div>\n        <div class="inline-buttons">\n          <button class="btn-cancel slider-cancel">Cancel</button>\n          <button class="btn-confirm slider-confirm">Done</button>\n        </div>\n      `),a=parseFloat(o),s=i.querySelector(".slider-input"),l=i.querySelector(".slider-value"),c=2*Math.abs(a)||1;let h,p,f;if(s.min=(a-c).toString(),s.max=(a+c).toString(),s.step=(2*c/100).toString(),s.value=a,l.textContent=a.toFixed(3),["INPUT","TEXTAREA"].includes(t.tagName))h=t.value,p=t.selectionStart,f=t.selectionEnd;else{h=t.textContent;const e=v(t);p=e.cursorPos-o.length,f=e.cursorPos}let w=!1;const y=()=>{w||(r(t,"number-adjust"),w=!0);const e=s.value,n=parseFloat(e).toFixed(3);l.textContent=n;const i=h.slice(0,p),o=h.slice(f);if(["INPUT","TEXTAREA"].includes(t.tagName))t.value=i+n+o,t.setSelectionRange(p,p+n.length);else{t.textContent=i+n+o;const e=document.createRange(),a=t.firstChild;e.setStart(a,p+n.length),e.collapse(!0);const s=window.getSelection();s.removeAllRanges(),s.addRange(e)}window.rebuildProgram?.(),window.render?.()};s.addEventListener("input",y),i.querySelector(".slider-confirm").onclick=e=>{e.stopPropagation(),s.removeEventListener("input",y),m(u),t.focus(),window.rebuildProgram?.(),window.render?.()},i.querySelector(".slider-cancel").onclick=e=>{if(e.stopPropagation(),s.removeEventListener("input",y),m(u),["INPUT","TEXTAREA"].includes(t.tagName))t.value=h,t.setSelectionRange(p,f);else{t.textContent=h;const e=document.createRange(),n=t.firstChild;e.setStart(n,f),e.collapse(!0);const i=window.getSelection();i.removeAllRanges(),i.addRange(e)}t.focus()},u.append(d("div",{class:"custom-context-menu-separator"}))}if(i&&n){const e=`find-input-${Date.now()}`,i=`replace-input-${Date.now()}`,a=`find-label-${Date.now()}`,s=`replace-label-${Date.now()}`,l=g(`\n          <label id="${a}" for="${e}">Find Text:</label>\n          <input type="text" id="${e}" name="find-text" class="find-input" readonly value="${o.replace(/"/g,"&quot;")}" aria-labelledby="${a}">\n          <label id="${s}" for="${i}">Replace All:</label>\n          <input type="text" id="${i}" name="replace-text" class="replace-input" placeholder="Replace with..." aria-labelledby="${s}">\n          <div class="inline-buttons">\n            <button class="btn-cancel replace-cancel">Cancel</button>\n            <button class="btn-confirm replace-confirm">Replace</button>\n          </div>\n        `);p("Cut",(()=>{r(t,"cut"),document.execCommand("cut")})),p("Copy",(()=>document.execCommand("copy")));const c=l.querySelector(".replace-input");c.focus(),l.querySelector(".replace-confirm").onclick=e=>{e.stopPropagation(),((e,i)=>{if(n&&t){if(r(t,"replace-all"),["INPUT","TEXTAREA"].includes(t.tagName))t.value=t.value.split(e).join(i);else{const n=t.closest("[contenteditable]");n&&(n.innerHTML=n.innerHTML.split(e).join(i))}window.rebuildProgram?.(),window.render?.()}})(o,c.value),m(u)},l.querySelector(".replace-cancel").onclick=e=>{e.stopPropagation(),m(u)},u.append(d("div",{class:"custom-context-menu-separator"}))}n&&(p("Paste",(async()=>{r(t,"paste");let e="";try{e=await navigator.clipboard.readText()}catch{}if(["INPUT","TEXTAREA"].includes(t.tagName)){const{selectionStart:n,selectionEnd:i,value:o}=t;t.value=o.slice(0,n)+e+o.slice(i);const a=n+e.length;t.setSelectionRange(a,a),t.focus()}else{if(!document.execCommand("insertText",!1,e)){const t=window.getSelection();if(t.rangeCount){const n=t.getRangeAt(0);n.deleteContents(),n.insertNode(document.createTextNode(e)),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}}t.focus()}window.rebuildProgram?.(),window.render?.()})),p("Copy Text Field",(()=>{t.focus(),["INPUT","TEXTAREA"].includes(t.tagName)?t.select():document.execCommand("selectAll"),document.execCommand("copy")})),p("Delete All (Text Field)",(()=>{r(t,"delete-all"),t.focus(),["INPUT","TEXTAREA"].includes(t.tagName)?t.value="":t.textContent="",window.rebuildProgram?.(),window.render?.()}))),p("Copy All",(()=>{const e=document.createRange();e.selectNodeContents(document.body);const t=window.getSelection();t.removeAllRanges(),t.addRange(e),document.execCommand("copy"),t.removeAllRanges()})),u.append(d("div",{class:"custom-context-menu-separator"})),p("Undo",(()=>{const e=s.undo();e&&l(e)}),!s.canUndo()),p("Redo",(()=>{const e=s.redo();e&&l(e)}),!s.canRedo()),u.append(d("div",{class:"custom-context-menu-separator"})),p("Back",(()=>s.back())),p("Reload",(()=>location.reload())),u.style.visibility="hidden",u.style.display="block";const{width:a,height:c}=u.getBoundingClientRect();u.style.display="none",u.style.visibility="";let h=e.clientX,f=e.clientY;h+a>window.innerWidth&&(h=window.innerWidth-a-5),f+c>window.innerHeight&&(f=e.clientY-c,f<5&&(f=5)),u.style.left=`${h}px`,u.style.top=`${f}px`,u.style.display="block"})),document.addEventListener("click",(e=>{u.contains(e.target)||m(u)})),window.addEventListener("scroll",(()=>m(u))),document.addEventListener("keydown",(e=>{"Escape"===e.key&&m(u)})),setTimeout((()=>{(()=>{const e=document.querySelector("#vertCode"),t=document.querySelector("#fragCode");e&&c(e),t&&c(t),document.querySelectorAll("input:not([type=file]), textarea, [contenteditable]").forEach((e=>c(e)))})(),((e,t=document)=>Array.from(t.querySelectorAll(e)))("#vertCode, #fragCode").forEach((e=>{e.addEventListener("mousedown",(t=>2===t.button&&e.focus())),c(e)}))}),1e3);new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{1===e.nodeType&&(e.matches&&e.matches("input, textarea, [contenteditable]")&&c(e),e.querySelectorAll&&e.querySelectorAll("input, textarea, [contenteditable]").forEach((e=>{c(e)})))}))}))})).observe(document.body,{childList:!0,subtree:!0})})(),(()=>{const e=document.getElementById("preview-panel");if(!e)return;const t=document.createElement("button");t.className="instruction-btn",t.title="Instructions",t.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"\n         stroke="var(--6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n         viewBox="0 0 24 24" aria-hidden="true">\n      <circle cx="12" cy="12" r="10" />\n      <line x1="12" y1="16" x2="12" y2="12" />\n      <line x1="12" y1="8" x2="12" y2="8" />\n    </svg>\n  ',"static"===getComputedStyle(e).position&&(e.style.position="relative"),t.addEventListener("click",(function(){const t=document.createElement("div");t.className="instruction-overlay";const n=document.createElement("div");n.className="instruction-modal",n.innerHTML="\n      <h2>GLSL Editor – Guide</h2>\n      <ul>\n        <li><strong>Save/Browse:</strong> Save shaders locally, by share link or publicly (premium), and explore public gallery</li>\n        <li><strong>Editor:</strong> Write or edit <code>.vert</code> and <code>.frag</code> code with live updates</li>\n        <li><strong>GLSL Version:</strong> Use <code>#ifdef GL_ES ... #endif</code> for GLSL 2.0, or <code>#version 300 es</code> for GLSL ES 3.00</li>\n        <li><strong>WebGPU Support:</strong> <em>Experimental</em> — Use toggle to switch to WebGPU canvas</li>\n        <li><strong>Import/Export:</strong> Drag & drop or upload <code>.vert</code>, <code>.frag</code>, <code>.vs</code>, <code>.fs</code>, <code>.txt</code>, or <code>.html</code> files</li>\n        <li><strong>Audio Reactive:</strong> Use mic, system audio, or uploaded files for audio-reactive effects via bass, mid, treble and overall volume uniforms</li>\n        <li><strong>Record:</strong> Capture WebM/MP4 of canvas with included audio</li>\n        <li><strong>Performance:</strong> Monitor FPS, memory, draw calls</li>\n        <li><strong>Linting:</strong> Get instant console feedback for mistakes</li>\n        <li><strong>Customize:</strong> Resize or hide panels and theme the UI</li>\n        <li><strong>Color:</strong> Click a <code>vec3</code> color to open picker</li>\n        <li><strong>Format:</strong> Open code formatter to minify or format your code</li>\n        <li><strong>Visualize Code:</strong> Open flowchart window to visualize your code and export as PNG or JSON/TXT package</li>\n        <li><strong>Insert GLSL Snippets:</strong> Click in text area, then open snippet library to add code segments</li>\n        <li><strong>Support:</strong> Contact: <span>compositionsbymax@gmail.com</span></li>\n      </ul>\n    ";const i=document.createElement("button");i.className="shortcut-trigger-btn",i.innerHTML='\n      <svg viewBox="0 0 24 24" width="16" height="16" fill="none"\n           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <rect x="2" y="4" width="20" height="16" rx="2"/>\n        <path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h8M6 16h.01M10 16h.01M14 16h.01M18 16h.01"/>\n      </svg>\n    ',i.addEventListener("click",(()=>{window.KeyboardShortcuts?.open&&window.KeyboardShortcuts.open()}));const o=document.createElement("button");o.textContent="✕",o.setAttribute("aria-label","Close instructions"),o.className="instruction-close-btn",o.addEventListener("click",(()=>e.removeChild(t))),document.addEventListener("keydown",(n=>"Escape"===n.key&&e.contains(t)&&e.removeChild(t)),{once:!0}),n.appendChild(i),n.appendChild(o),t.appendChild(n),e.appendChild(t)})),e.appendChild(t)})();class d{constructor(){this.isInitialized=!1,this.currentTextarea=null,this.currentEditor=null,this.currentMatch=null,this.currentStartPos=0,this.currentEndPos=0,this.tabElement=null,this.originalValues={r:0,g:0,b:0},this.tabRemovalTimeout=null,this.clickOutsideHandler=null,this.init()}ColorRegex(){return/\(\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\s*\)/g}init(){this.isInitialized||(this.HTML(),this.bind(),this.attachToTextareas(),this.setupFullscreenHandler(),this.isInitialized=!0)}setupFullscreenHandler(){document.addEventListener("fullscreenchange",(()=>{const e=document.getElementById("glsl-color-picker-overlay"),t=this.tabElement;document.fullscreenElement?(e&&document.fullscreenElement.appendChild(e),t&&document.fullscreenElement.appendChild(t)):(e&&document.body.appendChild(e),t&&document.body.appendChild(t))}))}HTML(){if(document.getElementById("glsl-color-picker-overlay"))return;const e=document.createElement("div");e.className="glsl-color-picker-overlay",e.id="glsl-color-picker-overlay",e.innerHTML='\n            <div class="glsl-color-picker" id="glsl-color-picker">\n                <h3>Edit GLSL Color</h3>\n                <div class="glsl-color-preview" id="glsl-color-preview"></div>\n                <div class="glsl-color-inputs">\n                    <div class="glsl-input-group">\n                        <label for="glsl-red">Red</label>\n                        <input type="number" id="glsl-red" step="0.01" min="0" max="2">\n                    </div>\n                    <div class="glsl-input-group">\n                        <label for="glsl-green">Green</label>\n                        <input type="number" id="glsl-green" step="0.01" min="0" max="2">\n                    </div>\n                    <div class="glsl-input-group">\n                        <label for="glsl-blue">Blue</label>\n                        <input type="number" id="glsl-blue" step="0.01" min="0" max="2">\n                    </div>\n                </div>\n                <div class="glsl-color-sliders">\n                    <div class="glsl-slider-group">\n                        <label for="glsl-red-slider">R</label>\n                        <input type="range" id="glsl-red-slider" min="0" max="2" step="0.01">\n                        <span id="glsl-red-value">0.00</span>\n                    </div>\n                    <div class="glsl-slider-group">\n                        <label for="glsl-green-slider">G</label>\n                        <input type="range" id="glsl-green-slider" min="0" max="2" step="0.01">\n                        <span id="glsl-green-value">0.00</span>\n                    </div>\n                    <div class="glsl-slider-group">\n                        <label for="glsl-blue-slider">B</label>\n                        <input type="range" id="glsl-blue-slider" min="0" max="2" step="0.01">\n                        <span id="glsl-blue-value">0.00</span>\n                    </div>\n                </div>\n                <div class="glsl-color-buttons">\n                    <button class="glsl-btn glsl-btn-cancel" id="glsl-cancel">Cancel</button>\n                    <button class="glsl-btn glsl-btn-apply" id="glsl-apply">Apply</button>\n                </div>\n            </div>\n        ';(document.fullscreenElement||document.body).appendChild(e)}bind(){const e=document.getElementById("glsl-color-picker-overlay"),t=document.getElementById("glsl-red"),n=document.getElementById("glsl-green"),i=document.getElementById("glsl-blue"),o=document.getElementById("glsl-red-slider"),a=document.getElementById("glsl-green-slider"),s=document.getElementById("glsl-blue-slider"),r=document.getElementById("glsl-cancel"),l=document.getElementById("glsl-apply");e.addEventListener("click",(t=>{t.target===e&&this.cancelPicker()}));const c=(e=!1)=>{const r=parseFloat(t.value)||0,l=parseFloat(n.value)||0,c=parseFloat(i.value)||0;o.value=r,a.value=l,s.value=c,document.getElementById("glsl-red-value").textContent=r.toFixed(2),document.getElementById("glsl-green-value").textContent=l.toFixed(2),document.getElementById("glsl-blue-value").textContent=c.toFixed(2),this.updatePreview(r,l,c),e&&(this.updateEditors(r,l,c),this.highlightColor(this.currentTextarea,this.currentEditor,this.currentStartPos,this.currentEndPos))};[t,n,i].forEach((e=>{e.addEventListener("input",(()=>c(!1)))})),[o,a,s].forEach(((e,o)=>{e.addEventListener("input",(()=>{[t,n,i][o].value=e.value,c(!0)}))})),r.addEventListener("click",(()=>this.cancelPicker())),l.addEventListener("click",(()=>this.applyColor())),document.addEventListener("keydown",(e=>{"block"===document.getElementById("glsl-color-picker-overlay").style.display&&("Escape"===e.key?this.cancelPicker():"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&this.applyColor())}))}updateEditors(e,t,n){if(!this.currentTextarea)return;const i=`(${e.toFixed(1)}, ${t.toFixed(1)}, ${n.toFixed(1)})`,o=this.currentTextarea.value,a=o.substring(0,this.currentStartPos)+i+o.substring(this.currentEndPos);this.currentEndPos=this.currentStartPos+i.length,this.currentTextarea.value=a;const s=new Event("input",{bubbles:!0});this.currentTextarea.dispatchEvent(s)}attachToTextareas(){const e=()=>{document.querySelectorAll("textarea").forEach((e=>{e.dataset.glslColorPickerAttached||(this.attachToTextarea(e),e.dataset.glslColorPickerAttached="true")}));document.querySelectorAll('.glsl-editor[contenteditable="true"]').forEach((e=>{e.dataset.glslColorPickerAttached||(this.attachToEditor(e),e.dataset.glslColorPickerAttached="true")}))};e();new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0})}attachToTextarea(e){const t=t=>this.handleTextareaClick(t,e);e.addEventListener("click",t),e._glslClickHandler=t}attachToEditor(e){const t=t=>this.handleEditorClick(t,e);e.addEventListener("click",t),e._glslClickHandler=t}handleEditorClick(e,t){const n=t.getAttribute("data-associated-textarea-id"),i=n?document.getElementById(n):null;if(!i)return;if(!window.getSelection().rangeCount)return;const o=this.getEditorCursorPosition(t),a=i.value,s=this.ColorRegex();let r;for(;null!==(r=s.exec(a));){const n=r.index,a=n+r[0].length;if(o>=n&&o<=a)return void setTimeout((()=>{this.showTab(e.clientX,e.clientY,i,t,r,n,a)}),10)}this.removeTab()}getEditorCursorPosition(e){const t=window.getSelection();if(!t.rangeCount)return 0;let n=0,i=!1;return function e(o){if(!i)if(o.nodeType===Node.TEXT_NODE){const e=o.textContent.replace(/\r\n/g,"\n");if(t.anchorNode===o)return n+=t.anchorOffset,void(i=!0);n+=e.length}else for(let t=0;t<o.childNodes.length&&(e(o.childNodes[t]),!i);t++);}(e),n}handleTextareaClick(e,t){const n=t.selectionStart,i=t.value,o=this.ColorRegex();let a;for(;null!==(a=o.exec(i));){const i=a.index,o=i+a[0].length;if(n>=i&&n<=o)return void setTimeout((()=>{this.showTab(e.clientX,e.clientY,t,null,a,i,o)}),10)}this.removeTab()}showTab(e,t,n,i,o,a,s){this.removeTab();const r=document.createElement("div");r.className="glsl-tab",r.innerHTML='\n        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n            <g transform="scale(0.09)">\n                <path fill="var(--7)" d="M254.141,53.244C224.508,18.909,185.299,0,143.736,0c-35.062,0-68.197,13.458-93.302,37.9 C10.383,76.892-2.822,123.282,14.207,165.178c13.868,34.122,45.625,57.954,77.227,57.954c0.841,0,1.671-0.016,2.508-0.053 c4.705-0.194,9.249-0.586,13.646-0.966c5.309-0.462,10.325-0.895,14.77-0.895c10.54,0,19.645,0,19.645,26.846 c0,28.811,17.538,48.934,42.65,48.936c0.002,0,0.002,0,0.004,0c17.864,0,37.651-10.342,57.215-29.903 c25.882-25.88,43.099-62.198,47.234-99.64C293.762,125.326,281.343,84.763,254.141,53.244z M227.315,252.54 c-15.397,15.398-30.55,23.877-42.66,23.875c-16.288,0-22.064-15.274-22.064-28.352c0-32.357-12.786-47.43-40.232-47.43 c-5.333,0-10.778,0.472-16.545,0.969c-4.169,0.359-8.481,0.733-12.724,0.909c-0.553,0.024-1.102,0.034-1.655,0.034 c-23.07,0-47.529-18.975-58.156-45.118c-13.714-33.738-2.225-71.927,31.519-104.779c21.239-20.676,49.272-32.063,78.939-32.063 c35.485,0,69.159,16.373,94.82,46.107C289.187,125.359,272.6,207.256,227.315,252.54z"/>\n                <path d="M192.654,165.877c0,17.213,13.918,31.217,31.026,31.217c17.107,0,31.025-14.004,31.025-31.217 c0-17.215-13.918-31.219-31.025-31.219C206.572,134.658,192.654,148.662,192.654,165.877z M234.118,165.877 c0,5.861-4.682,10.633-10.438,10.633c-5.756,0-10.438-4.771-10.438-10.633c0-5.863,4.683-10.633,10.438-10.633 C229.436,155.244,234.118,160.014,234.118,165.877z"/>\n                <path d="M226.914,93.489c0-17.215-13.917-31.219-31.025-31.219c-17.107,0-31.025,14.004-31.025,31.219 c0,17.211,13.918,31.218,31.025,31.218C212.997,124.707,226.914,110.7,226.914,93.489z M185.45,93.489 c0-5.865,4.684-10.632,10.439-10.632c5.756,0,10.438,4.767,10.438,10.632c0,5.86-4.683,10.633-10.438,10.633 C190.133,104.122,185.45,99.35,185.45,93.489z"/>\n                <path d="M124.863,39.627c-17.107,0-31.025,14.004-31.025,31.217c0,17.213,13.918,31.217,31.025,31.217s31.025-14.004,31.025-31.217 C155.888,53.631,141.97,39.627,124.863,39.627z M124.863,81.478c-5.756,0-10.438-4.771-10.438-10.634 c0-5.863,4.682-10.633,10.438-10.633c5.756,0,10.438,4.77,10.438,10.633C135.3,76.707,130.619,81.478,124.863,81.478z"/>\n                <path d="M70.821,92.809c-17.107,0-31.026,14.004-31.026,31.217c0,17.214,13.919,31.219,31.026,31.219s31.024-14.005,31.024-31.219 C101.845,106.813,87.928,92.809,70.821,92.809z M70.821,134.658c-5.757,0-10.439-4.77-10.439-10.633 c0-5.861,4.683-10.63,10.439-10.63c5.755,0,10.438,4.769,10.438,10.63C81.259,129.889,76.576,134.658,70.821,134.658z"/>\n            </g>\n            </svg>\n        ',r.style.left=e+5+"px",r.style.top=t+5+"px";r.addEventListener("click",(r=>{this.openPicker(n,i,o,a,s,e,t),this.removeTab()}));(document.fullscreenElement||document.body).appendChild(r),this.tabElement=r,this.removeClickOutsideHandler(),this.clickOutsideHandler=e=>{const t=e.target;!this.tabElement||this.tabElement.contains(t)||n.contains(t)||i&&i.contains(t)||(this.removeTab(),this.removeClickOutsideHandler())},setTimeout((()=>{document.addEventListener("click",this.clickOutsideHandler)}),50),this.tabRemovalTimeout=setTimeout((()=>{this.removeTab()}),5e3)}removeTab(){this.tabRemovalTimeout&&(clearTimeout(this.tabRemovalTimeout),this.tabRemovalTimeout=null),this.tabElement&&(this.tabElement.remove(),this.tabElement=null),this.removeClickOutsideHandler()}removeClickOutsideHandler(){this.clickOutsideHandler&&(document.removeEventListener("click",this.clickOutsideHandler),this.clickOutsideHandler=null)}positionPicker(e,t){const n=document.getElementById("glsl-color-picker-overlay"),i=document.getElementById("glsl-color-picker");i.style.visibility="hidden",n.style.display="block";const o=i.getBoundingClientRect(),a=o.width,s=o.height;i.style.visibility="visible";const r=window.innerWidth,l=window.innerHeight,c=20;let d=e,u=t+30;if(d+a+c>r&&(d=r-a-c),d<c&&(d=c),u+s+c>l){const e=t-s-30;u=e>=c?e:Math.max(c,(l-s)/2)}i.style.left=d+"px",i.style.top=u+"px"}openPicker(e,t,n,i,o,a,s){this.currentTextarea=e,this.currentEditor=t,this.currentMatch=n,this.currentStartPos=i,this.currentEndPos=o;const r=parseFloat(n[1]),l=parseFloat(n[2]),c=parseFloat(n[3]);this.originalValues={r:r,g:l,b:c},document.getElementById("glsl-red").value=r,document.getElementById("glsl-green").value=l,document.getElementById("glsl-blue").value=c,document.getElementById("glsl-red-slider").value=r,document.getElementById("glsl-green-slider").value=l,document.getElementById("glsl-blue-slider").value=c,document.getElementById("glsl-red-value").textContent=r.toFixed(2),document.getElementById("glsl-green-value").textContent=l.toFixed(2),document.getElementById("glsl-blue-value").textContent=c.toFixed(2),this.updatePreview(r,l,c),this.positionPicker(a,s),document.getElementById("glsl-color-picker-overlay").style.display="block",this.highlightColor(e,t,i,o)}updatePreview(e,t,n){const i=document.getElementById("glsl-color-preview"),o=Math.min(255,Math.max(0,Math.round(255*e))),a=Math.min(255,Math.max(0,Math.round(255*t))),s=Math.min(255,Math.max(0,Math.round(255*n)));i.style.backgroundColor=`rgb(${o}, ${a}, ${s})`}highlightColor(e,t,n,i){e&&(e.focus(),e.setSelectionRange(n,i))}applyColor(){if(!this.currentTextarea)return;const e=parseFloat(document.getElementById("glsl-red").value)||0,t=parseFloat(document.getElementById("glsl-green").value)||0,n=parseFloat(document.getElementById("glsl-blue").value)||0,i=`(${e.toFixed(1)}, ${t.toFixed(1)}, ${n.toFixed(1)})`,o=this.currentTextarea.value,a=o.substring(0,this.currentStartPos)+i+o.substring(this.currentEndPos);this.currentTextarea.value=a;const s=new Event("input",{bubbles:!0});this.currentTextarea.dispatchEvent(s),this.closePicker()}cancelPicker(){if(this.currentTextarea&&this.originalValues){const e=`(${this.originalValues.r.toFixed(1)}, ${this.originalValues.g.toFixed(1)}, ${this.originalValues.b.toFixed(1)})`,t=this.currentTextarea.value,n=t.substring(0,this.currentStartPos)+e+t.substring(this.currentEndPos);this.currentTextarea.value=n;const i=new Event("input",{bubbles:!0});this.currentTextarea.dispatchEvent(i)}this.closePicker()}closePicker(){document.getElementById("glsl-color-picker-overlay").style.display="none",this.currentTextarea=null,this.currentEditor=null,this.currentMatch=null,this.originalValues={r:0,g:0,b:0},this.removeTab()}highlightColorsInTextarea(e){const t=e.value,n=this.ColorRegex();let i;const o=[];for(;null!==(i=n.exec(t));)o.push({text:i[0],start:i.index,end:i.index+i[0].length,r:parseFloat(i[1]),g:parseFloat(i[2]),b:parseFloat(i[3])});return o}destroy(){this.removeTab(),this.removeClickOutsideHandler();const e=document.getElementById("glsl-color-picker-overlay");e&&e.remove();document.querySelectorAll("textarea[data-glsl-color-picker-attached]").forEach((e=>{e._glslClickHandler&&(e.removeEventListener("click",e._glslClickHandler),delete e._glslClickHandler),delete e.dataset.glslColorPickerAttached}));document.querySelectorAll(".glsl-editor[data-glsl-color-picker-attached]").forEach((e=>{e._glslClickHandler&&(e.removeEventListener("click",e._glslClickHandler),delete e._glslClickHandler),delete e.dataset.glslColorPickerAttached})),this.isInitialized=!1}}if("loading"===document.readyState)document.addEventListener("DOMContentLoaded",(()=>{try{window.ColorPicker=new d}catch(e){}}));else try{window.ColorPicker=new d}catch(e){}"undefined"!=typeof module&&module.exports&&(module.exports=d),function(){const e=["attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","bool","true","false","vec2","vec3","vec4","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","mat2","mat3","mat4","sampler2D","samplerCube","void","main","gl_Position","gl_FragColor","gl_FragData","gl_FragCoord","gl_FrontFacing","texture2D","textureCube","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","reflect","refract","precision","lowp","mediump","highp"];let t=null,n=!1,i="",o="";function a(){(document.fullscreenElement||document.body).insertAdjacentHTML("beforeend",'\n            <div class="glsl-formatter-modal-overlay" id="glslFormatterModal">\n                <div class="glsl-formatter-modal">\n                    <div class="glsl-formatter-modal-header">\n                        <button class="glsl-formatter-modal-close" onclick="GLSLFormatter.closeModal()">×</button>\n                        <h2 class="glsl-formatter-modal-title">GLSL Formatter</h2>\n                    </div>\n                    <div class="glsl-formatter-switches">\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslFormatSwitch">\n                                <span class="glsl-formatter-slider format"></span>\n                                <span class="glsl-formatter-switch-label">Format</span>\n                            </label>\n                        </div>\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslRemoveExtraLinesSwitch">\n                                <span class="glsl-formatter-slider remove-lines"></span>\n                                <span class="glsl-formatter-switch-label">Remove Extra Lines</span>\n                            </label>\n                        </div>\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslRemoveCommentsSwitch">\n                                <span class="glsl-formatter-slider remove-comments"></span>\n                                <span class="glsl-formatter-switch-label">Remove Comments</span>\n                            </label>\n                        </div>\n                        <div class="glsl-formatter-switch-group">\n                            <label class="glsl-formatter-switch">\n                                <input type="checkbox" id="glslMinifySwitch">\n                                <span class="glsl-formatter-slider minify"></span>\n                                <span class="glsl-formatter-switch-label">Minify</span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class="glsl-formatter-actions">\n                        <button class="glsl-formatter-btn glsl-formatter-btn-primary" onclick="GLSLFormatter.saveChanges()">Save</button>\n                        <button class="glsl-formatter-btn glsl-formatter-btn-secondary" onclick="GLSLFormatter.cancelChanges()">Cancel</button>\n                    </div>\n                </div>\n            </div>\n        '),t=document.getElementById("glslFormatterModal"),function(){const e=document.getElementById("glslFormatSwitch"),i=document.getElementById("glslMinifySwitch"),o=document.getElementById("glslRemoveCommentsSwitch"),a=document.getElementById("glslRemoveExtraLinesSwitch");e.addEventListener("change",(()=>{e.checked&&i.checked&&(i.checked=!1),i.disabled=e.checked,c()})),i.addEventListener("change",(()=>{i.checked&&e.checked&&(e.checked=!1),e.disabled=i.checked,c()})),o.addEventListener("change",c),a.addEventListener("change",c),t.addEventListener("click",(e=>{e.target===t&&h()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&n&&h()}))}()}function s(t){let n=t.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"");n=n.replace(/\s+/g," ").trim();let i="",o=!1,a=0;for(let e=0;e<n.length;e++){const t=n[e],s=e>0?n[e-1]:"",r=e<n.length-1?n[e+1]:"";"("===t&&a++,")"===t&&a--,o||"f"!==t||"for"!==n.substr(e,3)||0!==e&&!/\s/.test(s)||(o=!0),o&&")"===t&&0===a&&(o=!1),i+=t,";"!==t||o||0!==a?("{"===t||"}"===t&&r&&";"!==r&&"}"!==r)&&(i+="\n"):i+="\n"}i=i.replace(/\s*([{}();,=+\-*/<>!&|])\s*/g,"$1");for(let t of e){const e=new RegExp(`\\b${t}\\b`,"g");i=i.replace(e,` ${t} `)}i=i.replace(/\s+/g," ").trim(),i=i.replace(/\s*([{}();,=+\-*/<>!&|])\s*/g,"$1");return i.split("\n").map((e=>e.trim())).filter((e=>e.length>0)).join("\n")}function r(e){if(!e.trim())return e;let t=e;const n=document.getElementById("glslRemoveCommentsSwitch"),i=document.getElementById("glslRemoveExtraLinesSwitch"),o=document.getElementById("glslFormatSwitch"),a=document.getElementById("glslMinifySwitch");return n.checked&&(t=function(e){let t=e;return t=t.replace(/\/\/.*$/gm,""),t=t.replace(/\/\*[\s\S]*?\*\//g,""),t=t.replace(/ +$/gm,""),t}(t)),i.checked&&(t=function(e){const t=e.split("\n"),n=[];for(let e of t)""!==e.trim()&&n.push(e);return n.join("\n")}(t)),o.checked?t=function(e){const t=e.split("\n").filter((e=>e.trim().length>0));let n;if(t.reduce(((e,t)=>e+t.length),0)/(t.length||1)>100||t.length<5){let t=e.replace(/\s+/g," ").trim(),i="",o=!1,a=0;for(let e=0;e<t.length;e++){const n=t[e],s=e>0?t[e-1]:"",r=e<t.length-1?t[e+1]:"";"("===n&&a++,")"===n&&a--,o||"f"!==n||"for"!==t.substr(e,3)||0!==e&&!/\s/.test(s)||(o=!0),o&&")"===n&&0===a&&(o=!1),i+=n,";"!==n||o||0!==a?("{"===n||"}"===n&&r&&";"!==r&&"}"!==r)&&(i+="\n"):i+="\n"}n=i}else n=e;const i=n.split("\n"),o=[];let a=0;for(let e of i){const t=e.trim();if(!t){o.push("");continue}if(t.startsWith("#")){o.push(t);continue}t.startsWith("}")&&(a=Math.max(0,a-1));const n="  ".repeat(a);o.push(n+t),t.endsWith("{")&&a++}return o.join("\n")}(t):a.checked&&(t=function(e){const t=e.split("\n"),n=[];let i=[];for(let e of t){const t=e.trim();t.startsWith("#")?(i.length&&(n.push({type:"code",lines:i.slice()}),i=[]),n.push({type:"directive",content:t})):i.push(e)}i.length&&n.push({type:"code",lines:i.slice()});const o=[];for(let e of n)if("directive"===e.type)o.push(e.content);else if("code"===e.type){const t=e.lines.join("\n");if(t.trim()){const e=s(t).split("\n");for(let t of e)o.push(t)}}return o.join("\n").trim()}(t)),t}function l(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");i=e?e.value:"",o=t?t.value:""}function c(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&(e.value=r(i)),t&&(t.value=r(o))}function d(){t||a(),l(),t.style.display="flex",n=!0,setTimeout((()=>{t.classList.add("show")}),10)}function u(){t&&(t.classList.remove("show"),n=!1,setTimeout((()=>{t.style.display="none"}),300))}function m(){l(),u()}function h(){!function(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&(e.value=i),t&&(t.value=o)}(),u()}function p(e){e.altKey&&"KeyM"===e.code&&(e.preventDefault(),n?h():d())}function g(){document.addEventListener("keydown",p),document.addEventListener("fullscreenchange",(()=>{const e=document.getElementById("glslFormatterModal"),t=document.getElementById("glslFormatterToggleButton"),n=document.fullscreenElement||document.body;t&&n.appendChild(t),e&&n.appendChild(e)})),window.GLSLFormatter={openModal:d,closeModal:u,saveChanges:m,cancelChanges:h}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()}(),function(){let e=null;const t={vertex:{"Vertex Input":{pattern:/attribute\s+\w+\s+\w+|in\s+\w+\s+\w+/,priority:1},"Position Transform":{pattern:/gl_Position\s*=|mvp|modelViewProjection/,priority:8},"Vertex Output":{pattern:/varying\s+\w+\s+\w+|out\s+\w+\s+\w+/,priority:7},"Matrix Operations":{pattern:/mat[2-4]|transpose|inverse/,priority:5},"Vertex Lighting":{pattern:/dot\s*\(.*normal|reflect\s*\(/,priority:6}},fragment:{"Fragment Input":{pattern:/varying\s+\w+\s+\w+|in\s+\w+\s+\w+/,priority:1},"Screen Coordinates":{pattern:/gl_FragCoord/,priority:2},"UV Mapping":{pattern:/uv\s*=|texCoord/,priority:2},"Texture Sampling":{pattern:/texture2D|texture|sampler/,priority:4},"Coordinate Transform":{pattern:/atan|length|normalize/,priority:3},"Polar Coordinates":{pattern:/atan\s*\(|polar|radius|angle/,priority:3},"Mathematical Operations":{pattern:/mod\s*\(|fract\s*\(|step\s*\(/,priority:5},"Fractal Iteration":{pattern:/z\s*=\s*z.*\+|mandelbrot|julia/,priority:6},"Shape Functions":{pattern:/circle|rectangle|superformula|pow\s*\(/,priority:5},Rotation:{pattern:/rot2|cos\s*\(.*sin\s*\(|rotation/,priority:4},"Time Animation":{pattern:/u_time|time|iTime/,priority:3},"Color Generation":{pattern:/vec3\s*\(.*,.*,.*\)|rgb|hsv/,priority:7},"Color Mixing":{pattern:/mix\s*\(|lerp\s*\(/,priority:8},Lighting:{pattern:/dot\s*\(.*normal|specular|diffuse/,priority:6},"Distance Fields":{pattern:/length\s*\(|distance\s*\(|sdf/,priority:5},"Noise Functions":{pattern:/noise\s*\(|random\s*\(|perlin/,priority:4},"Fragment Output":{pattern:/gl_FragColor\s*=|FragColor\s*=/,priority:9}},common:{Conditionals:{pattern:/if\s*\(|else|switch/,priority:0},Loops:{pattern:/for\s*\(|while\s*\(/,priority:0},Functions:{pattern:/\w+\s*\([^)]*\)\s*{/,priority:0},Constants:{pattern:/const\s+\w+|#define/,priority:0},Uniforms:{pattern:/uniform\s+\w+\s+\w+/,priority:0}}};function n(e,t){const n=e.split("\n"),i=[];return n.forEach(((e,n)=>{t.test(e)&&i.push({lineNumber:n+1,lineContent:e.trim(),match:e.match(t)?.[0]||""})})),i}function i(e,i){const o=[],a={...t.common,...t[i]};for(const[t,s]of Object.entries(a)){const a=n(e,s.pattern);a.length>0&&o.push({name:t,type:"vertex"===i?"vertex":"fragment"===i?"fragment":"common",priority:s.priority||0,matches:a})}return o.sort(((e,t)=>e.priority-t.priority)),o}function o(e,t){const n=document.getElementById("flowchartTooltip")||function(){const e=document.createElement("div");return e.className="flowchart-tooltip",e.id="flowchartTooltip",document.body.appendChild(e),e}();let i=`${t.name}\n\nFound on lines:\n`;t.matches.forEach((e=>{i+=`Line ${e.lineNumber}: ${e.lineContent}\n`})),n.textContent=i;const o=n.getBoundingClientRect(),a=window.innerWidth,s=window.innerHeight;let r=e.pageX+10,l=e.pageY+10;r+o.width>a&&(r=e.pageX-o.width-10),l+o.height>s&&(l=e.pageY-o.height-10),n.style.left=r+"px",n.style.top=l+"px",n.classList.add("show")}function a(){const e=document.getElementById("flowchartTooltip");e&&e.classList.remove("show")}function s(e,t,n=9){const i=e.split(/,\s*/),o=[];let a="";const s=.6*n,r=Math.floor(t/s);for(let e of i)a.length+e.length+2<=r?(a&&(a+=", "),a+=e):(a&&o.push(a),a=e);return a&&o.push(a),o}function r(){const t=document.getElementById("vertCode")?.value||"",n=document.getElementById("fragCode")?.value||"",r=i(t,"vertex"),l=i(n,"fragment");e={vertexStages:r,fragmentStages:l,vertexCode:t,fragmentCode:n,timestamp:(new Date).toISOString()},function(e,t){const n=document.getElementById("flowchartSVG");n.innerHTML="";const i=200,r=15,l=e=>{const t=s(e.matches.map((e=>`L${e.lineNumber}`)).join(", "),180);return Math.max(50,50+12*(t.length-1))},c=e.map(l),d=t.map(l),u=c.reduce(((e,t)=>e+t+r),0)-r,m=d.reduce(((e,t)=>e+t+r),0)-r,h=50+Math.max(u,m)+30;n.setAttribute("width","100%"),n.setAttribute("height",h),n.setAttribute("viewBox",`0 0 550 ${h}`),n.style.minHeight=h+"px";const p=document.createElementNS("http://www.w3.org/2000/svg","defs");p.innerHTML='\n            <marker id="flowchart-arrow-marker" viewBox="0 0 10 10" refX="9" refY="3"\n                    markerWidth="6" markerHeight="6" orient="auto">\n                <path d="M0,0 L0,6 L9,3 z" fill="#666"/>\n            </marker>\n        ',n.appendChild(p);const g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",125),g.setAttribute("y",25),g.setAttribute("class","flowchart-label"),g.setAttribute("font-size","16"),g.setAttribute("font-weight","bold"),g.textContent="Vertex Shader",n.appendChild(g);const v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",425),v.setAttribute("y",25),v.setAttribute("class","flowchart-label"),v.setAttribute("font-size","16"),v.setAttribute("font-weight","bold"),v.textContent="Fragment Shader",n.appendChild(v);let f=50;if(e.forEach(((t,l)=>{const d=c[l],u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("x",25),u.setAttribute("y",f),u.setAttribute("width",i),u.setAttribute("height",d),u.setAttribute("rx",6),u.setAttribute("class",`flowchart-node ${t.type}`),u.addEventListener("mouseenter",(e=>o(e,t))),u.addEventListener("mouseleave",a),u.addEventListener("mousemove",(e=>{const n=document.getElementById("flowchartTooltip");n&&n.classList.contains("show")&&o(e,t)})),n.appendChild(u);const m=document.createElementNS("http://www.w3.org/2000/svg","text");if(m.setAttribute("x",125),m.setAttribute("y",f+d/2-10),m.setAttribute("class","flowchart-label"),m.textContent=t.name,n.appendChild(m),s(t.matches.map((e=>`L${e.lineNumber}`)).join(", "),180).forEach(((e,t)=>{const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",125),i.setAttribute("y",f+d/2+5+12*t),i.setAttribute("class","flowchart-line-number"),i.textContent=e,n.appendChild(i)})),l<e.length-1){const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",125),e.setAttribute("y1",f+d),e.setAttribute("x2",125),e.setAttribute("y2",f+d+r),e.setAttribute("class","flowchart-arrow"),n.appendChild(e)}f+=d+r})),f=50,t.forEach(((e,l)=>{const c=d[l],u=325,m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("x",u),m.setAttribute("y",f),m.setAttribute("width",i),m.setAttribute("height",c),m.setAttribute("rx",6),m.setAttribute("class",`flowchart-node ${e.type}`),m.addEventListener("mouseenter",(t=>o(t,e))),m.addEventListener("mouseleave",a),m.addEventListener("mousemove",(t=>{const n=document.getElementById("flowchartTooltip");n&&n.classList.contains("show")&&o(t,e)})),n.appendChild(m);const h=document.createElementNS("http://www.w3.org/2000/svg","text");if(h.setAttribute("x",425),h.setAttribute("y",f+c/2-10),h.setAttribute("class","flowchart-label"),h.textContent=e.name,n.appendChild(h),s(e.matches.map((e=>`L${e.lineNumber}`)).join(", "),180).forEach(((e,t)=>{const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",425),i.setAttribute("y",f+c/2+5+12*t),i.setAttribute("class","flowchart-line-number"),i.textContent=e,n.appendChild(i)})),l<t.length-1){const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",425),e.setAttribute("y1",f+c),e.setAttribute("x2",425),e.setAttribute("y2",f+c+r),e.setAttribute("class","flowchart-arrow"),n.appendChild(e)}f+=c+r})),e.length>0&&t.length>0){const e=50+u/2,t=50+d[0]/2,i=Math.max(e,t),o=document.createElementNS("http://www.w3.org/2000/svg","path"),a=225,s=325;o.setAttribute("d",`M ${a} ${i} L ${s} ${i}`),o.setAttribute("class","flowchart-arrow"),o.setAttribute("stroke-dasharray","5,5"),n.appendChild(o)}}(r,l)}function l(){document.getElementById("flowchartOverlay").classList.add("show"),document.getElementById("flowchartWindow").classList.add("show"),r()}function c(){document.getElementById("flowchartOverlay").classList.remove("show"),document.getElementById("flowchartWindow").classList.remove("show"),a()}function d(){const e=document.createElement("div");e.id="flowchartOverlay",e.className="flowchart-overlay",e.addEventListener("click",c);const t=document.createElement("div");t.id="flowchartWindow",t.innerHTML='\n            <div class="flowchart-header">\n                <h3>Flowchart <span style="font-size:12px;color:var(--a)">(Hover nodes for details)</span></h3>\n                <div class="flowchart-controls">\n                    <div class="export-dropdown" id="exportDropdown">\n                        <button onclick="glslFlowchart.toggleExport()">Export ▼</button>\n                        <div class="export-dropdown-content">\n                            <button onclick="glslFlowchart.exportPNG()">PNG Image</button>\n                            <button onclick="glslFlowchart.exportJSON()">JSON Data</button>\n                            <button onclick="glslFlowchart.exportTXT()">Text Report</button>\n                        </div>\n                    </div>\n                    <button class="flowchartclose-btn" onclick="glslFlowchart.close()">Close</button>\n                </div>\n            </div>\n            <div class="flowchart-content">\n                <svg id="flowchartSVG"></svg>\n            </div>\n        ',t.addEventListener("click",(e=>e.stopPropagation())),document.body.appendChild(e),document.body.appendChild(t)}function u(){document.addEventListener("keydown",(e=>{if(e.altKey&&"KeyV"===e.code){e.preventDefault();document.getElementById("flowchartWindow").classList.contains("show")?c():l()}"Escape"===e.key&&document.getElementById("flowchartWindow").classList.contains("show")&&c()}))}document.addEventListener("click",(function(e){const t=document.getElementById("exportDropdown");t&&!t.contains(e.target)&&t.classList.remove("show")})),window.glslFlowchart={open:l,close:c,exportPNG:function(){const e=document.getElementById("flowchartSVG");if(!e)return;const t=e.cloneNode(!0),n=(window.getComputedStyle(document.documentElement),{"--0":"rgba(0,0,0,0.3)","--1":"rgba(0,0,0,0.1)","--2":"#1a1a1a","--3":"#333333","--4":"#2a2a2a","--5":"#666666","--6":"#444444","--7":"#ffffff","--a":"#4a9eff","--b":"#ff6b6b","--m":"#ff9f43","--r":"#ee5a52","--ah":"#357abd","--rh":"#d63031"});!function e(t){["fill","stroke"].forEach((e=>{const i=t.getAttribute(e);if(i&&i.startsWith("var(")){const o=i.match(/var\((--[^)]+)\)/)?.[1];o&&n[o]&&t.setAttribute(e,n[o])}}));const i=t.getAttribute("style");if(i){let e=i;Object.entries(n).forEach((([t,n])=>{e=e.replace(new RegExp(`var\\(${t}\\)`,"g"),n)})),t.setAttribute("style",e)}Array.from(t.children).forEach((t=>e(t)))}(t);const i=document.createElementNS("http://www.w3.org/2000/svg","style");i.textContent="\n            .flowchart-node { fill: #1a1a1a; stroke: #333333; stroke-width: 2px; }\n            .flowchart-node.vertex { fill: #1a1a1a; stroke: #4a9eff; }\n            .flowchart-node.fragment { fill: #1a1a1a; stroke: #ff9f43; }\n            .flowchart-node.common { fill: #1a1a1a; stroke: #ff6b6b; }\n            .flowchart-label { font-family: Arial, sans-serif; fill: #ffffff; text-anchor: middle; dominant-baseline: middle; }\n            .flowchart-line-number { font-family: monospace; fill: #666666; text-anchor: middle; }\n            .flowchart-arrow { stroke: #666666; stroke-width: 2px; fill: none; }\n        ",t.insertBefore(i,t.firstChild);const o=t.querySelector("defs");if(o){const e=o.querySelector("#flowchart-arrow-marker path");e&&e.setAttribute("fill","#666666")}const a=e.getBoundingClientRect();t.setAttribute("width",a.width),t.setAttribute("height",a.height);const s=(new XMLSerializer).serializeToString(t),r=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),l=document.createElement("canvas"),c=l.getContext("2d"),d=new Image;l.width=2*a.width,l.height=2*a.height,d.onload=function(){c.fillStyle="#ffffff",c.fillRect(0,0,l.width,l.height),c.scale(2,2),c.drawImage(d,0,0),l.toBlob((function(e){if(e){const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="glsl-flowchart.png",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}}),"image/png"),URL.revokeObjectURL(d.src)},d.onerror=function(){alert("Failed to export PNG. Try the SVG export instead."),URL.revokeObjectURL(d.src)};const u=URL.createObjectURL(r);d.src=u},exportJSON:function(){if(!e)return void alert("Please generate a flowchart first");const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download="glsl-flowchart.json",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)},exportTXT:function(){if(!e)return void alert("Please generate a flowchart first");let t="GLSL Shader Flowchart Analysis\n";t+=`Generated: ${e.timestamp}\n\n`,t+="=== VERTEX SHADER STAGES ===\n",e.vertexStages.forEach(((e,n)=>{t+=`\n${n+1}. ${e.name} (${e.type})\n`,t+=`   Priority: ${e.priority}\n`,t+="   Found on lines:\n",e.matches.forEach((e=>{t+=`     Line ${e.lineNumber}: ${e.lineContent}\n`}))})),t+="\n=== FRAGMENT SHADER STAGES ===\n",e.fragmentStages.forEach(((e,n)=>{t+=`\n${n+1}. ${e.name} (${e.type})\n`,t+=`   Priority: ${e.priority}\n`,t+="   Found on lines:\n",e.matches.forEach((e=>{t+=`     Line ${e.lineNumber}: ${e.lineContent}\n`}))})),t+="\n=== ORIGINAL CODE ===\n\n",t+=`--- Vertex Shader ---\n${e.vertexCode}\n\n`,t+=`--- Fragment Shader ---\n${e.fragmentCode}\n`;const n=new Blob([t],{type:"text/plain"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download="glsl-flowchart.txt",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)},toggleExport:function(){document.getElementById("exportDropdown").classList.toggle("show")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{d(),u()})):(d(),u(),document.addEventListener("fullscreenchange",(()=>{const e=document.getElementById("flowchartOverlay"),t=document.getElementById("flowchartWindow");document.fullscreenElement?(document.fullscreenElement.appendChild(e),document.fullscreenElement.appendChild(t)):(document.body.appendChild(e),document.body.appendChild(t))})))}();class u{constructor(){this.initialized=!1,this.contexts=[{type:"public",tabId:"tabPublic",listId:"publicShaderList",inputId:"publicSearchInput",clearBtnId:"publicClearBtn",placeholder:"Search public shaders..."},{type:"local",tabId:"tabLocal",listId:"localShaderList",inputId:"localSearchInput",clearBtnId:"localClearBtn",placeholder:"Search local shaders..."}],this.Inputs()}Inputs(){this.initialized||(this.initialized=!0,this.contexts.forEach((e=>{const t=document.getElementById(e.tabId);if(!t)return;if(t.querySelector(".search-container"))return;const n=t.querySelector("h3");if(!n)return;const i=document.createElement("div");i.className="search-container",i.innerHTML=`\n        <input type="text"\n               id="${e.inputId}"\n               placeholder="${e.placeholder}"\n               class="search-input">\n        <button id="${e.clearBtnId}" class="clear-btn" style="display:none;">×</button>\n      `,n.insertAdjacentElement("afterend",i)})),this.EventListeners(),this.setupTabObserver())}EventListeners(){this.contexts.forEach((e=>{const t=document.getElementById(e.inputId),n=document.getElementById(e.clearBtnId);t&&t.addEventListener("input",(t=>{const i=t.target.value;this.Search(i,e.type),this.Clear(i,n)})),n&&t&&n.addEventListener("click",(()=>{t.value="",this.Search("",e.type),this.Clear("",n),t.focus()}))}))}Clear(e,t){t&&(t.style.display=e&&e.length>0?"inline-block":"none")}Search(e,t){const n=e.toLowerCase().trim(),i=this.contexts.find((e=>e.type===t));if(!i)return;const o=document.getElementById(i.listId);if(!o)return;const a=o.querySelectorAll(".shader-card");let s=0;a.forEach((e=>{const t=this.getTitle(e),i=this.getAuthor(e);""===n||t.toLowerCase().includes(n)||i.toLowerCase().includes(n)?(e.style.display="",s++):e.style.display="none"})),this.NoResults(o,0===s&&""!==n,t)}getTitle(e){const t=e.querySelector("strong");return t&&(t.textContent||t.innerText)||""}getAuthor(e){const t=e.querySelector(".shader-author");if(!t)return"";return(t.textContent||t.innerText||"").replace(/^by\s+/i,"")}NoResults(e,t,n){const i=e.querySelector(".no-results-message");if(t&&!i){const t=document.createElement("div");t.className="no-results-message",t.innerHTML=`<p>No ${n} shaders found matching your search.</p>`,e.appendChild(t)}else!t&&i&&i.remove()}refresh(){this.contexts.forEach((e=>{const t=document.getElementById(e.inputId);t&&t.value&&this.Search(t.value,e.type)}))}clear(){this.contexts.forEach((e=>{const t=document.getElementById(e.inputId),n=document.getElementById(e.clearBtnId);t&&(t.value="",this.Search("",e.type),this.Clear("",n))}))}setupTabObserver(){const e=new MutationObserver((e=>{e.forEach((e=>{if("attributes"===e.type&&"style"===e.attributeName){const t=e.target;if("block"===t.style.display||""===t.style.display){const e=this.contexts.find((e=>e.tabId===t.id));e&&setTimeout((()=>{this.refreshTabIfNeeded(e.type)}),10)}}}))}));this.contexts.forEach((t=>{const n=document.getElementById(t.tabId);n&&e.observe(n,{attributes:!0,attributeFilter:["style"]})}))}refreshTabIfNeeded(e){const t=this.contexts.find((t=>t.type===e));if(!t)return;const n=document.getElementById(t.inputId),i=document.getElementById(t.clearBtnId);n&&n.value&&(this.Search(n.value,t.type),this.Clear(n.value,i))}}function m(){window.shaderSearch||(window.shaderSearch=new u)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m(),function(){const e=navigator.platform.toUpperCase().indexOf("MAC")>=0||navigator.userAgent.toUpperCase().indexOf("MAC")>=0,t={modifier:e?"Cmd":"Win",alt:e?"Opt":"Alt",control:"Ctrl"},n=[{row:1,keys:[{key:"Esc",width:"4em",id:"escape"},{key:"F1",width:"3em"},{key:"F2",width:"3em"},{key:"F3",width:"3em"},{key:"F4",width:"3em"},{key:"F5",width:"3em"},{key:"F6",width:"3em"},{key:"F7",width:"3em"},{key:"F8",width:"3em"},{key:"F9",width:"3em"},{key:"F10",width:"3em"},{key:"F11",width:"3em"},{key:"F12",width:"3em"}]},{row:2,keys:[{key:"`",width:"3em"},{key:"1",width:"3em"},{key:"2",width:"3em"},{key:"3",width:"3em"},{key:"4",width:"3em"},{key:"5",width:"3em"},{key:"6",width:"3em"},{key:"7",width:"3em"},{key:"8",width:"3em"},{key:"9",width:"3em"},{key:"0",width:"3em"},{key:"-",width:"3em"},{key:"=",width:"3em"},{key:"Backspace",width:"6em"}]},{row:3,keys:[{key:"Tab",width:"4.5em"},{key:"Q",width:"3em"},{key:"W",width:"3em"},{key:"E",width:"3em"},{key:"R",width:"3em"},{key:"T",width:"3em"},{key:"Y",width:"3em"},{key:"U",width:"3em"},{key:"I",width:"3em"},{key:"O",width:"3em"},{key:"P",width:"3em",id:"p"},{key:"[",width:"3em"},{key:"]",width:"3em"},{key:"\\",width:"4.5em"}]},{row:4,keys:[{key:"Caps",width:"5.25em"},{key:"A",width:"3em"},{key:"S",width:"3em"},{key:"D",width:"3em"},{key:"F",width:"3em",id:"f"},{key:"G",width:"3em"},{key:"H",width:"3em"},{key:"J",width:"3em"},{key:"K",width:"3em"},{key:"L",width:"3em"},{key:";",width:"3em"},{key:"'",width:"3em"},{key:"Enter",width:"6.75em"}]},{row:5,keys:[{key:"Shift",width:"7em",class:"modifier",id:"shift"},{key:"Z",width:"3em"},{key:"X",width:"3em"},{key:"C",width:"3em"},{key:"V",width:"3em",id:"v"},{key:"B",width:"3em"},{key:"N",width:"3em"},{key:"M",width:"3em",id:"m"},{key:",",width:"3em"},{key:".",width:"3em"},{key:"/",width:"3em"},{key:"Shift",width:"7em",class:"modifier",id:"shift-right"}]},{row:6,keys:[{key:t.control,width:"4em",class:"modifier",id:"ctrl"},{key:t.modifier,width:"3em",class:"modifier",id:"command"},{key:t.alt,width:"3em",class:"modifier",id:"alt"},{key:"Space",width:"18em"},{key:t.alt,width:"3em",class:"modifier",id:"alt-right"},{key:"Menu",width:"3em",class:"modifier"},{key:t.control,width:"4em",class:"modifier",id:"ctrl-right"},{key:"←",width:"3em",id:"arrow-left"},{key:"UD",width:"3em",id:"arrow-stack",isStack:!0},{key:"→",width:"3em",id:"arrow-right"}]}],i=[{desc:"Close any modal (hold to exit fullscreen)",keys:"Esc",highlight:["escape"],id:"close"},{desc:"Fullscreen/Open + Close Editor panel",keys:`${t.control} + F`,highlight:["ctrl","f"],id:"Open"},{desc:"Enable / Disable Window Focus",keys:`${t.control} + P`,highlight:["ctrl","p"],id:"focus"},{desc:"Play / Pause loaded audio",keys:`${t.alt} + P`,highlight:["alt","p"],id:"play"},{desc:"Performance mode (hide buttons)",keys:`${t.control} + Shift + D`,highlight:["ctrl","shift","d"],id:"performance"},{desc:"Switch between local shaders",keys:"L + Arrow Keys",highlight:["l","arrow-right","arrow-left"],id:"local-shaders"},{desc:"Switch between public shaders",keys:"P + Arrow Keys",highlight:["p","arrow-right","arrow-left"],id:"public-shaders"},{desc:"Format/minify code",keys:`${t.alt} + M`,highlight:["alt","m"],id:"format"},{desc:"Visualize code with flowchart modal",keys:`${t.alt} + V`,highlight:["alt","v"],id:"visualize"},{desc:"Delete one line and copy to clipboard",keys:`${t.modifier} + X`,highlight:["command","x"],id:"Cut"}];window.userLoggedIn&&i.push({desc:"Find code snippets",keys:`${t.control} + S`,highlight:["ctrl","s"],id:"find"}),window.KeyboardShortcuts={modal:null,isOpen:!1,currentHighlight:null,resizeTimeout:null,calculateKeyboardSize:function(){const e=this.modal,t=document.getElementById("keyboard");if(!e||!t)return;const n=window.innerWidth,i=(e.querySelector(".keyboard-container"),n<=480?20:60),o=(Math.min(.95*n,1200)-i)/900;let a=Math.min(o,1);n<=480?a=Math.max(a,.55):n<=600?a=Math.max(a,.65):n<=800&&(a=Math.max(a,.75)),a=Math.max(a,.45),t.style.transform=`scale(${a})`;t.querySelectorAll(".key").forEach((e=>{a<.6?(e.style.fontSize="9px",e.style.minHeight="24px"):a<.8?(e.style.fontSize="10px",e.style.minHeight="28px"):(e.style.fontSize="11px",e.style.minHeight="32px")}));t.querySelectorAll(".key.half-height").forEach((e=>{e.style.fontSize=a<.6?"8px":"9px"}))},init:function(){document.body.insertAdjacentHTML("beforeend",`\n        <div class="shortcut-modal" id="shortcut-modal">\n            <div class="shortcut">\n                <button class="close-btn" onclick="KeyboardShortcuts.close()">&times;</button>\n                <div class="shortcut-header">\n                    <h2 class="shortcut-title">Keyboard Shortcuts</h2>\n                </div>\n                <div class="shortcut-content">\n                    <div class="commands-list-container">\n                        <div class="commands-list" id="commands-list">\n                            ${i.map((e=>`\n                                <div class="command-item" data-shortcut="${e.id}">\n                                    <span class="command-desc">${e.desc}</span>\n                                    <span class="command-keys">${e.keys}</span>\n                                </div>\n                            `)).join("")}\n                        </div>\n                    </div>\n                    <div class="keyboard-container">\n                        <div class="keyboard" id="keyboard">\n                            ${n.map((e=>`\n                            <div class="keyboard-row" style="grid-template-columns: repeat(${e.keys.length}, auto);">\n                                ${e.keys.map((e=>e.isStack?`\n                                            <div class="arrow-stack" style="width: ${e.width};">\n                                                <div class="key half-height" data-key="arrow-up" id="key-arrow-up">↑</div>\n                                                <div class="key half-height" data-key="arrow-down" id="key-arrow-down">↓</div>\n                                            </div>\n                                        `:`\n                                            <div class="key ${e.class||""}" \n                                                style="width: ${e.width};" \n                                                data-key="${e.id||e.key.toLowerCase()}"\n                                                id="key-${e.id||e.key.toLowerCase()}">\n                                                ${e.key}\n                                            </div>\n                                        `)).join("")}\n                            </div>\n                        `)).join("")}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `),this.modal=document.getElementById("shortcut-modal"),this.bindEvents(),window.addEventListener("resize",(()=>{this.isOpen&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.calculateKeyboardSize()}),100))}))},bindEvents:function(){document.querySelectorAll(".command-item").forEach((e=>{e.addEventListener("mouseenter",(e=>{const t=e.target.dataset.shortcut,n=i.find((e=>e.id===t));n&&(this.highlightKeys(n.highlight),e.target.classList.add("active"))})),e.addEventListener("mouseleave",(e=>{this.clearHighlight(),e.target.classList.remove("active")}))})),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.close()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isOpen&&this.close()}))},highlightKeys:function(e){this.clearHighlight(),this.currentHighlight=e,e.forEach((e=>{let t=document.getElementById(`key-${e}`);if(!t)switch(e){case"alt":t=document.getElementById("key-alt")||document.getElementById("key-alt-right");break;case"ctrl":t=document.getElementById("key-ctrl")||document.getElementById("key-ctrl-right");break;case"shift":t=document.getElementById("key-shift")||document.getElementById("key-shift-right")}t&&t.classList.add("highlight")}))},clearHighlight:function(){this.currentHighlight&&(this.currentHighlight.forEach((e=>{document.querySelectorAll(`[data-key="${e}"], #key-${e}`).forEach((e=>e.classList.remove("highlight")))})),document.querySelectorAll(".key.highlight").forEach((e=>{e.classList.remove("highlight")})),this.currentHighlight=null)},open:function(){(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.body).appendChild(this.modal),this.modal.classList.add("show"),this.isOpen=!0,setTimeout((()=>this.calculateKeyboardSize()),50)},close:function(){this.modal.classList.remove("show"),this.isOpen=!1,this.clearHighlight()}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{KeyboardShortcuts.init()})):KeyboardShortcuts.init()}(),function(){let e=!1,t=new Map,n=new Map,i=!1;function o(){const o=document.getElementById("editors");i=o&&"none"!==o.style.display,i&&window.toggleEditors&&window.toggleEditors(),setTimeout((()=>{["#editors","#divider","#fsBtn","#lint",".lbtn","#shaderWindow"].forEach((e=>{document.querySelectorAll(e).forEach((e=>{t.set(e,e.style.display),e.classList.add("performance-mode-hidden")}))}));const i=document.getElementById("glcanvas"),o=document.getElementById("preview-panel"),a=document.getElementById("app");i&&o&&a&&(t.set("canvas",{width:i.style.width,height:i.style.height,position:i.style.position,top:i.style.top,left:i.style.left,zIndex:i.style.zIndex}),t.set("previewPanel",{width:o.style.width,height:o.style.height,position:o.style.position,top:o.style.top,left:o.style.left,zIndex:o.style.zIndex}),t.set("app",{overflow:a.style.overflow,gridTemplateColumns:a.style.gridTemplateColumns}),n.set(i,i.className),n.set(o,o.className),n.set(a,a.className),n.set(document.body,document.body.className),i.classList.add("performance-mode-canvas"),o.classList.add("performance-mode-preview"),a.classList.add("performance-mode-app"),document.body.classList.add("performance-mode-body"),i.width=window.innerWidth,i.height=window.innerHeight,window.resizeCanvas?window.resizeCanvas():window.dispatchEvent(new Event("resize"))),e=!0}),20)}function a(){t.forEach(((e,t)=>{"string"!=typeof t&&(t.classList.remove("performance-mode-hidden"),t.style.display=e)}));const o=document.getElementById("glcanvas"),a=document.getElementById("preview-panel"),s=document.getElementById("app");if(o&&n.has(o)&&(o.className=n.get(o)),a&&n.has(a)&&(a.className=n.get(a)),s&&n.has(s)&&(s.className=n.get(s)),n.has(document.body)&&(document.body.className=n.get(document.body)),o&&t.has("canvas")){const e=t.get("canvas");Object.assign(o.style,e)}if(a&&t.has("previewPanel")){const e=t.get("previewPanel");Object.assign(a.style,e)}if(s&&t.has("app")){const e=t.get("app");s.style.overflow=e.overflow,s.style.gridTemplateColumns=e.gridTemplateColumns}e=!1,setTimeout((()=>{if(i&&window.toggleEditors){const e=document.getElementById("editors");e&&"none"===e.style.display&&window.toggleEditors()}window.resizeCanvas?window.resizeCanvas():window.dispatchEvent(new Event("resize"))}),20)}function s(){e?a():o()}document.addEventListener("keydown",(function(t){("F11"===t.key||t.ctrlKey&&t.shiftKey&&"D"===t.key)&&(t.preventDefault(),s()),"Escape"===t.key&&e&&a()})),window.addEventListener("resize",(function(){if(e){const e=document.getElementById("glcanvas");e&&(e.width=window.innerWidth,e.height=window.innerHeight)}})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("glcanvas");e&&e.addEventListener("dblclick",(function(e){e.preventDefault(),s()}))})),window.webglPerformanceMode={enter:o,exit:a,toggle:s,isActive:function(){return e}}}(),(()=>{let e=0,t=0,n=[],i=[];const o=new Set,a={lastLoad:0,loadTimes:[],maxPerSecond:1,maxPer30Seconds:10,window30s:3e4,minInterval:1e3};function s(){n=function(){const e=[],t=document.getElementById("publicShaderList");return t?(t.querySelectorAll("[data-public-token]").forEach((t=>{const n=t.getAttribute("data-public-token"),i=t.closest("div");if(i&&n){const t=i.querySelector("strong"),o=t?t.textContent:"Unknown",a=i.querySelector('span[style*="color"]'),s=a?a.textContent.replace("by ",""):"Unknown";e.push({token:n,title:o,user:s})}})),e):e}(),i=function(){const e=[],t=document.getElementById("localShaderList");return t?(t.querySelectorAll("[data-local-index]").forEach((t=>{const n=parseInt(t.getAttribute("data-local-index")),i=t.closest("div");if(i&&!isNaN(n)){const t=i.querySelector("strong"),o=t?t.textContent:"Unknown";e.push({index:n,title:o})}})),e):e}(),e>=n.length&&(e=Math.max(0,n.length-1)),t>=i.length&&(t=Math.max(0,i.length-1))}function r(){const e=Date.now(),t=a;if(e-t.lastLoad<t.minInterval){Math.ceil((t.minInterval-(e-t.lastLoad))/1e3);return{allowed:!1,message:"Slow down!"}}if(t.loadTimes=t.loadTimes.filter((n=>e-n<t.window30s)),t.loadTimes.length>=t.maxPer30Seconds){const n=Math.min(...t.loadTimes),i=Math.ceil((t.window30s-(e-n))/1e3);return{allowed:!1,message:`Rate limit exceeded! You can only load ${t.maxPer30Seconds} public shaders per 30 seconds. Please wait ${i} second${i>1?"s":""}.`}}return{allowed:!0}}function l(e){if(e<0||e>=n.length)return!1;const t=r();if(!t.allowed)return c(t.message,"error"),!1;const i=n[e],o=document.getElementById("publicShaderList");if(!o)return!1;const s=o.querySelector(`[data-public-token="${i.token}"]`);return!!s&&(s.click(),function(){const e=Date.now();a.lastLoad=e,a.loadTimes.push(e)}(),!0)}function c(e,t="info"){"function"!=typeof window.showToast||window.showToast(e,t)}function d(t){if(s(),0===n.length)return void c("No public shaders available","warning");e="next"===t?(e+1)%n.length:(e-1+n.length)%n.length;n[e];l(e)}function u(e){if(s(),0===i.length)return void c("No local shaders available","warning");t="next"===e?(t+1)%i.length:(t-1+i.length)%i.length;i[t];!function(e){if(e<0||e>=i.length)return!1;const t=i[e],n=document.getElementById("localShaderList");if(!n)return!1;const o=n.querySelector(`[data-local-index="${t.index}"]`);!!o&&o.click()}(t)}function m(e){if(!e.key)return;const t=e.key.toLowerCase();o.add(t),o.has("p")&&("ArrowRight"===e.key?(e.preventDefault(),d("next")):"ArrowLeft"===e.key&&(e.preventDefault(),d("prev"))),o.has("l")&&("ArrowRight"===e.key?(e.preventDefault(),u("next")):"ArrowLeft"===e.key&&(e.preventDefault(),u("prev")))}function h(e){if(!e||"string"!=typeof e.key)return;const t=e.key.toLowerCase();o.delete(t)}async function p(){await new Promise((e=>{const t=setInterval((()=>{document.getElementById("shaderWindow")&&(clearInterval(t),e())}),100)})),setTimeout((()=>{document.addEventListener("keydown",m),document.addEventListener("keyup",h),window.addEventListener("blur",(()=>{o.clear()})),s()}),500)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p(),window.shaderKeyboardNav={updateShaderLists:s,navigatePublicShaders:d,navigateLocalShaders:u,getStatus:()=>({publicShaders:n.length,localShaders:i.length,publicIndex:e,localIndex:t,publicList:n,localList:i,rateLimitStatus:{lastLoad:a.lastLoad,recentLoads:a.loadTimes.length,canLoadNow:r().allowed}})}})();var h;new MutationObserver(((e,t)=>{document.getElementById("preview-panel")&&(t.disconnect(),(()=>{function e(){const e=document.getElementById("preview-panel");e.style.position="relative";const t=document.getElementById("glcanvas"),n=document.createElement("canvas");n.id="canvas3D",n.style.display="none",e.appendChild(n);const i=document.createElement("button");i.id="threeLoadBtn",i.textContent="3D",e.appendChild(i);const o=document.createElement("div");o.id="threedModalBg";const a=document.createElement("div");a.id="threedModal",a.innerHTML='\n      <h2>Load 3D Model</h2>\n      <div id="threedDropZone">\n        <p>Drag and drop a 3D model file here<br>or click to browse</p>\n        <div class="format-info">Supports: OBJ, PLY, STL, OFF</div>\n        <input type="file" id="objFileInput" accept=".obj,.ply,.stl,.off" hidden />\n      </div>\n      <div style="margin:10px 0; display:flex; gap:10px;">\n        <label class="checkbox-container">\n          <input type="checkbox" id="objCull" checked />\n          <span class="custom-checkbox"></span>\n          <span style="margin-left:5px;">Face Culling</span>\n        </label>\n        <label class="checkbox-container">\n          <input type="checkbox" id="objWire" />\n          <span class="custom-checkbox"></span>\n          <span style="margin-left:5px;">Wireframe</span>\n        </label>\n      </div>\n      <div id="threedInfo">No model loaded</div>\n      <div id="threedErr"></div>\n      <footer>\n        <button id="threedRevert">Revert Shaders</button>\n        <button id="threedClose">Cancel</button>\n      </footer>\n    ',o.appendChild(a),e.appendChild(o),i.onclick=()=>o.classList.add("show"),a.querySelector("#threedClose").onclick=()=>o.classList.remove("show");const s=a.querySelector("#threedDropZone"),r=a.querySelector("#objFileInput");return s.addEventListener("click",(()=>r.click())),s.addEventListener("dragover",(e=>{e.preventDefault(),s.classList.add("dragover")})),s.addEventListener("dragleave",(e=>{e.preventDefault(),s.classList.remove("dragover")})),s.addEventListener("drop",(e=>{e.preventDefault(),s.classList.remove("dragover"),e.dataTransfer.files.length&&(r.files=e.dataTransfer.files,r.dispatchEvent(new Event("change")))})),{canvas:n,originalCanvas:t,fileInput:r,cullChk:a.querySelector("#objCull"),wireChk:a.querySelector("#objWire"),info:a.querySelector("#threedInfo"),err:a.querySelector("#threedErr"),revertBtn:a.querySelector("#threedRevert"),hide:()=>o.classList.remove("show")}}function t(){const e=window.getCurrentAnimationType?.();return e&&"webgl"!==e?(window.switchToAnimationType?.("webgl"),new Promise((e=>setTimeout(e,100)))):Promise.resolve()}let n={vertex:"",fragment:""};const i={vertex:"attribute vec3 a_position, a_normal;\nuniform mat4 u_modelMatrix, u_viewMatrix, u_projectionMatrix;\nuniform mat3 u_normalMatrix;\nvarying vec3 v_normal, v_position;\nvoid main() {\n  vec4 worldPosition = u_modelMatrix * vec4(a_position, 1.0);\n  v_position = worldPosition.xyz;\n  v_normal = normalize(u_normalMatrix * a_normal);\n  gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;\n}",fragment:"precision mediump float;\nvarying vec3 v_normal, v_position;\nuniform vec3 u_lightPosition, u_viewPosition;\nuniform bool u_wireframe;\nuniform float u_time;\nvoid main() {\n  vec3 normal = normalize(v_normal);\n  vec3 lightDir = normalize(u_lightPosition - v_position);\n  vec3 viewDir = normalize(u_viewPosition - v_position);\n  vec3 reflectDir = reflect(-lightDir, normal);\n  float ambient = 0.3;\n  float diffuse = max(dot(normal, lightDir), 0.0);\n  float specular = pow(max(dot(viewDir, reflectDir), 0.0), 32.0) * 0.5;\n  vec3 base = u_wireframe ? vec3(0.0, 1.0, 0.0) : vec3(0.7, 0.8, 1.0);\n  vec3 timeColor = vec3(\n    0.5 + 0.5 * sin(u_time * 0.8),\n    0.5 + 0.5 * sin(u_time * 1.2 + 2.0),\n    0.5 + 0.5 * sin(u_time * 0.6 + 4.0)\n  );\n  vec3 color = u_wireframe \n    ? base \n    : mix(base, timeColor * 0.3 + base, 0.3) * (ambient + diffuse) + vec3(1.0) * specular;\n  gl_FragColor = vec4(color, 1.0);\n}"};function o(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&(n.vertex=e.value,n.fragment=t.value)}function a(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&(e.value=i.vertex,t.value=i.fragment,window.rebuildProgram&&window.rebuildProgram())}function s(){const e=document.getElementById("vertCode"),t=document.getElementById("fragCode");e&&t&&n.vertex&&n.fragment&&(e.value=n.vertex,t.value=n.fragment,window.rebuildProgram&&window.rebuildProgram())}window.is3DModelActive=function(){return!0===window.objCanvasActive},window.deactivate3DModel=function(){x&&(x=null),C=null,b(E),window.objCanvasActive=!1};const r={identity:()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],perspective:(e,t,n,i)=>{const o=1/Math.tan(e/2),a=1/(n-i);return[o/t,0,0,0,0,o,0,0,0,0,(i+n)*a,-1,0,0,2*i*n*a,0]},lookAt:(e,t,n)=>{const i=l.normalize(l.sub(t,e)),o=l.normalize(l.cross(i,n)),a=l.cross(o,i);return[o[0],a[0],-i[0],0,o[1],a[1],-i[1],0,o[2],a[2],-i[2],0,-l.dot(o,e),-l.dot(a,e),l.dot(i,e),1]},rotateX:e=>{const t=Math.cos(e),n=Math.sin(e);return[1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1]},rotateY:e=>{const t=Math.cos(e),n=Math.sin(e);return[t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1]},scale:(e,t=e,n=e)=>[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1],multiply:(e,t)=>{const n=new Array(16).fill(0);for(let i=0;i<4;i++)for(let o=0;o<4;o++)for(let a=0;a<4;a++)n[4*i+o]+=e[4*i+a]*t[4*a+o];return n}},l={normalize:e=>{const t=Math.hypot(e[0],e[1],e[2]);return t>1e-5?[e[0]/t,e[1]/t,e[2]/t]:[0,0,1]},sub:(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],cross:(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]};function c(e,t,n=!0){return e.getFloat32(t,n)}function d(e,t,n=!0){return e.getUint32(t,n)}function u(e,t){return e.getUint8(t)}function m(e){const t=[],n=[],i=[];return e.split(/\r?\n/).forEach((e=>{const o=e.trim().split(/\s+/);if("v"===o[0]&&t.push(o.slice(1).map(Number)),"vn"===o[0]&&n.push(o.slice(1).map(Number)),"f"===o[0]){const e=o.slice(1).map((e=>{const[t,,n]=e.split("/");return{v:+t-1,n:n?+n-1:-1}}));e.length>=3&&i.push(e)}})),v(t,n,i,"OBJ")}function h(e){const t="string"==typeof e;let n,i,o=0,a=0,s="ascii";t?(n=e.split(/\r?\n/),i=n.findIndex((e=>"end_header"===e.trim()))):(n=(new TextDecoder).decode(e.slice(0,1e3)).split(/\r?\n/),i=n.findIndex((e=>"end_header"===e.trim())));for(let e=0;e<=i;e++){const t=n[e].trim();t.startsWith("format")?s=t.includes("binary")?"binary":"ascii":t.startsWith("element vertex")?o=parseInt(t.split(" ")[2]):t.startsWith("element face")&&(a=parseInt(t.split(" ")[2]))}const r=[],l=[];if("ascii"===s&&t){let e=i+1;for(let t=0;t<o;t++){const t=n[e++].trim().split(/\s+/).map(Number);r.push([t[0],t[1],t[2]])}for(let t=0;t<a;t++){const t=n[e++].trim().split(/\s+/).map(Number),i=t[0],o=[];for(let e=1;e<=i;e++)o.push({v:t[e],n:-1});o.length>=3&&l.push(o)}}else if("binary"===s&&!t){const t=(new TextEncoder).encode(n.slice(0,i+1).join("\n")+"\n").length,s=new DataView(e.buffer||e);let m=t;for(let e=0;e<o;e++){const e=c(s,m),t=c(s,m+4),n=c(s,m+8);r.push([e,t,n]),m+=12}for(let e=0;e<a;e++){const e=u(s,m++),t=[];for(let n=0;n<e;n++)t.push({v:d(s,m),n:-1}),m+=4;t.length>=3&&l.push(t)}}return v(r,[],l,"PLY")}function p(e){const t="string"==typeof e,n=[],i=[];let o=new Map,a=0;function s(e,t,i){const s=`${e.toFixed(6)},${t.toFixed(6)},${i.toFixed(6)}`;return o.has(s)?o.get(s):(o.set(s,a),n.push([e,t,i]),a++)}if(t){const t=e.split(/\r?\n/);let n=[];for(const e of t){const t=e.trim();if(t.startsWith("vertex")){const e=t.split(/\s+/).slice(1).map(Number),o=s(e[0],e[1],e[2]);n.push({v:o,n:-1}),3===n.length&&(i.push([...n]),n=[])}}}else{const t=new DataView(e.buffer||e),n=d(t,80);let o=84;for(let e=0;e<n;e++){o+=12;const e=[];for(let n=0;n<3;n++){const n=s(c(t,o),c(t,o+4),c(t,o+8));e.push({v:n,n:-1}),o+=12}i.push(e),o+=2}}return v(n,[],i,"STL")}function g(e){const t=e.split(/\r?\n/).filter((e=>e.trim()&&!e.trim().startsWith("#")));let n=0;"OFF"===t[n].trim()&&n++;const i=t[n++].trim().split(/\s+/).map(Number),o=i[0],a=i[1],s=[],r=[];for(let e=0;e<o;e++){const e=t[n++].trim().split(/\s+/).map(Number);s.push([e[0],e[1],e[2]])}for(let e=0;e<a;e++){const e=t[n++].trim().split(/\s+/).map(Number),i=e[0],o=[];for(let t=1;t<=i;t++)o.push({v:e[t],n:-1});o.length>=3&&r.push(o)}return v(s,[],r,"OFF")}function v(e,t,n,i){const o=[],a=[],s=[];let r=0;n.forEach((n=>{for(let i=1;i<n.length-1;i++)[n[0],n[i],n[i+1]].forEach((c=>{const d=e[c.v],u=c.n>=0&&t[c.n]?t[c.n]:(()=>{const t=e[n[0].v],o=e[n[i].v],a=e[n[i+1].v];return l.normalize(l.cross(l.sub(o,t),l.sub(a,t)))})();o.push(...d),a.push(...u),s.push(r++)}))}));const c=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(let e=0;e<o.length;e+=3)c[0]=Math.min(c[0],o[e]),c[1]=Math.min(c[1],o[e+1]),c[2]=Math.min(c[2],o[e+2]),d[0]=Math.max(d[0],o[e]),d[1]=Math.max(d[1],o[e+1]),d[2]=Math.max(d[2],o[e+2]);const u=[(c[0]+d[0])/2,(c[1]+d[1])/2,(c[2]+d[2])/2],m=2/Math.max(d[0]-c[0],d[1]-c[1],d[2]-c[2]);for(let e=0;e<o.length;e+=3)o[e]=(o[e]-u[0])*m,o[e+1]=(o[e+1]-u[1])*m,o[e+2]=(o[e+2]-u[2])*m;return{verts:o,norms:a,idxs:s,stats:{vertices:e.length,faces:n.length,triangles:s.length/3,format:i}}}function f(e,t){const n=e.name.toLowerCase().split(".").pop();try{switch(n){case"obj":return m(t);case"ply":return h(t);case"stl":return p(t);case"off":return g(t);default:throw new Error(`Unsupported format: ${n}`)}}catch(e){throw new Error(`Failed to parse ${n.toUpperCase()} file: ${e.message}`)}}function w(e){const t=e.getContext("webgl");if(!t)throw new Error("WebGL unavailable");let n=null;const i={},o=(e,n)=>{const i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(i));return i},a=()=>{const e=document.getElementById("vertCode"),a=document.getElementById("fragCode");if(!e||!a)return!1;try{if(n&&t.deleteProgram(n),n=t.createProgram(),t.attachShader(n,o(t.VERTEX_SHADER,e.value)),t.attachShader(n,o(t.FRAGMENT_SHADER,a.value)),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(n));return t.useProgram(n),i.attrPos=t.getAttribLocation(n,"a_position"),i.attrNorm=t.getAttribLocation(n,"a_normal"),i.uniM=t.getUniformLocation(n,"u_modelMatrix"),i.uniV=t.getUniformLocation(n,"u_viewMatrix"),i.uniP=t.getUniformLocation(n,"u_projectionMatrix"),i.uniN=t.getUniformLocation(n,"u_normalMatrix"),i.uniL=t.getUniformLocation(n,"u_lightPosition"),i.uniU=t.getUniformLocation(n,"u_viewPosition"),i.uniW=t.getUniformLocation(n,"u_wireframe"),i.uniTime=t.getUniformLocation(n,"u_time"),!0}catch(e){return!1}};return a(),{gl:t,updateProgram:a,getLocations:()=>i}}function y(e){e.originalCanvas&&(e.originalCanvas.style.display="none"),e.canvas.style.display="block",window.objCanvasActive=!0}function b(e){e.canvas.style.display="none",e.originalCanvas&&(e.originalCanvas.style.display="block"),window.objCanvasActive=!1}const E=e();let C=null,x=null;const S={drag:!1,last:[0,0],rot:[0,0],zoom:1};let L=performance.now();o(),E.revertBtn.addEventListener("click",(()=>{s(),b(E),x&&(x=null),C=null,E.fileInput.value="",E.info.textContent="Reverted to original shaders",E.hide()}));const k=document.getElementById("vertCode"),T=document.getElementById("fragCode");function A(){const e=E.canvas;e.style.width="100%",e.style.height="100%",e.width=e.clientWidth,e.height=e.clientHeight,x=w(e);const t=x.gl;x.bV=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,x.bV),t.bufferData(t.ARRAY_BUFFER,new Float32Array(C.verts),t.STATIC_DRAW),x.bN=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,x.bN),t.bufferData(t.ARRAY_BUFFER,new Float32Array(C.norms),t.STATIC_DRAW);const n=t.getExtension("OES_element_index_uint")&&C.idxs.length>65535,i=n?new Uint32Array(C.idxs):new Uint16Array(C.idxs);x.bI=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,x.bI),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),C.indexType=n?t.UNSIGNED_INT:t.UNSIGNED_SHORT,C.indexCount=i.length,t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),e.addEventListener("mousedown",(e=>{S.drag=!0,S.last=[e.clientX,e.clientY]})),window.addEventListener("mousemove",(e=>{S.drag&&(S.rot[0]+=.01*(e.clientY-S.last[1]),S.rot[1]+=.01*(e.clientX-S.last[0]),S.last=[e.clientX,e.clientY])})),window.addEventListener("mouseup",(()=>S.drag=!1)),e.addEventListener("wheel",(e=>{e.preventDefault(),S.zoom*=e.deltaY>0?1.1:.9,S.zoom=Math.min(Math.max(S.zoom,.1),10)})),window.addEventListener("resize",(()=>{e.width=e.clientWidth,e.height=e.clientHeight})),requestAnimationFrame(I)}function I(){if(!x||!C)return;const e=x.gl,t=x.getLocations();e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);const n=r.multiply(r.rotateY(S.rot[1]),r.multiply(r.rotateX(S.rot[0]),r.scale(S.zoom))),i=r.lookAt([0,0,3],[0,0,0],[0,1,0]),o=r.perspective(Math.PI/3,e.canvas.width/e.canvas.height,.01,1e3),a=[n[0],n[1],n[2],n[4],n[5],n[6],n[8],n[9],n[10]];t.uniM&&e.uniformMatrix4fv(t.uniM,!1,n),t.uniV&&e.uniformMatrix4fv(t.uniV,!1,i),t.uniP&&e.uniformMatrix4fv(t.uniP,!1,o),t.uniN&&e.uniformMatrix3fv(t.uniN,!1,a),t.uniL&&e.uniform3fv(t.uniL,[5,5,5]),t.uniU&&e.uniform3fv(t.uniU,[0,0,3]),t.uniW&&e.uniform1i(t.uniW,E.wireChk.checked?1:0),t.uniTime&&e.uniform1f(t.uniTime,.001*(performance.now()-L)),E.cullChk.checked?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),t.attrPos>=0&&(e.bindBuffer(e.ARRAY_BUFFER,x.bV),e.enableVertexAttribArray(t.attrPos),e.vertexAttribPointer(t.attrPos,3,e.FLOAT,!1,0,0)),t.attrNorm>=0&&(e.bindBuffer(e.ARRAY_BUFFER,x.bN),e.enableVertexAttribArray(t.attrNorm),e.vertexAttribPointer(t.attrNorm,3,e.FLOAT,!1,0,0)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,x.bI),e.drawElements(e.TRIANGLES,C.indexCount,C.indexType,0),requestAnimationFrame(I)}k&&T&&[k,T].forEach((e=>{e.addEventListener("input",(()=>{x&&x.updateProgram()}))})),E.fileInput.addEventListener("change",(async e=>{const n=e.target.files[0];if(!n)return;E.err.style.display="none",E.info.textContent="Loading...",window.cameraSystem?.isActive&&(await window.cameraSystem.stopCamera(),await new Promise((e=>setTimeout(e,250)))),await t();const i=n.name.toLowerCase().split(".").pop(),o=["stl","ply"].includes(i),s=new FileReader;s.onload=()=>{try{C=f(n,s.result),y(E),a(),A(),E.info.textContent=`Format: ${C.stats.format} | Verts: ${C.stats.vertices} | Faces: ${C.stats.faces} | Triangles: ${C.stats.triangles}`,E.hide()}catch(e){E.err.textContent=e.message,E.err.style.display="block",E.info.textContent="Failed to load model"}},o?s.readAsArrayBuffer(n):s.readAsText(n)}))})())})).observe(document.body,{childList:!0,subtree:!0}),function(){let e=!1,t={vertex:"",fragment:""},n=null,i=null,o=null,a=Date.now(),s={x:0,y:0,clickX:0,clickY:0,isPressed:!1,lastClickTime:0},r={bass:0,mid:0,treble:0,volume:0};window.jsCanvasState={isJSMode:()=>e,getCanvas:()=>i,getContext:()=>o,getAudioData:()=>r};function l(){if(!e&&window.webgpuState&&window.webgpuState.isWebGPUMode()){const e=document.getElementById("webgpuToggle");return e&&e.click(),void setTimeout((()=>l()),200)}if(!e&&window.is3DModelActive?.()&&window.deactivate3DModel?.(),!e&&window.cameraSystem?.isActive)return void window.cameraSystem.stopCamera().then((()=>{setTimeout((()=>l()),250)}));const r=$("jsToggleBtn"),u=$("vertPanel"),m=$("fragPanel"),h=$("rowDivider"),p=$("glcanvas"),g=$("vertCode"),v=$("fragCode");if(e){e=!1,n&&(cancelAnimationFrame(n),n=null),r.innerHTML="JS",r.title="Switch to JavaScript Mode",r.classList.remove("active"),m.style.removeProperty("display"),h.style.removeProperty("display"),u.style.height="50%",m.style.height="50%";u.querySelector(".panel-header span").textContent="Vertex Shader",g.value=t.vertex,v.value=t.fragment,p.style.display="block",i&&(i.resizeObserver&&i.resizeObserver.disconnect(),i.remove(),i=null,o=null),window.rebuildProgram&&window.rebuildProgram()}else{e=!0,t.vertex=g.value,t.fragment=v.value,r.innerHTML="GL",r.title="Switch back to WebGL Mode",r.classList.add("active"),m.style.display="none",h.style.display="none",u.style.height="100%";u.querySelector(".panel-header span").textContent="JavaScript Animation",g.value="// JavaScript Canvas Animation with Audio Reactivity\n// Available variables: ctx, width, height, time, mouse, audio\n// ctx - 2D canvas context\n// width, height - canvas dimensions  \n// time - elapsed time in seconds\n// mouse - {x, y, clickX, clickY, isPressed, lastClickTime}\n// audio - {bass, mid, treble, volume} (0.0-1.0)\n// Clear with audio-reactive transparency\nctx.fillStyle = `rgba(0, 0, 0, ${0.05 + audio.volume * 0.15})`;\nctx.fillRect(0, 0, width, height);\n// Audio-reactive gradient\nconst centerX = width / 2 + Math.sin(time + audio.bass * 10) * (50 + audio.treble * 100);\nconst centerY = height / 2 + Math.cos(time * 0.7 + audio.mid * 8) * (40 + audio.bass * 80);\nconst gradient = ctx.createRadialGradient(\n    centerX, centerY, 20 + audio.volume * 80,\n    width / 2, height / 2, \n    Math.max(width, height) / 2 * (1 + audio.volume * 0.5)\n);\ngradient.addColorStop(0, `hsl(${(time * 20 + audio.bass * 180) % 360}, ${70 + audio.mid * 30}%, ${60 + audio.treble * 30}%)`);\ngradient.addColorStop(1, `hsl(${(time * 20 + 180 + audio.treble * 180) % 360}, ${50 + audio.volume * 30}%, 20%)`);\nctx.fillStyle = gradient;\nctx.fillRect(0, 0, width, height);\n// Audio-reactive particles\nconst particleCount = 8 + Math.floor(audio.volume * 12);\nfor (let i = 0; i < particleCount; i++) {\n    const angle = (time + i * 0.5 + audio.bass * 5) * (0.8 + audio.mid * 2);\n    const distance = 100 + i * 20 + audio.treble * 150;\n    const x = width / 2 + Math.cos(angle) * distance;\n    const y = height / 2 + Math.sin(angle) * distance * 0.8;\n    const radius = 20 + Math.sin(time * 2 + i + audio.volume * 10) * (10 + audio.bass * 20);\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, Math.PI * 2);\n    ctx.fillStyle = `hsla(${(time * 30 + i * 45 + audio.treble * 120) % 360}, ${80 + audio.mid * 20}%, ${70 + audio.volume * 20}%, ${0.6 + audio.volume * 0.4})`;\n    ctx.fill();\n    // Audio-reactive glow effect\n    if (audio.volume > 0.3) {\n        ctx.shadowColor = ctx.fillStyle;\n        ctx.shadowBlur = 20 + audio.volume * 30;\n        ctx.fill();\n        ctx.shadowBlur = 0;\n    }\n}\n// Mouse interaction with audio influence\nif (mouse.isPressed) {\n    const rippleTime = (Date.now() - mouse.lastClickTime) / 1000;\n    const baseRadius = rippleTime * 200;\n    const audioRadius = baseRadius * (1 + audio.volume * 2);\n    const alpha = Math.max(0, 1 - rippleTime);\n    if (alpha > 0) {\n        ctx.beginPath();\n        ctx.arc(mouse.clickX, mouse.clickY, audioRadius, 0, Math.PI * 2);\n        ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * (0.5 + audio.volume * 0.5)})`;\n        ctx.lineWidth = 3 + audio.bass * 5;\n        ctx.stroke();\n        // Secondary ripple with different frequency\n        ctx.beginPath();\n        ctx.arc(mouse.clickX, mouse.clickY, audioRadius * 0.6, 0, Math.PI * 2);\n        ctx.strokeStyle = `rgba(${255 * audio.bass}, ${255 * audio.mid}, ${255 * audio.treble}, ${alpha * 0.3})`;\n        ctx.lineWidth = 1;\n        ctx.stroke();\n    }\n}\n// Mouse cursor with audio visualization\nif (mouse.x > 0 && mouse.y > 0) {\n    const cursorRadius = 30 + Math.sin(time * 3) * 10 + audio.volume * 40;\n    ctx.beginPath();\n    ctx.arc(mouse.x, mouse.y, cursorRadius, 0, Math.PI * 2);\n    ctx.strokeStyle = `hsla(${(time * 50 + audio.bass * 180) % 360}, 100%, ${80 + audio.treble * 20}%, ${0.6 + audio.mid * 0.4})`;\n    ctx.lineWidth = 2 + audio.volume * 4;\n    ctx.stroke();\n    // Inner audio visualization\n    for (let i = 0; i < 4; i++) {\n        const audioValue = [audio.bass, audio.mid, audio.treble, audio.volume][i];\n        const angle = (time * 2 + i * Math.PI / 2) + audioValue * 10;\n        const innerRadius = 10 + audioValue * 15;\n        const innerX = mouse.x + Math.cos(angle) * innerRadius;\n        const innerY = mouse.y + Math.sin(angle) * innerRadius;\n        ctx.beginPath();\n        ctx.arc(innerX, innerY, 3 + audioValue * 5, 0, Math.PI * 2);\n        const colors = ['#ff4444', '#44ff44', '#4444ff', '#ffff44'];\n        ctx.fillStyle = colors[i];\n        ctx.fill();\n    }\n}",p.style.display="none",function(){const e=$("preview-panel");i=document.createElement("canvas"),i.id="jsCanvas",e.appendChild(i),o=i.getContext("2d"),c()}(),function(){if(!i)return;const e=e=>{const t=i.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}};i.addEventListener("mousemove",(t=>{const n=e(t);s.x=n.x,s.y=n.y})),i.addEventListener("mousedown",(t=>{const n=e(t);s.isPressed=!0,s.clickX=n.x,s.clickY=n.y,s.lastClickTime=Date.now()})),i.addEventListener("mouseup",(()=>{s.isPressed=!1})),i.addEventListener("mouseleave",(()=>{s.isPressed=!1}))}(),function(){if(!i)return;const t=new ResizeObserver((()=>{e&&c()})),n=$("preview-panel");t.observe(n),i.resizeObserver=t}(),a=Date.now(),d()}}function c(){if(!i)return;const e=$("preview-panel").getBoundingClientRect(),t=e.width,n=e.height;i.width===t&&i.height===n||(i.width=t,i.height=n,s.x=0,s.y=0)}function d(){if(!e||!i||!o)return;!function(){if(window.audioReactiveInstance&&window.audioReactiveInstance.analyser&&window.audioReactiveInstance.isActive){const e=window.audioReactiveInstance.analyser,t=window.audioReactiveInstance.sensitivity,n=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(n);const i=(e,t,i,o=1)=>Math.min(1,n.slice(e,t).reduce(((e,t)=>e+t))/(t-e)/255*i*o);r={bass:i(0,20,t.bass,.4),mid:i(20,60,t.mid),treble:i(60,120,t.treble),volume:i(0,n.length,t.volume)}}else r={bass:0,mid:0,treble:0,volume:0}}();const t=$("vertCode"),l=(Date.now()-a)/1e3,u=i.width,m=i.height;0!==u&&0!==m||c();try{const e=`\n                try {\n                    ${t.value}\n                } catch (e) {\n                    ctx.fillStyle = 'var(--r)';\n                    ctx.font = '14px monospace';\n                    ctx.fillText('Error: ' + e.message, 10, 30);\n                    console.error('Animation error:', e);\n                }\n            `;new Function("ctx","width","height","time","mouse","audio",e)(o,u,m,l,s,r)}catch(e){o.fillStyle="#ff0000",o.font="14px monospace",o.fillText("Error: "+e.message,10,30)}n=requestAnimationFrame(d)}function u(){const t=()=>{if(!$("preview-panel")||!$("vertCode"))return void setTimeout(t,100);!function(){const e=document.createElement("button");e.id="jsToggleBtn",e.innerHTML="JS",e.title="JavaScript Canvas Mode",e.addEventListener("click",l);const t=$("preview-panel");t.classList.add("preview-panel-relative"),t.appendChild(e)}(),function(){let t;$("vertCode").addEventListener("input",(()=>{e&&(clearTimeout(t),t=setTimeout((()=>{}),100))}))}();const n=new MutationObserver((()=>{if(e){const e=$("vertPanel");e&&"100%"!==e.style.height&&(e.style.height="100%")}}));setTimeout((()=>{const e=$("vertPanel");e&&n.observe(e,{attributes:!0,attributeFilter:["style"]})}),1e3)};t()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}(),function(){const e='\n<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">\n  <rect x="3" y="7" width="18" height="13" rx="2"/>\n  <path d="M8 7l1.5-2h5L16 7"/>\n  <circle cx="12" cy="13.5" r="3.5"/>\n</svg>\n';class t{constructor(){this.stream=null,this.video=null,this.texture=null,this.isActive=!1,this.devices=[],this.currentDeviceId=null,this.gl=null,this.program=null,this.originalFragCode=null,this.originalVertCode=null,this.autoInjectShader=!0,this.cameraRenderLoopId=null,this.originalRenderFn=null,this.originalRebuildFn=null,this.createUI(),this.setupEventListeners(),this.enumerateDevices()}getCameraFragmentShader(){return"#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform float u_time;\nuniform vec2 u_resolution;\nuniform sampler2D u_camera;\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / u_resolution.xy;\n    uv.x = 1.0 - uv.x;\n    uv.y = 1.0 - uv.y;\n    vec4 cameraColor = texture2D(u_camera, uv);\n    gl_FragColor = vec4(cameraColor.rgb, 1.0);\n}"}getCameraVertexShader(){return"attribute vec2 a_position;\nvoid main() {\n  gl_Position = vec4(a_position, 0., 1.);\n}"}createUI(){this.cameraBtn||(this.cameraBtn=document.createElement("button"),this.cameraBtn.className="camera-btn",this.cameraBtn.innerHTML=`${e}`,this.cameraBtn.title="Webcam Support");const t=document.fullscreenElement||document.body;t.contains(this.cameraBtn)||t.appendChild(this.cameraBtn),this.modal||(this.modal=document.createElement("div"),this.modal.className="camera-modal",this.modal.innerHTML='\n                    <div class="camera-content">\n                        <div class="camera-header">\n                            <h3>Webcam Setup</h3>\n                            <button class="camera-close">×</button>\n                        </div>\n                        <video class="camera-preview" id="cameraPreview" autoplay muted playsinline></video>\n                        <div class="camera-controls">\n                            <select class="camera-device-select" id="cameraDeviceSelect">\n                                <option value="">Select Camera...</option>\n                            </select>\n                            <div class="camera-auto-inject">\n                                <label>\n                                    <input type="checkbox" id="autoInjectCheckbox" checked>\n                                    Auto-inject camera preview shader\n                                </label>\n                            </div>\n                            <div class="camera-buttons">\n                                <button class="camera-control-btn" id="startCameraBtn">Start Camera</button>\n                                <button class="camera-control-btn stop" id="stopCameraBtn" disabled>Stop Camera</button>\n                            </div>\n                            <div class="camera-status" id="cameraStatus">Camera not active</div>\n                        </div>\n                        <div class="camera-info">\n                            <h4>Using Camera in Shaders:</h4>\n                            <p>Once enabled, use <code>uniform sampler2D u_camera;</code> to access the webcam texture in your fragment shader.</p>\n                            <p>Example: <code>vec4 camColor = texture2D(u_camera, uv);</code></p>\n                            <p><strong>Note:</strong> Camera texture coordinates are flipped horizontally by default for mirror effect.</p>\n                            <p><strong>Auto-inject:</strong> When enabled, starting the camera will temporarily replace your fragment shader with a camera preview. Stopping the camera restores your original code.</p>\n                        </div>\n                    </div>\n                ',document.body.appendChild(this.modal)),this.preview=document.getElementById("cameraPreview"),this.deviceSelect=document.getElementById("cameraDeviceSelect"),this.startBtn=document.getElementById("startCameraBtn"),this.stopBtn=document.getElementById("stopCameraBtn"),this.status=document.getElementById("cameraStatus"),this.closeBtn=this.modal.querySelector(".camera-close"),this.autoInjectCheckbox=document.getElementById("autoInjectCheckbox"),document.addEventListener("fullscreenchange",(()=>{const e=document.fullscreenElement||document.body;this.cameraBtn.parentNode&&this.cameraBtn.parentNode.removeChild(this.cameraBtn),e.appendChild(this.cameraBtn)}))}setupEventListeners(){this.cameraBtn.addEventListener("click",(()=>this.openModal())),this.closeBtn.addEventListener("click",(()=>this.closeModal())),this.startBtn.addEventListener("click",(()=>this.startCamera())),this.stopBtn.addEventListener("click",(()=>this.stopCamera())),this.autoInjectCheckbox.addEventListener("change",(e=>{this.autoInjectShader=e.target.checked})),this.deviceSelect.addEventListener("change",(e=>{this.currentDeviceId=e.target.value,this.isActive&&this.startCamera()})),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.closeModal()})),this.setupShaderIntegration(),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.modal.classList.contains("show")&&this.closeModal()}))}async enumerateDevices(){try{const e=await navigator.mediaDevices.enumerateDevices();this.devices=e.filter((e=>"videoinput"===e.kind)),this.deviceSelect.innerHTML='<option value="">Select Camera...</option>',this.devices.forEach((e=>{const t=document.createElement("option");t.value=e.deviceId,t.textContent=e.label||`Camera ${this.devices.indexOf(e)+1}`,this.deviceSelect.appendChild(t)})),0===this.devices.length&&(this.status.textContent="No cameras found",this.status.className="camera-error")}catch(e){this.status.textContent="Error accessing camera devices",this.status.className="camera-error"}}injectCameraShader(){const e=document.getElementById("fragCode"),t=document.getElementById("vertCode");e&&this.autoInjectShader&&(null===this.originalFragCode&&(this.originalFragCode=e.value),t&&null===this.originalVertCode&&(this.originalVertCode=t.value),e.value=this.getCameraFragmentShader(),t&&(t.value=this.getCameraVertexShader()),this.uniformWarningShown=!1,window.rebuildProgram&&(window.rebuildProgram(),setTimeout((()=>{this.isActive&&(this.createTexture(),setTimeout((()=>this.bindTexture()),100))}),100)))}restoreOriginalShader(){const e=document.getElementById("fragCode"),t=document.getElementById("vertCode");e&&null!==this.originalFragCode&&this.autoInjectShader&&(e.value=this.originalFragCode,this.originalFragCode=null),t&&null!==this.originalVertCode&&this.autoInjectShader&&(t.value=this.originalVertCode,this.originalVertCode=null),window.rebuildProgram&&window.rebuildProgram()}forceAnimationReset(){window.pauseAnimation&&"function"==typeof window.pauseAnimation&&window.pauseAnimation(),this.gl&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.flush(),this.gl.finish()),setTimeout((()=>{window.resumeAnimation&&"function"==typeof window.resumeAnimation?window.resumeAnimation():window.render&&"function"==typeof window.render&&window.render()}),150)}cancelCameraRenderLoop(){this.cameraRenderLoopId&&(cancelAnimationFrame(this.cameraRenderLoopId),this.cameraRenderLoopId=null)}async startCamera(){try{const t=window.getCurrentAnimationType?.();t&&"webgl"!==t&&(window.switchToAnimationType?.("webgl"),await new Promise((e=>setTimeout(e,300)))),this.stream&&this.stopCamera();const n={video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}}};this.currentDeviceId&&(n.video.deviceId={exact:this.currentDeviceId}),this.stream=await navigator.mediaDevices.getUserMedia(n),this.preview.srcObject=this.stream,await new Promise(((e,t)=>{this.preview.onloadedmetadata=()=>e(),this.preview.onerror=e=>t(e)})),await this.preview.play(),this.isActive=!0,this.cameraBtn.classList.add("active"),this.cameraBtn.innerHTML=`${e}`,this.startBtn.disabled=!0,this.stopBtn.disabled=!1,this.status.textContent=`Camera active (${this.preview.videoWidth}x${this.preview.videoHeight})`,this.status.className="camera-status",this.gl||this.initGL(),this.createTexture(),this.injectCameraShader();const i=()=>{this.isActive?(this.updateTexture(),this.bindTexture(),window.render&&window.render(),this.cameraRenderLoopId=requestAnimationFrame(i)):this.cameraRenderLoopId=null};this.cameraRenderLoopId=requestAnimationFrame(i)}catch(t){this.status.textContent=`Error: ${t.message}`,this.status.className="camera-error",this.isActive=!1,this.cameraBtn.classList.remove("active"),this.cameraBtn.innerHTML=`${e}`}}async stopCamera(){if(this.isActive||this.stream){if(this.cancelCameraRenderLoop(),this.isActive=!1,this.gl&&this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.deleteTexture(this.texture),this.texture=null),this.stream){for(const e of this.stream.getTracks())try{e.stop()}catch(e){}this.stream=null}this.preview&&(this.preview.pause(),this.preview.removeAttribute("src"),this.preview.srcObject=null,await new Promise((e=>setTimeout(e,100)))),this.cameraBtn.classList.remove("active"),this.startBtn.disabled=!1,this.stopBtn.disabled=!0,this.status.textContent="Camera stopped",this.status.className="camera-status",this.restoreOriginalShader(),requestAnimationFrame((()=>this.forceAnimationReset()))}}openModal(){(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.body).appendChild(this.modal),this.modal.classList.add("show"),this.devices.length||this.enumerateDevices()}closeModal(){this.modal.classList.remove("show")}createTexture(){this.gl&&this.preview&&(this.texture&&this.gl.deleteTexture(this.texture),this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR))}updateTexture(){if(this.gl&&this.texture&&this.preview&&this.isActive){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture);try{this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.preview)}catch(e){}}}bindTexture(){if(!this.gl||!this.texture||!this.isActive)return!1;if(this.program&&window.uniforms){const e=["u_camera","uCamera","iCamera","camera"];for(const t of e)if(window.uniforms[t])return this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.uniform1i(window.uniforms[t].loc,0),!0}return!1}setupShaderIntegration(){this.originalRenderFn=window.render,this.originalRebuildFn=window.rebuildProgram,this.originalRenderFn&&(window.render=()=>{this.isActive&&this.gl&&this.program&&(this.updateTexture(),this.bindTexture()),this.originalRenderFn()}),this.originalRebuildFn&&(window.rebuildProgram=()=>{this.originalRebuildFn(),setTimeout((()=>{this.gl=window.gl||document.getElementById("glcanvas").getContext("webgl2")||document.getElementById("glcanvas").getContext("webgl"),this.program=window.program,this.isActive&&this.gl&&this.createTexture()}),10)})}initGL(){const e=document.getElementById("glcanvas");this.gl=e.getContext("webgl2")||e.getContext("webgl"),this.program=window.program}destroy(){this.stopCamera(),this.originalRenderFn&&(window.render=this.originalRenderFn),this.originalRebuildFn&&(window.rebuildProgram=this.originalRebuildFn),this.cameraBtn&&this.cameraBtn.parentNode&&this.cameraBtn.parentNode.removeChild(this.cameraBtn),this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal)}}function n(){document.getElementById("glcanvas")?(window.cameraSystem=new t,window.cameraSystem.initGL()):setTimeout(n,100)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.addEventListener("beforeunload",(e=>{window.cameraSystem&&window.cameraSystem.isActive&&window.cameraSystem.stream&&window.cameraSystem.stream.getTracks().forEach((e=>e.stop()))})),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&window.cameraSystem&&window.cameraSystem.isActive&&window.cameraSystem.stream&&window.cameraSystem.stream.getTracks().forEach((e=>e.stop()))}))}(),function(){if(document.getElementById("pm-root"))return;const e=document.createElement("button");e.id="pm-toggle-btn",e.title="Sequencer",e.innerHTML='\n    <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none"\n        xmlns="http://www.w3.org/2000/svg">\n      <path fill="currentColor" d="M8 5v14l11-7z"/>\n    </svg>\n  ',document.body.appendChild(e);const t=document.createElement("div");t.id="pm-root",t.style.display="none",t.innerHTML='\n    <div class="pm-header">\n      <div id="pm-controls">\n        <button class="pm-btn pm-small" id="pm-add-step">+ Step</button>\n        <button class="pm-btn pm-small" id="pm-play">Play ▶</button>\n        <button class="pm-btn pm-small" id="pm-pause" disabled>Pause ⏸</button>\n        <button class="pm-btn pm-small" id="pm-stop" disabled>Stop ◼</button>\n        <button class="pm-btn pm-small" id="pm-step-back">◀</button>\n        <button class="pm-btn pm-small" id="pm-step-forward">▶</button>\n        <label style="display:flex;align-items:center;gap:6px;margin-left:6px;">\n          <input type="checkbox" id="pm-loop"> Loop\n        </label>\n      </div>\n      <button class="pm-btn" id="pm-close">✕</button>\n    </div>\n    <div id="pm-body">\n      <div id="pm-steps-area">\n        <div class="pm-steps-row" id="pm-steps-row"></div>\n      </div>\n    </div>\n  ',document.body.appendChild(t);const n={root:t,stepsRow:t.querySelector("#pm-steps-row"),addBtn:t.querySelector("#pm-add-step"),playBtn:t.querySelector("#pm-play"),pauseBtn:t.querySelector("#pm-pause"),stopBtn:t.querySelector("#pm-stop"),stepBack:t.querySelector("#pm-step-back"),stepFwd:t.querySelector("#pm-step-forward"),loopChk:t.querySelector("#pm-loop"),closeBtn:t.querySelector("#pm-close"),toggleBtn:e},i=document.getElementById("vertCode"),o=document.getElementById("fragCode");let a=[],s=!1,r=!1,l=0,c=null,d=0,u=0,m=null,h=!1;const p=(()=>{let e=1;return()=>"pm-step-"+e++})();function g(e,t){const n=document.createElement("div");n.className="pm-step",n.dataset.stepId=e.id,n.innerHTML=`\n      <div class="pm-header">\n        <div>\n          <div class="pm-step-title">Step ${t+1}</div>\n        </div>\n        <div class="pm-actions">\n          <button class="pm-btn pm-small pm-copy">Copy</button>\n          <button class="pm-btn pm-small pm-dup">Dup</button>\n          <button class="pm-btn pm-small pm-remove">✕</button>\n        </div>\n      </div>\n      <label for="pm-vert-${e.id}">Vertex shader (step)</label>\n      <textarea id="pm-vert-${e.id}" name="pm-vert-${e.id}" class="pm-vert" spellcheck="false"></textarea>\n      <label for="pm-frag-${e.id}">Fragment shader (step)</label>\n      <textarea id="pm-frag-${e.id}" name="pm-frag-${e.id}" class="pm-frag" spellcheck="false"></textarea>\n      <div style="display:flex;justify-content:space-between;align-items:center;">\n        <div>\n          <label for="pm-delay-${e.id}" style="font-size:12px;color:#aaa">Delay (s)</label>\n          <input id="pm-delay-${e.id}" name="pm-delay-${e.id}" class="pm-delay" type="number" min="0" step="0.1" value="${e.delay}">\n        </div>\n      </div>\n    `,n.querySelector(".pm-vert").value=e.vert||"",n.querySelector(".pm-frag").value=e.frag||"",n.addEventListener("click",(t=>{t.target.closest("textarea, input, label, .pm-actions, .pm-remove, .pm-copy, .pm-dup")||w(e.id,{previewOnly:!0})})),n.querySelector(".pm-remove").addEventListener("click",(t=>{t.stopPropagation(),function(e){const t=a.findIndex((t=>t.id===e));if(-1===t)return;a.splice(t,1),s&&(t<l&&l--,t===l&&k());f()}(e.id)})),n.querySelector(".pm-copy").addEventListener("click",(e=>{e.stopPropagation(),y(n.querySelector(".pm-vert").value,n.querySelector(".pm-frag").value),I("Copied to main editors")})),n.querySelector(".pm-dup").addEventListener("click",(e=>{e.stopPropagation();v({vert:n.querySelector(".pm-vert").value,frag:n.querySelector(".pm-frag").value,delay:parseFloat(n.querySelector(".pm-delay").value)||1},t+1)}));const i=()=>{const t=e.id,i=a.find((e=>e.id===t));i&&(i.vert=n.querySelector(".pm-vert").value,i.frag=n.querySelector(".pm-frag").value,i.delay=parseFloat(n.querySelector(".pm-delay").value)||0)};return n.querySelector(".pm-vert").addEventListener("input",i),n.querySelector(".pm-frag").addEventListener("input",i),n.querySelector(".pm-delay").addEventListener("input",i),n}function v(e={vert:"",frag:"",delay:1},t=null){const n={id:p(),vert:e.vert||"",frag:e.frag||"",delay:"number"==typeof e.delay?e.delay:parseFloat(e.delay)||1};return null===t||t>=a.length?a.push(n):a.splice(t,0,n),f(),w(n.id,{previewOnly:!0}),n}function f(){if(n.stepsRow.innerHTML="",0===a.length){const e=document.createElement("div");return e.style.color="#777",e.style.padding="12px",e.innerText="No steps yet. Click + Step to add.",void n.stepsRow.appendChild(e)}a.forEach(((e,t)=>{const i=g(e,t);if(0!==t){const e=document.createElement("div");e.className="pm-arrow",e.innerHTML='\n          <svg width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">\n            <g fill="none" stroke="#7fbfff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <path d="M4 18 H26"></path>\n              <path d="M20 12 L28 18 L20 24"></path>\n            </g>\n          </svg>\n        ',n.stepsRow.appendChild(e)}n.stepsRow.appendChild(i)})),n.stepsRow.querySelectorAll(".pm-step").forEach(((e,t)=>{const n=e.querySelector(".pm-step-title");n&&(n.textContent=`Step ${t+1}`)})),b()}function w(e,{previewOnly:t=!1}={}){const n=a.findIndex((t=>t.id===e));if(-1===n)return;l=n;const i=a[n];y(i.vert,i.frag),b(),t||E(n)}function y(e,t){if(i&&(i.value=e,i.dispatchEvent(new Event("input",{bubbles:!0}))),o&&(o.value=t,o.dispatchEvent(new Event("input",{bubbles:!0}))),"function"==typeof window.rebuildProgram)try{window.rebuildProgram()}catch(e){}}function b(){Array.from(n.stepsRow.querySelectorAll(".pm-step")).forEach(((e,t)=>{e.classList.remove("pm-active","pm-future"),s?t<l||(t===l?e.classList.add("pm-active"):e.classList.add("pm-future")):t===l&&e.classList.add("pm-active")}))}function E(e=0){0!==a.length?(e<0&&(e=0),e>=a.length&&(e=a.length-1),s=!0,r=!1,l=e,h=n.loopChk.checked,n.playBtn.disabled=!0,n.pauseBtn.disabled=!1,n.stopBtn.disabled=!1,C(),b()):I("No steps to play")}function C(){T();const e=a[l];e?(y(e.vert,e.frag),d=Date.now(),u=d+Math.max(0,1e3*(e.delay||0)),m=null,c=e.delay<=0?setTimeout((()=>{x()}),20):setTimeout((()=>{x()}),Math.max(10,1e3*(e.delay||0))),b()):k()}function x(){T(),l++,l>=a.length?h?(l=0,C()):k():C()}function S(){s&&!r&&(r=!0,c?(m=Math.max(0,u-Date.now()),T()):m=null,n.pauseBtn.disabled=!0,n.playBtn.disabled=!1,b())}function L(){s&&r&&(r=!1,n.pauseBtn.disabled=!1,n.playBtn.disabled=!0,null!=m?(d=Date.now(),u=d+m,c=setTimeout((()=>{x()}),m),m=null,b()):C())}function k(){T(),s=!1,r=!1,l=0,n.playBtn.disabled=!1,n.pauseBtn.disabled=!0,n.stopBtn.disabled=!0,b()}function T(){c&&(clearTimeout(c),c=null)}let A=null;function I(e,t=1200){if(!document.getElementById("pm-toast")){const e=document.createElement("div");e.id="pm-toast",e.style.position="fixed",e.style.right="12px",e.style.bottom="12px",e.style.zIndex=1e5,e.style.background="rgba(0,0,0,0.7)",e.style.color="#fff",e.style.padding="8px 12px",e.style.borderRadius="8px",e.style.fontSize="13px",document.body.appendChild(e)}const n=document.getElementById("pm-toast");n.textContent=e,n.style.opacity="1",clearTimeout(A),A=setTimeout((()=>{n.style.opacity="0"}),t)}n.addBtn.addEventListener("click",(()=>v({vert:i?i.value:"",frag:o?o.value:"",delay:1}))),n.playBtn.addEventListener("click",(()=>{s?r&&L():E(l||0)})),n.pauseBtn.addEventListener("click",(()=>S())),n.stopBtn.addEventListener("click",(()=>k())),n.stepFwd.addEventListener("click",(()=>function(){if(0===a.length)return;if(s&&!r)return void x();l=Math.min(a.length-1,l+1);const e=a[l];e&&y(e.vert,e.frag),b()}())),n.stepBack.addEventListener("click",(()=>function(){if(0===a.length)return;if(s&&!r)return l=Math.max(0,l-1),void C();l=Math.max(0,l-1);const e=a[l];e&&y(e.vert,e.frag),b()}())),n.loopChk.addEventListener("change",(()=>{h=n.loopChk.checked})),n.closeBtn.addEventListener("click",(()=>{t.style.display="none"})),n.toggleBtn.addEventListener("click",(()=>{[e,t].forEach((e=>{const t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.body;t.contains(e)||t.appendChild(e)})),t.style.display="none"===t.style.display?"flex":"none"})),t.addEventListener("keydown",(e=>{"Space"===e.code&&(e.preventDefault(),s?r?L():n.pauseBtn.click():n.playBtn.click())})),document.addEventListener("keydown",(e=>{"Escape"===e.code&&"none"!==t.style.display&&(e.preventDefault(),t.style.display="none")})),n.toggleBtn.addEventListener("dblclick",(()=>{t.style.right="12px",t.style.top="52px",t.style.transform="none",t.style.width="820px",t.style.height="520px"})),0===a.length&&(v({vert:i?i.value:"attribute vec2 a_position;\\nvoid main(){ gl_Position = vec4(a_position,0.,1.); }",frag:o?o.value:"// fragment step 1",delay:3}),v({vert:i?i.value:"attribute vec2 a_position;\\nvoid main(){ gl_Position = vec4(a_position,0.,1.); }",frag:o?o.value:"// fragment step 2",delay:3})),f(),window.PerformanceManager={createStep:v,startPlayback:E,stopPlayback:k,pausePlayback:S,resumePlayback:L,steps:a,selectStepById:w,savePreset:function(e="pm-last"){try{localStorage.setItem(e,JSON.stringify(a)),I("Saved preset")}catch(e){}},loadPreset:function(e="pm-last"){try{const t=localStorage.getItem(e);if(!t)return;const n=JSON.parse(t);Array.isArray(n)&&(a=n.map((e=>({id:p(),vert:e.vert||"",frag:e.frag||"",delay:parseFloat(e.delay)||0}))),f(),I("Loaded preset"))}catch(e){}}},window.addEventListener("beforeunload",(()=>{T()})),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].forEach((n=>{document.addEventListener(n,(()=>{[e,t].forEach((e=>{const t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.body;e.parentNode&&e.parentNode.removeChild(e),t.appendChild(e)}))}))})),t.style.display="none"}(),function(){function e(){["vertCode","fragCode"].forEach((e=>{const o=document.getElementById(e);o&&function(e){const o=window.getComputedStyle(e),a=document.createElement("div");a.className="glsl-editor-wrapper";const s=document.createElement("div");s.className="glsl-editor",s.setAttribute("contenteditable","true"),s.setAttribute("spellcheck","false"),s.setAttribute("data-associated-textarea-id",e.id),e.classList.add("glsl-hidden-textarea"),function(e,t,n){const i=window.getComputedStyle(e);n.forEach((e=>{const n=i.getPropertyValue(e);n&&t.style.setProperty(e,n)}))}(e,a,["padding","margin","width","height","border","border-radius","flex","flex-grow","flex-shrink","flex-basis","min-width","min-height","max-width","max-height","box-shadow"]),s.style.fontFamily=o.getPropertyValue("font-family"),s.style.fontSize=o.getPropertyValue("font-size"),s.style.lineHeight=o.getPropertyValue("line-height"),s.style.padding=o.getPropertyValue("padding"),s.style.border="none",s.style.margin="0",e.parentNode.replaceChild(a,e),a.appendChild(e),a.appendChild(s);const r=e.value||"";t(s,r),s.addEventListener("input",(()=>{const[o,a]=n(s);let r=s.innerText.replace(/\r\n/g,"\n");e.value.endsWith("\n")&&!r.endsWith("\n")&&(r+="\n"),e.value=r,t(s,r),i(s,o,a),e.dispatchEvent(new Event("input",{bubbles:!0}))}));new MutationObserver((()=>{const o=e.value||"";if(s.innerText.replace(/\r\n/g,"\n")!==o){const[e,a]=n(s);t(s,o),i(s,e,a)}})).observe(e,{characterData:!0,childList:!0,subtree:!0,attributes:!0});let l=e.value;setInterval((()=>{if(e.value!==l){l=e.value;const[o,a]=n(s);t(s,e.value),i(s,o,a)}}),100),s.addEventListener("beforeinput",(o=>{if("insertParagraph"===o.inputType){o.preventDefault();const[a,r]=n(s);let l=s.innerText.replace(/\r\n/g,"\n");const c=l.slice(0,a)+"\n"+l.slice(r);e.value=c,t(s,c),i(s,a+1,a+1),e.dispatchEvent(new Event("input",{bubbles:!0}))}})),["dragover","dragleave"].forEach((e=>s.addEventListener(e,(e=>(e.preventDefault(),e.stopPropagation()))))),s.addEventListener("drop",(n=>{if(n.preventDefault(),n.stopPropagation(),n.dataTransfer.files.length){const i=new FileReader;i.onload=n=>{e.value=n.target.result,t(s,n.target.result),e.dispatchEvent(new Event("input",{bubbles:!0}))},i.readAsText(n.dataTransfer.files[0])}}))}(o)}))}function t(e,t){e.textContent="";const n=function(e){const t=["void","bool","int","float","vec2","vec3","vec4","mat2","mat3","mat4","bvec2","bvec3","bvec4","ivec2","ivec3","ivec4","sampler2D","samplerCube","lowp","mediump","highp"],n=["gl_Position","gl_FragCoord","gl_FragColor","gl_PointSize","radians","degrees","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","faceforward","reflect","refract","texture2D","textureCube","texture2DProj","texture2DLod","dFdx","dFdy","fwidth"],i=["time","mouse","resolution","iTime","iResolution"],o="\\b(?:"+["precision","uniform","attribute","varying","layout","const","in","out","inout","if","else","for","while","do","return","break","continue","discard"].join("|")+")\\b",a="\\b(?:"+t.join("|")+")\\b",s="\\b(?:"+n.join("|")+")\\b",r="\\b(?:"+i.join("|")+")\\b",l=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)|(\\/\\/.*)|("+o+")|("+a+")|("+s+")|(\\b\\d+(?:\\.\\d+)?(?:[eE][+-]?\\d+)?\\b)|("+r+")|(\\b[ua][A-Za-z0-9_]*\\b)|(\\b[A-Za-z_]\\w*)(?=\\s*\\()","g"),c=[];let d,u=0;for(;null!==(d=l.exec(e));){d.index>u&&c.push({type:"text",value:e.slice(u,d.index)});const[t,n,i,o,a,s,r,m,h,p]=d;let g="text";n||i?g="comment":o?g="keyword":a?g="type":s?g="builtin":r?g="number":m||h?g="variable":p&&(g="function"),c.push({type:g,value:t}),u=l.lastIndex}u<e.length&&c.push({type:"text",value:e.slice(u)});return c}(t);n.forEach((t=>{const n=document.createElement("span");"text"!==t.type&&(n.className="token-"+t.type),n.textContent=t.value,e.appendChild(n)}))}function n(e){const t=window.getSelection();let n=0,i=-1,o=-1;return function e(a){if(a)if(a.nodeType===Node.TEXT_NODE){const e=a.textContent.replace(/\r\n/g,"\n");t.anchorNode===a&&(i=n+t.anchorOffset),t.focusNode===a&&(o=n+t.focusOffset),n+=e.length}else for(let t=0;t<a.childNodes.length&&(e(a.childNodes[t]),-1===o||-1===i);t++);}(e),i<0&&(i=o=0),[Math.min(i,o),Math.max(i,o)]}function i(e,t,n){let i=0,o=null,a=0,s=null,r=0;if(function e(l){if(l&&!s)if(l.nodeType===Node.TEXT_NODE){const e=l.textContent.replace(/\r\n/g,"\n"),c=i+e.length;null===o&&t<=c&&(o=l,a=t-i),null===s&&n<=c&&(s=l,r=n-i),i=c}else for(let t=0;t<l.childNodes.length&&(e(l.childNodes[t]),!s);t++);}(e),o&&s){const e=document.createRange();e.setStart(o,a),e.setEnd(s,r);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}(),h=()=>{const e=["vertCode","fragCode"],t={"(":")","[":"]","{":"}",'"':'"',"'":"'"};function n(e,t){let n=0,i=[e],o=!1;const a=window.getSelection();for(a.removeAllRanges();i.length&&!o;){const e=i.shift();if(3===e.nodeType){const i=n+e.length;if(t<=i){const i=document.createRange();i.setStart(e,t-n),i.collapse(!0),a.addRange(i),o=!0}n=i}else 1===e.nodeType&&i.push(...e.childNodes)}}document.addEventListener("keydown",(i=>{let o=document.activeElement?.closest('.glsl-editor[contenteditable="true"]');if(!o)return;const a=o.getAttribute("data-associated-textarea-id");if(!e.includes(a))return;const s=document.getElementById(a);if(!s)return;const r=window.getSelection();let l=0;if(r.rangeCount){const e=r.getRangeAt(0),t=e.cloneRange();t.selectNodeContents(o),t.setEnd(e.endContainer,e.endOffset),l=t.toString().length}const c=l,d=s.value;if(t[i.key]&&!i.ctrlKey&&!i.metaKey&&!i.altKey){i.preventDefault();const e=i.key+t[i.key];return s.value=d.slice(0,l)+e+d.slice(c),o.innerText=s.value,o.dispatchEvent(new Event("input",{bubbles:!0})),void queueMicrotask((()=>n(o,l+1)))}if("Tab"===i.key&&!i.shiftKey)return i.preventDefault(),s.value=d.slice(0,l)+"  "+d.slice(c),o.innerText=s.value,o.dispatchEvent(new Event("input",{bubbles:!0})),void queueMicrotask((()=>n(o,l+2)));if("Enter"===i.key){i.preventDefault();const e=d.slice(0,l).split("\n"),t="\n"+(e[e.length-1].match(/^\s*/)[0]||"")+("{"===d[l-1]?"  ":"");return s.value=d.slice(0,l)+t+d.slice(c),o.innerText=s.value,o.dispatchEvent(new Event("input",{bubbles:!0})),void queueMicrotask((()=>n(o,l+t.length)))}if((i.metaKey||i.ctrlKey)&&"x"===i.key.toLowerCase()){i.preventDefault();const e=d.split("\n");let t=0,a=0;for(let n=0;n<e.length;n++){if(l<=t+e[n].length){a=n;break}t+=e[n].length+1}const r=t,c=t+e[a].length,u=e[a],m=d.slice(0,r)+d.slice(c+(a<e.length-1?1:0));return s.value=m,o.innerText=m,o.dispatchEvent(new Event("input",{bubbles:!0})),navigator.clipboard.writeText(u).catch((e=>{})),void queueMicrotask((()=>n(o,r)))}}),!0)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h();</script></body></html>